{"version":3,"file":"dwv.min.js","mappings":"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EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC35BD,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,GACllCD,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,MAK9lCO,IAAK,CACHP,IAAKL,GAtIT,SAAyBrF,GACvB,MAAMF,EAAU,EAAJE,EACZ,OAAIF,EAAMsF,IACDA,IAEFtF,CACT,IAiII6F,MAAON,GAvHX,SAA0BrF,GACxB,MAAMkG,EAAQd,EAAgB,EAC9B,IAAItF,EAAM,EACV,OAAIE,GAAKkG,IACPpG,EAAoB,GAAbE,EAAIkG,GACPpG,EAAMsF,KACDA,IAGJtF,CACT,IA8GI8F,KAAMP,GArGV,SAAyBrF,GACvB,MAAMkG,EAAQd,EAAgB,EAC9B,IAAItF,EAAM,EACV,OAAIE,GAAK,EAAIkG,IACXpG,EAAwB,GAAjBE,EAAI,EAAIkG,GACXpG,EAAMsF,KACDA,IAGJtF,CACT,KAgGEqG,SAAU,CACRT,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC1sCC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC58BC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,MAM12BQ,IAAK,CACHV,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC1kCC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC9lCC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,MAMrpCS,eAAgB,CACdX,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC7iCC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC19BC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,MAMxmCU,WAAY,CACVZ,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACpnCC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC3lCC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,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","sources":["webpack://@themetzmeier/dwv/webpack/universalModuleDefinition","webpack://@themetzmeier/dwv/external umd {\"root\":\"JSZip\",\"commonjs\":\"jszip\",\"commonjs2\":\"jszip\",\"amd\":\"jszip\"}","webpack://@themetzmeier/dwv/external umd {\"root\":\"Konva\",\"commonjs\":\"konva\",\"commonjs2\":\"konva\",\"amd\":\"konva\"}","webpack://@themetzmeier/dwv/external umd {\"root\":\"MagicWand\",\"commonjs\":\"magic-wand-tool\",\"commonjs2\":\"magic-wand-tool\",\"amd\":\"konmagic-wand-tool\"}","webpack://@themetzmeier/dwv/webpack/bootstrap","webpack://@themetzmeier/dwv/webpack/runtime/compat get default export","webpack://@themetzmeier/dwv/webpack/runtime/define property getters","webpack://@themetzmeier/dwv/webpack/runtime/hasOwnProperty shorthand","webpack://@themetzmeier/dwv/webpack/runtime/make namespace object","webpack://@themetzmeier/dwv/./src/math/index.js","webpack://@themetzmeier/dwv/./src/image/modalityLut.js","webpack://@themetzmeier/dwv/./src/utils/logger.js","webpack://@themetzmeier/dwv/./src/image/windowLevel.js","webpack://@themetzmeier/dwv/./src/image/voiLut.js","webpack://@themetzmeier/dwv/./src/image/windowLut.js","webpack://@themetzmeier/dwv/./src/image/luts.js","webpack://@themetzmeier/dwv/./src/utils/colour.js","webpack://@themetzmeier/dwv/./src/math/vector.js","webpack://@themetzmeier/dwv/./src/math/matrix.js","webpack://@themetzmeier/dwv/./src/math/point.js","webpack://@themetzmeier/dwv/./src/utils/string.js","webpack://@themetzmeier/dwv/./src/utils/array.js","webpack://@themetzmeier/dwv/./src/dicom/dictionary.js","webpack://@themetzmeier/dwv/./src/dicom/dicomTag.js","webpack://@themetzmeier/dwv/./src/dicom/dataReader.js","webpack://@themetzmeier/dwv/./src/dicom/dataElement.js","webpack://@themetzmeier/dwv/./src/dicom/dicomParser.js","webpack://@themetzmeier/dwv/./src/utils/listen.js","webpack://@themetzmeier/dwv/./src/image/iterator.js","webpack://@themetzmeier/dwv/./src/image/rsi.js","webpack://@themetzmeier/dwv/./src/image/size.js","webpack://@themetzmeier/dwv/./src/image/spacing.js","webpack://@themetzmeier/dwv/./src/image/geometry.js","webpack://@themetzmeier/dwv/./src/dicom/dicomElementsWrapper.js","webpack://@themetzmeier/dwv/./src/image/imageFactory.js","webpack://@themetzmeier/dwv/./src/image/maskFactory.js","webpack://@themetzmeier/dwv/./src/image/image.js","webpack://@themetzmeier/dwv/./src/image/viewFactory.js","webpack://@themetzmeier/dwv/./src/image/view.js","webpack://@themetzmeier/dwv/./src/image/viewMonochrome.js","webpack://@themetzmeier/dwv/./src/image/viewPaletteColor.js","webpack://@themetzmeier/dwv/./src/image/viewRgb.js","webpack://@themetzmeier/dwv/./src/image/viewYbrFull.js","webpack://@themetzmeier/dwv/./src/image/planeHelper.js","webpack://@themetzmeier/dwv/./src/gui/layerGroup.js","webpack://@themetzmeier/dwv/./src/image/maskSegmentHelper.js","webpack://@themetzmeier/dwv/./src/app/viewController.js","webpack://@themetzmeier/dwv/./src/gui/generic.js","webpack://@themetzmeier/dwv/./src/gui/viewLayer.js","webpack://@themetzmeier/dwv/./src/gui/style.js","webpack://@themetzmeier/dwv/./src/tools/drawCommands.js","webpack://@themetzmeier/dwv/./src/app/drawController.js","webpack://@themetzmeier/dwv/./src/gui/drawLayer.js","webpack://@themetzmeier/dwv/./src/gui/stage.js","webpack://@themetzmeier/dwv/./src/io/state.js","webpack://@themetzmeier/dwv/./src/utils/uri.js","webpack://@themetzmeier/dwv/./src/tools/undo.js","webpack://@themetzmeier/dwv/./src/app/toolboxController.js","webpack://@themetzmeier/dwv/./src/utils/progress.js","webpack://@themetzmeier/dwv/./src/io/urlsLoader.js","webpack://@themetzmeier/dwv/./src/utils/thread.js","webpack://@themetzmeier/dwv/./src/image/decoder.js","webpack://@themetzmeier/dwv/./src/image/dicomBufferToView.js","webpack://@themetzmeier/dwv/./src/io/memoryLoader.js","webpack://@themetzmeier/dwv/./src/image/domReader.js","webpack://@themetzmeier/dwv/./src/io/loaderList.js","webpack://@themetzmeier/dwv/./src/io/dicomDataLoader.js","webpack://@themetzmeier/dwv/./src/io/jsonTextLoader.js","webpack://@themetzmeier/dwv/./src/io/multipartLoader.js","webpack://@themetzmeier/dwv/./src/io/rawImageLoader.js","webpack://@themetzmeier/dwv/./src/io/rawVideoLoader.js","webpack://@themetzmeier/dwv/./src/io/zipLoader.js","webpack://@themetzmeier/dwv/./src/io/filesLoader.js","webpack://@themetzmeier/dwv/./src/app/loadController.js","webpack://@themetzmeier/dwv/./src/app/dataController.js","webpack://@themetzmeier/dwv/./src/utils/operator.js","webpack://@themetzmeier/dwv/./src/gui/overlayData.js","webpack://@themetzmeier/dwv/./src/tools/scrollWheel.js","webpack://@themetzmeier/dwv/./src/utils/i18n.js","webpack://@themetzmeier/dwv/./src/math/line.js","webpack://@themetzmeier/dwv/./src/math/stats.js","webpack://@themetzmeier/dwv/./src/tools/editor.js","webpack://@themetzmeier/dwv/./src/tools/draw.js","webpack://@themetzmeier/dwv/./src/math/roi.js","webpack://@themetzmeier/dwv/./src/app/defaults.js","webpack://@themetzmeier/dwv/./src/tools/roi.js","webpack://@themetzmeier/dwv/./src/math/path.js","webpack://@themetzmeier/dwv/./src/math/bucketQueue.js","webpack://@themetzmeier/dwv/./src/math/scissors.js","webpack://@themetzmeier/dwv/./src/math/circle.js","webpack://@themetzmeier/dwv/./src/math/ellipse.js","webpack://@themetzmeier/dwv/./src/math/rectangle.js","webpack://@themetzmeier/dwv/./src/image/filter.js","webpack://@themetzmeier/dwv/./src/tools/filter.js","webpack://@themetzmeier/dwv/./src/tools/index.js","webpack://@themetzmeier/dwv/./src/tools/windowLevel.js","webpack://@themetzmeier/dwv/./src/tools/scroll.js","webpack://@themetzmeier/dwv/./src/tools/zoomPan.js","webpack://@themetzmeier/dwv/./src/tools/opacity.js","webpack://@themetzmeier/dwv/./src/tools/floodfill.js","webpack://@themetzmeier/dwv/./src/tools/livewire.js","webpack://@themetzmeier/dwv/./src/tools/arrow.js","webpack://@themetzmeier/dwv/./src/tools/circle.js","webpack://@themetzmeier/dwv/./src/tools/ellipse.js","webpack://@themetzmeier/dwv/./src/tools/freeHand.js","webpack://@themetzmeier/dwv/./src/tools/protractor.js","webpack://@themetzmeier/dwv/./src/tools/rectangle.js","webpack://@themetzmeier/dwv/./src/tools/ruler.js","webpack://@themetzmeier/dwv/./src/app/application.js","webpack://@themetzmeier/dwv/./src/dicom/dataWriter.js","webpack://@themetzmeier/dwv/./src/dicom/dicomWriter.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"konva\"), require(\"jszip\"), require(\"magic-wand-tool\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"konva\", \"jszip\", \"konmagic-wand-tool\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"dwv\"] = factory(require(\"konva\"), require(\"jszip\"), require(\"magic-wand-tool\"));\n\telse\n\t\troot[\"dwv\"] = factory(root[\"Konva\"], root[\"JSZip\"], root[\"MagicWand\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE__436__, __WEBPACK_EXTERNAL_MODULE__626__, __WEBPACK_EXTERNAL_MODULE__812__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__626__;","module.exports = __WEBPACK_EXTERNAL_MODULE__436__;","module.exports = __WEBPACK_EXTERNAL_MODULE__812__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\r\n * Immutable index.\r\n * Warning: the input array is NOT cloned, modifying it will\r\n *  modify the index values.\r\n */\r\nexport class Index {\r\n\r\n  /**\r\n   * Index values.\r\n   *\r\n   * @type {number[]}\r\n   */\r\n  #values;\r\n\r\n  /**\r\n   * @param {number[]} values The index values.\r\n   */\r\n  constructor(values) {\r\n    if (!values || typeof values === 'undefined') {\r\n      throw new Error('Cannot create index with no values.');\r\n    }\r\n    if (values.length === 0) {\r\n      throw new Error('Cannot create index with empty values.');\r\n    }\r\n    const valueCheck = function (val) {\r\n      return !isNaN(val);\r\n    };\r\n    if (!values.every(valueCheck)) {\r\n      throw new Error('Cannot create index with non number values.');\r\n    }\r\n    this.#values = values;\r\n  }\r\n\r\n  /**\r\n   * Get the index value at the given array index.\r\n   *\r\n   * @param {number} i The index to get.\r\n   * @returns {number|undefined} The value or undefined if not in range.\r\n   */\r\n  get(i) {\r\n    return this.#values[i];\r\n  }\r\n\r\n  /**\r\n   * Get the length of the index.\r\n   *\r\n   * @returns {number} The length.\r\n   */\r\n  length() {\r\n    return this.#values.length;\r\n  }\r\n\r\n  /**\r\n   * Get a string representation of the Index.\r\n   *\r\n   * @returns {string} The Index as a string.\r\n   */\r\n  toString() {\r\n    return '(' + this.#values.toString() + ')';\r\n  }\r\n\r\n  /**\r\n   * Get the values of this index.\r\n   *\r\n   * @returns {number[]} The array of values.\r\n   */\r\n  getValues() {\r\n    return this.#values.slice();\r\n  }\r\n\r\n  /**\r\n   * Check if the input index can be compared to this one.\r\n   *\r\n   * @param {Index} rhs The index to compare to.\r\n   * @returns {boolean} True if both indices are comparable.\r\n   */\r\n  canCompare(rhs) {\r\n    // check input\r\n    if (!rhs) {\r\n      return false;\r\n    }\r\n    // check length\r\n    if (this.length() !== rhs.length()) {\r\n      return false;\r\n    }\r\n    // seems ok!\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Check for Index equality.\r\n   *\r\n   * @param {Index} rhs The index to compare to.\r\n   * @returns {boolean} True if both indices are equal.\r\n   */\r\n  equals(rhs) {\r\n    // check if can compare\r\n    if (!this.canCompare(rhs)) {\r\n      return false;\r\n    }\r\n    // check values\r\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\r\n      if (this.get(i) !== rhs.get(i)) {\r\n        return false;\r\n      }\r\n    }\r\n    // seems ok!\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Compare indices and return different dimensions.\r\n   *\r\n   * @param {Index} rhs The index to compare to.\r\n   * @returns {number[]} The list of different dimensions.\r\n   */\r\n  compare(rhs) {\r\n    // check if can compare\r\n    if (!this.canCompare(rhs)) {\r\n      return null;\r\n    }\r\n    // check values\r\n    const diffDims = [];\r\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\r\n      if (this.get(i) !== rhs.get(i)) {\r\n        diffDims.push(i);\r\n      }\r\n    }\r\n    return diffDims;\r\n  }\r\n\r\n  /**\r\n   * Add another index to this one.\r\n   *\r\n   * @param {Index} rhs The index to add.\r\n   * @returns {Index} The index representing the sum of both indices.\r\n   */\r\n  add(rhs) {\r\n    // check if can compare\r\n    if (!this.canCompare(rhs)) {\r\n      return null;\r\n    }\r\n    // add values\r\n    const values = [];\r\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\r\n      values.push(this.get(i) + rhs.get(i));\r\n    }\r\n    // seems ok!\r\n    return new Index(values);\r\n  }\r\n\r\n  /**\r\n   * Get the current index with a new 2D base.\r\n   *\r\n   * @param {number} i The new 0 index.\r\n   * @param {number} j The new 1 index.\r\n   * @returns {Index} The new index.\r\n   */\r\n  getWithNew2D(i, j) {\r\n    const values = [i, j];\r\n    for (let l = 2, lenl = this.length(); l < lenl; ++l) {\r\n      values.push(this.get(l));\r\n    }\r\n    return new Index(values);\r\n  }\r\n\r\n  /**\r\n   * Get a string id from the index values in the form of: '#0-1_#1-2'.\r\n   *\r\n   * @param {number[]} [dims] Optional list of dimensions to use.\r\n   * @returns {string} The string id.\r\n   */\r\n  toStringId(dims) {\r\n    if (typeof dims === 'undefined') {\r\n      dims = [];\r\n      for (let j = 0; j < this.length(); ++j) {\r\n        dims.push(j);\r\n      }\r\n    }\r\n    for (let ii = 0; ii < dims.length; ++ii) {\r\n      if (dims[ii] >= this.length()) {\r\n        throw new Error('Non valid dimension for toStringId.');\r\n      }\r\n    }\r\n    let res = '';\r\n    for (let i = 0; i < dims.length; ++i) {\r\n      if (i !== 0) {\r\n        res += '_';\r\n      }\r\n      res += '#' + dims[i] + '-' + this.get(dims[i]);\r\n    }\r\n    return res;\r\n  }\r\n\r\n} // Index class\r\n\r\n/**\r\n * Get an index with values set to 0 and the input size.\r\n *\r\n * @param {number} size The size of the index.\r\n * @returns {Index} The zero index.\r\n */\r\nexport function getZeroIndex(size) {\r\n  const values = new Array(size);\r\n  values.fill(0);\r\n  return new Index(values);\r\n}\r\n\r\n/**\r\n * Get an index from an id string in the form of: '#0-1_#1-2'\r\n * (result of index.toStringId).\r\n *\r\n * @param {string} inputStr The input string.\r\n * @returns {Index} The corresponding index.\r\n */\r\nexport function getIndexFromStringId(inputStr) {\r\n  // split ids\r\n  const strIds = inputStr.split('_');\r\n  // get the size of the index\r\n  let pointLength = 0;\r\n  let dim;\r\n  for (let i = 0; i < strIds.length; ++i) {\r\n    dim = parseInt(strIds[i].substring(1, 2), 10);\r\n    if (dim > pointLength) {\r\n      pointLength = dim;\r\n    }\r\n  }\r\n  if (pointLength === 0) {\r\n    throw new Error('No dimension found in point stringId');\r\n  }\r\n  // default values\r\n  const values = new Array(pointLength);\r\n  values.fill(0);\r\n  // get other values from the input string\r\n  for (let j = 0; j < strIds.length; ++j) {\r\n    dim = parseInt(strIds[j].substring(1, 3), 10);\r\n    const value = parseInt(strIds[j].substring(3), 10);\r\n    values[dim] = value;\r\n  }\r\n  return new Index(values);\r\n}\r\n","// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {RescaleSlopeAndIntercept} from './rsi';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Modality LUT class: compensates for any modality-specific presentation.\r\n * Typically consists of a rescale slope and intercept to\r\n * rescale the data range.\r\n *\r\n * @see https://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.11.html\r\n */\r\nexport class ModalityLut {\r\n\r\n  /**\r\n   * The rescale slope.\r\n   *\r\n   * @type {RescaleSlopeAndIntercept}\r\n   */\r\n  #rsi;\r\n\r\n  /**\r\n   * Is the RSI an identity one.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isIdRsi;\r\n\r\n  /**\r\n   * The size of the LUT array.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #length;\r\n\r\n  /**\r\n   * The internal LUT array.\r\n   *\r\n   * @type {Float32Array}\r\n   */\r\n  #lut;\r\n\r\n  /**\r\n   * @param {RescaleSlopeAndIntercept} rsi The rescale slope and intercept.\r\n   * @param {number} bitsStored The number of bits used to store the data.\r\n   */\r\n  constructor(rsi, bitsStored) {\r\n    this.#rsi = rsi;\r\n    this.#isIdRsi = rsi.isID();\r\n\r\n    this.#length = Math.pow(2, bitsStored);\r\n\r\n    // create lut if not identity RSI\r\n    if (!this.#isIdRsi) {\r\n      this.#lut = new Float32Array(this.#length);\r\n      for (let i = 0; i < this.#length; ++i) {\r\n        this.#lut[i] = this.#rsi.apply(i);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the Rescale Slope and Intercept (RSI).\r\n   *\r\n   * @returns {RescaleSlopeAndIntercept} The rescale slope and intercept object.\r\n   */\r\n  getRSI() {\r\n    return this.#rsi;\r\n  }\r\n\r\n  /**\r\n   * Get the length of the LUT array.\r\n   *\r\n   * @returns {number} The length of the LUT array.\r\n   */\r\n  getLength() {\r\n    return this.#length;\r\n  }\r\n\r\n  /**\r\n   * Get the value of the LUT at the given offset.\r\n   *\r\n   * @param {number} offset The input offset in [0,2^bitsStored] range\r\n   *   or full range for ID rescale.\r\n   * @returns {number} The float32 value of the LUT at the given offset.\r\n   */\r\n  getValue(offset) {\r\n    return this.#isIdRsi ? offset : this.#lut[offset];\r\n  }\r\n\r\n} // class ModalityLut\r\n","export const logger = {\r\n  /**\r\n   * Available log levels.\r\n   * Note: need to activate verbose level in\r\n   *   Chrome console to see DEBUG messages.\r\n   */\r\n  levels: {\r\n    TRACE: 0,\r\n    DEBUG: 1,\r\n    INFO: 2,\r\n    WARN: 3,\r\n    ERROR: 4\r\n  },\r\n\r\n  /**\r\n   * Logger level: default to WARN.\r\n   */\r\n  level: 3,\r\n\r\n  /**\r\n   * Log a trace message.\r\n   *\r\n   * @param {string} msg The message to log.\r\n   */\r\n  trace: function (msg) {\r\n    if (this.level <= this.levels.TRACE) {\r\n      console.trace(msg);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log a debug message.\r\n   * Careful: depends on console settings.\r\n   *\r\n   * @param {string} msg The message to log.\r\n   */\r\n  debug: function (msg) {\r\n    if (this.level <= this.levels.DEBUG) {\r\n      console.debug(msg);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log an info message.\r\n   *\r\n   * @param {string} msg The message to log.\r\n   */\r\n  info: function (msg) {\r\n    if (this.level <= this.levels.INFO) {\r\n      console.info(msg);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log a warn message.\r\n   *\r\n   * @param {string} msg The message to log.\r\n   */\r\n  warn: function (msg) {\r\n    if (this.level <= this.levels.WARN) {\r\n      console.warn(msg);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log an error message.\r\n   *\r\n   * @param {string} msg The message to log.\r\n   */\r\n  error: function (msg) {\r\n    if (this.level <= this.levels.ERROR) {\r\n      console.error(msg);\r\n    }\r\n  }\r\n\r\n}; // logger\r\n","import {logger} from '../utils/logger';\r\n\r\n/**\r\n * Minimum window width value.\r\n *\r\n * @see http://dicom.nema.org/dicom/2013/output/chtml/part03/sect_C.11.html#sect_C.11.2.1.2\r\n */\r\nconst minWindowWidth = 1;\r\n\r\n/**\r\n * Validate an input window width.\r\n *\r\n * @param {number} value The value to test.\r\n * @returns {number} A valid window width.\r\n */\r\nexport function validateWindowWidth(value) {\r\n  return value < minWindowWidth ? minWindowWidth : value;\r\n}\r\n\r\n/**\r\n * Window and Level also known as window width and center.\r\n */\r\nexport class WindowLevel {\r\n  /**\r\n   * The window center.\r\n   *\r\n   * @type {number}\r\n   */\r\n  center;\r\n\r\n  /**\r\n   * The window width.\r\n   *\r\n   * @type {number}\r\n   */\r\n  width;\r\n\r\n  /**\r\n   * @param {number} center The window center.\r\n   * @param {number} width The window width.\r\n   */\r\n  constructor(center, width) {\r\n    // check width\r\n    if (width < minWindowWidth) {\r\n      logger.warn('Using minimum window width since input is not valid: ' +\r\n        width);\r\n      width = minWindowWidth;\r\n    }\r\n    this.center = center;\r\n    this.width = width;\r\n  }\r\n\r\n  /**\r\n   * Check for equality.\r\n   *\r\n   * @param {WindowLevel} rhs The other object to compare to.\r\n   * @returns {boolean} True if both objects are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      typeof rhs !== 'undefined' &&\r\n      this.center === rhs.center &&\r\n      this.width === rhs.width;\r\n  }\r\n\r\n} // WindowLevel class\r\n\r\n/**\r\n * List of default window level presets.\r\n *\r\n * @type {Object.<string, Object.<string, WindowLevel>>}\r\n */\r\nexport const defaultPresets = {\r\n  CT: {\r\n    mediastinum: new WindowLevel(40, 400),\r\n    lung: new WindowLevel(-500, 1500),\r\n    bone: new WindowLevel(500, 2000),\r\n    brain: new WindowLevel(40, 80),\r\n    head: new WindowLevel(90, 350)\r\n  }\r\n};\r\n","// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {WindowLevel} from './windowLevel';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * VOI (Values of Interest) LUT class: apply window centre and width.\r\n * <br>Pseudo-code:\r\n * <pre>\r\n *  if (x &lt;= c - 0.5 - (w-1)/2), then y = ymin\r\n *  else if (x > c - 0.5 + (w-1)/2), then y = ymax,\r\n *  else y = ((x - (c - 0.5)) / (w-1) + 0.5) * (ymax - ymin) + ymin\r\n * </pre>\r\n *\r\n * @see https://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.11.2.html\r\n */\r\nexport class VoiLut {\r\n\r\n  /**\r\n   * The window and level.\r\n   *\r\n   * @type {WindowLevel}\r\n   */\r\n  #windowLevel;\r\n\r\n  /**\r\n   * Signed data offset. Defaults to 0.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #signedOffset = 0;\r\n\r\n  /**\r\n   * Output value minimum. Defaults to 0.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #ymin = 0;\r\n\r\n  /**\r\n   * Output value maximum. Defaults to 255.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #ymax = 255;\r\n\r\n  /**\r\n   * Input value minimum (calculated).\r\n   *\r\n   * @type {number}\r\n   */\r\n  #xmin = null;\r\n\r\n  /**\r\n   * Input value maximum (calculated).\r\n   *\r\n   * @type {number}\r\n   */\r\n  #xmax = null;\r\n\r\n  /**\r\n   * Window level equation slope (calculated).\r\n   *\r\n   * @type {number}\r\n   */\r\n  #slope = null;\r\n\r\n  /**\r\n   * Window level equation intercept (calculated).\r\n   *\r\n   * @type {number}\r\n   */\r\n  #inter = null;\r\n\r\n  /**\r\n   * @param {WindowLevel} wl The window center and width.\r\n   */\r\n  constructor(wl) {\r\n    this.#windowLevel = wl;\r\n    this.#init();\r\n  }\r\n\r\n  /**\r\n   * Get the window and level.\r\n   *\r\n   * @returns {WindowLevel} The window center and width.\r\n   */\r\n  getWindowLevel() {\r\n    return this.#windowLevel;\r\n  }\r\n\r\n  /**\r\n   * Initialise members. Called at construction.\r\n   *\r\n   */\r\n  #init() {\r\n    const center = this.#windowLevel.center;\r\n    const width = this.#windowLevel.width;\r\n    const c = center + this.#signedOffset;\r\n    // from the standard\r\n    this.#xmin = c - 0.5 - ((width - 1) / 2);\r\n    this.#xmax = c - 0.5 + ((width - 1) / 2);\r\n    // develop the equation:\r\n    // y = ( ( x - (c - 0.5) ) / (w-1) + 0.5 ) * (ymax - ymin) + ymin\r\n    // y = ( x / (w-1) ) * (ymax - ymin) +\r\n    //     ( -(c - 0.5) / (w-1) + 0.5 ) * (ymax - ymin) + ymin\r\n    this.#slope = (this.#ymax - this.#ymin) / (width - 1);\r\n    this.#inter = (-(c - 0.5) / (width - 1) + 0.5) *\r\n      (this.#ymax - this.#ymin) + this.#ymin;\r\n  }\r\n\r\n  /**\r\n   * Set the signed offset.\r\n   *\r\n   * @param {number} offset The signed data offset,\r\n   *   typically: slope * ( size / 2).\r\n   */\r\n  setSignedOffset(offset) {\r\n    this.#signedOffset = offset;\r\n    // re-initialise\r\n    this.#init();\r\n  }\r\n\r\n  /**\r\n   * Apply the window level on an input value.\r\n   *\r\n   * @param {number} value The value to rescale as an integer.\r\n   * @returns {number} The leveled value, in the\r\n   *  [ymin, ymax] range (default [0,255]).\r\n   */\r\n  apply(value) {\r\n    if (value <= this.#xmin) {\r\n      return this.#ymin;\r\n    } else if (value > this.#xmax) {\r\n      return this.#ymax;\r\n    } else {\r\n      return (value * this.#slope) + this.#inter;\r\n    }\r\n  }\r\n\r\n} // class VoiLut\r\n","// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ModalityLut} from './modalityLut';\r\nimport {VoiLut} from './voiLut';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Window LUT class: combines a modality LUT and a VOI LUT.\r\n */\r\nexport class WindowLut {\r\n\r\n  /**\r\n   * The modality LUT.\r\n   *\r\n   * @type {ModalityLut}\r\n   */\r\n  #modalityLut;\r\n\r\n  /**\r\n   * The VOI LUT.\r\n   *\r\n   * @type {VoiLut}\r\n   */\r\n  #voiLut;\r\n\r\n  /**\r\n   * The internal LUT array: Uint8ClampedArray clamps between 0 and 255.\r\n   *\r\n   * @type {Uint8ClampedArray}\r\n   */\r\n  #lut;\r\n\r\n  /**\r\n   * Shift for signed data.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #signedShift = 0;\r\n\r\n  /**\r\n   * Is the RSI discrete.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isDiscrete = true;\r\n\r\n  /**\r\n   * Construct a window LUT object, VOI LUT is set with\r\n   *   the 'setVoiLut' method.\r\n   *\r\n   * @param {ModalityLut} modalityLut The associated rescale LUT.\r\n   * @param {boolean} isSigned Flag to know if the data is signed or not.\r\n   * @param {boolean} isDiscrete Flag to know if the input data is discrete.\r\n   */\r\n  constructor(modalityLut, isSigned, isDiscrete) {\r\n    this.#modalityLut = modalityLut;\r\n\r\n    if (isSigned) {\r\n      const size = this.#modalityLut.getLength();\r\n      this.#signedShift = size / 2;\r\n    } else {\r\n      this.#signedShift = 0;\r\n    }\r\n\r\n    this.#isDiscrete = isDiscrete;\r\n  }\r\n\r\n  /**\r\n   * Get the VOI LUT.\r\n   *\r\n   * @returns {VoiLut} The VOI LUT.\r\n   */\r\n  getVoiLut() {\r\n    return this.#voiLut;\r\n  }\r\n\r\n  /**\r\n   * Get the modality LUT.\r\n   *\r\n   * @returns {ModalityLut} The modality LUT.\r\n   */\r\n  getModalityLut() {\r\n    return this.#modalityLut;\r\n  }\r\n\r\n  /**\r\n   * Set the VOI LUT.\r\n   *\r\n   * @param {VoiLut} lut The VOI LUT.\r\n   */\r\n  setVoiLut(lut) {\r\n    // store the window values\r\n    this.#voiLut = lut;\r\n\r\n    // possible signed shift (LUT indices are positive)\r\n    this.#voiLut.setSignedOffset(\r\n      this.#modalityLut.getRSI().getSlope() * this.#signedShift);\r\n\r\n    // create lut if not continous\r\n    if (this.#isDiscrete) {\r\n      const size = this.#modalityLut.getLength();\r\n      // use clamped array (polyfilled in env.js)\r\n      this.#lut = new Uint8ClampedArray(size);\r\n      // by default WindowLevel returns a value in the [0,255] range\r\n      // this is ok with regular Arrays and ClampedArray.\r\n      for (let i = 0; i < size; ++i) {\r\n        this.#lut[i] = this.#voiLut.apply(this.#modalityLut.getValue(i));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the value of the LUT at the given offset.\r\n   *\r\n   * @param {number} offset The input offset in [0,2^bitsStored] range\r\n   *   for discrete data or full range for non discrete.\r\n   * @returns {number} The integer value (default [0,255]) of the LUT\r\n   *   at the given offset.\r\n   */\r\n  getValue(offset) {\r\n    if (this.#isDiscrete) {\r\n      return this.#lut[offset + this.#signedShift];\r\n    } else {\r\n      return Math.floor(this.#voiLut.apply(offset + this.#signedShift));\r\n    }\r\n  }\r\n\r\n} // class WindowLut\r\n","/**\r\n * Lookup tables for image colour display.\r\n */\r\n\r\nconst lut_range_max = 256;\r\n\r\n/**\r\n * Build a LUT of size lut_range_max.\r\n *\r\n * @param {Function} func The i to lut function.\r\n * @returns {Array} The LUT.\r\n */\r\nfunction buildLut(func) {\r\n  const lut = [];\r\n  for (let i = 0; i < lut_range_max; ++i) {\r\n    lut.push(func(i));\r\n  }\r\n  return lut;\r\n}\r\n\r\n/**\r\n * Ramp to lut_range_max minus one on the first third values.\r\n *\r\n * @param {number} i The input index.\r\n * @returns {number} The lut value.\r\n */\r\nfunction toMaxFirstThird(i) {\r\n  const val = i * 3;\r\n  if (val > lut_range_max - 1) {\r\n    return lut_range_max - 1;\r\n  }\r\n  return val;\r\n}\r\n\r\n/**\r\n * Ramp to lut_range_max minus one on the second third values.\r\n *  otherwise return 0 for the first third and\r\n *  lut_range_max minus one for the last third.\r\n *\r\n * @param {number} i The input index.\r\n * @returns {number} The lut value.\r\n */\r\nfunction toMaxSecondThird(i) {\r\n  const third = lut_range_max / 3;\r\n  let val = 0;\r\n  if (i >= third) {\r\n    val = (i - third) * 3;\r\n    if (val > lut_range_max - 1) {\r\n      return lut_range_max - 1;\r\n    }\r\n  }\r\n  return val;\r\n}\r\n\r\n/**\r\n * Ramp to lut_range_max minus one on the last third values.\r\n *  otherwise return 0.\r\n *\r\n * @param {number} i The input index.\r\n * @returns {number} The lut value.\r\n */\r\nfunction toMaxThirdThird(i) {\r\n  const third = lut_range_max / 3;\r\n  let val = 0;\r\n  if (i >= 2 * third) {\r\n    val = (i - 2 * third) * 3;\r\n    if (val > lut_range_max - 1) {\r\n      return lut_range_max - 1;\r\n    }\r\n  }\r\n  return val;\r\n}\r\n\r\n/**\r\n * Identity, returns i.\r\n *\r\n * @param {number} i The input index.\r\n * @returns {number} The lut value.\r\n */\r\nfunction id(i) {\r\n  return i;\r\n}\r\n\r\n/**\r\n * Returns lut_range_max minus one minus i.\r\n *\r\n * @param {number} i The input index.\r\n * @returns {number} The lut value.\r\n */\r\nfunction invId(i) {\r\n  return (lut_range_max - 1) - i;\r\n}\r\n\r\n/**\r\n * Colour map: red, green and blue components\r\n * to associate with intensity values.\r\n */\r\nexport class ColourMap {\r\n  /**\r\n   * Red component: 256 values in the [0, 255] range.\r\n   *\r\n   * @type {number[]}\r\n   */\r\n  red;\r\n  /**\r\n   * Green component: 256 values in the [0, 255] range.\r\n   *\r\n   * @type {number[]}\r\n   */\r\n  green;\r\n  /**\r\n   * Blue component: 256 values in the [0, 255] range.\r\n   *\r\n   * @type {number[]}\r\n   */\r\n  blue;\r\n\r\n  /**\r\n   * @param {number[]} red Red component.\r\n   * @param {number[]} green Green component.\r\n   * @param {number[]} blue Blue component.\r\n   */\r\n  constructor(red, green, blue) {\r\n    this.red = red;\r\n    this.green = green;\r\n    this.blue = blue;\r\n  }\r\n}\r\n\r\n/**\r\n * List of available lookup tables (lut).\r\n *\r\n * @type {Object<string, ColourMap>}\r\n */\r\nexport const luts = {\r\n  // plain\r\n  plain: {\r\n    red: buildLut(id),\r\n    green: buildLut(id),\r\n    blue: buildLut(id)\r\n  },\r\n\r\n  // inverse plain\r\n  invPlain: {\r\n    red: buildLut(invId),\r\n    green: buildLut(invId),\r\n    blue: buildLut(invId)\r\n  },\r\n\r\n  // rainbow\r\n  /* eslint-disable max-len */\r\n  rainbow: {\r\n    blue: [0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152, 156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204, 208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 255, 247, 239, 231, 223, 215, 207, 199, 191, 183, 175, 167, 159, 151, 143, 135, 127, 119, 111, 103, 95, 87, 79, 71, 63, 55, 47, 39, 31, 23, 15, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    green: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96, 104, 112, 120, 128, 136, 144, 152, 160, 168, 176, 184, 192, 200, 208, 216, 224, 232, 240, 248, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 253, 251, 249, 247, 245, 243, 241, 239, 237, 235, 233, 231, 229, 227, 225, 223, 221, 219, 217, 215, 213, 211, 209, 207, 205, 203, 201, 199, 197, 195, 193, 192, 189, 186, 183, 180, 177, 174, 171, 168, 165, 162, 159, 156, 153, 150, 147, 144, 141, 138, 135, 132, 129, 126, 123, 120, 117, 114, 111, 108, 105, 102, 99, 96, 93, 90, 87, 84, 81, 78, 75, 72, 69, 66, 63, 60, 57, 54, 51, 48, 45, 42, 39, 36, 33, 30, 27, 24, 21, 18, 15, 12, 9, 6, 3],\r\n    red: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 62, 60, 58, 56, 54, 52, 50, 48, 46, 44, 42, 40, 38, 36, 34, 32, 30, 28, 26, 24, 22, 20, 18, 16, 14, 12, 10, 8, 6, 4, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152, 156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204, 208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]\r\n  },\r\n  /* eslint-enable max-len */\r\n\r\n  // hot\r\n  hot: {\r\n    red: buildLut(toMaxFirstThird),\r\n    green: buildLut(toMaxSecondThird),\r\n    blue: buildLut(toMaxThirdThird)\r\n  },\r\n\r\n  // hot iron\r\n  /* eslint-disable max-len */\r\n  hot_iron: {\r\n    red: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164, 166, 168, 170, 172, 174, 176, 178, 180, 182, 184, 186, 188, 190, 192, 194, 196, 198, 200, 202, 204, 206, 208, 210, 212, 214, 216, 218, 220, 222, 224, 226, 228, 230, 232, 234, 236, 238, 240, 242, 244, 246, 248, 250, 252, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\r\n    green: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164, 166, 168, 170, 172, 174, 176, 178, 180, 182, 184, 186, 188, 190, 192, 194, 196, 198, 200, 202, 204, 206, 208, 210, 212, 214, 216, 218, 220, 222, 224, 226, 228, 230, 232, 234, 236, 238, 240, 242, 244, 246, 248, 250, 252, 255],\r\n    blue: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152, 156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204, 208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 255]\r\n  },\r\n  /* eslint-enable max-len */\r\n\r\n  // pet\r\n  /* eslint-disable max-len */\r\n  pet: {\r\n    red: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164, 166, 168, 170, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\r\n    green: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 128, 126, 124, 122, 120, 118, 116, 114, 112, 110, 108, 106, 104, 102, 100, 98, 96, 94, 92, 90, 88, 86, 84, 82, 80, 78, 76, 74, 72, 70, 68, 66, 64, 63, 61, 59, 57, 55, 53, 51, 49, 47, 45, 43, 41, 39, 37, 35, 33, 31, 29, 27, 25, 23, 21, 19, 17, 15, 13, 11, 9, 7, 5, 3, 1, 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164, 166, 168, 170, 172, 174, 176, 178, 180, 182, 184, 186, 188, 190, 192, 194, 196, 198, 200, 202, 204, 206, 208, 210, 212, 214, 216, 218, 220, 222, 224, 226, 228, 230, 232, 234, 236, 238, 240, 242, 244, 246, 248, 250, 252, 255],\r\n    blue: [0, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 252, 248, 244, 240, 236, 232, 228, 224, 220, 216, 212, 208, 204, 200, 196, 192, 188, 184, 180, 176, 172, 168, 164, 160, 156, 152, 148, 144, 140, 136, 132, 128, 124, 120, 116, 112, 108, 104, 100, 96, 92, 88, 84, 80, 76, 72, 68, 64, 60, 56, 52, 48, 44, 40, 36, 32, 28, 24, 20, 16, 12, 8, 4, 0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 85, 89, 93, 97, 101, 105, 109, 113, 117, 121, 125, 129, 133, 137, 141, 145, 149, 153, 157, 161, 165, 170, 174, 178, 182, 186, 190, 194, 198, 202, 206, 210, 214, 218, 222, 226, 230, 234, 238, 242, 246, 250, 255]\r\n  },\r\n  /* eslint-enable max-len */\r\n\r\n  // hot metal blue\r\n  /* eslint-disable max-len */\r\n  hot_metal_blue: {\r\n    red: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 6, 9, 12, 15, 18, 21, 24, 26, 29, 32, 35, 38, 41, 44, 47, 50, 52, 55, 57, 59, 62, 64, 66, 69, 71, 74, 76, 78, 81, 83, 85, 88, 90, 93, 96, 99, 102, 105, 108, 111, 114, 116, 119, 122, 125, 128, 131, 134, 137, 140, 143, 146, 149, 152, 155, 158, 161, 164, 166, 169, 172, 175, 178, 181, 184, 187, 190, 194, 198, 201, 205, 209, 213, 217, 221, 224, 228, 232, 236, 240, 244, 247, 251, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\r\n    green: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 4, 6, 8, 9, 11, 13, 15, 17, 19, 21, 23, 24, 26, 28, 30, 32, 34, 36, 38, 40, 41, 43, 45, 47, 49, 51, 53, 55, 56, 58, 60, 62, 64, 66, 68, 70, 72, 73, 75, 77, 79, 81, 83, 85, 87, 88, 90, 92, 94, 96, 98, 100, 102, 104, 105, 107, 109, 111, 113, 115, 117, 119, 120, 122, 124, 126, 128, 130, 132, 134, 136, 137, 139, 141, 143, 145, 147, 149, 151, 152, 154, 156, 158, 160, 162, 164, 166, 168, 169, 171, 173, 175, 177, 179, 181, 183, 184, 186, 188, 190, 192, 194, 196, 198, 200, 201, 203, 205, 207, 209, 211, 213, 215, 216, 218, 220, 222, 224, 226, 228, 229, 231, 233, 235, 237, 239, 240, 242, 244, 246, 248, 250, 251, 253, 255],\r\n    blue: [0, 2, 4, 6, 8, 10, 12, 14, 16, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 184, 186, 188, 190, 192, 194, 196, 198, 200, 197, 194, 191, 188, 185, 182, 179, 176, 174, 171, 168, 165, 162, 159, 156, 153, 150, 144, 138, 132, 126, 121, 115, 109, 103, 97, 91, 85, 79, 74, 68, 62, 56, 50, 47, 44, 41, 38, 35, 32, 29, 26, 24, 21, 18, 15, 12, 9, 6, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 6, 9, 12, 15, 18, 21, 24, 26, 29, 32, 35, 38, 41, 44, 47, 50, 53, 56, 59, 62, 65, 68, 71, 74, 76, 79, 82, 85, 88, 91, 94, 97, 100, 103, 106, 109, 112, 115, 118, 121, 124, 126, 129, 132, 135, 138, 141, 144, 147, 150, 153, 156, 159, 162, 165, 168, 171, 174, 176, 179, 182, 185, 188, 191, 194, 197, 200, 203, 206, 210, 213, 216, 219, 223, 226, 229, 232, 236, 239, 242, 245, 249, 252, 255]\r\n  },\r\n  /* eslint-enable max-len */\r\n\r\n  // pet 20 step\r\n  /* eslint-disable max-len */\r\n  pet_20step: {\r\n    red: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\r\n    green: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\r\n    blue: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]\r\n  }\r\n  /* eslint-enable max-len */\r\n};\r\n","// example implementation: dcmtk/dcmiod/libsrc/cielabutil.cc\r\n// https://github.com/DCMTK/dcmtk/blob/DCMTK-3.6.6/dcmiod/libsrc/cielabutil.cc\r\n\r\n/**\r\n * Check if two rgb objects are equal.\r\n *\r\n * @param {object} c1 The first colour.\r\n * @param {object} c2 The second colour.\r\n * @returns {boolean} True if both colour are equal.\r\n */\r\nexport function isEqualRgb(c1, c2) {\r\n  return c1 !== null &&\r\n    c2 !== null &&\r\n    typeof c1 !== 'undefined' &&\r\n    typeof c2 !== 'undefined' &&\r\n    c1.r === c2.r &&\r\n    c1.g === c2.g &&\r\n    c1.b === c2.b;\r\n}\r\n\r\n/**\r\n * Convert YBR to RGB.\r\n *\r\n * @see http://dicom.nema.org/dicom/2013/output/chtml/part03/sect_C.7.html#sect_C.7.6.3.1.2\r\n * @see https://en.wikipedia.org/wiki/YCbCr#JPEG_conversion\r\n * @param {number} y The Y component.\r\n * @param {number} cb The Cb component.\r\n * @param {number} cr The Cr component.\r\n * @returns {object} RGB equivalent as {r,g,b}.\r\n */\r\nexport function ybrToRgb(y, cb, cr) {\r\n  return {\r\n    r: y + 1.402 * (cr - 128),\r\n    g: y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128),\r\n    b: y + 1.772 * (cb - 128)\r\n  };\r\n}\r\n\r\n/**\r\n * Convert a hex color into RGB.\r\n *\r\n * @param {string} hexStr The hex color as '#ab01ef'.\r\n * @returns {object} The RGB values as {r,g,b}.\r\n */\r\nexport function hexToRgb(hexStr) {\r\n  return {\r\n    r: parseInt(hexStr.substring(1, 3), 16),\r\n    g: parseInt(hexStr.substring(3, 5), 16),\r\n    b: parseInt(hexStr.substring(5, 7), 16)\r\n  };\r\n}\r\n\r\n/**\r\n * Convert RGB to its hex equivalent.\r\n *\r\n * @param {object} rgb The RGB object as {r,g,b}.\r\n * @returns {string} A string representing the hex color as '#ab01ef'.\r\n */\r\nexport function rgbToHex(rgb) {\r\n  return '#' +\r\n    ((1 << 24) + (rgb.r << 16) + (rgb.g << 8) + rgb.b).toString(16).slice(1);\r\n}\r\n\r\n/**\r\n * Get the brightness of a RGB colour: calculates\r\n * the luma (Y) of the YIQ colour space.\r\n *\r\n * @see https://en.wikipedia.org/wiki/YIQ#From_RGB_to_YIQ\r\n * @param {object} rgbTriplet RGB triplet.\r\n * @returns {number} The brightness ([0,1]).\r\n */\r\nexport function getBrightness(rgbTriplet) {\r\n  // 0.001172549 = 0.299 / 255\r\n  // 0.002301961 = 0.587 / 255\r\n  // 0.000447059 = 0.114 / 255\r\n  return rgbTriplet.r * 0.001172549 +\r\n    rgbTriplet.g * 0.002301961 +\r\n    rgbTriplet.b * 0.000447059;\r\n}\r\n\r\n/**\r\n * Check if a colour given in hexadecimal format is dark.\r\n *\r\n * @param {string} hexColour The colour (as '#ab01ef').\r\n * @returns {boolean} True if the colour is dark (brightness < 0.5).\r\n */\r\nexport function isDarkColour(hexColour) {\r\n  return getBrightness(hexToRgb(hexColour)) < 0.5;\r\n}\r\n\r\n/**\r\n * Get the shadow colour of an input colour.\r\n *\r\n * @param {string} hexColour The colour (as '#ab01ef').\r\n * @returns {string} The shadow colour (white or black).\r\n */\r\nexport function getShadowColour(hexColour) {\r\n  return isDarkColour(hexColour) ? '#fff' : '#000';\r\n}\r\n\r\n/**\r\n * Unsigned int CIE LAB value ([0, 65535]) to CIE LAB value\r\n *   (L: [0, 100], a: [-128, 127], b: [-128, 127]).\r\n *\r\n * @param {object} triplet CIE LAB triplet as {l,a,b} with unsigned range.\r\n * @returns {object} CIE LAB triplet as {l,a,b} with CIE LAB range.\r\n */\r\nexport function uintLabToLab(triplet) {\r\n  // 0.001525902 = 100 / 65535\r\n  // 0.003891051 = 255 / 65535\r\n  return {\r\n    l: 0.001525902 * triplet.l,\r\n    a: 0.003891051 * triplet.a - 128,\r\n    b: 0.003891051 * triplet.b - 128,\r\n  };\r\n}\r\n\r\n/**\r\n * CIE LAB value (L: [0, 100], a: [-128, 127], b: [-128, 127]) to\r\n *   unsigned int CIE LAB ([0, 65535]).\r\n *\r\n * @param {object} triplet CIE XYZ triplet as {x,y,z} with CIE LAB range.\r\n * @returns {object} CIE LAB triplet as {l,a,b} with unsigned range.\r\n */\r\nexport function labToUintLab(triplet) {\r\n  // 655.35 = 65535 / 100\r\n  // aUint = (a + 128) * 65535 / 255\r\n  // 257 = 65535 / 255\r\n  // 32896 = 257 * 128\r\n  return {\r\n    l: 655.35 * triplet.l,\r\n    a: 257 * triplet.a + 32896,\r\n    b: 257 * triplet.b + 32896,\r\n  };\r\n}\r\n\r\n/**\r\n * CIE Standard Illuminant D65, standard 2 observer.\r\n *\r\n * @see https://en.wikipedia.org/wiki/Illuminant_D65\r\n */\r\nconst d65 = {\r\n  x: 95.0489,\r\n  y: 100,\r\n  z: 108.884\r\n};\r\n\r\n/**\r\n * Convert CIE LAB to CIE XYZ (standard illuminant D65, 2degree 1931).\r\n *\r\n * @see https://en.wikipedia.org/wiki/CIELAB_color_space#From_CIELAB_to_CIEXYZ\r\n * @param {object} triplet CIE LAB triplet as {l,a,b}.\r\n * @returns {object} CIE XYZ triplet as {x,y,z}.\r\n */\r\nexport function cielabToCiexyz(triplet) {\r\n  /**\r\n   * Apply the inverse lab function.\r\n   *\r\n   * @param {number} x The input value.\r\n   * @returns {number} The result\r\n   */\r\n  function invLabFunc(x) {\r\n    let res = null;\r\n    // delta = 6 / 29 = 0.206896552\r\n    if (x > 0.206896552) {\r\n      res = Math.pow(x, 3);\r\n    } else {\r\n      // 0.128418549 = 3 * delta^2\r\n      // 0.017712903 = 3 * delta^2 * (4 / 29)\r\n      res = 0.128418549 * x - 0.017712903;\r\n    }\r\n    return res;\r\n  }\r\n\r\n  const illuminant = d65;\r\n  const l0 = (triplet.l + 16) / 116;\r\n\r\n  return {\r\n    x: illuminant.x * invLabFunc(l0 + triplet.a / 500),\r\n    y: illuminant.y * invLabFunc(l0),\r\n    z: illuminant.z * invLabFunc(l0 - triplet.b / 200)\r\n  };\r\n}\r\n\r\n/**\r\n * Convert CIE XYZ to CIE LAB (standard illuminant D65, 2degree 1931).\r\n *\r\n * @see https://en.wikipedia.org/wiki/CIELAB_color_space#From_CIEXYZ_to_CIELAB\r\n * @param {object} triplet CIE XYZ triplet as {x,y,z}.\r\n * @returns {object} CIE LAB triplet as {l,a,b}.\r\n */\r\nexport function ciexyzToCielab(triplet) {\r\n  /**\r\n   * Apply the lab function.\r\n   *\r\n   * @param {number} x The input value.\r\n   * @returns {number} The result\r\n   */\r\n  function labFunc(x) {\r\n    let res = null;\r\n    // delta = 6 / 29 = 0.206896552\r\n    // delta^3 = 0.008856452\r\n    if (x > 0.008856452) {\r\n      res = Math.pow(x, 0.333333333);\r\n    } else {\r\n      // 7.787037037 = 1 / 3 * delta^2\r\n      // 0.137931034 = 4 / 29\r\n      res = 7.787037037 * x + 0.137931034;\r\n    }\r\n    return res;\r\n  }\r\n\r\n  const illuminant = d65;\r\n  const fy = labFunc(triplet.y / illuminant.y);\r\n\r\n  return {\r\n    l: 116 * fy - 16,\r\n    a: 500 * (labFunc(triplet.x / illuminant.x) - fy),\r\n    b: 200 * (fy - labFunc(triplet.z / illuminant.z))\r\n  };\r\n}\r\n\r\n/**\r\n * Convert CIE XYZ to sRGB.\r\n *\r\n * @see https://en.wikipedia.org/wiki/SRGB#From_CIE_XYZ_to_sRGB\r\n * @param {object} triplet CIE XYZ triplet as {x,y,z}.\r\n * @returns {object} sRGB triplet as {r,g,b}.\r\n */\r\nexport function ciexyzToSrgb(triplet) {\r\n  /**\r\n   * Apply the gamma function.\r\n   *\r\n   * @param {number} x The input value.\r\n   * @returns {number} The result\r\n   */\r\n  function gammaFunc(x) {\r\n    let res = null;\r\n    if (x <= 0.0031308) {\r\n      res = 12.92 * x;\r\n    } else {\r\n      // 0.416666667 = 1 / 2.4\r\n      res = 1.055 * Math.pow(x, 0.416666667) - 0.055;\r\n    }\r\n    // clip [0,1]\r\n    return Math.min(1, Math.max(0, res));\r\n  }\r\n\r\n  const x = triplet.x / 100;\r\n  const y = triplet.y / 100;\r\n  const z = triplet.z / 100;\r\n\r\n  return {\r\n    r: Math.round(255 * gammaFunc(3.2406 * x - 1.5372 * y - 0.4986 * z)),\r\n    g: Math.round(255 * gammaFunc(-0.9689 * x + 1.8758 * y + 0.0415 * z)),\r\n    b: Math.round(255 * gammaFunc(0.0557 * x - 0.2040 * y + 1.0570 * z))\r\n  };\r\n}\r\n\r\n/**\r\n * Convert sRGB to CIE XYZ.\r\n *\r\n * @see https://en.wikipedia.org/wiki/SRGB#From_sRGB_to_CIE_XYZ\r\n * @param {object} triplet sRGB triplet as {r,g,b}.\r\n * @returns {object} CIE XYZ triplet as {x,y,z}.\r\n */\r\nexport function srgbToCiexyz(triplet) {\r\n  /**\r\n   * Apply the inverse gamma function.\r\n   *\r\n   * @param {number} x The input value.\r\n   * @returns {number} The result\r\n   */\r\n  function invGammaFunc(x) {\r\n    let res = null;\r\n    if (x <= 0.04045) {\r\n      res = x / 12.92;\r\n    } else {\r\n      res = Math.pow((x + 0.055) / 1.055, 2.4);\r\n    }\r\n    return res;\r\n  }\r\n\r\n  const rl = invGammaFunc(triplet.r / 255);\r\n  const gl = invGammaFunc(triplet.g / 255);\r\n  const bl = invGammaFunc(triplet.b / 255);\r\n\r\n  return {\r\n    x: 100 * (0.4124 * rl + 0.3576 * gl + 0.1805 * bl),\r\n    y: 100 * (0.2126 * rl + 0.7152 * gl + 0.0722 * bl),\r\n    z: 100 * (0.0193 * rl + 0.1192 * gl + 0.9505 * bl)\r\n  };\r\n}\r\n\r\n/**\r\n * Convert CIE LAB to sRGB (standard illuminant D65).\r\n *\r\n * @param {object} triplet CIE LAB triplet as {l,a,b}.\r\n * @returns {object} sRGB triplet as {r,g,b}.\r\n */\r\nexport function cielabToSrgb(triplet) {\r\n  return ciexyzToSrgb(cielabToCiexyz(triplet));\r\n}\r\n\r\n/**\r\n * Convert sRGB to CIE LAB (standard illuminant D65).\r\n *\r\n * @param {object} triplet sRGB triplet as {r,g,b}.\r\n * @returns {object} CIE LAB triplet as {l,a,b}.\r\n */\r\nexport function srgbToCielab(triplet) {\r\n  return ciexyzToCielab(srgbToCiexyz(triplet));\r\n}\r\n\r\n/**\r\n * Get the hex code of a string colour for a colour used in pre dwv v0.17.\r\n *\r\n * @param {string} name The name of a colour.\r\n * @returns {string} The hex representing the colour.\r\n */\r\nexport function colourNameToHex(name) {\r\n  // default colours used in dwv version < 0.17\r\n  const dict = {\r\n    Yellow: '#ffff00',\r\n    Red: '#ff0000',\r\n    White: '#ffffff',\r\n    Green: '#008000',\r\n    Blue: '#0000ff',\r\n    Lime: '#00ff00',\r\n    Fuchsia: '#ff00ff',\r\n    Black: '#000000'\r\n  };\r\n  let res = '#ffff00';\r\n  if (typeof dict[name] !== 'undefined') {\r\n    res = dict[name];\r\n  }\r\n  return res;\r\n}\r\n","/**\r\n * Immutable 3D vector.\r\n */\r\nexport class Vector3D {\r\n\r\n  /**\r\n   * X coordinate.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #x;\r\n\r\n  /**\r\n   * Y coordinate.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #y;\r\n\r\n  /**\r\n   * Z coordinate.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #z;\r\n\r\n  /**\r\n   * @param {number} x The X component of the vector.\r\n   * @param {number} y The Y component of the vector.\r\n   * @param {number} z The Z component of the vector.\r\n   */\r\n  constructor(x, y, z) {\r\n    this.#x = x;\r\n    this.#y = y;\r\n    this.#z = z;\r\n  }\r\n\r\n  /**\r\n   * Get the X component of the vector.\r\n   *\r\n   * @returns {number} The X component of the vector.\r\n   */\r\n  getX() {\r\n    return this.#x;\r\n  }\r\n\r\n  /**\r\n   * Get the Y component of the vector.\r\n   *\r\n   * @returns {number} The Y component of the vector.\r\n   */\r\n  getY() {\r\n    return this.#y;\r\n  }\r\n\r\n  /**\r\n   * Get the Z component of the vector.\r\n   *\r\n   * @returns {number} The Z component of the vector.\r\n   */\r\n  getZ() {\r\n    return this.#z;\r\n  }\r\n\r\n  /**\r\n   * Check for Vector3D equality.\r\n   *\r\n   * @param {Vector3D} rhs The other vector to compare to.\r\n   * @returns {boolean} True if both vectors are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      this.getX() === rhs.getX() &&\r\n      this.getY() === rhs.getY() &&\r\n      this.getZ() === rhs.getZ();\r\n  }\r\n\r\n  /**\r\n   * Get a string representation of the Vector3D.\r\n   *\r\n   * @returns {string} The vector as a string.\r\n   */\r\n  toString() {\r\n    return '(' + this.getX() +\r\n      ', ' + this.getY() +\r\n      ', ' + this.getZ() + ')';\r\n  }\r\n\r\n  /**\r\n   * Get the norm of the vector.\r\n   *\r\n   * @returns {number} The norm.\r\n   */\r\n  norm() {\r\n    return Math.sqrt(\r\n      (this.getX() * this.getX()) +\r\n      (this.getY() * this.getY()) +\r\n      (this.getZ() * this.getZ())\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the cross product with another Vector3D, ie the\r\n   * vector that is perpendicular to both a and b.\r\n   * If both vectors are parallel, the cross product is a zero vector.\r\n   *\r\n   * @see https://en.wikipedia.org/wiki/Cross_product\r\n   * @param {Vector3D} vector3D The input vector.\r\n   * @returns {Vector3D} The result vector.\r\n   */\r\n  crossProduct(vector3D) {\r\n    return new Vector3D(\r\n      (this.getY() * vector3D.getZ()) - (vector3D.getY() * this.getZ()),\r\n      (this.getZ() * vector3D.getX()) - (vector3D.getZ() * this.getX()),\r\n      (this.getX() * vector3D.getY()) - (vector3D.getX() * this.getY()));\r\n  }\r\n\r\n  /**\r\n   * Get the dot product with another Vector3D.\r\n   *\r\n   * @see https://en.wikipedia.org/wiki/Dot_product\r\n   * @param {Vector3D} vector3D The input vector.\r\n   * @returns {number} The dot product.\r\n   */\r\n  dotProduct(vector3D) {\r\n    return (this.getX() * vector3D.getX()) +\r\n      (this.getY() * vector3D.getY()) +\r\n      (this.getZ() * vector3D.getZ());\r\n  }\r\n\r\n} // Vector3D class","import {Vector3D} from './vector';\r\nimport {Point3D} from './point';\r\nimport {Index} from './index';\r\nimport {logger} from '../utils/logger';\r\n\r\n// Number.EPSILON is difference between 1 and the smallest\r\n// floating point number greater than 1\r\n// -> ~2e-16\r\n// BIG_EPSILON -> ~2e-12\r\nexport const BIG_EPSILON = Number.EPSILON * 1e4;\r\n// 'real world', for example when comparing positions\r\nexport const REAL_WORLD_EPSILON = 1e-4;\r\n\r\n/**\r\n * Check if two numbers are similar.\r\n *\r\n * @param {number} a The first number.\r\n * @param {number} b The second number.\r\n * @param {number} tol The comparison tolerance,\r\n *   default to Number.EPSILON.\r\n * @returns {boolean} True if similar.\r\n */\r\nexport function isSimilar(a, b, tol) {\r\n  if (typeof tol === 'undefined') {\r\n    tol = Number.EPSILON;\r\n  }\r\n  return Math.abs(a - b) < tol;\r\n}\r\n\r\n/**\r\n * Immutable 3x3 Matrix.\r\n */\r\nexport class Matrix33 {\r\n\r\n  /**\r\n   * Matrix values.\r\n   *\r\n   * @type {number[]}\r\n   */\r\n  #values;\r\n\r\n  /**\r\n   * Matrix inverse, calculated at first ask\r\n   *\r\n   * @type {Matrix33}\r\n   */\r\n  #inverse;\r\n\r\n  /**\r\n   * @param {number[]} values row-major ordered 9 values.\r\n   */\r\n  constructor(values) {\r\n    this.#values = values;\r\n  }\r\n\r\n  /**\r\n   * Get a value of the matrix.\r\n   *\r\n   * @param {number} row The row at wich to get the value.\r\n   * @param {number} col The column at wich to get the value.\r\n   * @returns {number|undefined} The value at the position.\r\n   */\r\n  get(row, col) {\r\n    return this.#values[row * 3 + col];\r\n  }\r\n\r\n  /**\r\n   * Get the inverse of this matrix.\r\n   *\r\n   * @returns {Matrix33|undefined} The inverse matrix or undefined\r\n   *   if the determinant is zero.\r\n   */\r\n  getInverse() {\r\n    if (typeof this.#inverse === 'undefined') {\r\n      this.#inverse = getMatrixInverse(this);\r\n    }\r\n    return this.#inverse;\r\n  }\r\n\r\n  /**\r\n   * Check for Matrix33 equality.\r\n   *\r\n   * @param {Matrix33} rhs The other matrix to compare to.\r\n   * @param {number} [p] A numeric expression for the precision to use in check\r\n   *   (ex: 0.001). Defaults to Number.EPSILON if not provided.\r\n   * @returns {boolean} True if both matrices are equal.\r\n   */\r\n  equals(rhs, p) {\r\n    // TODO: add type check\r\n    // check values\r\n    for (let i = 0; i < 3; ++i) {\r\n      for (let j = 0; j < 3; ++j) {\r\n        if (!isSimilar(this.get(i, j), rhs.get(i, j), p)) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get a string representation of the Matrix33.\r\n   *\r\n   * @returns {string} The matrix as a string.\r\n   */\r\n  toString() {\r\n    let str = '[';\r\n    for (let i = 0; i < 3; ++i) {\r\n      if (i !== 0) {\r\n        str += ', \\n ';\r\n      }\r\n      for (let j = 0; j < 3; ++j) {\r\n        if (j !== 0) {\r\n          str += ', ';\r\n        }\r\n        str += this.get(i, j);\r\n      }\r\n    }\r\n    str += ']';\r\n    return str;\r\n  }\r\n\r\n  /**\r\n   * Multiply this matrix by another.\r\n   *\r\n   * @param {Matrix33} rhs The matrix to multiply by.\r\n   * @returns {Matrix33} The product matrix.\r\n   */\r\n  multiply(rhs) {\r\n    const values = [];\r\n    for (let i = 0; i < 3; ++i) {\r\n      for (let j = 0; j < 3; ++j) {\r\n        let tmp = 0;\r\n        for (let k = 0; k < 3; ++k) {\r\n          tmp += this.get(i, k) * rhs.get(k, j);\r\n        }\r\n        values.push(tmp);\r\n      }\r\n    }\r\n    return new Matrix33(values);\r\n  }\r\n\r\n  /**\r\n   * Get the absolute value of this matrix.\r\n   *\r\n   * @returns {Matrix33} The result matrix.\r\n   */\r\n  getAbs() {\r\n    const values = [];\r\n    for (let i = 0; i < 3; ++i) {\r\n      for (let j = 0; j < 3; ++j) {\r\n        values.push(Math.abs(this.get(i, j)));\r\n      }\r\n    }\r\n    return new Matrix33(values);\r\n  }\r\n\r\n  /**\r\n   * Multiply this matrix by a 3D array.\r\n   *\r\n   * @param {number[]} array3D The input 3D array.\r\n   * @returns {number[]} The result 3D array.\r\n   */\r\n  multiplyArray3D(array3D) {\r\n    if (array3D.length !== 3) {\r\n      throw new Error('Cannot multiply 3x3 matrix with non 3D array: ' +\r\n        array3D.length);\r\n    }\r\n    const values = [];\r\n    for (let i = 0; i < 3; ++i) {\r\n      let tmp = 0;\r\n      for (let j = 0; j < 3; ++j) {\r\n        tmp += this.get(i, j) * array3D[j];\r\n      }\r\n      values.push(tmp);\r\n    }\r\n    return values;\r\n  }\r\n\r\n  /**\r\n   * Multiply this matrix by a 3D vector.\r\n   *\r\n   * @param {Vector3D} vector3D The input 3D vector.\r\n   * @returns {Vector3D} The result 3D vector.\r\n   */\r\n  multiplyVector3D(vector3D) {\r\n    const array3D = this.multiplyArray3D(\r\n      [vector3D.getX(), vector3D.getY(), vector3D.getZ()]\r\n    );\r\n    return new Vector3D(array3D[0], array3D[1], array3D[2]);\r\n  }\r\n\r\n  /**\r\n   * Multiply this matrix by a 3D point.\r\n   *\r\n   * @param {Point3D} point3D The input 3D point.\r\n   * @returns {Point3D} The result 3D point.\r\n   */\r\n  multiplyPoint3D(point3D) {\r\n    const array3D = this.multiplyArray3D(\r\n      [point3D.getX(), point3D.getY(), point3D.getZ()]\r\n    );\r\n    return new Point3D(array3D[0], array3D[1], array3D[2]);\r\n  }\r\n\r\n  /**\r\n   * Multiply this matrix by a 3D index.\r\n   *\r\n   * @param {Index} index3D The input 3D index.\r\n   * @returns {Index} The result 3D index.\r\n   */\r\n  multiplyIndex3D(index3D) {\r\n    const array3D = this.multiplyArray3D(index3D.getValues());\r\n    return new Index(array3D);\r\n  }\r\n\r\n  /**\r\n   * Get the index of the maximum in absolute value of a row.\r\n   *\r\n   * @param {number} row The row to get the maximum from.\r\n   * @returns {object} The {value,index} of the maximum.\r\n   */\r\n  getRowAbsMax(row) {\r\n    const values = [\r\n      Math.abs(this.get(row, 0)),\r\n      Math.abs(this.get(row, 1)),\r\n      Math.abs(this.get(row, 2))\r\n    ];\r\n    const absMax = Math.max.apply(null, values);\r\n    const index = values.indexOf(absMax);\r\n    return {\r\n      value: this.get(row, index),\r\n      index: index\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the index of the maximum in absolute value of a column.\r\n   *\r\n   * @param {number} col The column to get the maximum from.\r\n   * @returns {object} The {value,index} of the maximum.\r\n   */\r\n  getColAbsMax(col) {\r\n    const values = [\r\n      Math.abs(this.get(0, col)),\r\n      Math.abs(this.get(1, col)),\r\n      Math.abs(this.get(2, col))\r\n    ];\r\n    const absMax = Math.max.apply(null, values);\r\n    const index = values.indexOf(absMax);\r\n    return {\r\n      value: this.get(index, col),\r\n      index: index\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get this matrix with only zero and +/- ones instead of the maximum,\r\n   *\r\n   * @returns {Matrix33} The simplified matrix.\r\n   */\r\n  asOneAndZeros() {\r\n    const res = [];\r\n    for (let j = 0; j < 3; ++j) {\r\n      const max = this.getRowAbsMax(j);\r\n      const sign = max.value > 0 ? 1 : -1;\r\n      for (let i = 0; i < 3; ++i) {\r\n        if (i === max.index) {\r\n          //res.push(1);\r\n          res.push(1 * sign);\r\n        } else {\r\n          res.push(0);\r\n        }\r\n      }\r\n    }\r\n    return new Matrix33(res);\r\n  }\r\n\r\n  /**\r\n   * Get the third column direction index of an orientation matrix.\r\n   *\r\n   * @returns {number} The index of the absolute maximum of the last column.\r\n   */\r\n  getThirdColMajorDirection() {\r\n    return this.getColAbsMax(2).index;\r\n  }\r\n\r\n} // Matrix33\r\n\r\n/**\r\n * Get the inverse of an input 3*3 matrix.\r\n *\r\n * @param {Matrix33} m The input matrix.\r\n * @returns {Matrix33|undefined} The inverse matrix or undefined\r\n *   if the determinant is zero.\r\n * @see https://en.wikipedia.org/wiki/Invertible_matrix#Inversion_of_3_%C3%97_3_matrices\r\n * @see https://github.com/willnode/N-Matrix-Programmer\r\n */\r\nfunction getMatrixInverse(m) {\r\n  const m00 = m.get(0, 0);\r\n  const m01 = m.get(0, 1);\r\n  const m02 = m.get(0, 2);\r\n  const m10 = m.get(1, 0);\r\n  const m11 = m.get(1, 1);\r\n  const m12 = m.get(1, 2);\r\n  const m20 = m.get(2, 0);\r\n  const m21 = m.get(2, 1);\r\n  const m22 = m.get(2, 2);\r\n\r\n  const a1212 = m11 * m22 - m12 * m21;\r\n  const a2012 = m12 * m20 - m10 * m22;\r\n  const a0112 = m10 * m21 - m11 * m20;\r\n\r\n  let det = m00 * a1212 + m01 * a2012 + m02 * a0112;\r\n  if (det === 0) {\r\n    logger.warn('Cannot invert 3*3 matrix with zero determinant.');\r\n    return undefined;\r\n  }\r\n  det = 1 / det;\r\n\r\n  const values = [\r\n    det * a1212,\r\n    det * (m02 * m21 - m01 * m22),\r\n    det * (m01 * m12 - m02 * m11),\r\n    det * a2012,\r\n    det * (m00 * m22 - m02 * m20),\r\n    det * (m02 * m10 - m00 * m12),\r\n    det * a0112,\r\n    det * (m01 * m20 - m00 * m21),\r\n    det * (m00 * m11 - m01 * m10)\r\n  ];\r\n\r\n  return new Matrix33(values);\r\n}\r\n\r\n/**\r\n * Create a 3x3 identity matrix.\r\n *\r\n * @returns {Matrix33} The identity matrix.\r\n */\r\nexport function getIdentityMat33() {\r\n  /* eslint-disable array-element-newline */\r\n  return new Matrix33([\r\n    1, 0, 0,\r\n    0, 1, 0,\r\n    0, 0, 1\r\n  ]);\r\n  /* eslint-enable array-element-newline */\r\n}\r\n\r\n/**\r\n * Check if a matrix is a 3x3 identity matrix.\r\n *\r\n * @param {Matrix33} mat33 The matrix to test.\r\n * @returns {boolean} True if identity.\r\n */\r\nexport function isIdentityMat33(mat33) {\r\n  return mat33.equals(getIdentityMat33());\r\n}\r\n\r\n/**\r\n * Create a 3x3 coronal (xzy) matrix.\r\n *\r\n * @returns {Matrix33} The coronal matrix.\r\n */\r\nexport function getCoronalMat33() {\r\n  /* eslint-disable array-element-newline */\r\n  return new Matrix33([\r\n    1, 0, 0,\r\n    0, 0, 1,\r\n    0, -1, 0\r\n  ]);\r\n  /* eslint-enable array-element-newline */\r\n}\r\n\r\n/**\r\n * Create a 3x3 sagittal (yzx) matrix.\r\n *\r\n * @returns {Matrix33} The sagittal matrix.\r\n */\r\nexport function getSagittalMat33() {\r\n  /* eslint-disable array-element-newline */\r\n  return new Matrix33([\r\n    0, 0, -1,\r\n    1, 0, 0,\r\n    0, -1, 0\r\n  ]);\r\n  /* eslint-enable array-element-newline */\r\n}\r\n\r\n/**\r\n * Get an orientation matrix from a name.\r\n *\r\n * @param {string} name The orientation name.\r\n * @returns {Matrix33|undefined} The orientation matrix.\r\n */\r\nexport function getMatrixFromName(name) {\r\n  let matrix;\r\n  if (name === 'axial') {\r\n    matrix = getIdentityMat33();\r\n  } else if (name === 'coronal') {\r\n    matrix = getCoronalMat33();\r\n  } else if (name === 'sagittal') {\r\n    matrix = getSagittalMat33();\r\n  }\r\n  return matrix;\r\n}\r\n\r\n/**\r\n * Get the orientation code of an orientation matrix. Each letter defines\r\n * the towards direction. Letters are: R (right), L (left),\r\n * A (anterior), P (posterior), I (inferior) and S (superior).\r\n *\r\n * @param {Matrix33} matrix The orientation matrix.\r\n * @returns {string} The orientation code.\r\n */\r\nexport function getOrientationStringLPS(matrix) {\r\n  const v0 = new Vector3D(\r\n    matrix.get(0, 0),\r\n    matrix.get(1, 0),\r\n    matrix.get(2, 0)\r\n  );\r\n  const v1 = new Vector3D(\r\n    matrix.get(0, 1),\r\n    matrix.get(1, 1),\r\n    matrix.get(2, 1)\r\n  );\r\n  const v2 = new Vector3D(\r\n    matrix.get(0, 2),\r\n    matrix.get(1, 2),\r\n    matrix.get(2, 2)\r\n  );\r\n  return getVectorStringLPS(v0) +\r\n    getVectorStringLPS(v1) +\r\n    getVectorStringLPS(v2);\r\n}\r\n\r\n/**\r\n * Get the orientation code of an orientation vector.\r\n * Credits: David Clunie, https://www.dclunie.com/medical-image-faq/html/part2.html\r\n *\r\n * @param {*} vector The orientation vector.\r\n * @returns {string} The orientation code.\r\n */\r\nfunction getVectorStringLPS(vector) {\r\n  let abs = new Vector3D(\r\n    Math.abs(vector.getX()),\r\n    Math.abs(vector.getY()),\r\n    Math.abs(vector.getZ())\r\n  );\r\n\r\n  let orientation = '';\r\n  const orientationX = vector.getX() < 0 ? 'R' : 'L';\r\n  const orientationY = vector.getY() < 0 ? 'A' : 'P';\r\n  // as defined in DICOM\r\n  //const orientationZ = vector.getZ() < 0 ? 'F' : 'H';\r\n  const orientationZ = vector.getZ() < 0 ? 'I' : 'S';\r\n\r\n  const threshold = 0.0001;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    if (abs.getX() > threshold &&\r\n      abs.getX() > abs.getY() &&\r\n      abs.getX() > abs.getZ()) {\r\n      orientation += orientationX;\r\n      abs = new Vector3D(0, abs.getY(), abs.getZ());\r\n    } else if (abs.getY() > threshold &&\r\n      abs.getY() > abs.getX() &&\r\n      abs.getY() > abs.getZ()) {\r\n      orientation += orientationY;\r\n      abs = new Vector3D(abs.getX(), 0, abs.getZ());\r\n    } else if (abs.getZ() > threshold &&\r\n      abs.getZ() > abs.getX() &&\r\n      abs.getZ() > abs.getY()) {\r\n      orientation += orientationZ;\r\n      abs = new Vector3D(abs.getX(), abs.getY(), 0);\r\n    } else {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return orientation;\r\n}","import {isSimilar} from './matrix';\r\nimport {Vector3D} from './vector';\r\n\r\n/**\r\n * Immutable 2D point.\r\n */\r\nexport class Point2D {\r\n\r\n  /**\r\n   * X position.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #x;\r\n\r\n  /**\r\n   * Y position.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #y;\r\n\r\n  /**\r\n   * @param {number} x The X coordinate for the point.\r\n   * @param {number} y The Y coordinate for the point.\r\n   */\r\n  constructor(x, y) {\r\n    this.#x = x;\r\n    this.#y = y;\r\n  }\r\n\r\n  /**\r\n   * Get the X position of the point.\r\n   *\r\n   * @returns {number} The X position of the point.\r\n   */\r\n  getX() {\r\n    return this.#x;\r\n  }\r\n\r\n  /**\r\n   * Get the Y position of the point.\r\n   *\r\n   * @returns {number} The Y position of the point.\r\n   */\r\n  getY() {\r\n    return this.#y;\r\n  }\r\n\r\n  /**\r\n   * Check for Point2D equality.\r\n   *\r\n   * @param {Point2D} rhs The other point to compare to.\r\n   * @returns {boolean} True if both points are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      this.getX() === rhs.getX() &&\r\n      this.getY() === rhs.getY();\r\n  }\r\n\r\n  /**\r\n   * Get a string representation of the Point2D.\r\n   *\r\n   * @returns {string} The point as a string.\r\n   */\r\n  toString() {\r\n    return '(' + this.getX() + ', ' + this.getY() + ')';\r\n  }\r\n\r\n  /**\r\n   * Get the distance to another Point2D.\r\n   *\r\n   * @param {Point2D} point2D The input point.\r\n   * @returns {number} The distance to the input point.\r\n   */\r\n  getDistance(point2D) {\r\n    return Math.sqrt(\r\n      (this.getX() - point2D.getX()) * (this.getX() - point2D.getX()) +\r\n      (this.getY() - point2D.getY()) * (this.getY() - point2D.getY()));\r\n  }\r\n\r\n  /**\r\n   * Round a Point2D.\r\n   *\r\n   * @returns {Point2D} The rounded point.\r\n   */\r\n  getRound() {\r\n    return new Point2D(\r\n      Math.round(this.getX()),\r\n      Math.round(this.getY())\r\n    );\r\n  }\r\n\r\n} // Point2D class\r\n\r\n/**\r\n * Immutable 3D point.\r\n */\r\nexport class Point3D {\r\n\r\n  /**\r\n   * X position.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #x;\r\n\r\n  /**\r\n   * Y position.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #y;\r\n\r\n  /**\r\n   * Z position.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #z;\r\n\r\n  /**\r\n   * @param {number} x The X coordinate for the point.\r\n   * @param {number} y The Y coordinate for the point.\r\n   * @param {number} z The Z coordinate for the point.\r\n   */\r\n  constructor(x, y, z) {\r\n    this.#x = x;\r\n    this.#y = y;\r\n    this.#z = z;\r\n  }\r\n\r\n  /**\r\n   * Get the X position of the point.\r\n   *\r\n   * @returns {number} The X position of the point.\r\n   */\r\n  getX() {\r\n    return this.#x;\r\n  }\r\n\r\n  /**\r\n   * Get the Y position of the point.\r\n   *\r\n   * @returns {number} The Y position of the point.\r\n   */\r\n  getY() {\r\n    return this.#y;\r\n  }\r\n\r\n  /**\r\n   * Get the Z position of the point.\r\n   *\r\n   * @returns {number} The Z position of the point.\r\n   */\r\n  getZ() {\r\n    return this.#z;\r\n  }\r\n\r\n\r\n  /**\r\n   * Check for Point3D equality.\r\n   *\r\n   * @param {Point3D} rhs The other point to compare to.\r\n   * @returns {boolean} True if both points are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      this.getX() === rhs.getX() &&\r\n      this.getY() === rhs.getY() &&\r\n      this.getZ() === rhs.getZ();\r\n  }\r\n\r\n  /**\r\n   * Check for Point3D similarity.\r\n   *\r\n   * @param {Point3D} rhs The other point to compare to.\r\n   * @param {number} tol Optional comparison tolerance,\r\n   *   default to Number.EPSILON.\r\n   * @returns {boolean} True if both points are equal.\r\n   */\r\n  isSimilar(rhs, tol) {\r\n    return rhs !== null &&\r\n      isSimilar(this.getX(), rhs.getX(), tol) &&\r\n      isSimilar(this.getY(), rhs.getY(), tol) &&\r\n      isSimilar(this.getZ(), rhs.getZ(), tol);\r\n  }\r\n\r\n  /**\r\n   * Get a string representation of the Point3D.\r\n   *\r\n   * @returns {string} The point as a string.\r\n   */\r\n  toString() {\r\n    return '(' + this.getX() +\r\n      ', ' + this.getY() +\r\n      ', ' + this.getZ() + ')';\r\n  }\r\n\r\n  /**\r\n   * Get the distance to another Point3D.\r\n   *\r\n   * @param {Point3D} point3D The input point.\r\n   * @returns {number} Ths distance to the input point.\r\n   */\r\n  getDistance(point3D) {\r\n    return Math.sqrt(\r\n      (this.getX() - point3D.getX()) * (this.getX() - point3D.getX()) +\r\n      (this.getY() - point3D.getY()) * (this.getY() - point3D.getY()) +\r\n      (this.getZ() - point3D.getZ()) * (this.getZ() - point3D.getZ()));\r\n  }\r\n\r\n  /**\r\n   * Get the difference to another Point3D.\r\n   *\r\n   * @param {Point3D} point3D The input point.\r\n   * @returns {Vector3D} The 3D vector from the input point to this one.\r\n   */\r\n  minus(point3D) {\r\n    return new Vector3D(\r\n      (this.getX() - point3D.getX()),\r\n      (this.getY() - point3D.getY()),\r\n      (this.getZ() - point3D.getZ()));\r\n  }\r\n\r\n} // Point3D class\r\n\r\n/**\r\n * Get an array find callback for an equal input point.\r\n *\r\n * @param {Point3D} point The point to compare to.\r\n * @returns {Function} A function that compares, using `equals`,\r\n *   its input point to the one given as input to this function.\r\n */\r\nexport function getEqualPoint3DFunction(point) {\r\n  return function (element) {\r\n    return element.equals(point);\r\n  };\r\n}\r\n\r\n/**\r\n * Immutable point.\r\n * Warning: the input array is NOT cloned, modifying it will\r\n *  modify the index values.\r\n */\r\nexport class Point {\r\n\r\n  /**\r\n   * Point values.\r\n   *\r\n   * @type {number[]}\r\n   */\r\n  #values;\r\n\r\n  /**\r\n   * @param {number[]} values The point values.\r\n   */\r\n  constructor(values) {\r\n    if (!values || typeof values === 'undefined') {\r\n      throw new Error('Cannot create point with no values.');\r\n    }\r\n    if (values.length === 0) {\r\n      throw new Error('Cannot create point with empty values.');\r\n    }\r\n    const valueCheck = function (val) {\r\n      return !isNaN(val);\r\n    };\r\n    if (!values.every(valueCheck)) {\r\n      throw new Error('Cannot create point with non number values.');\r\n    }\r\n    this.#values = values;\r\n  }\r\n\r\n  /**\r\n   * Get the index value at the given array index.\r\n   *\r\n   * @param {number} i The index to get.\r\n   * @returns {number} The value.\r\n   */\r\n  get(i) {\r\n    return this.#values[i];\r\n  }\r\n\r\n  /**\r\n   * Get the length of the index.\r\n   *\r\n   * @returns {number} The length.\r\n   */\r\n  length() {\r\n    return this.#values.length;\r\n  }\r\n\r\n  /**\r\n   * Get a string representation of the Index.\r\n   *\r\n   * @returns {string} The Index as a string.\r\n   */\r\n  toString() {\r\n    return '(' + this.#values.toString() + ')';\r\n  }\r\n\r\n  /**\r\n   * Get the values of this index.\r\n   *\r\n   * @returns {number[]} The array of values.\r\n   */\r\n  getValues() {\r\n    return this.#values.slice();\r\n  }\r\n\r\n  /**\r\n   * Check if the input point can be compared to this one.\r\n   *\r\n   * @param {Point} rhs The point to compare to.\r\n   * @returns {boolean} True if both points are comparable.\r\n   */\r\n  canCompare(rhs) {\r\n    // check input\r\n    if (!rhs) {\r\n      return false;\r\n    }\r\n    // check length\r\n    if (this.length() !== rhs.length()) {\r\n      return false;\r\n    }\r\n    // seems ok!\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Check for Point equality.\r\n   *\r\n   * @param {Point} rhs The point to compare to.\r\n   * @returns {boolean} True if both points are equal.\r\n   */\r\n  equals(rhs) {\r\n    // check if can compare\r\n    if (!this.canCompare(rhs)) {\r\n      return false;\r\n    }\r\n    // check values\r\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\r\n      if (this.get(i) !== rhs.get(i)) {\r\n        return false;\r\n      }\r\n    }\r\n    // seems ok!\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Compare points and return different dimensions.\r\n   *\r\n   * @param {Point} rhs The point to compare to.\r\n   * @returns {number[]} The list of different dimensions.\r\n   */\r\n  compare(rhs) {\r\n    // check if can compare\r\n    if (!this.canCompare(rhs)) {\r\n      return null;\r\n    }\r\n    // check values\r\n    const diffDims = [];\r\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\r\n      if (this.get(i) !== rhs.get(i)) {\r\n        diffDims.push(i);\r\n      }\r\n    }\r\n    return diffDims;\r\n  }\r\n\r\n  /**\r\n   * Get the 3D part of this point.\r\n   *\r\n   * @returns {Point3D} The Point3D.\r\n   */\r\n  get3D() {\r\n    return new Point3D(this.get(0), this.get(1), this.get(2));\r\n  }\r\n\r\n  /**\r\n   * Add another point to this one.\r\n   *\r\n   * @param {Point} rhs The point to add.\r\n   * @returns {Point} The point representing the sum of both points.\r\n   */\r\n  add(rhs) {\r\n    // check if can compare\r\n    if (!this.canCompare(rhs)) {\r\n      return null;\r\n    }\r\n    const values = [];\r\n    const values0 = this.getValues();\r\n    const values1 = rhs.getValues();\r\n    for (let i = 0; i < values0.length; ++i) {\r\n      values.push(values0[i] + values1[i]);\r\n    }\r\n    return new Point(values);\r\n  }\r\n\r\n  /**\r\n   * Merge this point with a Point3D to create a new point.\r\n   *\r\n   * @param {Point3D} rhs The Point3D to merge with.\r\n   * @returns {Point} The merge result.\r\n   */\r\n  mergeWith3D(rhs) {\r\n    const values = this.getValues();\r\n    values[0] = rhs.getX();\r\n    values[1] = rhs.getY();\r\n    values[2] = rhs.getZ();\r\n    return new Point(values);\r\n  }\r\n\r\n} // Point class\r\n","/**\r\n * Capitalise the first letter of a string.\r\n *\r\n * @param {string} string The string to capitalise the first letter.\r\n * @returns {string} The new string.\r\n */\r\nexport function capitaliseFirstLetter(string) {\r\n  let res = string;\r\n  if (string) {\r\n    res = string.charAt(0).toUpperCase() + string.slice(1);\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Check if a string starts with the input element.\r\n *\r\n * @param {string} str The input string.\r\n * @param {string} search The searched start.\r\n * @param {number} [rawPos] The position in this string at which to begin\r\n *  searching for searchString. Defaults to 0.\r\n * @returns {boolean} True if the input string starts with the searched string.\r\n */\r\nexport function startsWith(str, search, rawPos) {\r\n  if (typeof str === 'undefined' || str === null ||\r\n    typeof search === 'undefined' || search === null) {\r\n    return false;\r\n  }\r\n  const pos = rawPos > 0 ? rawPos | 0 : 0;\r\n  return str.substring(pos, pos + search.length) === search;\r\n}\r\n\r\n/**\r\n * Check if a string ends with the input element.\r\n *\r\n * @param {string} str The input string.\r\n * @param {string} search The searched ending.\r\n * @returns {boolean} True if the input string ends with the searched string.\r\n */\r\nexport function endsWith(str, search) {\r\n  if (typeof str === 'undefined' || str === null ||\r\n    typeof search === 'undefined' || search === null) {\r\n    return false;\r\n  }\r\n  return str.substring(str.length - search.length) === search;\r\n}\r\n\r\n/**\r\n * Split key/value string:\r\n *  key0=val00&key0=val01&key1=val10 returns\r\n *  { key0 : [val00, val01], key1 : val1 }\r\n *\r\n * @param {string} inputStr The string to split.\r\n * @returns {object} The split string.\r\n */\r\nexport function splitKeyValueString(inputStr) {\r\n  // result\r\n  const result = {};\r\n  // check input string\r\n  if (inputStr) {\r\n    // split key/value pairs\r\n    const pairs = inputStr.split('&');\r\n    for (let i = 0; i < pairs.length; ++i) {\r\n      const pair = pairs[i].split('=');\r\n      // if the key does not exist, create it\r\n      if (!result[pair[0]]) {\r\n        result[pair[0]] = pair[1];\r\n      } else {\r\n        // make it an array\r\n        if (!(result[pair[0]] instanceof Array)) {\r\n          result[pair[0]] = [result[pair[0]]];\r\n        }\r\n        result[pair[0]].push(pair[1]);\r\n      }\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * Get flags from an input string. Flags are words surrounded with curly\r\n * braces.\r\n *\r\n * @param {string} inputStr The input string.\r\n * @returns {Array} An array of found flags.\r\n */\r\nexport function getFlags(inputStr) {\r\n  const flags = [];\r\n  // check input string\r\n  if (inputStr === null || typeof inputStr === 'undefined') {\r\n    return flags;\r\n  }\r\n\r\n  // word surrounded by curly braces\r\n  const regex = /{(\\w+)}/g;\r\n\r\n  let match = regex.exec(inputStr);\r\n  while (match) {\r\n    flags.push(match[1]); // first matching group\r\n    match = regex.exec(inputStr);\r\n  }\r\n  return flags;\r\n}\r\n\r\n/**\r\n * Replace flags in a input string. Flags are keywords surrounded with curly\r\n * braces.\r\n *\r\n * @param {string} inputStr The input string.\r\n * @param {object} values A object of {value, unit}.\r\n * @returns {string} The result string.\r\n */\r\nexport function replaceFlags(inputStr, values) {\r\n  let res = '';\r\n  // check input string\r\n  if (inputStr === null || typeof inputStr === 'undefined') {\r\n    return res;\r\n  }\r\n  res = inputStr;\r\n  // check values\r\n  if (values === null || typeof values === 'undefined') {\r\n    return res;\r\n  }\r\n\r\n  // loop through flags\r\n  const keys = getFlags(inputStr);\r\n  for (let i = 0; i < keys.length; ++i) {\r\n    const valueObj = values[keys[i]];\r\n    if (valueObj !== null && typeof valueObj !== 'undefined' &&\r\n      valueObj.value !== null && typeof valueObj.value !== 'undefined') {\r\n      // value string\r\n      let valueStr = valueObj.value.toPrecision(4);\r\n      // add unit if available\r\n      // space or no space? Yes apart from degree...\r\n      // check: https://en.wikipedia.org/wiki/Space_(punctuation)#Spaces_and_unit_symbols\r\n      if (valueObj.unit !== null &&\r\n        typeof valueObj.unit !== 'undefined' &&\r\n        valueObj.unit.length !== 0) {\r\n        if (valueObj.unit !== 'degree') {\r\n          valueStr += ' ';\r\n        }\r\n        valueStr += valueObj.unit;\r\n      }\r\n      // flag to replace\r\n      const flag = '{' + keys[i] + '}';\r\n      // replace\r\n      res = res.replace(flag, valueStr);\r\n    }\r\n  }\r\n  // return\r\n  return res;\r\n}\r\n\r\n/**\r\n * Get the root of an input path.\r\n * Splits using `/` as separator.\r\n *\r\n * @param {string} path The input path\r\n * @returns {string} The input path without its last part.\r\n */\r\nexport function getRootPath(path) {\r\n  return path.split('/').slice(0, -1).join('/');\r\n}\r\n\r\n/**\r\n * Get a file extension: anything after the last dot.\r\n * File name starting with a dot are discarded.\r\n * Extensions are expected to contain at least one letter.\r\n *\r\n * @param {string} filePath The file path containing the file name.\r\n * @returns {string} The lower case file extension or null for none.\r\n */\r\nexport function getFileExtension(filePath) {\r\n  let ext = null;\r\n  if (typeof filePath !== 'undefined' &&\r\n    filePath !== null &&\r\n    filePath[0] !== '.') {\r\n    const pathSplit = filePath.toLowerCase().split('.');\r\n    if (pathSplit.length !== 1) {\r\n      ext = pathSplit.pop();\r\n      // extension should contain at least one letter and no slash\r\n      const regExp = /[a-z]/;\r\n      if (!regExp.test(ext) || ext.includes('/')) {\r\n        ext = null;\r\n      }\r\n    }\r\n  }\r\n  return ext;\r\n}\r\n\r\n/**\r\n * Convert a string to a Uint8Array.\r\n *\r\n * @param {string} str The string to convert.\r\n * @returns {Uint8Array} The Uint8Array.\r\n */\r\nexport function stringToUint8Array(str) {\r\n  const arr = new Uint8Array(str.length);\r\n  for (let i = 0, leni = str.length; i < leni; i++) {\r\n    arr[i] = str.charCodeAt(i);\r\n  }\r\n  return arr;\r\n}\r\n\r\n/**\r\n * Round a float number to a given precision.\r\n * Inspired from https://stackoverflow.com/a/49729715/3639892.\r\n * Can be a solution to not have trailing zero as when\r\n * using toFixed or toPrecision.\r\n * '+number.toFixed(precision)' does not pass all the tests...\r\n *\r\n * @param {number} number The number to round.\r\n * @param {number} precision The rounding precision.\r\n * @returns {number} The rounded number.\r\n */\r\nexport function precisionRound(number, precision) {\r\n  const factor = Math.pow(10, precision);\r\n  const delta = 0.01 / factor; // fixes precisionRound(1.005, 2)\r\n  return Math.round(number * factor + delta) / factor;\r\n}\r\n","import {stringToUint8Array} from './string';\r\n\r\n/**\r\n * Check if the first input array contains all the\r\n * elements of the second input array.\r\n *\r\n * @param {Array} arr0 The test array.\r\n * @param {Array} arr1 The elements to check in the first array.\r\n * @returns {boolean} True if all the elements of arr1 are included in arr0.\r\n */\r\nexport function arrayContains(arr0, arr1) {\r\n  // check input\r\n  if (arr0 === null ||\r\n    arr1 === null ||\r\n    typeof arr0 === 'undefined' ||\r\n    typeof arr1 === 'undefined') {\r\n    return false;\r\n  }\r\n  if (arr0.length === 0 ||\r\n    arr1.length === 0 ||\r\n    arr1.length > arr0.length) {\r\n    return false;\r\n  }\r\n  // check values\r\n  for (const itemArr1 of arr1) {\r\n    if (!arr0.includes(itemArr1)) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * Check for array equality after sorting.\r\n *\r\n * @param {Array} arr0 First array.\r\n * @param {*} arr1 Second array.\r\n * @returns {boolean} True if both array are defined and contain same values.\r\n */\r\nexport function arraySortEquals(arr0, arr1) {\r\n  if (arr0 === null ||\r\n    arr1 === null ||\r\n    typeof arr0 === 'undefined' ||\r\n    typeof arr1 === 'undefined') {\r\n    return false;\r\n  }\r\n  const arr0sorted = arr0.slice().sort();\r\n  const arr1sorted = arr1.slice().sort();\r\n  return arrayEquals(arr0sorted, arr1sorted);\r\n}\r\n\r\n/**\r\n * Check for array equality.\r\n *\r\n * @param {Array} arr0 First array.\r\n * @param {*} arr1 Second array.\r\n * @returns {boolean} True if both array are defined and contain same values.\r\n */\r\nexport function arrayEquals(arr0, arr1) {\r\n  if (arr0 === null ||\r\n    arr1 === null ||\r\n    typeof arr0 === 'undefined' ||\r\n    typeof arr1 === 'undefined') {\r\n    return false;\r\n  }\r\n  if (arr0.length !== arr1.length) {\r\n    return false;\r\n  }\r\n  return arr0.every(function (element, index) {\r\n    return element === arr1[index];\r\n  });\r\n}\r\n\r\n/**\r\n * Convert a Uint8Array to a string.\r\n *\r\n * @param {Uint8Array} arr The array to convert.\r\n * @returns {string} The array as string.\r\n */\r\nexport function uint8ArrayToString(arr) {\r\n  return String.fromCharCode.apply(String, arr);\r\n}\r\n\r\n/**\r\n * Array find in a subset of the input array.\r\n * Equivalent to: arr.slice(start, end).find(callbackFn)\r\n *\r\n * @param {Uint8Array} arr The input array to search.\r\n * @param {Function} callbackFn The find function.\r\n * @param {number|undefined} start The array start index.\r\n * @param {number|undefined} [end] The array end index.\r\n * @returns {number|undefined} The index where the element was found.\r\n */\r\nexport function findInArraySubset(arr, callbackFn, start, end) {\r\n  // check inputs\r\n  if (typeof start === 'undefined' ||\r\n    start < 0 ||\r\n    start >= arr.length\r\n  ) {\r\n    start = 0;\r\n  }\r\n  if (typeof end === 'undefined' ||\r\n    end <= start ||\r\n    end > arr.length) {\r\n    end = arr.length;\r\n  }\r\n  // run\r\n  for (let i = start; i < end; ++i) {\r\n    if (callbackFn(arr[i], i, arr)) {\r\n      return i;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * Get a find in array callback.\r\n *\r\n * @param {Uint8Array} arr1 The array to find.\r\n * @returns {Function} The find callback function.\r\n */\r\nexport function getFindArrayInArrayCallback(arr1) {\r\n  return function (element, index, arr0) {\r\n    for (let i = 0; i < arr1.length; ++i) {\r\n      if (arr0[index + i] !== arr1[i]) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n}\r\n\r\n/**\r\n * Extract each element of a multipart ArrayBuffer.\r\n * https://en.wikipedia.org/wiki/MIME#Multipart_messages\r\n *\r\n * @param {ArrayBuffer} arr The multipart array.\r\n * @returns {Array} The multipart parts as an array of object as\r\n *  {'Content-Type', ..., data} (depending on header tags)\r\n */\r\nexport function parseMultipart(arr) {\r\n  const u8Array = new Uint8Array(arr);\r\n\r\n  const parts = [];\r\n  // check input\r\n  if (u8Array.length === 0) {\r\n    return parts;\r\n  }\r\n\r\n  // \\r\\n\\r\\n\r\n  const doubleReturnNew = new Uint8Array([0x0d, 0x0a, 0x0d, 0x0a]);\r\n  const partHeaderEndCb = getFindArrayInArrayCallback(doubleReturnNew);\r\n\r\n  // look for boundary in first part header\r\n  let partHeaderEndIndex = findInArraySubset(\r\n    u8Array, partHeaderEndCb, 0\r\n  );\r\n  if (typeof partHeaderEndIndex === 'undefined') {\r\n    throw new Error('Can\\'t find the end of the first multipart header');\r\n  }\r\n  const firstPartHeader = u8Array.slice(0, partHeaderEndIndex);\r\n  // switch to string to use split\r\n  const lines = uint8ArrayToString(firstPartHeader).split('\\r\\n');\r\n  // boundary should start with '--'\r\n  let boundaryStr;\r\n  for (let i = 0; i < lines.length; ++i) {\r\n    if (lines[i][0] === '-' && lines[i][1] === '-') {\r\n      boundaryStr = lines[i];\r\n      break;\r\n    }\r\n  }\r\n  if (typeof boundaryStr === 'undefined') {\r\n    throw new Error('Can\\'t find the boundary between multi-parts');\r\n  }\r\n  const boundary = stringToUint8Array(boundaryStr);\r\n  const boundaryCb = getFindArrayInArrayCallback(boundary);\r\n  const boundaryLen = boundaryStr.length;\r\n\r\n  // skip mime header\r\n  let nextBoundaryIndex = findInArraySubset(\r\n    u8Array, boundaryCb, 0\r\n  );\r\n\r\n  // loop through content\r\n  while (typeof partHeaderEndIndex !== 'undefined') {\r\n    const part = {};\r\n\r\n    // header\r\n    const partHeader = u8Array.slice(\r\n      nextBoundaryIndex + boundaryLen, partHeaderEndIndex);\r\n    // split into object\r\n    const partHeaderLines =\r\n      uint8ArrayToString(partHeader).split('\\r\\n');\r\n    for (let l = 0; l < partHeaderLines.length; ++l) {\r\n      const line = partHeaderLines[l];\r\n      const semiColonIndex = line.indexOf(':');\r\n      if (semiColonIndex !== -1) {\r\n        const key = line.substring(0, semiColonIndex).trim();\r\n        const val = line.substring(semiColonIndex + 1).trim();\r\n        part[key] = val;\r\n      }\r\n    }\r\n\r\n    // find next boundary\r\n    nextBoundaryIndex = findInArraySubset(\r\n      u8Array, boundaryCb, partHeaderEndIndex\r\n    );\r\n    // exit if none\r\n    if (typeof nextBoundaryIndex === 'undefined') {\r\n      break;\r\n    }\r\n\r\n    // get part\r\n    // partHeaderEndIndex plus the size of the '\\r\\n\\r\\n' separator\r\n    const dataBeginIndex = partHeaderEndIndex + 4;\r\n    // nextBoundaryIndex minus the previous '\\r\\n'\r\n    const dataEndIndex = nextBoundaryIndex - 2;\r\n    if (dataBeginIndex < dataEndIndex) {\r\n      part.data = u8Array.slice(dataBeginIndex, dataEndIndex).buffer;\r\n    } else {\r\n      part.data = new Uint8Array();\r\n    }\r\n\r\n    // store part\r\n    parts.push(part);\r\n\r\n    // find next part header end\r\n    partHeaderEndIndex = findInArraySubset(\r\n      u8Array, partHeaderEndCb,\r\n      nextBoundaryIndex + boundaryLen\r\n    );\r\n  }\r\n\r\n  return parts;\r\n}\r\n\r\n/**\r\n * Build a multipart message.\r\n * See: https://en.wikipedia.org/wiki/MIME#Multipart_messages\r\n * See: https://hg.orthanc-server.com/orthanc-dicomweb/file/tip/Resources/Samples/JavaScript/stow-rs.js\r\n *\r\n * @param {Array} parts The message parts as an array of object containing\r\n *   content headers and messages as the data property (as returned by parse).\r\n * @param {string} boundary The message boundary.\r\n * @returns {Uint8Array} The full multipart message.\r\n */\r\nexport function buildMultipart(parts, boundary) {\r\n  const lineBreak = '\\r\\n';\r\n  // build headers and calculate size\r\n  let partsSize = 0;\r\n  const headers = [];\r\n  for (let i = 0; i < parts.length; ++i) {\r\n    let headerStr = '';\r\n    if (i !== 0) {\r\n      headerStr += lineBreak;\r\n    }\r\n    headerStr += '--' + boundary + lineBreak;\r\n    const partKeys = Object.keys(parts[i]);\r\n    for (let k = 0; k < partKeys.length; ++k) {\r\n      const key = partKeys[k];\r\n      if (key !== 'data') {\r\n        headerStr += key + ': ' + parts[i][key] + lineBreak;\r\n      }\r\n    }\r\n    headerStr += lineBreak;\r\n    const header = stringToUint8Array(headerStr);\r\n    headers.push(header);\r\n    partsSize += header.byteLength + parts[i].data.byteLength;\r\n  }\r\n  // build trailer\r\n  const trailerStr = lineBreak + '--' + boundary + '--' + lineBreak;\r\n  const trailer = stringToUint8Array(trailerStr);\r\n\r\n  // final buffer\r\n  const buffer = new Uint8Array(partsSize + trailer.byteLength);\r\n  let offset = 0;\r\n  // concatenate parts\r\n  for (let j = 0; j < parts.length; ++j) {\r\n    buffer.set(headers[j], offset);\r\n    offset += headers[j].byteLength;\r\n    buffer.set(new Uint8Array(parts[j].data), offset);\r\n    offset += parts[j].data.byteLength;\r\n  }\r\n  // end buffer with trailer\r\n  buffer.set(trailer, offset);\r\n\r\n  // return\r\n  return buffer;\r\n}\r\n","/* eslint-disable quote-props */\r\n/* eslint max-len:0 */\r\n\r\n/**\r\n * DICOM tag dictionary 2022a.\r\n * Generated using xml standard conversion from {@link https://github.com/ivmartel/dcmStdToJs} v0.1.0.\r\n * Conversion changes:\r\n * - (vr) 'See Note' -> 'NONE'\r\n * - (vr) 'OB or OW' -> 'ox'\r\n * - (vr) 'US or SS' -> 'xs'\r\n * - (vr) 'US or OW' -> 'xx'\r\n * - (vr) 'US or SS or OW' -> 'xs'\r\n * - added 'GenericGroupLength' element to each group\r\n * Local changes:\r\n * - tag numbers with 'xx' were replaced with '00', 'xxx' with '001' and\r\n *  'xxxx' with '0004'\r\n */\r\nexport const dictionary = {\r\n  '0000': {\r\n    '0000': ['UL', '1', 'CommandGroupLength'],\r\n    '0001': ['UL', '1', 'CommandLengthToEnd'],\r\n    '0002': ['UI', '1', 'AffectedSOPClassUID'],\r\n    '0003': ['UI', '1', 'RequestedSOPClassUID'],\r\n    '0010': ['SH', '1', 'CommandRecognitionCode'],\r\n    '0100': ['US', '1', 'CommandField'],\r\n    '0110': ['US', '1', 'MessageID'],\r\n    '0120': ['US', '1', 'MessageIDBeingRespondedTo'],\r\n    '0200': ['AE', '1', 'Initiator'],\r\n    '0300': ['AE', '1', 'Receiver'],\r\n    '0400': ['AE', '1', 'FindLocation'],\r\n    '0600': ['AE', '1', 'MoveDestination'],\r\n    '0700': ['US', '1', 'Priority'],\r\n    '0800': ['US', '1', 'CommandDataSetType'],\r\n    '0850': ['US', '1', 'NumberOfMatches'],\r\n    '0860': ['US', '1', 'ResponseSequenceNumber'],\r\n    '0900': ['US', '1', 'Status'],\r\n    '0901': ['AT', '1-n', 'OffendingElement'],\r\n    '0902': ['LO', '1', 'ErrorComment'],\r\n    '0903': ['US', '1', 'ErrorID'],\r\n    '1000': ['UI', '1', 'AffectedSOPInstanceUID'],\r\n    '1001': ['UI', '1', 'RequestedSOPInstanceUID'],\r\n    '1002': ['US', '1', 'EventTypeID'],\r\n    '1005': ['AT', '1-n', 'AttributeIdentifierList'],\r\n    '1008': ['US', '1', 'ActionTypeID'],\r\n    '1020': ['US', '1', 'NumberOfRemainingSuboperations'],\r\n    '1021': ['US', '1', 'NumberOfCompletedSuboperations'],\r\n    '1022': ['US', '1', 'NumberOfFailedSuboperations'],\r\n    '1023': ['US', '1', 'NumberOfWarningSuboperations'],\r\n    '1030': ['AE', '1', 'MoveOriginatorApplicationEntityTitle'],\r\n    '1031': ['US', '1', 'MoveOriginatorMessageID'],\r\n    '4000': ['LT', '1', 'DialogReceiver'],\r\n    '4010': ['LT', '1', 'TerminalType'],\r\n    '5010': ['SH', '1', 'MessageSetID'],\r\n    '5020': ['SH', '1', 'EndMessageID'],\r\n    '5110': ['LT', '1', 'DisplayFormat'],\r\n    '5120': ['LT', '1', 'PagePositionID'],\r\n    '5130': ['CS', '1', 'TextFormatID'],\r\n    '5140': ['CS', '1', 'NormalReverse'],\r\n    '5150': ['CS', '1', 'AddGrayScale'],\r\n    '5160': ['CS', '1', 'Borders'],\r\n    '5170': ['IS', '1', 'Copies'],\r\n    '5180': ['CS', '1', 'CommandMagnificationType'],\r\n    '5190': ['CS', '1', 'Erase'],\r\n    '51A0': ['CS', '1', 'Print'],\r\n    '51B0': ['US', '1-n', 'Overlays']\r\n  },\r\n  '0002': {\r\n    '0000': ['UL', '1', 'FileMetaInformationGroupLength'],\r\n    '0001': ['OB', '1', 'FileMetaInformationVersion'],\r\n    '0002': ['UI', '1', 'MediaStorageSOPClassUID'],\r\n    '0003': ['UI', '1', 'MediaStorageSOPInstanceUID'],\r\n    '0010': ['UI', '1', 'TransferSyntaxUID'],\r\n    '0012': ['UI', '1', 'ImplementationClassUID'],\r\n    '0013': ['SH', '1', 'ImplementationVersionName'],\r\n    '0016': ['AE', '1', 'SourceApplicationEntityTitle'],\r\n    '0017': ['AE', '1', 'SendingApplicationEntityTitle'],\r\n    '0018': ['AE', '1', 'ReceivingApplicationEntityTitle'],\r\n    '0026': ['UR', '1', 'SourcePresentationAddress'],\r\n    '0027': ['UR', '1', 'SendingPresentationAddress'],\r\n    '0028': ['UR', '1', 'ReceivingPresentationAddress'],\r\n    '0031': ['OB', '1', 'RTVMetaInformationVersion'],\r\n    '0032': ['UI', '1', 'RTVCommunicationSOPClassUID'],\r\n    '0033': ['UI', '1', 'RTVCommunicationSOPInstanceUID'],\r\n    '0035': ['OB', '1', 'RTVSourceIdentifier'],\r\n    '0036': ['OB', '1', 'RTVFlowIdentifier'],\r\n    '0037': ['UL', '1', 'RTVFlowRTPSamplingRate'],\r\n    '0038': ['FD', '1', 'RTVFlowActualFrameDuration'],\r\n    '0100': ['UI', '1', 'PrivateInformationCreatorUID'],\r\n    '0102': ['OB', '1', 'PrivateInformation']\r\n  },\r\n  '0004': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '1130': ['CS', '1', 'FileSetID'],\r\n    '1141': ['CS', '1-8', 'FileSetDescriptorFileID'],\r\n    '1142': ['CS', '1', 'SpecificCharacterSetOfFileSetDescriptorFile'],\r\n    '1200': ['UL', '1', 'OffsetOfTheFirstDirectoryRecordOfTheRootDirectoryEntity'],\r\n    '1202': ['UL', '1', 'OffsetOfTheLastDirectoryRecordOfTheRootDirectoryEntity'],\r\n    '1212': ['US', '1', 'FileSetConsistencyFlag'],\r\n    '1220': ['SQ', '1', 'DirectoryRecordSequence'],\r\n    '1400': ['UL', '1', 'OffsetOfTheNextDirectoryRecord'],\r\n    '1410': ['US', '1', 'RecordInUseFlag'],\r\n    '1420': ['UL', '1', 'OffsetOfReferencedLowerLevelDirectoryEntity'],\r\n    '1430': ['CS', '1', 'DirectoryRecordType'],\r\n    '1432': ['UI', '1', 'PrivateRecordUID'],\r\n    '1500': ['CS', '1-8', 'ReferencedFileID'],\r\n    '1504': ['UL', '1', 'MRDRDirectoryRecordOffset'],\r\n    '1510': ['UI', '1', 'ReferencedSOPClassUIDInFile'],\r\n    '1511': ['UI', '1', 'ReferencedSOPInstanceUIDInFile'],\r\n    '1512': ['UI', '1', 'ReferencedTransferSyntaxUIDInFile'],\r\n    '151A': ['UI', '1-n', 'ReferencedRelatedGeneralSOPClassUIDInFile'],\r\n    '1600': ['UL', '1', 'NumberOfReferences']\r\n  },\r\n  '0008': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['UL', '1', 'LengthToEnd'],\r\n    '0005': ['CS', '1-n', 'SpecificCharacterSet'],\r\n    '0006': ['SQ', '1', 'LanguageCodeSequence'],\r\n    '0008': ['CS', '2-n', 'ImageType'],\r\n    '0010': ['SH', '1', 'RecognitionCode'],\r\n    '0012': ['DA', '1', 'InstanceCreationDate'],\r\n    '0013': ['TM', '1', 'InstanceCreationTime'],\r\n    '0014': ['UI', '1', 'InstanceCreatorUID'],\r\n    '0015': ['DT', '1', 'InstanceCoercionDateTime'],\r\n    '0016': ['UI', '1', 'SOPClassUID'],\r\n    '0018': ['UI', '1', 'SOPInstanceUID'],\r\n    '001A': ['UI', '1-n', 'RelatedGeneralSOPClassUID'],\r\n    '001B': ['UI', '1', 'OriginalSpecializedSOPClassUID'],\r\n    '0020': ['DA', '1', 'StudyDate'],\r\n    '0021': ['DA', '1', 'SeriesDate'],\r\n    '0022': ['DA', '1', 'AcquisitionDate'],\r\n    '0023': ['DA', '1', 'ContentDate'],\r\n    '0024': ['DA', '1', 'OverlayDate'],\r\n    '0025': ['DA', '1', 'CurveDate'],\r\n    '002A': ['DT', '1', 'AcquisitionDateTime'],\r\n    '0030': ['TM', '1', 'StudyTime'],\r\n    '0031': ['TM', '1', 'SeriesTime'],\r\n    '0032': ['TM', '1', 'AcquisitionTime'],\r\n    '0033': ['TM', '1', 'ContentTime'],\r\n    '0034': ['TM', '1', 'OverlayTime'],\r\n    '0035': ['TM', '1', 'CurveTime'],\r\n    '0040': ['US', '1', 'DataSetType'],\r\n    '0041': ['LO', '1', 'DataSetSubtype'],\r\n    '0042': ['CS', '1', 'NuclearMedicineSeriesType'],\r\n    '0050': ['SH', '1', 'AccessionNumber'],\r\n    '0051': ['SQ', '1', 'IssuerOfAccessionNumberSequence'],\r\n    '0052': ['CS', '1', 'QueryRetrieveLevel'],\r\n    '0053': ['CS', '1', 'QueryRetrieveView'],\r\n    '0054': ['AE', '1-n', 'RetrieveAETitle'],\r\n    '0055': ['AE', '1', 'StationAETitle'],\r\n    '0056': ['CS', '1', 'InstanceAvailability'],\r\n    '0058': ['UI', '1-n', 'FailedSOPInstanceUIDList'],\r\n    '0060': ['CS', '1', 'Modality'],\r\n    '0061': ['CS', '1-n', 'ModalitiesInStudy'],\r\n    '0062': ['UI', '1-n', 'SOPClassesInStudy'],\r\n    '0063': ['SQ', '1', 'AnatomicRegionsInStudyCodeSequence'],\r\n    '0064': ['CS', '1', 'ConversionType'],\r\n    '0068': ['CS', '1', 'PresentationIntentType'],\r\n    '0070': ['LO', '1', 'Manufacturer'],\r\n    '0080': ['LO', '1', 'InstitutionName'],\r\n    '0081': ['ST', '1', 'InstitutionAddress'],\r\n    '0082': ['SQ', '1', 'InstitutionCodeSequence'],\r\n    '0090': ['PN', '1', 'ReferringPhysicianName'],\r\n    '0092': ['ST', '1', 'ReferringPhysicianAddress'],\r\n    '0094': ['SH', '1-n', 'ReferringPhysicianTelephoneNumbers'],\r\n    '0096': ['SQ', '1', 'ReferringPhysicianIdentificationSequence'],\r\n    '009C': ['PN', '1-n', 'ConsultingPhysicianName'],\r\n    '009D': ['SQ', '1', 'ConsultingPhysicianIdentificationSequence'],\r\n    '0100': ['SH', '1', 'CodeValue'],\r\n    '0101': ['LO', '1', 'ExtendedCodeValue'],\r\n    '0102': ['SH', '1', 'CodingSchemeDesignator'],\r\n    '0103': ['SH', '1', 'CodingSchemeVersion'],\r\n    '0104': ['LO', '1', 'CodeMeaning'],\r\n    '0105': ['CS', '1', 'MappingResource'],\r\n    '0106': ['DT', '1', 'ContextGroupVersion'],\r\n    '0107': ['DT', '1', 'ContextGroupLocalVersion'],\r\n    '0108': ['LT', '1', 'ExtendedCodeMeaning'],\r\n    '0109': ['SQ', '1', 'CodingSchemeResourcesSequence'],\r\n    '010A': ['CS', '1', 'CodingSchemeURLType'],\r\n    '010B': ['CS', '1', 'ContextGroupExtensionFlag'],\r\n    '010C': ['UI', '1', 'CodingSchemeUID'],\r\n    '010D': ['UI', '1', 'ContextGroupExtensionCreatorUID'],\r\n    '010E': ['UR', '1', 'CodingSchemeURL'],\r\n    '010F': ['CS', '1', 'ContextIdentifier'],\r\n    '0110': ['SQ', '1', 'CodingSchemeIdentificationSequence'],\r\n    '0112': ['LO', '1', 'CodingSchemeRegistry'],\r\n    '0114': ['ST', '1', 'CodingSchemeExternalID'],\r\n    '0115': ['ST', '1', 'CodingSchemeName'],\r\n    '0116': ['ST', '1', 'CodingSchemeResponsibleOrganization'],\r\n    '0117': ['UI', '1', 'ContextUID'],\r\n    '0118': ['UI', '1', 'MappingResourceUID'],\r\n    '0119': ['UC', '1', 'LongCodeValue'],\r\n    '0120': ['UR', '1', 'URNCodeValue'],\r\n    '0121': ['SQ', '1', 'EquivalentCodeSequence'],\r\n    '0122': ['LO', '1', 'MappingResourceName'],\r\n    '0123': ['SQ', '1', 'ContextGroupIdentificationSequence'],\r\n    '0124': ['SQ', '1', 'MappingResourceIdentificationSequence'],\r\n    '0201': ['SH', '1', 'TimezoneOffsetFromUTC'],\r\n    '0202': ['', '', ''],\r\n    '0220': ['SQ', '1', 'ResponsibleGroupCodeSequence'],\r\n    '0221': ['CS', '1', 'EquipmentModality'],\r\n    '0222': ['LO', '1', 'ManufacturerRelatedModelGroup'],\r\n    '0300': ['SQ', '1', 'PrivateDataElementCharacteristicsSequence'],\r\n    '0301': ['US', '1', 'PrivateGroupReference'],\r\n    '0302': ['LO', '1', 'PrivateCreatorReference'],\r\n    '0303': ['CS', '1', 'BlockIdentifyingInformationStatus'],\r\n    '0304': ['US', '1-n', 'NonidentifyingPrivateElements'],\r\n    '0305': ['SQ', '1', 'DeidentificationActionSequence'],\r\n    '0306': ['US', '1-n', 'IdentifyingPrivateElements'],\r\n    '0307': ['CS', '1', 'DeidentificationAction'],\r\n    '0308': ['US', '1', 'PrivateDataElement'],\r\n    '0309': ['UL', '1-3', 'PrivateDataElementValueMultiplicity'],\r\n    '030A': ['CS', '1', 'PrivateDataElementValueRepresentation'],\r\n    '030B': ['UL', '1-2', 'PrivateDataElementNumberOfItems'],\r\n    '030C': ['UC', '1', 'PrivateDataElementName'],\r\n    '030D': ['UC', '1', 'PrivateDataElementKeyword'],\r\n    '030E': ['UT', '1', 'PrivateDataElementDescription'],\r\n    '030F': ['UT', '1', 'PrivateDataElementEncoding'],\r\n    '0310': ['SQ', '1', 'PrivateDataElementDefinitionSequence'],\r\n    '1000': ['AE', '1', 'NetworkID'],\r\n    '1010': ['SH', '1', 'StationName'],\r\n    '1030': ['LO', '1', 'StudyDescription'],\r\n    '1032': ['SQ', '1', 'ProcedureCodeSequence'],\r\n    '103E': ['LO', '1', 'SeriesDescription'],\r\n    '103F': ['SQ', '1', 'SeriesDescriptionCodeSequence'],\r\n    '1040': ['LO', '1', 'InstitutionalDepartmentName'],\r\n    '1041': ['SQ', '1', 'InstitutionalDepartmentTypeCodeSequence'],\r\n    '1048': ['PN', '1-n', 'PhysiciansOfRecord'],\r\n    '1049': ['SQ', '1', 'PhysiciansOfRecordIdentificationSequence'],\r\n    '1050': ['PN', '1-n', 'PerformingPhysicianName'],\r\n    '1052': ['SQ', '1', 'PerformingPhysicianIdentificationSequence'],\r\n    '1060': ['PN', '1-n', 'NameOfPhysiciansReadingStudy'],\r\n    '1062': ['SQ', '1', 'PhysiciansReadingStudyIdentificationSequence'],\r\n    '1070': ['PN', '1-n', 'OperatorsName'],\r\n    '1072': ['SQ', '1', 'OperatorIdentificationSequence'],\r\n    '1080': ['LO', '1-n', 'AdmittingDiagnosesDescription'],\r\n    '1084': ['SQ', '1', 'AdmittingDiagnosesCodeSequence'],\r\n    '1090': ['LO', '1', 'ManufacturerModelName'],\r\n    '1100': ['SQ', '1', 'ReferencedResultsSequence'],\r\n    '1110': ['SQ', '1', 'ReferencedStudySequence'],\r\n    '1111': ['SQ', '1', 'ReferencedPerformedProcedureStepSequence'],\r\n    '1115': ['SQ', '1', 'ReferencedSeriesSequence'],\r\n    '1120': ['SQ', '1', 'ReferencedPatientSequence'],\r\n    '1125': ['SQ', '1', 'ReferencedVisitSequence'],\r\n    '1130': ['SQ', '1', 'ReferencedOverlaySequence'],\r\n    '1134': ['SQ', '1', 'ReferencedStereometricInstanceSequence'],\r\n    '113A': ['SQ', '1', 'ReferencedWaveformSequence'],\r\n    '1140': ['SQ', '1', 'ReferencedImageSequence'],\r\n    '1145': ['SQ', '1', 'ReferencedCurveSequence'],\r\n    '114A': ['SQ', '1', 'ReferencedInstanceSequence'],\r\n    '114B': ['SQ', '1', 'ReferencedRealWorldValueMappingInstanceSequence'],\r\n    '1150': ['UI', '1', 'ReferencedSOPClassUID'],\r\n    '1155': ['UI', '1', 'ReferencedSOPInstanceUID'],\r\n    '1156': ['SQ', '1', 'DefinitionSourceSequence'],\r\n    '115A': ['UI', '1-n', 'SOPClassesSupported'],\r\n    '1160': ['IS', '1-n', 'ReferencedFrameNumber'],\r\n    '1161': ['UL', '1-n', 'SimpleFrameList'],\r\n    '1162': ['UL', '3-3n', 'CalculatedFrameList'],\r\n    '1163': ['FD', '2', 'TimeRange'],\r\n    '1164': ['SQ', '1', 'FrameExtractionSequence'],\r\n    '1167': ['UI', '1', 'MultiFrameSourceSOPInstanceUID'],\r\n    '1190': ['UR', '1', 'RetrieveURL'],\r\n    '1195': ['UI', '1', 'TransactionUID'],\r\n    '1196': ['US', '1', 'WarningReason'],\r\n    '1197': ['US', '1', 'FailureReason'],\r\n    '1198': ['SQ', '1', 'FailedSOPSequence'],\r\n    '1199': ['SQ', '1', 'ReferencedSOPSequence'],\r\n    '119A': ['SQ', '1', 'OtherFailuresSequence'],\r\n    '1200': ['SQ', '1', 'StudiesContainingOtherReferencedInstancesSequence'],\r\n    '1250': ['SQ', '1', 'RelatedSeriesSequence'],\r\n    '2110': ['CS', '1', 'LossyImageCompressionRetired'],\r\n    '2111': ['ST', '1', 'DerivationDescription'],\r\n    '2112': ['SQ', '1', 'SourceImageSequence'],\r\n    '2120': ['SH', '1', 'StageName'],\r\n    '2122': ['IS', '1', 'StageNumber'],\r\n    '2124': ['IS', '1', 'NumberOfStages'],\r\n    '2127': ['SH', '1', 'ViewName'],\r\n    '2128': ['IS', '1', 'ViewNumber'],\r\n    '2129': ['IS', '1', 'NumberOfEventTimers'],\r\n    '212A': ['IS', '1', 'NumberOfViewsInStage'],\r\n    '2130': ['DS', '1-n', 'EventElapsedTimes'],\r\n    '2132': ['LO', '1-n', 'EventTimerNames'],\r\n    '2133': ['SQ', '1', 'EventTimerSequence'],\r\n    '2134': ['FD', '1', 'EventTimeOffset'],\r\n    '2135': ['SQ', '1', 'EventCodeSequence'],\r\n    '2142': ['IS', '1', 'StartTrim'],\r\n    '2143': ['IS', '1', 'StopTrim'],\r\n    '2144': ['IS', '1', 'RecommendedDisplayFrameRate'],\r\n    '2200': ['CS', '1', 'TransducerPosition'],\r\n    '2204': ['CS', '1', 'TransducerOrientation'],\r\n    '2208': ['CS', '1', 'AnatomicStructure'],\r\n    '2218': ['SQ', '1', 'AnatomicRegionSequence'],\r\n    '2220': ['SQ', '1', 'AnatomicRegionModifierSequence'],\r\n    '2228': ['SQ', '1', 'PrimaryAnatomicStructureSequence'],\r\n    '2229': ['SQ', '1', 'AnatomicStructureSpaceOrRegionSequence'],\r\n    '2230': ['SQ', '1', 'PrimaryAnatomicStructureModifierSequence'],\r\n    '2240': ['SQ', '1', 'TransducerPositionSequence'],\r\n    '2242': ['SQ', '1', 'TransducerPositionModifierSequence'],\r\n    '2244': ['SQ', '1', 'TransducerOrientationSequence'],\r\n    '2246': ['SQ', '1', 'TransducerOrientationModifierSequence'],\r\n    '2251': ['SQ', '1', 'AnatomicStructureSpaceOrRegionCodeSequenceTrial'],\r\n    '2253': ['SQ', '1', 'AnatomicPortalOfEntranceCodeSequenceTrial'],\r\n    '2255': ['SQ', '1', 'AnatomicApproachDirectionCodeSequenceTrial'],\r\n    '2256': ['ST', '1', 'AnatomicPerspectiveDescriptionTrial'],\r\n    '2257': ['SQ', '1', 'AnatomicPerspectiveCodeSequenceTrial'],\r\n    '2258': ['ST', '1', 'AnatomicLocationOfExaminingInstrumentDescriptionTrial'],\r\n    '2259': ['SQ', '1', 'AnatomicLocationOfExaminingInstrumentCodeSequenceTrial'],\r\n    '225A': ['SQ', '1', 'AnatomicStructureSpaceOrRegionModifierCodeSequenceTrial'],\r\n    '225C': ['SQ', '1', 'OnAxisBackgroundAnatomicStructureCodeSequenceTrial'],\r\n    '3001': ['SQ', '1', 'AlternateRepresentationSequence'],\r\n    '3002': ['UI', '1-n', 'AvailableTransferSyntaxUID'],\r\n    '3010': ['UI', '1-n', 'IrradiationEventUID'],\r\n    '3011': ['SQ', '1', 'SourceIrradiationEventSequence'],\r\n    '3012': ['UI', '1', 'RadiopharmaceuticalAdministrationEventUID'],\r\n    '4000': ['LT', '1', 'IdentifyingComments'],\r\n    '9007': ['CS', '4', 'FrameType'],\r\n    '9092': ['SQ', '1', 'ReferencedImageEvidenceSequence'],\r\n    '9121': ['SQ', '1', 'ReferencedRawDataSequence'],\r\n    '9123': ['UI', '1', 'CreatorVersionUID'],\r\n    '9124': ['SQ', '1', 'DerivationImageSequence'],\r\n    '9154': ['SQ', '1', 'SourceImageEvidenceSequence'],\r\n    '9205': ['CS', '1', 'PixelPresentation'],\r\n    '9206': ['CS', '1', 'VolumetricProperties'],\r\n    '9207': ['CS', '1', 'VolumeBasedCalculationTechnique'],\r\n    '9208': ['CS', '1', 'ComplexImageComponent'],\r\n    '9209': ['CS', '1', 'AcquisitionContrast'],\r\n    '9215': ['SQ', '1', 'DerivationCodeSequence'],\r\n    '9237': ['SQ', '1', 'ReferencedPresentationStateSequence'],\r\n    '9410': ['SQ', '1', 'ReferencedOtherPlaneSequence'],\r\n    '9458': ['SQ', '1', 'FrameDisplaySequence'],\r\n    '9459': ['FL', '1', 'RecommendedDisplayFrameRateInFloat'],\r\n    '9460': ['CS', '1', 'SkipFrameRangeFlag']\r\n  },\r\n  '0010': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['PN', '1', 'PatientName'],\r\n    '0020': ['LO', '1', 'PatientID'],\r\n    '0021': ['LO', '1', 'IssuerOfPatientID'],\r\n    '0022': ['CS', '1', 'TypeOfPatientID'],\r\n    '0024': ['SQ', '1', 'IssuerOfPatientIDQualifiersSequence'],\r\n    '0026': ['SQ', '1', 'SourcePatientGroupIdentificationSequence'],\r\n    '0027': ['SQ', '1', 'GroupOfPatientsIdentificationSequence'],\r\n    '0028': ['US', '3', 'SubjectRelativePositionInImage'],\r\n    '0030': ['DA', '1', 'PatientBirthDate'],\r\n    '0032': ['TM', '1', 'PatientBirthTime'],\r\n    '0033': ['LO', '1', 'PatientBirthDateInAlternativeCalendar'],\r\n    '0034': ['LO', '1', 'PatientDeathDateInAlternativeCalendar'],\r\n    '0035': ['CS', '1', 'PatientAlternativeCalendar'],\r\n    '0040': ['CS', '1', 'PatientSex'],\r\n    '0050': ['SQ', '1', 'PatientInsurancePlanCodeSequence'],\r\n    '0101': ['SQ', '1', 'PatientPrimaryLanguageCodeSequence'],\r\n    '0102': ['SQ', '1', 'PatientPrimaryLanguageModifierCodeSequence'],\r\n    '0200': ['CS', '1', 'QualityControlSubject'],\r\n    '0201': ['SQ', '1', 'QualityControlSubjectTypeCodeSequence'],\r\n    '0212': ['UC', '1', 'StrainDescription'],\r\n    '0213': ['LO', '1', 'StrainNomenclature'],\r\n    '0214': ['LO', '1', 'StrainStockNumber'],\r\n    '0215': ['SQ', '1', 'StrainSourceRegistryCodeSequence'],\r\n    '0216': ['SQ', '1', 'StrainStockSequence'],\r\n    '0217': ['LO', '1', 'StrainSource'],\r\n    '0218': ['UT', '1', 'StrainAdditionalInformation'],\r\n    '0219': ['SQ', '1', 'StrainCodeSequence'],\r\n    '0221': ['SQ', '1', 'GeneticModificationsSequence'],\r\n    '0222': ['UC', '1', 'GeneticModificationsDescription'],\r\n    '0223': ['LO', '1', 'GeneticModificationsNomenclature'],\r\n    '0229': ['SQ', '1', 'GeneticModificationsCodeSequence'],\r\n    '1000': ['LO', '1-n', 'OtherPatientIDs'],\r\n    '1001': ['PN', '1-n', 'OtherPatientNames'],\r\n    '1002': ['SQ', '1', 'OtherPatientIDsSequence'],\r\n    '1005': ['PN', '1', 'PatientBirthName'],\r\n    '1010': ['AS', '1', 'PatientAge'],\r\n    '1020': ['DS', '1', 'PatientSize'],\r\n    '1021': ['SQ', '1', 'PatientSizeCodeSequence'],\r\n    '1022': ['DS', '1', 'PatientBodyMassIndex'],\r\n    '1023': ['DS', '1', 'MeasuredAPDimension'],\r\n    '1024': ['DS', '1', 'MeasuredLateralDimension'],\r\n    '1030': ['DS', '1', 'PatientWeight'],\r\n    '1040': ['LO', '1', 'PatientAddress'],\r\n    '1050': ['LO', '1-n', 'InsurancePlanIdentification'],\r\n    '1060': ['PN', '1', 'PatientMotherBirthName'],\r\n    '1080': ['LO', '1', 'MilitaryRank'],\r\n    '1081': ['LO', '1', 'BranchOfService'],\r\n    '1090': ['LO', '1', 'MedicalRecordLocator'],\r\n    '1100': ['SQ', '1', 'ReferencedPatientPhotoSequence'],\r\n    '2000': ['LO', '1-n', 'MedicalAlerts'],\r\n    '2110': ['LO', '1-n', 'Allergies'],\r\n    '2150': ['LO', '1', 'CountryOfResidence'],\r\n    '2152': ['LO', '1', 'RegionOfResidence'],\r\n    '2154': ['SH', '1-n', 'PatientTelephoneNumbers'],\r\n    '2155': ['LT', '1', 'PatientTelecomInformation'],\r\n    '2160': ['SH', '1', 'EthnicGroup'],\r\n    '2180': ['SH', '1', 'Occupation'],\r\n    '21A0': ['CS', '1', 'SmokingStatus'],\r\n    '21B0': ['LT', '1', 'AdditionalPatientHistory'],\r\n    '21C0': ['US', '1', 'PregnancyStatus'],\r\n    '21D0': ['DA', '1', 'LastMenstrualDate'],\r\n    '21F0': ['LO', '1', 'PatientReligiousPreference'],\r\n    '2201': ['LO', '1', 'PatientSpeciesDescription'],\r\n    '2202': ['SQ', '1', 'PatientSpeciesCodeSequence'],\r\n    '2203': ['CS', '1', 'PatientSexNeutered'],\r\n    '2210': ['CS', '1', 'AnatomicalOrientationType'],\r\n    '2292': ['LO', '1', 'PatientBreedDescription'],\r\n    '2293': ['SQ', '1', 'PatientBreedCodeSequence'],\r\n    '2294': ['SQ', '1', 'BreedRegistrationSequence'],\r\n    '2295': ['LO', '1', 'BreedRegistrationNumber'],\r\n    '2296': ['SQ', '1', 'BreedRegistryCodeSequence'],\r\n    '2297': ['PN', '1', 'ResponsiblePerson'],\r\n    '2298': ['CS', '1', 'ResponsiblePersonRole'],\r\n    '2299': ['LO', '1', 'ResponsibleOrganization'],\r\n    '4000': ['LT', '1', 'PatientComments'],\r\n    '9431': ['FL', '1', 'ExaminedBodyThickness']\r\n  },\r\n  '0012': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['LO', '1', 'ClinicalTrialSponsorName'],\r\n    '0020': ['LO', '1', 'ClinicalTrialProtocolID'],\r\n    '0021': ['LO', '1', 'ClinicalTrialProtocolName'],\r\n    '0030': ['LO', '1', 'ClinicalTrialSiteID'],\r\n    '0031': ['LO', '1', 'ClinicalTrialSiteName'],\r\n    '0040': ['LO', '1', 'ClinicalTrialSubjectID'],\r\n    '0042': ['LO', '1', 'ClinicalTrialSubjectReadingID'],\r\n    '0050': ['LO', '1', 'ClinicalTrialTimePointID'],\r\n    '0051': ['ST', '1', 'ClinicalTrialTimePointDescription'],\r\n    '0052': ['FD', '1', 'LongitudinalTemporalOffsetFromEvent'],\r\n    '0053': ['CS', '1', 'LongitudinalTemporalEventType'],\r\n    '0060': ['LO', '1', 'ClinicalTrialCoordinatingCenterName'],\r\n    '0062': ['CS', '1', 'PatientIdentityRemoved'],\r\n    '0063': ['LO', '1-n', 'DeidentificationMethod'],\r\n    '0064': ['SQ', '1', 'DeidentificationMethodCodeSequence'],\r\n    '0071': ['LO', '1', 'ClinicalTrialSeriesID'],\r\n    '0072': ['LO', '1', 'ClinicalTrialSeriesDescription'],\r\n    '0081': ['LO', '1', 'ClinicalTrialProtocolEthicsCommitteeName'],\r\n    '0082': ['LO', '1', 'ClinicalTrialProtocolEthicsCommitteeApprovalNumber'],\r\n    '0083': ['SQ', '1', 'ConsentForClinicalTrialUseSequence'],\r\n    '0084': ['CS', '1', 'DistributionType'],\r\n    '0085': ['CS', '1', 'ConsentForDistributionFlag'],\r\n    '0086': ['DA', '1', 'EthicsCommitteeApprovalEffectivenessStartDate'],\r\n    '0087': ['DA', '1', 'EthicsCommitteeApprovalEffectivenessEndDate']\r\n  },\r\n  '0014': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0023': ['ST', '1', 'CADFileFormat'],\r\n    '0024': ['ST', '1', 'ComponentReferenceSystem'],\r\n    '0025': ['ST', '1', 'ComponentManufacturingProcedure'],\r\n    '0028': ['ST', '1', 'ComponentManufacturer'],\r\n    '0030': ['DS', '1-n', 'MaterialThickness'],\r\n    '0032': ['DS', '1-n', 'MaterialPipeDiameter'],\r\n    '0034': ['DS', '1-n', 'MaterialIsolationDiameter'],\r\n    '0042': ['ST', '1', 'MaterialGrade'],\r\n    '0044': ['ST', '1', 'MaterialPropertiesDescription'],\r\n    '0045': ['ST', '1', 'MaterialPropertiesFileFormatRetired'],\r\n    '0046': ['LT', '1', 'MaterialNotes'],\r\n    '0050': ['CS', '1', 'ComponentShape'],\r\n    '0052': ['CS', '1', 'CurvatureType'],\r\n    '0054': ['DS', '1', 'OuterDiameter'],\r\n    '0056': ['DS', '1', 'InnerDiameter'],\r\n    '0100': ['LO', '1-n', 'ComponentWelderIDs'],\r\n    '0101': ['CS', '1', 'SecondaryApprovalStatus'],\r\n    '0102': ['DA', '1', 'SecondaryReviewDate'],\r\n    '0103': ['TM', '1', 'SecondaryReviewTime'],\r\n    '0104': ['PN', '1', 'SecondaryReviewerName'],\r\n    '0105': ['ST', '1', 'RepairID'],\r\n    '0106': ['SQ', '1', 'MultipleComponentApprovalSequence'],\r\n    '0107': ['CS', '1-n', 'OtherApprovalStatus'],\r\n    '0108': ['CS', '1-n', 'OtherSecondaryApprovalStatus'],\r\n    '1010': ['ST', '1', 'ActualEnvironmentalConditions'],\r\n    '1020': ['DA', '1', 'ExpiryDate'],\r\n    '1040': ['ST', '1', 'EnvironmentalConditions'],\r\n    '2002': ['SQ', '1', 'EvaluatorSequence'],\r\n    '2004': ['IS', '1', 'EvaluatorNumber'],\r\n    '2006': ['PN', '1', 'EvaluatorName'],\r\n    '2008': ['IS', '1', 'EvaluationAttempt'],\r\n    '2012': ['SQ', '1', 'IndicationSequence'],\r\n    '2014': ['IS', '1', 'IndicationNumber'],\r\n    '2016': ['SH', '1', 'IndicationLabel'],\r\n    '2018': ['ST', '1', 'IndicationDescription'],\r\n    '201A': ['CS', '1-n', 'IndicationType'],\r\n    '201C': ['CS', '1', 'IndicationDisposition'],\r\n    '201E': ['SQ', '1', 'IndicationROISequence'],\r\n    '2030': ['SQ', '1', 'IndicationPhysicalPropertySequence'],\r\n    '2032': ['SH', '1', 'PropertyLabel'],\r\n    '2202': ['IS', '1', 'CoordinateSystemNumberOfAxes'],\r\n    '2204': ['SQ', '1', 'CoordinateSystemAxesSequence'],\r\n    '2206': ['ST', '1', 'CoordinateSystemAxisDescription'],\r\n    '2208': ['CS', '1', 'CoordinateSystemDataSetMapping'],\r\n    '220A': ['IS', '1', 'CoordinateSystemAxisNumber'],\r\n    '220C': ['CS', '1', 'CoordinateSystemAxisType'],\r\n    '220E': ['CS', '1', 'CoordinateSystemAxisUnits'],\r\n    '2210': ['OB', '1', 'CoordinateSystemAxisValues'],\r\n    '2220': ['SQ', '1', 'CoordinateSystemTransformSequence'],\r\n    '2222': ['ST', '1', 'TransformDescription'],\r\n    '2224': ['IS', '1', 'TransformNumberOfAxes'],\r\n    '2226': ['IS', '1-n', 'TransformOrderOfAxes'],\r\n    '2228': ['CS', '1', 'TransformedAxisUnits'],\r\n    '222A': ['DS', '1-n', 'CoordinateSystemTransformRotationAndScaleMatrix'],\r\n    '222C': ['DS', '1-n', 'CoordinateSystemTransformTranslationMatrix'],\r\n    '3011': ['DS', '1', 'InternalDetectorFrameTime'],\r\n    '3012': ['DS', '1', 'NumberOfFramesIntegrated'],\r\n    '3020': ['SQ', '1', 'DetectorTemperatureSequence'],\r\n    '3022': ['ST', '1', 'SensorName'],\r\n    '3024': ['DS', '1', 'HorizontalOffsetOfSensor'],\r\n    '3026': ['DS', '1', 'VerticalOffsetOfSensor'],\r\n    '3028': ['DS', '1', 'SensorTemperature'],\r\n    '3040': ['SQ', '1', 'DarkCurrentSequence'],\r\n    '3050': ['ox', '1', 'DarkCurrentCounts'],\r\n    '3060': ['SQ', '1', 'GainCorrectionReferenceSequence'],\r\n    '3070': ['ox', '1', 'AirCounts'],\r\n    '3071': ['DS', '1', 'KVUsedInGainCalibration'],\r\n    '3072': ['DS', '1', 'MAUsedInGainCalibration'],\r\n    '3073': ['DS', '1', 'NumberOfFramesUsedForIntegration'],\r\n    '3074': ['LO', '1', 'FilterMaterialUsedInGainCalibration'],\r\n    '3075': ['DS', '1', 'FilterThicknessUsedInGainCalibration'],\r\n    '3076': ['DA', '1', 'DateOfGainCalibration'],\r\n    '3077': ['TM', '1', 'TimeOfGainCalibration'],\r\n    '3080': ['OB', '1', 'BadPixelImage'],\r\n    '3099': ['LT', '1', 'CalibrationNotes'],\r\n    '3100': ['LT', '1', 'LinearityCorrectionTechnique'],\r\n    '3101': ['LT', '1', 'BeamHardeningCorrectionTechnique'],\r\n    '4002': ['SQ', '1', 'PulserEquipmentSequence'],\r\n    '4004': ['CS', '1', 'PulserType'],\r\n    '4006': ['LT', '1', 'PulserNotes'],\r\n    '4008': ['SQ', '1', 'ReceiverEquipmentSequence'],\r\n    '400A': ['CS', '1', 'AmplifierType'],\r\n    '400C': ['LT', '1', 'ReceiverNotes'],\r\n    '400E': ['SQ', '1', 'PreAmplifierEquipmentSequence'],\r\n    '400F': ['LT', '1', 'PreAmplifierNotes'],\r\n    '4010': ['SQ', '1', 'TransmitTransducerSequence'],\r\n    '4011': ['SQ', '1', 'ReceiveTransducerSequence'],\r\n    '4012': ['US', '1', 'NumberOfElements'],\r\n    '4013': ['CS', '1', 'ElementShape'],\r\n    '4014': ['DS', '1', 'ElementDimensionA'],\r\n    '4015': ['DS', '1', 'ElementDimensionB'],\r\n    '4016': ['DS', '1', 'ElementPitchA'],\r\n    '4017': ['DS', '1', 'MeasuredBeamDimensionA'],\r\n    '4018': ['DS', '1', 'MeasuredBeamDimensionB'],\r\n    '4019': ['DS', '1', 'LocationOfMeasuredBeamDiameter'],\r\n    '401A': ['DS', '1', 'NominalFrequency'],\r\n    '401B': ['DS', '1', 'MeasuredCenterFrequency'],\r\n    '401C': ['DS', '1', 'MeasuredBandwidth'],\r\n    '401D': ['DS', '1', 'ElementPitchB'],\r\n    '4020': ['SQ', '1', 'PulserSettingsSequence'],\r\n    '4022': ['DS', '1', 'PulseWidth'],\r\n    '4024': ['DS', '1', 'ExcitationFrequency'],\r\n    '4026': ['CS', '1', 'ModulationType'],\r\n    '4028': ['DS', '1', 'Damping'],\r\n    '4030': ['SQ', '1', 'ReceiverSettingsSequence'],\r\n    '4031': ['DS', '1', 'AcquiredSoundpathLength'],\r\n    '4032': ['CS', '1', 'AcquisitionCompressionType'],\r\n    '4033': ['IS', '1', 'AcquisitionSampleSize'],\r\n    '4034': ['DS', '1', 'RectifierSmoothing'],\r\n    '4035': ['SQ', '1', 'DACSequence'],\r\n    '4036': ['CS', '1', 'DACType'],\r\n    '4038': ['DS', '1-n', 'DACGainPoints'],\r\n    '403A': ['DS', '1-n', 'DACTimePoints'],\r\n    '403C': ['DS', '1-n', 'DACAmplitude'],\r\n    '4040': ['SQ', '1', 'PreAmplifierSettingsSequence'],\r\n    '4050': ['SQ', '1', 'TransmitTransducerSettingsSequence'],\r\n    '4051': ['SQ', '1', 'ReceiveTransducerSettingsSequence'],\r\n    '4052': ['DS', '1', 'IncidentAngle'],\r\n    '4054': ['ST', '1', 'CouplingTechnique'],\r\n    '4056': ['ST', '1', 'CouplingMedium'],\r\n    '4057': ['DS', '1', 'CouplingVelocity'],\r\n    '4058': ['DS', '1', 'ProbeCenterLocationX'],\r\n    '4059': ['DS', '1', 'ProbeCenterLocationZ'],\r\n    '405A': ['DS', '1', 'SoundPathLength'],\r\n    '405C': ['ST', '1', 'DelayLawIdentifier'],\r\n    '4060': ['SQ', '1', 'GateSettingsSequence'],\r\n    '4062': ['DS', '1', 'GateThreshold'],\r\n    '4064': ['DS', '1', 'VelocityOfSound'],\r\n    '4070': ['SQ', '1', 'CalibrationSettingsSequence'],\r\n    '4072': ['ST', '1', 'CalibrationProcedure'],\r\n    '4074': ['SH', '1', 'ProcedureVersion'],\r\n    '4076': ['DA', '1', 'ProcedureCreationDate'],\r\n    '4078': ['DA', '1', 'ProcedureExpirationDate'],\r\n    '407A': ['DA', '1', 'ProcedureLastModifiedDate'],\r\n    '407C': ['TM', '1-n', 'CalibrationTime'],\r\n    '407E': ['DA', '1-n', 'CalibrationDate'],\r\n    '4080': ['SQ', '1', 'ProbeDriveEquipmentSequence'],\r\n    '4081': ['CS', '1', 'DriveType'],\r\n    '4082': ['LT', '1', 'ProbeDriveNotes'],\r\n    '4083': ['SQ', '1', 'DriveProbeSequence'],\r\n    '4084': ['DS', '1', 'ProbeInductance'],\r\n    '4085': ['DS', '1', 'ProbeResistance'],\r\n    '4086': ['SQ', '1', 'ReceiveProbeSequence'],\r\n    '4087': ['SQ', '1', 'ProbeDriveSettingsSequence'],\r\n    '4088': ['DS', '1', 'BridgeResistors'],\r\n    '4089': ['DS', '1', 'ProbeOrientationAngle'],\r\n    '408B': ['DS', '1', 'UserSelectedGainY'],\r\n    '408C': ['DS', '1', 'UserSelectedPhase'],\r\n    '408D': ['DS', '1', 'UserSelectedOffsetX'],\r\n    '408E': ['DS', '1', 'UserSelectedOffsetY'],\r\n    '4091': ['SQ', '1', 'ChannelSettingsSequence'],\r\n    '4092': ['DS', '1', 'ChannelThreshold'],\r\n    '409A': ['SQ', '1', 'ScannerSettingsSequence'],\r\n    '409B': ['ST', '1', 'ScanProcedure'],\r\n    '409C': ['DS', '1', 'TranslationRateX'],\r\n    '409D': ['DS', '1', 'TranslationRateY'],\r\n    '409F': ['DS', '1', 'ChannelOverlap'],\r\n    '40A0': ['LO', '1-n', 'ImageQualityIndicatorType'],\r\n    '40A1': ['LO', '1-n', 'ImageQualityIndicatorMaterial'],\r\n    '40A2': ['LO', '1-n', 'ImageQualityIndicatorSize'],\r\n    '5002': ['IS', '1', 'LINACEnergy'],\r\n    '5004': ['IS', '1', 'LINACOutput'],\r\n    '5100': ['US', '1', 'ActiveAperture'],\r\n    '5101': ['DS', '1', 'TotalAperture'],\r\n    '5102': ['DS', '1', 'ApertureElevation'],\r\n    '5103': ['DS', '1', 'MainLobeAngle'],\r\n    '5104': ['DS', '1', 'MainRoofAngle'],\r\n    '5105': ['CS', '1', 'ConnectorType'],\r\n    '5106': ['SH', '1', 'WedgeModelNumber'],\r\n    '5107': ['DS', '1', 'WedgeAngleFloat'],\r\n    '5108': ['DS', '1', 'WedgeRoofAngle'],\r\n    '5109': ['CS', '1', 'WedgeElement1Position'],\r\n    '510A': ['DS', '1', 'WedgeMaterialVelocity'],\r\n    '510B': ['SH', '1', 'WedgeMaterial'],\r\n    '510C': ['DS', '1', 'WedgeOffsetZ'],\r\n    '510D': ['DS', '1', 'WedgeOriginOffsetX'],\r\n    '510E': ['DS', '1', 'WedgeTimeDelay'],\r\n    '510F': ['SH', '1', 'WedgeName'],\r\n    '5110': ['SH', '1', 'WedgeManufacturerName'],\r\n    '5111': ['LO', '1', 'WedgeDescription'],\r\n    '5112': ['DS', '1', 'NominalBeamAngle'],\r\n    '5113': ['DS', '1', 'WedgeOffsetX'],\r\n    '5114': ['DS', '1', 'WedgeOffsetY'],\r\n    '5115': ['DS', '1', 'WedgeTotalLength'],\r\n    '5116': ['DS', '1', 'WedgeInContactLength'],\r\n    '5117': ['DS', '1', 'WedgeFrontGap'],\r\n    '5118': ['DS', '1', 'WedgeTotalHeight'],\r\n    '5119': ['DS', '1', 'WedgeFrontHeight'],\r\n    '511A': ['DS', '1', 'WedgeRearHeight'],\r\n    '511B': ['DS', '1', 'WedgeTotalWidth'],\r\n    '511C': ['DS', '1', 'WedgeInContactWidth'],\r\n    '511D': ['DS', '1', 'WedgeChamferHeight'],\r\n    '511E': ['CS', '1', 'WedgeCurve'],\r\n    '511F': ['DS', '1', 'RadiusAlongWedge']\r\n  },\r\n  '0016': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['DS', '1', 'WhitePoint'],\r\n    '0002': ['DS', '3', 'PrimaryChromaticities'],\r\n    '0003': ['UT', '1', 'BatteryLevel'],\r\n    '0004': ['DS', '1', 'ExposureTimeInSeconds'],\r\n    '0005': ['DS', '1', 'FNumber'],\r\n    '0006': ['IS', '1', 'OECFRows'],\r\n    '0007': ['IS', '1', 'OECFColumns'],\r\n    '0008': ['UC', '1-n', 'OECFColumnNames'],\r\n    '0009': ['DS', '1-n', 'OECFValues'],\r\n    '000A': ['IS', '1', 'SpatialFrequencyResponseRows'],\r\n    '000B': ['IS', '1', 'SpatialFrequencyResponseColumns'],\r\n    '000C': ['UC', '1-n', 'SpatialFrequencyResponseColumnNames'],\r\n    '000D': ['DS', '1-n', 'SpatialFrequencyResponseValues'],\r\n    '000E': ['IS', '1', 'ColorFilterArrayPatternRows'],\r\n    '000F': ['IS', '1', 'ColorFilterArrayPatternColumns'],\r\n    '0010': ['DS', '1-n', 'ColorFilterArrayPatternValues'],\r\n    '0011': ['US', '1', 'FlashFiringStatus'],\r\n    '0012': ['US', '1', 'FlashReturnStatus'],\r\n    '0013': ['US', '1', 'FlashMode'],\r\n    '0014': ['US', '1', 'FlashFunctionPresent'],\r\n    '0015': ['US', '1', 'FlashRedEyeMode'],\r\n    '0016': ['US', '1', 'ExposureProgram'],\r\n    '0017': ['UT', '1', 'SpectralSensitivity'],\r\n    '0018': ['IS', '1', 'PhotographicSensitivity'],\r\n    '0019': ['IS', '1', 'SelfTimerMode'],\r\n    '001A': ['US', '1', 'SensitivityType'],\r\n    '001B': ['IS', '1', 'StandardOutputSensitivity'],\r\n    '001C': ['IS', '1', 'RecommendedExposureIndex'],\r\n    '001D': ['IS', '1', 'ISOSpeed'],\r\n    '001E': ['IS', '1', 'ISOSpeedLatitudeyyy'],\r\n    '001F': ['IS', '1', 'ISOSpeedLatitudezzz'],\r\n    '0020': ['UT', '1', 'EXIFVersion'],\r\n    '0021': ['DS', '1', 'ShutterSpeedValue'],\r\n    '0022': ['DS', '1', 'ApertureValue'],\r\n    '0023': ['DS', '1', 'BrightnessValue'],\r\n    '0024': ['DS', '1', 'ExposureBiasValue'],\r\n    '0025': ['DS', '1', 'MaxApertureValue'],\r\n    '0026': ['DS', '1', 'SubjectDistance'],\r\n    '0027': ['US', '1', 'MeteringMode'],\r\n    '0028': ['US', '1', 'LightSource'],\r\n    '0029': ['DS', '1', 'FocalLength'],\r\n    '002A': ['IS', '2-4', 'SubjectArea'],\r\n    '002B': ['OB', '1', 'MakerNote'],\r\n    '0030': ['DS', '1', 'Temperature'],\r\n    '0031': ['DS', '1', 'Humidity'],\r\n    '0032': ['DS', '1', 'Pressure'],\r\n    '0033': ['DS', '1', 'WaterDepth'],\r\n    '0034': ['DS', '1', 'Acceleration'],\r\n    '0035': ['DS', '1', 'CameraElevationAngle'],\r\n    '0036': ['DS', '1-2', 'FlashEnergy'],\r\n    '0037': ['IS', '2', 'SubjectLocation'],\r\n    '0038': ['DS', '1', 'PhotographicExposureIndex'],\r\n    '0039': ['US', '1', 'SensingMethod'],\r\n    '003A': ['US', '1', 'FileSource'],\r\n    '003B': ['US', '1', 'SceneType'],\r\n    '0041': ['US', '1', 'CustomRendered'],\r\n    '0042': ['US', '1', 'ExposureMode'],\r\n    '0043': ['US', '1', 'WhiteBalance'],\r\n    '0044': ['DS', '1', 'DigitalZoomRatio'],\r\n    '0045': ['IS', '1', 'FocalLengthIn35mmFilm'],\r\n    '0046': ['US', '1', 'SceneCaptureType'],\r\n    '0047': ['US', '1', 'GainControl'],\r\n    '0048': ['US', '1', 'Contrast'],\r\n    '0049': ['US', '1', 'Saturation'],\r\n    '004A': ['US', '1', 'Sharpness'],\r\n    '004B': ['OB', '1', 'DeviceSettingDescription'],\r\n    '004C': ['US', '1', 'SubjectDistanceRange'],\r\n    '004D': ['UT', '1', 'CameraOwnerName'],\r\n    '004E': ['DS', '4', 'LensSpecification'],\r\n    '004F': ['UT', '1', 'LensMake'],\r\n    '0050': ['UT', '1', 'LensModel'],\r\n    '0051': ['UT', '1', 'LensSerialNumber'],\r\n    '0061': ['CS', '1', 'InteroperabilityIndex'],\r\n    '0062': ['OB', '1', 'InteroperabilityVersion'],\r\n    '0070': ['OB', '1', 'GPSVersionID'],\r\n    '0071': ['CS', '1', 'GPSLatitudeRef'],\r\n    '0072': ['DS', '3', 'GPSLatitude'],\r\n    '0073': ['CS', '1', 'GPSLongitudeRef'],\r\n    '0074': ['DS', '3', 'GPSLongitude'],\r\n    '0075': ['US', '1', 'GPSAltitudeRef'],\r\n    '0076': ['DS', '1', 'GPSAltitude'],\r\n    '0077': ['DT', '1', 'GPSTimeStamp'],\r\n    '0078': ['UT', '1', 'GPSSatellites'],\r\n    '0079': ['CS', '1', 'GPSStatus'],\r\n    '007A': ['CS', '1', 'GPSMeasureMode'],\r\n    '007B': ['DS', '1', 'GPSDOP'],\r\n    '007C': ['CS', '1', 'GPSSpeedRef'],\r\n    '007D': ['DS', '1', 'GPSSpeed'],\r\n    '007E': ['CS', '1', 'GPSTrackRef'],\r\n    '007F': ['DS', '1', 'GPSTrack'],\r\n    '0080': ['CS', '1', 'GPSImgDirectionRef'],\r\n    '0081': ['DS', '1', 'GPSImgDirection'],\r\n    '0082': ['UT', '1', 'GPSMapDatum'],\r\n    '0083': ['CS', '1', 'GPSDestLatitudeRef'],\r\n    '0084': ['DS', '3', 'GPSDestLatitude'],\r\n    '0085': ['CS', '1', 'GPSDestLongitudeRef'],\r\n    '0086': ['DS', '3', 'GPSDestLongitude'],\r\n    '0087': ['CS', '1', 'GPSDestBearingRef'],\r\n    '0088': ['DS', '1', 'GPSDestBearing'],\r\n    '0089': ['CS', '1', 'GPSDestDistanceRef'],\r\n    '008A': ['DS', '1', 'GPSDestDistance'],\r\n    '008B': ['OB', '1', 'GPSProcessingMethod'],\r\n    '008C': ['OB', '1', 'GPSAreaInformation'],\r\n    '008D': ['DT', '1', 'GPSDateStamp'],\r\n    '008E': ['IS', '1', 'GPSDifferential'],\r\n    '1001': ['CS', '1', 'LightSourcePolarization'],\r\n    '1002': ['DS', '1', 'EmitterColorTemperature'],\r\n    '1003': ['CS', '1', 'ContactMethod'],\r\n    '1004': ['CS', '1-n', 'ImmersionMedia'],\r\n    '1005': ['DS', '1', 'OpticalMagnificationFactor']\r\n  },\r\n  '0018': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['LO', '1', 'ContrastBolusAgent'],\r\n    '0012': ['SQ', '1', 'ContrastBolusAgentSequence'],\r\n    '0013': ['FL', '1', 'ContrastBolusT1Relaxivity'],\r\n    '0014': ['SQ', '1', 'ContrastBolusAdministrationRouteSequence'],\r\n    '0015': ['CS', '1', 'BodyPartExamined'],\r\n    '0020': ['CS', '1-n', 'ScanningSequence'],\r\n    '0021': ['CS', '1-n', 'SequenceVariant'],\r\n    '0022': ['CS', '1-n', 'ScanOptions'],\r\n    '0023': ['CS', '1', 'MRAcquisitionType'],\r\n    '0024': ['SH', '1', 'SequenceName'],\r\n    '0025': ['CS', '1', 'AngioFlag'],\r\n    '0026': ['SQ', '1', 'InterventionDrugInformationSequence'],\r\n    '0027': ['TM', '1', 'InterventionDrugStopTime'],\r\n    '0028': ['DS', '1', 'InterventionDrugDose'],\r\n    '0029': ['SQ', '1', 'InterventionDrugCodeSequence'],\r\n    '002A': ['SQ', '1', 'AdditionalDrugSequence'],\r\n    '0030': ['LO', '1-n', 'Radionuclide'],\r\n    '0031': ['LO', '1', 'Radiopharmaceutical'],\r\n    '0032': ['DS', '1', 'EnergyWindowCenterline'],\r\n    '0033': ['DS', '1-n', 'EnergyWindowTotalWidth'],\r\n    '0034': ['LO', '1', 'InterventionDrugName'],\r\n    '0035': ['TM', '1', 'InterventionDrugStartTime'],\r\n    '0036': ['SQ', '1', 'InterventionSequence'],\r\n    '0037': ['CS', '1', 'TherapyType'],\r\n    '0038': ['CS', '1', 'InterventionStatus'],\r\n    '0039': ['CS', '1', 'TherapyDescription'],\r\n    '003A': ['ST', '1', 'InterventionDescription'],\r\n    '0040': ['IS', '1', 'CineRate'],\r\n    '0042': ['CS', '1', 'InitialCineRunState'],\r\n    '0050': ['DS', '1', 'SliceThickness'],\r\n    '0060': ['DS', '1', 'KVP'],\r\n    '0061': ['DS', '1', ''],\r\n    '0070': ['IS', '1', 'CountsAccumulated'],\r\n    '0071': ['CS', '1', 'AcquisitionTerminationCondition'],\r\n    '0072': ['DS', '1', 'EffectiveDuration'],\r\n    '0073': ['CS', '1', 'AcquisitionStartCondition'],\r\n    '0074': ['IS', '1', 'AcquisitionStartConditionData'],\r\n    '0075': ['IS', '1', 'AcquisitionTerminationConditionData'],\r\n    '0080': ['DS', '1', 'RepetitionTime'],\r\n    '0081': ['DS', '1', 'EchoTime'],\r\n    '0082': ['DS', '1', 'InversionTime'],\r\n    '0083': ['DS', '1', 'NumberOfAverages'],\r\n    '0084': ['DS', '1', 'ImagingFrequency'],\r\n    '0085': ['SH', '1', 'ImagedNucleus'],\r\n    '0086': ['IS', '1-n', 'EchoNumbers'],\r\n    '0087': ['DS', '1', 'MagneticFieldStrength'],\r\n    '0088': ['DS', '1', 'SpacingBetweenSlices'],\r\n    '0089': ['IS', '1', 'NumberOfPhaseEncodingSteps'],\r\n    '0090': ['DS', '1', 'DataCollectionDiameter'],\r\n    '0091': ['IS', '1', 'EchoTrainLength'],\r\n    '0093': ['DS', '1', 'PercentSampling'],\r\n    '0094': ['DS', '1', 'PercentPhaseFieldOfView'],\r\n    '0095': ['DS', '1', 'PixelBandwidth'],\r\n    '1000': ['LO', '1', 'DeviceSerialNumber'],\r\n    '1002': ['UI', '1', 'DeviceUID'],\r\n    '1003': ['LO', '1', 'DeviceID'],\r\n    '1004': ['LO', '1', 'PlateID'],\r\n    '1005': ['LO', '1', 'GeneratorID'],\r\n    '1006': ['LO', '1', 'GridID'],\r\n    '1007': ['LO', '1', 'CassetteID'],\r\n    '1008': ['LO', '1', 'GantryID'],\r\n    '1009': ['UT', '1', 'UniqueDeviceIdentifier'],\r\n    '100A': ['SQ', '1', 'UDISequence'],\r\n    '100B': ['UI', '1-n', 'ManufacturerDeviceClassUID'],\r\n    '1010': ['LO', '1', 'SecondaryCaptureDeviceID'],\r\n    '1011': ['LO', '1', 'HardcopyCreationDeviceID'],\r\n    '1012': ['DA', '1', 'DateOfSecondaryCapture'],\r\n    '1014': ['TM', '1', 'TimeOfSecondaryCapture'],\r\n    '1016': ['LO', '1', 'SecondaryCaptureDeviceManufacturer'],\r\n    '1017': ['LO', '1', 'HardcopyDeviceManufacturer'],\r\n    '1018': ['LO', '1', 'SecondaryCaptureDeviceManufacturerModelName'],\r\n    '1019': ['LO', '1-n', 'SecondaryCaptureDeviceSoftwareVersions'],\r\n    '101A': ['LO', '1-n', 'HardcopyDeviceSoftwareVersion'],\r\n    '101B': ['LO', '1', 'HardcopyDeviceManufacturerModelName'],\r\n    '1020': ['LO', '1-n', 'SoftwareVersions'],\r\n    '1022': ['SH', '1', 'VideoImageFormatAcquired'],\r\n    '1023': ['LO', '1', 'DigitalImageFormatAcquired'],\r\n    '1030': ['LO', '1', 'ProtocolName'],\r\n    '1040': ['LO', '1', 'ContrastBolusRoute'],\r\n    '1041': ['DS', '1', 'ContrastBolusVolume'],\r\n    '1042': ['TM', '1', 'ContrastBolusStartTime'],\r\n    '1043': ['TM', '1', 'ContrastBolusStopTime'],\r\n    '1044': ['DS', '1', 'ContrastBolusTotalDose'],\r\n    '1045': ['IS', '1', 'SyringeCounts'],\r\n    '1046': ['DS', '1-n', 'ContrastFlowRate'],\r\n    '1047': ['DS', '1-n', 'ContrastFlowDuration'],\r\n    '1048': ['CS', '1', 'ContrastBolusIngredient'],\r\n    '1049': ['DS', '1', 'ContrastBolusIngredientConcentration'],\r\n    '1050': ['DS', '1', 'SpatialResolution'],\r\n    '1060': ['DS', '1', 'TriggerTime'],\r\n    '1061': ['LO', '1', 'TriggerSourceOrType'],\r\n    '1062': ['IS', '1', 'NominalInterval'],\r\n    '1063': ['DS', '1', 'FrameTime'],\r\n    '1064': ['LO', '1', 'CardiacFramingType'],\r\n    '1065': ['DS', '1-n', 'FrameTimeVector'],\r\n    '1066': ['DS', '1', 'FrameDelay'],\r\n    '1067': ['DS', '1', 'ImageTriggerDelay'],\r\n    '1068': ['DS', '1', 'MultiplexGroupTimeOffset'],\r\n    '1069': ['DS', '1', 'TriggerTimeOffset'],\r\n    '106A': ['CS', '1', 'SynchronizationTrigger'],\r\n    '106C': ['US', '2', 'SynchronizationChannel'],\r\n    '106E': ['UL', '1', 'TriggerSamplePosition'],\r\n    '1070': ['LO', '1', 'RadiopharmaceuticalRoute'],\r\n    '1071': ['DS', '1', 'RadiopharmaceuticalVolume'],\r\n    '1072': ['TM', '1', 'RadiopharmaceuticalStartTime'],\r\n    '1073': ['TM', '1', 'RadiopharmaceuticalStopTime'],\r\n    '1074': ['DS', '1', 'RadionuclideTotalDose'],\r\n    '1075': ['DS', '1', 'RadionuclideHalfLife'],\r\n    '1076': ['DS', '1', 'RadionuclidePositronFraction'],\r\n    '1077': ['DS', '1', 'RadiopharmaceuticalSpecificActivity'],\r\n    '1078': ['DT', '1', 'RadiopharmaceuticalStartDateTime'],\r\n    '1079': ['DT', '1', 'RadiopharmaceuticalStopDateTime'],\r\n    '1080': ['CS', '1', 'BeatRejectionFlag'],\r\n    '1081': ['IS', '1', 'LowRRValue'],\r\n    '1082': ['IS', '1', 'HighRRValue'],\r\n    '1083': ['IS', '1', 'IntervalsAcquired'],\r\n    '1084': ['IS', '1', 'IntervalsRejected'],\r\n    '1085': ['LO', '1', 'PVCRejection'],\r\n    '1086': ['IS', '1', 'SkipBeats'],\r\n    '1088': ['IS', '1', 'HeartRate'],\r\n    '1090': ['IS', '1', 'CardiacNumberOfImages'],\r\n    '1094': ['IS', '1', 'TriggerWindow'],\r\n    '1100': ['DS', '1', 'ReconstructionDiameter'],\r\n    '1110': ['DS', '1', 'DistanceSourceToDetector'],\r\n    '1111': ['DS', '1', 'DistanceSourceToPatient'],\r\n    '1114': ['DS', '1', 'EstimatedRadiographicMagnificationFactor'],\r\n    '1120': ['DS', '1', 'GantryDetectorTilt'],\r\n    '1121': ['DS', '1', 'GantryDetectorSlew'],\r\n    '1130': ['DS', '1', 'TableHeight'],\r\n    '1131': ['DS', '1', 'TableTraverse'],\r\n    '1134': ['CS', '1', 'TableMotion'],\r\n    '1135': ['DS', '1-n', 'TableVerticalIncrement'],\r\n    '1136': ['DS', '1-n', 'TableLateralIncrement'],\r\n    '1137': ['DS', '1-n', 'TableLongitudinalIncrement'],\r\n    '1138': ['DS', '1', 'TableAngle'],\r\n    '113A': ['CS', '1', 'TableType'],\r\n    '1140': ['CS', '1', 'RotationDirection'],\r\n    '1141': ['DS', '1', 'AngularPosition'],\r\n    '1142': ['DS', '1-n', 'RadialPosition'],\r\n    '1143': ['DS', '1', 'ScanArc'],\r\n    '1144': ['DS', '1', 'AngularStep'],\r\n    '1145': ['DS', '1', 'CenterOfRotationOffset'],\r\n    '1146': ['DS', '1-n', 'RotationOffset'],\r\n    '1147': ['CS', '1', 'FieldOfViewShape'],\r\n    '1149': ['IS', '1-2', 'FieldOfViewDimensions'],\r\n    '1150': ['IS', '1', 'ExposureTime'],\r\n    '1151': ['IS', '1', 'XRayTubeCurrent'],\r\n    '1152': ['IS', '1', 'Exposure'],\r\n    '1153': ['IS', '1', 'ExposureInuAs'],\r\n    '1154': ['DS', '1', 'AveragePulseWidth'],\r\n    '1155': ['CS', '1', 'RadiationSetting'],\r\n    '1156': ['CS', '1', 'RectificationType'],\r\n    '115A': ['CS', '1', 'RadiationMode'],\r\n    '115E': ['DS', '1', 'ImageAndFluoroscopyAreaDoseProduct'],\r\n    '1160': ['SH', '1', 'FilterType'],\r\n    '1161': ['LO', '1-n', 'TypeOfFilters'],\r\n    '1162': ['DS', '1', 'IntensifierSize'],\r\n    '1164': ['DS', '2', 'ImagerPixelSpacing'],\r\n    '1166': ['CS', '1-n', 'Grid'],\r\n    '1170': ['IS', '1', 'GeneratorPower'],\r\n    '1180': ['SH', '1', 'CollimatorGridName'],\r\n    '1181': ['CS', '1', 'CollimatorType'],\r\n    '1182': ['IS', '1-2', 'FocalDistance'],\r\n    '1183': ['DS', '1-2', 'XFocusCenter'],\r\n    '1184': ['DS', '1-2', 'YFocusCenter'],\r\n    '1190': ['DS', '1-n', 'FocalSpots'],\r\n    '1191': ['CS', '1', 'AnodeTargetMaterial'],\r\n    '11A0': ['DS', '1', 'BodyPartThickness'],\r\n    '11A2': ['DS', '1', 'CompressionForce'],\r\n    '11A3': ['DS', '1', 'CompressionPressure'],\r\n    '11A4': ['LO', '1', 'PaddleDescription'],\r\n    '11A5': ['DS', '1', 'CompressionContactArea'],\r\n    '11B0': ['LO', '1', 'AcquisitionMode'],\r\n    '11B1': ['LO', '1', 'DoseModeName'],\r\n    '11B2': ['CS', '1', 'AcquiredSubtractionMaskFlag'],\r\n    '11B3': ['CS', '1', 'FluoroscopyPersistenceFlag'],\r\n    '11B4': ['CS', '1', 'FluoroscopyLastImageHoldPersistenceFlag'],\r\n    '11B5': ['IS', '1', 'UpperLimitNumberOfPersistentFluoroscopyFrames'],\r\n    '11B6': ['CS', '1', 'ContrastBolusAutoInjectionTriggerFlag'],\r\n    '11B7': ['FD', '1', 'ContrastBolusInjectionDelay'],\r\n    '11B8': ['SQ', '1', 'XAAcquisitionPhaseDetailsSequence'],\r\n    '11B9': ['FD', '1', 'XAAcquisitionFrameRate'],\r\n    '11BA': ['SQ', '1', 'XAPlaneDetailsSequence'],\r\n    '11BB': ['LO', '1', 'AcquisitionFieldOfViewLabel'],\r\n    '11BC': ['SQ', '1', 'XRayFilterDetailsSequence'],\r\n    '11BD': ['FD', '1', 'XAAcquisitionDuration'],\r\n    '11BE': ['CS', '1', 'ReconstructionPipelineType'],\r\n    '11BF': ['SQ', '1', 'ImageFilterDetailsSequence'],\r\n    '11C0': ['CS', '1', 'AppliedMaskSubtractionFlag'],\r\n    '11C1': ['SQ', '1', 'RequestedSeriesDescriptionCodeSequence'],\r\n    '1200': ['DA', '1-n', 'DateOfLastCalibration'],\r\n    '1201': ['TM', '1-n', 'TimeOfLastCalibration'],\r\n    '1202': ['DT', '1', 'DateTimeOfLastCalibration'],\r\n    '1203': ['DT', '1', 'CalibrationDateTime'],\r\n    '1210': ['SH', '1-n', 'ConvolutionKernel'],\r\n    '1240': ['IS', '1-n', 'UpperLowerPixelValues'],\r\n    '1242': ['IS', '1', 'ActualFrameDuration'],\r\n    '1243': ['IS', '1', 'CountRate'],\r\n    '1244': ['US', '1', 'PreferredPlaybackSequencing'],\r\n    '1250': ['SH', '1', 'ReceiveCoilName'],\r\n    '1251': ['SH', '1', 'TransmitCoilName'],\r\n    '1260': ['SH', '1', 'PlateType'],\r\n    '1261': ['LO', '1', 'PhosphorType'],\r\n    '1271': ['FD', '1', 'WaterEquivalentDiameter'],\r\n    '1272': ['SQ', '1', 'WaterEquivalentDiameterCalculationMethodCodeSequence'],\r\n    '1300': ['DS', '1', 'ScanVelocity'],\r\n    '1301': ['CS', '1-n', 'WholeBodyTechnique'],\r\n    '1302': ['IS', '1', 'ScanLength'],\r\n    '1310': ['US', '4', 'AcquisitionMatrix'],\r\n    '1312': ['CS', '1', 'InPlanePhaseEncodingDirection'],\r\n    '1314': ['DS', '1', 'FlipAngle'],\r\n    '1315': ['CS', '1', 'VariableFlipAngleFlag'],\r\n    '1316': ['DS', '1', 'SAR'],\r\n    '1318': ['DS', '1', 'dBdt'],\r\n    '1320': ['FL', '1', 'B1rms'],\r\n    '1400': ['LO', '1', 'AcquisitionDeviceProcessingDescription'],\r\n    '1401': ['LO', '1', 'AcquisitionDeviceProcessingCode'],\r\n    '1402': ['CS', '1', 'CassetteOrientation'],\r\n    '1403': ['CS', '1', 'CassetteSize'],\r\n    '1404': ['US', '1', 'ExposuresOnPlate'],\r\n    '1405': ['IS', '1', 'RelativeXRayExposure'],\r\n    '1411': ['DS', '1', 'ExposureIndex'],\r\n    '1412': ['DS', '1', 'TargetExposureIndex'],\r\n    '1413': ['DS', '1', 'DeviationIndex'],\r\n    '1450': ['DS', '1', 'ColumnAngulation'],\r\n    '1460': ['DS', '1', 'TomoLayerHeight'],\r\n    '1470': ['DS', '1', 'TomoAngle'],\r\n    '1480': ['DS', '1', 'TomoTime'],\r\n    '1490': ['CS', '1', 'TomoType'],\r\n    '1491': ['CS', '1', 'TomoClass'],\r\n    '1495': ['IS', '1', 'NumberOfTomosynthesisSourceImages'],\r\n    '1500': ['CS', '1', 'PositionerMotion'],\r\n    '1508': ['CS', '1', 'PositionerType'],\r\n    '1510': ['DS', '1', 'PositionerPrimaryAngle'],\r\n    '1511': ['DS', '1', 'PositionerSecondaryAngle'],\r\n    '1520': ['DS', '1-n', 'PositionerPrimaryAngleIncrement'],\r\n    '1521': ['DS', '1-n', 'PositionerSecondaryAngleIncrement'],\r\n    '1530': ['DS', '1', 'DetectorPrimaryAngle'],\r\n    '1531': ['DS', '1', 'DetectorSecondaryAngle'],\r\n    '1600': ['CS', '1-3', 'ShutterShape'],\r\n    '1602': ['IS', '1', 'ShutterLeftVerticalEdge'],\r\n    '1604': ['IS', '1', 'ShutterRightVerticalEdge'],\r\n    '1606': ['IS', '1', 'ShutterUpperHorizontalEdge'],\r\n    '1608': ['IS', '1', 'ShutterLowerHorizontalEdge'],\r\n    '1610': ['IS', '2', 'CenterOfCircularShutter'],\r\n    '1612': ['IS', '1', 'RadiusOfCircularShutter'],\r\n    '1620': ['IS', '2-2n', 'VerticesOfThePolygonalShutter'],\r\n    '1622': ['US', '1', 'ShutterPresentationValue'],\r\n    '1623': ['US', '1', 'ShutterOverlayGroup'],\r\n    '1624': ['US', '3', 'ShutterPresentationColorCIELabValue'],\r\n    '1630': ['CS', '1', 'OutlineShapeType'],\r\n    '1631': ['FD', '1', 'OutlineLeftVerticalEdge'],\r\n    '1632': ['FD', '1', 'OutlineRightVerticalEdge'],\r\n    '1633': ['FD', '1', 'OutlineUpperHorizontalEdge'],\r\n    '1634': ['FD', '1', 'OutlineLowerHorizontalEdge'],\r\n    '1635': ['FD', '2', 'CenterOfCircularOutline'],\r\n    '1636': ['FD', '1', 'DiameterOfCircularOutline'],\r\n    '1637': ['UL', '1', 'NumberOfPolygonalVertices'],\r\n    '1638': ['OF', '1', 'VerticesOfThePolygonalOutline'],\r\n    '1700': ['CS', '1-3', 'CollimatorShape'],\r\n    '1702': ['IS', '1', 'CollimatorLeftVerticalEdge'],\r\n    '1704': ['IS', '1', 'CollimatorRightVerticalEdge'],\r\n    '1706': ['IS', '1', 'CollimatorUpperHorizontalEdge'],\r\n    '1708': ['IS', '1', 'CollimatorLowerHorizontalEdge'],\r\n    '1710': ['IS', '2', 'CenterOfCircularCollimator'],\r\n    '1712': ['IS', '1', 'RadiusOfCircularCollimator'],\r\n    '1720': ['IS', '2-2n', 'VerticesOfThePolygonalCollimator'],\r\n    '1800': ['CS', '1', 'AcquisitionTimeSynchronized'],\r\n    '1801': ['SH', '1', 'TimeSource'],\r\n    '1802': ['CS', '1', 'TimeDistributionProtocol'],\r\n    '1803': ['LO', '1', 'NTPSourceAddress'],\r\n    '2001': ['IS', '1-n', 'PageNumberVector'],\r\n    '2002': ['SH', '1-n', 'FrameLabelVector'],\r\n    '2003': ['DS', '1-n', 'FramePrimaryAngleVector'],\r\n    '2004': ['DS', '1-n', 'FrameSecondaryAngleVector'],\r\n    '2005': ['DS', '1-n', 'SliceLocationVector'],\r\n    '2006': ['SH', '1-n', 'DisplayWindowLabelVector'],\r\n    '2010': ['DS', '2', 'NominalScannedPixelSpacing'],\r\n    '2020': ['CS', '1', 'DigitizingDeviceTransportDirection'],\r\n    '2030': ['DS', '1', 'RotationOfScannedFilm'],\r\n    '2041': ['SQ', '1', 'BiopsyTargetSequence'],\r\n    '2042': ['UI', '1', 'TargetUID'],\r\n    '2043': ['FL', '2', 'LocalizingCursorPosition'],\r\n    '2044': ['FL', '3', 'CalculatedTargetPosition'],\r\n    '2045': ['SH', '1', 'TargetLabel'],\r\n    '2046': ['FL', '1', 'DisplayedZValue'],\r\n    '3100': ['CS', '1', 'IVUSAcquisition'],\r\n    '3101': ['DS', '1', 'IVUSPullbackRate'],\r\n    '3102': ['DS', '1', 'IVUSGatedRate'],\r\n    '3103': ['IS', '1', 'IVUSPullbackStartFrameNumber'],\r\n    '3104': ['IS', '1', 'IVUSPullbackStopFrameNumber'],\r\n    '3105': ['IS', '1-n', 'LesionNumber'],\r\n    '4000': ['LT', '1', 'AcquisitionComments'],\r\n    '5000': ['SH', '1-n', 'OutputPower'],\r\n    '5010': ['LO', '1-n', 'TransducerData'],\r\n    '5011': ['SQ', '1', 'TransducerIdentificationSequence'],\r\n    '5012': ['DS', '1', 'FocusDepth'],\r\n    '5020': ['LO', '1', 'ProcessingFunction'],\r\n    '5021': ['LO', '1', 'PostprocessingFunction'],\r\n    '5022': ['DS', '1', 'MechanicalIndex'],\r\n    '5024': ['DS', '1', 'BoneThermalIndex'],\r\n    '5026': ['DS', '1', 'CranialThermalIndex'],\r\n    '5027': ['DS', '1', 'SoftTissueThermalIndex'],\r\n    '5028': ['DS', '1', 'SoftTissueFocusThermalIndex'],\r\n    '5029': ['DS', '1', 'SoftTissueSurfaceThermalIndex'],\r\n    '5030': ['DS', '1', 'DynamicRange'],\r\n    '5040': ['DS', '1', 'TotalGain'],\r\n    '5050': ['IS', '1', 'DepthOfScanField'],\r\n    '5100': ['CS', '1', 'PatientPosition'],\r\n    '5101': ['CS', '1', 'ViewPosition'],\r\n    '5104': ['SQ', '1', 'ProjectionEponymousNameCodeSequence'],\r\n    '5210': ['DS', '6', 'ImageTransformationMatrix'],\r\n    '5212': ['DS', '3', 'ImageTranslationVector'],\r\n    '6000': ['DS', '1', 'Sensitivity'],\r\n    '6011': ['SQ', '1', 'SequenceOfUltrasoundRegions'],\r\n    '6012': ['US', '1', 'RegionSpatialFormat'],\r\n    '6014': ['US', '1', 'RegionDataType'],\r\n    '6016': ['UL', '1', 'RegionFlags'],\r\n    '6018': ['UL', '1', 'RegionLocationMinX0'],\r\n    '601A': ['UL', '1', 'RegionLocationMinY0'],\r\n    '601C': ['UL', '1', 'RegionLocationMaxX1'],\r\n    '601E': ['UL', '1', 'RegionLocationMaxY1'],\r\n    '6020': ['SL', '1', 'ReferencePixelX0'],\r\n    '6022': ['SL', '1', 'ReferencePixelY0'],\r\n    '6024': ['US', '1', 'PhysicalUnitsXDirection'],\r\n    '6026': ['US', '1', 'PhysicalUnitsYDirection'],\r\n    '6028': ['FD', '1', 'ReferencePixelPhysicalValueX'],\r\n    '602A': ['FD', '1', 'ReferencePixelPhysicalValueY'],\r\n    '602C': ['FD', '1', 'PhysicalDeltaX'],\r\n    '602E': ['FD', '1', 'PhysicalDeltaY'],\r\n    '6030': ['UL', '1', 'TransducerFrequency'],\r\n    '6031': ['CS', '1', 'TransducerType'],\r\n    '6032': ['UL', '1', 'PulseRepetitionFrequency'],\r\n    '6034': ['FD', '1', 'DopplerCorrectionAngle'],\r\n    '6036': ['FD', '1', 'SteeringAngle'],\r\n    '6038': ['UL', '1', 'DopplerSampleVolumeXPositionRetired'],\r\n    '6039': ['SL', '1', 'DopplerSampleVolumeXPosition'],\r\n    '603A': ['UL', '1', 'DopplerSampleVolumeYPositionRetired'],\r\n    '603B': ['SL', '1', 'DopplerSampleVolumeYPosition'],\r\n    '603C': ['UL', '1', 'TMLinePositionX0Retired'],\r\n    '603D': ['SL', '1', 'TMLinePositionX0'],\r\n    '603E': ['UL', '1', 'TMLinePositionY0Retired'],\r\n    '603F': ['SL', '1', 'TMLinePositionY0'],\r\n    '6040': ['UL', '1', 'TMLinePositionX1Retired'],\r\n    '6041': ['SL', '1', 'TMLinePositionX1'],\r\n    '6042': ['UL', '1', 'TMLinePositionY1Retired'],\r\n    '6043': ['SL', '1', 'TMLinePositionY1'],\r\n    '6044': ['US', '1', 'PixelComponentOrganization'],\r\n    '6046': ['UL', '1', 'PixelComponentMask'],\r\n    '6048': ['UL', '1', 'PixelComponentRangeStart'],\r\n    '604A': ['UL', '1', 'PixelComponentRangeStop'],\r\n    '604C': ['US', '1', 'PixelComponentPhysicalUnits'],\r\n    '604E': ['US', '1', 'PixelComponentDataType'],\r\n    '6050': ['UL', '1', 'NumberOfTableBreakPoints'],\r\n    '6052': ['UL', '1-n', 'TableOfXBreakPoints'],\r\n    '6054': ['FD', '1-n', 'TableOfYBreakPoints'],\r\n    '6056': ['UL', '1', 'NumberOfTableEntries'],\r\n    '6058': ['UL', '1-n', 'TableOfPixelValues'],\r\n    '605A': ['FL', '1-n', 'TableOfParameterValues'],\r\n    '6060': ['FL', '1-n', 'RWaveTimeVector'],\r\n    '6070': ['US', '1', 'ActiveImageAreaOverlayGroup'],\r\n    '7000': ['CS', '1', 'DetectorConditionsNominalFlag'],\r\n    '7001': ['DS', '1', 'DetectorTemperature'],\r\n    '7004': ['CS', '1', 'DetectorType'],\r\n    '7005': ['CS', '1', 'DetectorConfiguration'],\r\n    '7006': ['LT', '1', 'DetectorDescription'],\r\n    '7008': ['LT', '1', 'DetectorMode'],\r\n    '700A': ['SH', '1', 'DetectorID'],\r\n    '700C': ['DA', '1', 'DateOfLastDetectorCalibration'],\r\n    '700E': ['TM', '1', 'TimeOfLastDetectorCalibration'],\r\n    '7010': ['IS', '1', 'ExposuresOnDetectorSinceLastCalibration'],\r\n    '7011': ['IS', '1', 'ExposuresOnDetectorSinceManufactured'],\r\n    '7012': ['DS', '1', 'DetectorTimeSinceLastExposure'],\r\n    '7014': ['DS', '1', 'DetectorActiveTime'],\r\n    '7016': ['DS', '1', 'DetectorActivationOffsetFromExposure'],\r\n    '701A': ['DS', '2', 'DetectorBinning'],\r\n    '7020': ['DS', '2', 'DetectorElementPhysicalSize'],\r\n    '7022': ['DS', '2', 'DetectorElementSpacing'],\r\n    '7024': ['CS', '1', 'DetectorActiveShape'],\r\n    '7026': ['DS', '1-2', 'DetectorActiveDimensions'],\r\n    '7028': ['DS', '2', 'DetectorActiveOrigin'],\r\n    '702A': ['LO', '1', 'DetectorManufacturerName'],\r\n    '702B': ['LO', '1', 'DetectorManufacturerModelName'],\r\n    '7030': ['DS', '2', 'FieldOfViewOrigin'],\r\n    '7032': ['DS', '1', 'FieldOfViewRotation'],\r\n    '7034': ['CS', '1', 'FieldOfViewHorizontalFlip'],\r\n    '7036': ['FL', '2', 'PixelDataAreaOriginRelativeToFOV'],\r\n    '7038': ['FL', '1', 'PixelDataAreaRotationAngleRelativeToFOV'],\r\n    '7040': ['LT', '1', 'GridAbsorbingMaterial'],\r\n    '7041': ['LT', '1', 'GridSpacingMaterial'],\r\n    '7042': ['DS', '1', 'GridThickness'],\r\n    '7044': ['DS', '1', 'GridPitch'],\r\n    '7046': ['IS', '2', 'GridAspectRatio'],\r\n    '7048': ['DS', '1', 'GridPeriod'],\r\n    '704C': ['DS', '1', 'GridFocalDistance'],\r\n    '7050': ['CS', '1-n', 'FilterMaterial'],\r\n    '7052': ['DS', '1-n', 'FilterThicknessMinimum'],\r\n    '7054': ['DS', '1-n', 'FilterThicknessMaximum'],\r\n    '7056': ['FL', '1-n', 'FilterBeamPathLengthMinimum'],\r\n    '7058': ['FL', '1-n', 'FilterBeamPathLengthMaximum'],\r\n    '7060': ['CS', '1', 'ExposureControlMode'],\r\n    '7062': ['LT', '1', 'ExposureControlModeDescription'],\r\n    '7064': ['CS', '1', 'ExposureStatus'],\r\n    '7065': ['DS', '1', 'PhototimerSetting'],\r\n    '8150': ['DS', '1', 'ExposureTimeInuS'],\r\n    '8151': ['DS', '1', 'XRayTubeCurrentInuA'],\r\n    '9004': ['CS', '1', 'ContentQualification'],\r\n    '9005': ['SH', '1', 'PulseSequenceName'],\r\n    '9006': ['SQ', '1', 'MRImagingModifierSequence'],\r\n    '9008': ['CS', '1', 'EchoPulseSequence'],\r\n    '9009': ['CS', '1', 'InversionRecovery'],\r\n    '9010': ['CS', '1', 'FlowCompensation'],\r\n    '9011': ['CS', '1', 'MultipleSpinEcho'],\r\n    '9012': ['CS', '1', 'MultiPlanarExcitation'],\r\n    '9014': ['CS', '1', 'PhaseContrast'],\r\n    '9015': ['CS', '1', 'TimeOfFlightContrast'],\r\n    '9016': ['CS', '1', 'Spoiling'],\r\n    '9017': ['CS', '1', 'SteadyStatePulseSequence'],\r\n    '9018': ['CS', '1', 'EchoPlanarPulseSequence'],\r\n    '9019': ['FD', '1', 'TagAngleFirstAxis'],\r\n    '9020': ['CS', '1', 'MagnetizationTransfer'],\r\n    '9021': ['CS', '1', 'T2Preparation'],\r\n    '9022': ['CS', '1', 'BloodSignalNulling'],\r\n    '9024': ['CS', '1', 'SaturationRecovery'],\r\n    '9025': ['CS', '1', 'SpectrallySelectedSuppression'],\r\n    '9026': ['CS', '1', 'SpectrallySelectedExcitation'],\r\n    '9027': ['CS', '1', 'SpatialPresaturation'],\r\n    '9028': ['CS', '1', 'Tagging'],\r\n    '9029': ['CS', '1', 'OversamplingPhase'],\r\n    '9030': ['FD', '1', 'TagSpacingFirstDimension'],\r\n    '9032': ['CS', '1', 'GeometryOfKSpaceTraversal'],\r\n    '9033': ['CS', '1', 'SegmentedKSpaceTraversal'],\r\n    '9034': ['CS', '1', 'RectilinearPhaseEncodeReordering'],\r\n    '9035': ['FD', '1', 'TagThickness'],\r\n    '9036': ['CS', '1', 'PartialFourierDirection'],\r\n    '9037': ['CS', '1', 'CardiacSynchronizationTechnique'],\r\n    '9041': ['LO', '1', 'ReceiveCoilManufacturerName'],\r\n    '9042': ['SQ', '1', 'MRReceiveCoilSequence'],\r\n    '9043': ['CS', '1', 'ReceiveCoilType'],\r\n    '9044': ['CS', '1', 'QuadratureReceiveCoil'],\r\n    '9045': ['SQ', '1', 'MultiCoilDefinitionSequence'],\r\n    '9046': ['LO', '1', 'MultiCoilConfiguration'],\r\n    '9047': ['SH', '1', 'MultiCoilElementName'],\r\n    '9048': ['CS', '1', 'MultiCoilElementUsed'],\r\n    '9049': ['SQ', '1', 'MRTransmitCoilSequence'],\r\n    '9050': ['LO', '1', 'TransmitCoilManufacturerName'],\r\n    '9051': ['CS', '1', 'TransmitCoilType'],\r\n    '9052': ['FD', '1-2', 'SpectralWidth'],\r\n    '9053': ['FD', '1-2', 'ChemicalShiftReference'],\r\n    '9054': ['CS', '1', 'VolumeLocalizationTechnique'],\r\n    '9058': ['US', '1', 'MRAcquisitionFrequencyEncodingSteps'],\r\n    '9059': ['CS', '1', 'Decoupling'],\r\n    '9060': ['CS', '1-2', 'DecoupledNucleus'],\r\n    '9061': ['FD', '1-2', 'DecouplingFrequency'],\r\n    '9062': ['CS', '1', 'DecouplingMethod'],\r\n    '9063': ['FD', '1-2', 'DecouplingChemicalShiftReference'],\r\n    '9064': ['CS', '1', 'KSpaceFiltering'],\r\n    '9065': ['CS', '1-2', 'TimeDomainFiltering'],\r\n    '9066': ['US', '1-2', 'NumberOfZeroFills'],\r\n    '9067': ['CS', '1', 'BaselineCorrection'],\r\n    '9069': ['FD', '1', 'ParallelReductionFactorInPlane'],\r\n    '9070': ['FD', '1', 'CardiacRRIntervalSpecified'],\r\n    '9073': ['FD', '1', 'AcquisitionDuration'],\r\n    '9074': ['DT', '1', 'FrameAcquisitionDateTime'],\r\n    '9075': ['CS', '1', 'DiffusionDirectionality'],\r\n    '9076': ['SQ', '1', 'DiffusionGradientDirectionSequence'],\r\n    '9077': ['CS', '1', 'ParallelAcquisition'],\r\n    '9078': ['CS', '1', 'ParallelAcquisitionTechnique'],\r\n    '9079': ['FD', '1-n', 'InversionTimes'],\r\n    '9080': ['ST', '1', 'MetaboliteMapDescription'],\r\n    '9081': ['CS', '1', 'PartialFourier'],\r\n    '9082': ['FD', '1', 'EffectiveEchoTime'],\r\n    '9083': ['SQ', '1', 'MetaboliteMapCodeSequence'],\r\n    '9084': ['SQ', '1', 'ChemicalShiftSequence'],\r\n    '9085': ['CS', '1', 'CardiacSignalSource'],\r\n    '9087': ['FD', '1', 'DiffusionBValue'],\r\n    '9089': ['FD', '3', 'DiffusionGradientOrientation'],\r\n    '9090': ['FD', '3', 'VelocityEncodingDirection'],\r\n    '9091': ['FD', '1', 'VelocityEncodingMinimumValue'],\r\n    '9092': ['SQ', '1', 'VelocityEncodingAcquisitionSequence'],\r\n    '9093': ['US', '1', 'NumberOfKSpaceTrajectories'],\r\n    '9094': ['CS', '1', 'CoverageOfKSpace'],\r\n    '9095': ['UL', '1', 'SpectroscopyAcquisitionPhaseRows'],\r\n    '9096': ['FD', '1', 'ParallelReductionFactorInPlaneRetired'],\r\n    '9098': ['FD', '1-2', 'TransmitterFrequency'],\r\n    '9100': ['CS', '1-2', 'ResonantNucleus'],\r\n    '9101': ['CS', '1', 'FrequencyCorrection'],\r\n    '9103': ['SQ', '1', 'MRSpectroscopyFOVGeometrySequence'],\r\n    '9104': ['FD', '1', 'SlabThickness'],\r\n    '9105': ['FD', '3', 'SlabOrientation'],\r\n    '9106': ['FD', '3', 'MidSlabPosition'],\r\n    '9107': ['SQ', '1', 'MRSpatialSaturationSequence'],\r\n    '9112': ['SQ', '1', 'MRTimingAndRelatedParametersSequence'],\r\n    '9114': ['SQ', '1', 'MREchoSequence'],\r\n    '9115': ['SQ', '1', 'MRModifierSequence'],\r\n    '9117': ['SQ', '1', 'MRDiffusionSequence'],\r\n    '9118': ['SQ', '1', 'CardiacSynchronizationSequence'],\r\n    '9119': ['SQ', '1', 'MRAveragesSequence'],\r\n    '9125': ['SQ', '1', 'MRFOVGeometrySequence'],\r\n    '9126': ['SQ', '1', 'VolumeLocalizationSequence'],\r\n    '9127': ['UL', '1', 'SpectroscopyAcquisitionDataColumns'],\r\n    '9147': ['CS', '1', 'DiffusionAnisotropyType'],\r\n    '9151': ['DT', '1', 'FrameReferenceDateTime'],\r\n    '9152': ['SQ', '1', 'MRMetaboliteMapSequence'],\r\n    '9155': ['FD', '1', 'ParallelReductionFactorOutOfPlane'],\r\n    '9159': ['UL', '1', 'SpectroscopyAcquisitionOutOfPlanePhaseSteps'],\r\n    '9166': ['CS', '1', 'BulkMotionStatus'],\r\n    '9168': ['FD', '1', 'ParallelReductionFactorSecondInPlane'],\r\n    '9169': ['CS', '1', 'CardiacBeatRejectionTechnique'],\r\n    '9170': ['CS', '1', 'RespiratoryMotionCompensationTechnique'],\r\n    '9171': ['CS', '1', 'RespiratorySignalSource'],\r\n    '9172': ['CS', '1', 'BulkMotionCompensationTechnique'],\r\n    '9173': ['CS', '1', 'BulkMotionSignalSource'],\r\n    '9174': ['CS', '1', 'ApplicableSafetyStandardAgency'],\r\n    '9175': ['LO', '1', 'ApplicableSafetyStandardDescription'],\r\n    '9176': ['SQ', '1', 'OperatingModeSequence'],\r\n    '9177': ['CS', '1', 'OperatingModeType'],\r\n    '9178': ['CS', '1', 'OperatingMode'],\r\n    '9179': ['CS', '1', 'SpecificAbsorptionRateDefinition'],\r\n    '9180': ['CS', '1', 'GradientOutputType'],\r\n    '9181': ['FD', '1', 'SpecificAbsorptionRateValue'],\r\n    '9182': ['FD', '1', 'GradientOutput'],\r\n    '9183': ['CS', '1', 'FlowCompensationDirection'],\r\n    '9184': ['FD', '1', 'TaggingDelay'],\r\n    '9185': ['ST', '1', 'RespiratoryMotionCompensationTechniqueDescription'],\r\n    '9186': ['SH', '1', 'RespiratorySignalSourceID'],\r\n    '9195': ['FD', '1', 'ChemicalShiftMinimumIntegrationLimitInHz'],\r\n    '9196': ['FD', '1', 'ChemicalShiftMaximumIntegrationLimitInHz'],\r\n    '9197': ['SQ', '1', 'MRVelocityEncodingSequence'],\r\n    '9198': ['CS', '1', 'FirstOrderPhaseCorrection'],\r\n    '9199': ['CS', '1', 'WaterReferencedPhaseCorrection'],\r\n    '9200': ['CS', '1', 'MRSpectroscopyAcquisitionType'],\r\n    '9214': ['CS', '1', 'RespiratoryCyclePosition'],\r\n    '9217': ['FD', '1', 'VelocityEncodingMaximumValue'],\r\n    '9218': ['FD', '1', 'TagSpacingSecondDimension'],\r\n    '9219': ['SS', '1', 'TagAngleSecondAxis'],\r\n    '9220': ['FD', '1', 'FrameAcquisitionDuration'],\r\n    '9226': ['SQ', '1', 'MRImageFrameTypeSequence'],\r\n    '9227': ['SQ', '1', 'MRSpectroscopyFrameTypeSequence'],\r\n    '9231': ['US', '1', 'MRAcquisitionPhaseEncodingStepsInPlane'],\r\n    '9232': ['US', '1', 'MRAcquisitionPhaseEncodingStepsOutOfPlane'],\r\n    '9234': ['UL', '1', 'SpectroscopyAcquisitionPhaseColumns'],\r\n    '9236': ['CS', '1', 'CardiacCyclePosition'],\r\n    '9239': ['SQ', '1', 'SpecificAbsorptionRateSequence'],\r\n    '9240': ['US', '1', 'RFEchoTrainLength'],\r\n    '9241': ['US', '1', 'GradientEchoTrainLength'],\r\n    '9250': ['CS', '1', 'ArterialSpinLabelingContrast'],\r\n    '9251': ['SQ', '1', 'MRArterialSpinLabelingSequence'],\r\n    '9252': ['LO', '1', 'ASLTechniqueDescription'],\r\n    '9253': ['US', '1', 'ASLSlabNumber'],\r\n    '9254': ['FD', '1', 'ASLSlabThickness'],\r\n    '9255': ['FD', '3', 'ASLSlabOrientation'],\r\n    '9256': ['FD', '3', 'ASLMidSlabPosition'],\r\n    '9257': ['CS', '1', 'ASLContext'],\r\n    '9258': ['UL', '1', 'ASLPulseTrainDuration'],\r\n    '9259': ['CS', '1', 'ASLCrusherFlag'],\r\n    '925A': ['FD', '1', 'ASLCrusherFlowLimit'],\r\n    '925B': ['LO', '1', 'ASLCrusherDescription'],\r\n    '925C': ['CS', '1', 'ASLBolusCutoffFlag'],\r\n    '925D': ['SQ', '1', 'ASLBolusCutoffTimingSequence'],\r\n    '925E': ['LO', '1', 'ASLBolusCutoffTechnique'],\r\n    '925F': ['UL', '1', 'ASLBolusCutoffDelayTime'],\r\n    '9260': ['SQ', '1', 'ASLSlabSequence'],\r\n    '9295': ['FD', '1', 'ChemicalShiftMinimumIntegrationLimitInppm'],\r\n    '9296': ['FD', '1', 'ChemicalShiftMaximumIntegrationLimitInppm'],\r\n    '9297': ['CS', '1', 'WaterReferenceAcquisition'],\r\n    '9298': ['IS', '1', 'EchoPeakPosition'],\r\n    '9301': ['SQ', '1', 'CTAcquisitionTypeSequence'],\r\n    '9302': ['CS', '1', 'AcquisitionType'],\r\n    '9303': ['FD', '1', 'TubeAngle'],\r\n    '9304': ['SQ', '1', 'CTAcquisitionDetailsSequence'],\r\n    '9305': ['FD', '1', 'RevolutionTime'],\r\n    '9306': ['FD', '1', 'SingleCollimationWidth'],\r\n    '9307': ['FD', '1', 'TotalCollimationWidth'],\r\n    '9308': ['SQ', '1', 'CTTableDynamicsSequence'],\r\n    '9309': ['FD', '1', 'TableSpeed'],\r\n    '9310': ['FD', '1', 'TableFeedPerRotation'],\r\n    '9311': ['FD', '1', 'SpiralPitchFactor'],\r\n    '9312': ['SQ', '1', 'CTGeometrySequence'],\r\n    '9313': ['FD', '3', 'DataCollectionCenterPatient'],\r\n    '9314': ['SQ', '1', 'CTReconstructionSequence'],\r\n    '9315': ['CS', '1', 'ReconstructionAlgorithm'],\r\n    '9316': ['CS', '1', 'ConvolutionKernelGroup'],\r\n    '9317': ['FD', '2', 'ReconstructionFieldOfView'],\r\n    '9318': ['FD', '3', 'ReconstructionTargetCenterPatient'],\r\n    '9319': ['FD', '1', 'ReconstructionAngle'],\r\n    '9320': ['SH', '1', 'ImageFilter'],\r\n    '9321': ['SQ', '1', 'CTExposureSequence'],\r\n    '9322': ['FD', '2', 'ReconstructionPixelSpacing'],\r\n    '9323': ['CS', '1-n', 'ExposureModulationType'],\r\n    '9324': ['FD', '1', 'EstimatedDoseSaving'],\r\n    '9325': ['SQ', '1', 'CTXRayDetailsSequence'],\r\n    '9326': ['SQ', '1', 'CTPositionSequence'],\r\n    '9327': ['FD', '1', 'TablePosition'],\r\n    '9328': ['FD', '1', 'ExposureTimeInms'],\r\n    '9329': ['SQ', '1', 'CTImageFrameTypeSequence'],\r\n    '9330': ['FD', '1', 'XRayTubeCurrentInmA'],\r\n    '9332': ['FD', '1', 'ExposureInmAs'],\r\n    '9333': ['CS', '1', 'ConstantVolumeFlag'],\r\n    '9334': ['CS', '1', 'FluoroscopyFlag'],\r\n    '9335': ['FD', '1', 'DistanceSourceToDataCollectionCenter'],\r\n    '9337': ['US', '1', 'ContrastBolusAgentNumber'],\r\n    '9338': ['SQ', '1', 'ContrastBolusIngredientCodeSequence'],\r\n    '9340': ['SQ', '1', 'ContrastAdministrationProfileSequence'],\r\n    '9341': ['SQ', '1', 'ContrastBolusUsageSequence'],\r\n    '9342': ['CS', '1', 'ContrastBolusAgentAdministered'],\r\n    '9343': ['CS', '1', 'ContrastBolusAgentDetected'],\r\n    '9344': ['CS', '1', 'ContrastBolusAgentPhase'],\r\n    '9345': ['FD', '1', 'CTDIvol'],\r\n    '9346': ['SQ', '1', 'CTDIPhantomTypeCodeSequence'],\r\n    '9351': ['FL', '1', 'CalciumScoringMassFactorPatient'],\r\n    '9352': ['FL', '3', 'CalciumScoringMassFactorDevice'],\r\n    '9353': ['FL', '1', 'EnergyWeightingFactor'],\r\n    '9360': ['SQ', '1', 'CTAdditionalXRaySourceSequence'],\r\n    '9361': ['CS', '1', 'MultienergyCTAcquisition'],\r\n    '9362': ['SQ', '1', 'MultienergyCTAcquisitionSequence'],\r\n    '9363': ['SQ', '1', 'MultienergyCTProcessingSequence'],\r\n    '9364': ['SQ', '1', 'MultienergyCTCharacteristicsSequence'],\r\n    '9365': ['SQ', '1', 'MultienergyCTXRaySourceSequence'],\r\n    '9366': ['US', '1', 'XRaySourceIndex'],\r\n    '9367': ['UC', '1', 'XRaySourceID'],\r\n    '9368': ['CS', '1', 'MultienergySourceTechnique'],\r\n    '9369': ['DT', '1', 'SourceStartDateTime'],\r\n    '936A': ['DT', '1', 'SourceEndDateTime'],\r\n    '936B': ['US', '1', 'SwitchingPhaseNumber'],\r\n    '936C': ['DS', '1', 'SwitchingPhaseNominalDuration'],\r\n    '936D': ['DS', '1', 'SwitchingPhaseTransitionDuration'],\r\n    '936E': ['DS', '1', 'EffectiveBinEnergy'],\r\n    '936F': ['SQ', '1', 'MultienergyCTXRayDetectorSequence'],\r\n    '9370': ['US', '1', 'XRayDetectorIndex'],\r\n    '9371': ['UC', '1', 'XRayDetectorID'],\r\n    '9372': ['CS', '1', 'MultienergyDetectorType'],\r\n    '9373': ['ST', '1', 'XRayDetectorLabel'],\r\n    '9374': ['DS', '1', 'NominalMaxEnergy'],\r\n    '9375': ['DS', '1', 'NominalMinEnergy'],\r\n    '9376': ['US', '1-n', 'ReferencedXRayDetectorIndex'],\r\n    '9377': ['US', '1-n', 'ReferencedXRaySourceIndex'],\r\n    '9378': ['US', '1-n', 'ReferencedPathIndex'],\r\n    '9379': ['SQ', '1', 'MultienergyCTPathSequence'],\r\n    '937A': ['US', '1', 'MultienergyCTPathIndex'],\r\n    '937B': ['UT', '1', 'MultienergyAcquisitionDescription'],\r\n    '937C': ['FD', '1', 'MonoenergeticEnergyEquivalent'],\r\n    '937D': ['SQ', '1', 'MaterialCodeSequence'],\r\n    '937E': ['CS', '1', 'DecompositionMethod'],\r\n    '937F': ['UT', '1', 'DecompositionDescription'],\r\n    '9380': ['SQ', '1', 'DecompositionAlgorithmIdentificationSequence'],\r\n    '9381': ['SQ', '1', 'DecompositionMaterialSequence'],\r\n    '9382': ['SQ', '1', 'MaterialAttenuationSequence'],\r\n    '9383': ['DS', '1', 'PhotonEnergy'],\r\n    '9384': ['DS', '1', 'XRayMassAttenuationCoefficient'],\r\n    '9401': ['SQ', '1', 'ProjectionPixelCalibrationSequence'],\r\n    '9402': ['FL', '1', 'DistanceSourceToIsocenter'],\r\n    '9403': ['FL', '1', 'DistanceObjectToTableTop'],\r\n    '9404': ['FL', '2', 'ObjectPixelSpacingInCenterOfBeam'],\r\n    '9405': ['SQ', '1', 'PositionerPositionSequence'],\r\n    '9406': ['SQ', '1', 'TablePositionSequence'],\r\n    '9407': ['SQ', '1', 'CollimatorShapeSequence'],\r\n    '9410': ['CS', '1', 'PlanesInAcquisition'],\r\n    '9412': ['SQ', '1', 'XAXRFFrameCharacteristicsSequence'],\r\n    '9417': ['SQ', '1', 'FrameAcquisitionSequence'],\r\n    '9420': ['CS', '1', 'XRayReceptorType'],\r\n    '9423': ['LO', '1', 'AcquisitionProtocolName'],\r\n    '9424': ['LT', '1', 'AcquisitionProtocolDescription'],\r\n    '9425': ['CS', '1', 'ContrastBolusIngredientOpaque'],\r\n    '9426': ['FL', '1', 'DistanceReceptorPlaneToDetectorHousing'],\r\n    '9427': ['CS', '1', 'IntensifierActiveShape'],\r\n    '9428': ['FL', '1-2', 'IntensifierActiveDimensions'],\r\n    '9429': ['FL', '2', 'PhysicalDetectorSize'],\r\n    '9430': ['FL', '2', 'PositionOfIsocenterProjection'],\r\n    '9432': ['SQ', '1', 'FieldOfViewSequence'],\r\n    '9433': ['LO', '1', 'FieldOfViewDescription'],\r\n    '9434': ['SQ', '1', 'ExposureControlSensingRegionsSequence'],\r\n    '9435': ['CS', '1', 'ExposureControlSensingRegionShape'],\r\n    '9436': ['SS', '1', 'ExposureControlSensingRegionLeftVerticalEdge'],\r\n    '9437': ['SS', '1', 'ExposureControlSensingRegionRightVerticalEdge'],\r\n    '9438': ['SS', '1', 'ExposureControlSensingRegionUpperHorizontalEdge'],\r\n    '9439': ['SS', '1', 'ExposureControlSensingRegionLowerHorizontalEdge'],\r\n    '9440': ['SS', '2', 'CenterOfCircularExposureControlSensingRegion'],\r\n    '9441': ['US', '1', 'RadiusOfCircularExposureControlSensingRegion'],\r\n    '9442': ['SS', '2-n', 'VerticesOfThePolygonalExposureControlSensingRegion'],\r\n    '9445': ['', '', ''],\r\n    '9447': ['FL', '1', 'ColumnAngulationPatient'],\r\n    '9449': ['FL', '1', 'BeamAngle'],\r\n    '9451': ['SQ', '1', 'FrameDetectorParametersSequence'],\r\n    '9452': ['FL', '1', 'CalculatedAnatomyThickness'],\r\n    '9455': ['SQ', '1', 'CalibrationSequence'],\r\n    '9456': ['SQ', '1', 'ObjectThicknessSequence'],\r\n    '9457': ['CS', '1', 'PlaneIdentification'],\r\n    '9461': ['FL', '1-2', 'FieldOfViewDimensionsInFloat'],\r\n    '9462': ['SQ', '1', 'IsocenterReferenceSystemSequence'],\r\n    '9463': ['FL', '1', 'PositionerIsocenterPrimaryAngle'],\r\n    '9464': ['FL', '1', 'PositionerIsocenterSecondaryAngle'],\r\n    '9465': ['FL', '1', 'PositionerIsocenterDetectorRotationAngle'],\r\n    '9466': ['FL', '1', 'TableXPositionToIsocenter'],\r\n    '9467': ['FL', '1', 'TableYPositionToIsocenter'],\r\n    '9468': ['FL', '1', 'TableZPositionToIsocenter'],\r\n    '9469': ['FL', '1', 'TableHorizontalRotationAngle'],\r\n    '9470': ['FL', '1', 'TableHeadTiltAngle'],\r\n    '9471': ['FL', '1', 'TableCradleTiltAngle'],\r\n    '9472': ['SQ', '1', 'FrameDisplayShutterSequence'],\r\n    '9473': ['FL', '1', 'AcquiredImageAreaDoseProduct'],\r\n    '9474': ['CS', '1', 'CArmPositionerTabletopRelationship'],\r\n    '9476': ['SQ', '1', 'XRayGeometrySequence'],\r\n    '9477': ['SQ', '1', 'IrradiationEventIdentificationSequence'],\r\n    '9504': ['SQ', '1', 'XRay3DFrameTypeSequence'],\r\n    '9506': ['SQ', '1', 'ContributingSourcesSequence'],\r\n    '9507': ['SQ', '1', 'XRay3DAcquisitionSequence'],\r\n    '9508': ['FL', '1', 'PrimaryPositionerScanArc'],\r\n    '9509': ['FL', '1', 'SecondaryPositionerScanArc'],\r\n    '9510': ['FL', '1', 'PrimaryPositionerScanStartAngle'],\r\n    '9511': ['FL', '1', 'SecondaryPositionerScanStartAngle'],\r\n    '9514': ['FL', '1', 'PrimaryPositionerIncrement'],\r\n    '9515': ['FL', '1', 'SecondaryPositionerIncrement'],\r\n    '9516': ['DT', '1', 'StartAcquisitionDateTime'],\r\n    '9517': ['DT', '1', 'EndAcquisitionDateTime'],\r\n    '9518': ['SS', '1', 'PrimaryPositionerIncrementSign'],\r\n    '9519': ['SS', '1', 'SecondaryPositionerIncrementSign'],\r\n    '9524': ['LO', '1', 'ApplicationName'],\r\n    '9525': ['LO', '1', 'ApplicationVersion'],\r\n    '9526': ['LO', '1', 'ApplicationManufacturer'],\r\n    '9527': ['CS', '1', 'AlgorithmType'],\r\n    '9528': ['LO', '1', 'AlgorithmDescription'],\r\n    '9530': ['SQ', '1', 'XRay3DReconstructionSequence'],\r\n    '9531': ['LO', '1', 'ReconstructionDescription'],\r\n    '9538': ['SQ', '1', 'PerProjectionAcquisitionSequence'],\r\n    '9541': ['SQ', '1', 'DetectorPositionSequence'],\r\n    '9542': ['SQ', '1', 'XRayAcquisitionDoseSequence'],\r\n    '9543': ['FD', '1', 'XRaySourceIsocenterPrimaryAngle'],\r\n    '9544': ['FD', '1', 'XRaySourceIsocenterSecondaryAngle'],\r\n    '9545': ['FD', '1', 'BreastSupportIsocenterPrimaryAngle'],\r\n    '9546': ['FD', '1', 'BreastSupportIsocenterSecondaryAngle'],\r\n    '9547': ['FD', '1', 'BreastSupportXPositionToIsocenter'],\r\n    '9548': ['FD', '1', 'BreastSupportYPositionToIsocenter'],\r\n    '9549': ['FD', '1', 'BreastSupportZPositionToIsocenter'],\r\n    '9550': ['FD', '1', 'DetectorIsocenterPrimaryAngle'],\r\n    '9551': ['FD', '1', 'DetectorIsocenterSecondaryAngle'],\r\n    '9552': ['FD', '1', 'DetectorXPositionToIsocenter'],\r\n    '9553': ['FD', '1', 'DetectorYPositionToIsocenter'],\r\n    '9554': ['FD', '1', 'DetectorZPositionToIsocenter'],\r\n    '9555': ['SQ', '1', 'XRayGridSequence'],\r\n    '9556': ['SQ', '1', 'XRayFilterSequence'],\r\n    '9557': ['FD', '3', 'DetectorActiveAreaTLHCPosition'],\r\n    '9558': ['FD', '6', 'DetectorActiveAreaOrientation'],\r\n    '9559': ['CS', '1', 'PositionerPrimaryAngleDirection'],\r\n    '9601': ['SQ', '1', 'DiffusionBMatrixSequence'],\r\n    '9602': ['FD', '1', 'DiffusionBValueXX'],\r\n    '9603': ['FD', '1', 'DiffusionBValueXY'],\r\n    '9604': ['FD', '1', 'DiffusionBValueXZ'],\r\n    '9605': ['FD', '1', 'DiffusionBValueYY'],\r\n    '9606': ['FD', '1', 'DiffusionBValueYZ'],\r\n    '9607': ['FD', '1', 'DiffusionBValueZZ'],\r\n    '9621': ['SQ', '1', 'FunctionalMRSequence'],\r\n    '9622': ['CS', '1', 'FunctionalSettlingPhaseFramesPresent'],\r\n    '9623': ['DT', '1', 'FunctionalSyncPulse'],\r\n    '9624': ['CS', '1', 'SettlingPhaseFrame'],\r\n    '9701': ['DT', '1', 'DecayCorrectionDateTime'],\r\n    '9715': ['FD', '1', 'StartDensityThreshold'],\r\n    '9716': ['FD', '1', 'StartRelativeDensityDifferenceThreshold'],\r\n    '9717': ['FD', '1', 'StartCardiacTriggerCountThreshold'],\r\n    '9718': ['FD', '1', 'StartRespiratoryTriggerCountThreshold'],\r\n    '9719': ['FD', '1', 'TerminationCountsThreshold'],\r\n    '9720': ['FD', '1', 'TerminationDensityThreshold'],\r\n    '9721': ['FD', '1', 'TerminationRelativeDensityThreshold'],\r\n    '9722': ['FD', '1', 'TerminationTimeThreshold'],\r\n    '9723': ['FD', '1', 'TerminationCardiacTriggerCountThreshold'],\r\n    '9724': ['FD', '1', 'TerminationRespiratoryTriggerCountThreshold'],\r\n    '9725': ['CS', '1', 'DetectorGeometry'],\r\n    '9726': ['FD', '1', 'TransverseDetectorSeparation'],\r\n    '9727': ['FD', '1', 'AxialDetectorDimension'],\r\n    '9729': ['US', '1', 'RadiopharmaceuticalAgentNumber'],\r\n    '9732': ['SQ', '1', 'PETFrameAcquisitionSequence'],\r\n    '9733': ['SQ', '1', 'PETDetectorMotionDetailsSequence'],\r\n    '9734': ['SQ', '1', 'PETTableDynamicsSequence'],\r\n    '9735': ['SQ', '1', 'PETPositionSequence'],\r\n    '9736': ['SQ', '1', 'PETFrameCorrectionFactorsSequence'],\r\n    '9737': ['SQ', '1', 'RadiopharmaceuticalUsageSequence'],\r\n    '9738': ['CS', '1', 'AttenuationCorrectionSource'],\r\n    '9739': ['US', '1', 'NumberOfIterations'],\r\n    '9740': ['US', '1', 'NumberOfSubsets'],\r\n    '9749': ['SQ', '1', 'PETReconstructionSequence'],\r\n    '9751': ['SQ', '1', 'PETFrameTypeSequence'],\r\n    '9755': ['CS', '1', 'TimeOfFlightInformationUsed'],\r\n    '9756': ['CS', '1', 'ReconstructionType'],\r\n    '9758': ['CS', '1', 'DecayCorrected'],\r\n    '9759': ['CS', '1', 'AttenuationCorrected'],\r\n    '9760': ['CS', '1', 'ScatterCorrected'],\r\n    '9761': ['CS', '1', 'DeadTimeCorrected'],\r\n    '9762': ['CS', '1', 'GantryMotionCorrected'],\r\n    '9763': ['CS', '1', 'PatientMotionCorrected'],\r\n    '9764': ['CS', '1', 'CountLossNormalizationCorrected'],\r\n    '9765': ['CS', '1', 'RandomsCorrected'],\r\n    '9766': ['CS', '1', 'NonUniformRadialSamplingCorrected'],\r\n    '9767': ['CS', '1', 'SensitivityCalibrated'],\r\n    '9768': ['CS', '1', 'DetectorNormalizationCorrection'],\r\n    '9769': ['CS', '1', 'IterativeReconstructionMethod'],\r\n    '9770': ['CS', '1', 'AttenuationCorrectionTemporalRelationship'],\r\n    '9771': ['SQ', '1', 'PatientPhysiologicalStateSequence'],\r\n    '9772': ['SQ', '1', 'PatientPhysiologicalStateCodeSequence'],\r\n    '9801': ['FD', '1-n', 'DepthsOfFocus'],\r\n    '9803': ['SQ', '1', 'ExcludedIntervalsSequence'],\r\n    '9804': ['DT', '1', 'ExclusionStartDateTime'],\r\n    '9805': ['FD', '1', 'ExclusionDuration'],\r\n    '9806': ['SQ', '1', 'USImageDescriptionSequence'],\r\n    '9807': ['SQ', '1', 'ImageDataTypeSequence'],\r\n    '9808': ['CS', '1', 'DataType'],\r\n    '9809': ['SQ', '1', 'TransducerScanPatternCodeSequence'],\r\n    '980B': ['CS', '1', 'AliasedDataType'],\r\n    '980C': ['CS', '1', 'PositionMeasuringDeviceUsed'],\r\n    '980D': ['SQ', '1', 'TransducerGeometryCodeSequence'],\r\n    '980E': ['SQ', '1', 'TransducerBeamSteeringCodeSequence'],\r\n    '980F': ['SQ', '1', 'TransducerApplicationCodeSequence'],\r\n    '9810': ['xs', '1', 'ZeroVelocityPixelValue'],\r\n    '9900': ['LO', '1', 'ReferenceLocationLabel'],\r\n    '9901': ['UT', '1', 'ReferenceLocationDescription'],\r\n    '9902': ['SQ', '1', 'ReferenceBasisCodeSequence'],\r\n    '9903': ['SQ', '1', 'ReferenceGeometryCodeSequence'],\r\n    '9904': ['DS', '1', 'OffsetDistance'],\r\n    '9905': ['CS', '1', 'OffsetDirection'],\r\n    '9906': ['SQ', '1', 'PotentialScheduledProtocolCodeSequence'],\r\n    '9907': ['SQ', '1', 'PotentialRequestedProcedureCodeSequence'],\r\n    '9908': ['UC', '1-n', 'PotentialReasonsForProcedure'],\r\n    '9909': ['SQ', '1', 'PotentialReasonsForProcedureCodeSequence'],\r\n    '990A': ['UC', '1-n', 'PotentialDiagnosticTasks'],\r\n    '990B': ['SQ', '1', 'ContraindicationsCodeSequence'],\r\n    '990C': ['SQ', '1', 'ReferencedDefinedProtocolSequence'],\r\n    '990D': ['SQ', '1', 'ReferencedPerformedProtocolSequence'],\r\n    '990E': ['SQ', '1', 'PredecessorProtocolSequence'],\r\n    '990F': ['UT', '1', 'ProtocolPlanningInformation'],\r\n    '9910': ['UT', '1', 'ProtocolDesignRationale'],\r\n    '9911': ['SQ', '1', 'PatientSpecificationSequence'],\r\n    '9912': ['SQ', '1', 'ModelSpecificationSequence'],\r\n    '9913': ['SQ', '1', 'ParametersSpecificationSequence'],\r\n    '9914': ['SQ', '1', 'InstructionSequence'],\r\n    '9915': ['US', '1', 'InstructionIndex'],\r\n    '9916': ['LO', '1', 'InstructionText'],\r\n    '9917': ['UT', '1', 'InstructionDescription'],\r\n    '9918': ['CS', '1', 'InstructionPerformedFlag'],\r\n    '9919': ['DT', '1', 'InstructionPerformedDateTime'],\r\n    '991A': ['UT', '1', 'InstructionPerformanceComment'],\r\n    '991B': ['SQ', '1', 'PatientPositioningInstructionSequence'],\r\n    '991C': ['SQ', '1', 'PositioningMethodCodeSequence'],\r\n    '991D': ['SQ', '1', 'PositioningLandmarkSequence'],\r\n    '991E': ['UI', '1', 'TargetFrameOfReferenceUID'],\r\n    '991F': ['SQ', '1', 'AcquisitionProtocolElementSpecificationSequence'],\r\n    '9920': ['SQ', '1', 'AcquisitionProtocolElementSequence'],\r\n    '9921': ['US', '1', 'ProtocolElementNumber'],\r\n    '9922': ['LO', '1', 'ProtocolElementName'],\r\n    '9923': ['UT', '1', 'ProtocolElementCharacteristicsSummary'],\r\n    '9924': ['UT', '1', 'ProtocolElementPurpose'],\r\n    '9930': ['CS', '1', 'AcquisitionMotion'],\r\n    '9931': ['SQ', '1', 'AcquisitionStartLocationSequence'],\r\n    '9932': ['SQ', '1', 'AcquisitionEndLocationSequence'],\r\n    '9933': ['SQ', '1', 'ReconstructionProtocolElementSpecificationSequence'],\r\n    '9934': ['SQ', '1', 'ReconstructionProtocolElementSequence'],\r\n    '9935': ['SQ', '1', 'StorageProtocolElementSpecificationSequence'],\r\n    '9936': ['SQ', '1', 'StorageProtocolElementSequence'],\r\n    '9937': ['LO', '1', 'RequestedSeriesDescription'],\r\n    '9938': ['US', '1-n', 'SourceAcquisitionProtocolElementNumber'],\r\n    '9939': ['US', '1-n', 'SourceAcquisitionBeamNumber'],\r\n    '993A': ['US', '1-n', 'SourceReconstructionProtocolElementNumber'],\r\n    '993B': ['SQ', '1', 'ReconstructionStartLocationSequence'],\r\n    '993C': ['SQ', '1', 'ReconstructionEndLocationSequence'],\r\n    '993D': ['SQ', '1', 'ReconstructionAlgorithmSequence'],\r\n    '993E': ['SQ', '1', 'ReconstructionTargetCenterLocationSequence'],\r\n    '9941': ['UT', '1', 'ImageFilterDescription'],\r\n    '9942': ['FD', '1', 'CTDIvolNotificationTrigger'],\r\n    '9943': ['FD', '1', 'DLPNotificationTrigger'],\r\n    '9944': ['CS', '1', 'AutoKVPSelectionType'],\r\n    '9945': ['FD', '1', 'AutoKVPUpperBound'],\r\n    '9946': ['FD', '1', 'AutoKVPLowerBound'],\r\n    '9947': ['CS', '1', 'ProtocolDefinedPatientPosition'],\r\n    'A001': ['SQ', '1', 'ContributingEquipmentSequence'],\r\n    'A002': ['DT', '1', 'ContributionDateTime'],\r\n    'A003': ['ST', '1', 'ContributionDescription']\r\n  },\r\n  '0020': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '000D': ['UI', '1', 'StudyInstanceUID'],\r\n    '000E': ['UI', '1', 'SeriesInstanceUID'],\r\n    '0010': ['SH', '1', 'StudyID'],\r\n    '0011': ['IS', '1', 'SeriesNumber'],\r\n    '0012': ['IS', '1', 'AcquisitionNumber'],\r\n    '0013': ['IS', '1', 'InstanceNumber'],\r\n    '0014': ['IS', '1', 'IsotopeNumber'],\r\n    '0015': ['IS', '1', 'PhaseNumber'],\r\n    '0016': ['IS', '1', 'IntervalNumber'],\r\n    '0017': ['IS', '1', 'TimeSlotNumber'],\r\n    '0018': ['IS', '1', 'AngleNumber'],\r\n    '0019': ['IS', '1', 'ItemNumber'],\r\n    '0020': ['CS', '2', 'PatientOrientation'],\r\n    '0022': ['IS', '1', 'OverlayNumber'],\r\n    '0024': ['IS', '1', 'CurveNumber'],\r\n    '0026': ['IS', '1', 'LUTNumber'],\r\n    '0030': ['DS', '3', 'ImagePosition'],\r\n    '0032': ['DS', '3', 'ImagePositionPatient'],\r\n    '0035': ['DS', '6', 'ImageOrientation'],\r\n    '0037': ['DS', '6', 'ImageOrientationPatient'],\r\n    '0050': ['DS', '1', 'Location'],\r\n    '0052': ['UI', '1', 'FrameOfReferenceUID'],\r\n    '0060': ['CS', '1', 'Laterality'],\r\n    '0062': ['CS', '1', 'ImageLaterality'],\r\n    '0070': ['LO', '1', 'ImageGeometryType'],\r\n    '0080': ['CS', '1-n', 'MaskingImage'],\r\n    '00AA': ['IS', '1', 'ReportNumber'],\r\n    '0100': ['IS', '1', 'TemporalPositionIdentifier'],\r\n    '0105': ['IS', '1', 'NumberOfTemporalPositions'],\r\n    '0110': ['DS', '1', 'TemporalResolution'],\r\n    '0200': ['UI', '1', 'SynchronizationFrameOfReferenceUID'],\r\n    '0242': ['UI', '1', 'SOPInstanceUIDOfConcatenationSource'],\r\n    '1000': ['IS', '1', 'SeriesInStudy'],\r\n    '1001': ['IS', '1', 'AcquisitionsInSeries'],\r\n    '1002': ['IS', '1', 'ImagesInAcquisition'],\r\n    '1003': ['IS', '1', 'ImagesInSeries'],\r\n    '1004': ['IS', '1', 'AcquisitionsInStudy'],\r\n    '1005': ['IS', '1', 'ImagesInStudy'],\r\n    '1020': ['LO', '1-n', 'Reference'],\r\n    '103F': ['LO', '1', 'TargetPositionReferenceIndicator'],\r\n    '1040': ['LO', '1', 'PositionReferenceIndicator'],\r\n    '1041': ['DS', '1', 'SliceLocation'],\r\n    '1070': ['IS', '1-n', 'OtherStudyNumbers'],\r\n    '1200': ['IS', '1', 'NumberOfPatientRelatedStudies'],\r\n    '1202': ['IS', '1', 'NumberOfPatientRelatedSeries'],\r\n    '1204': ['IS', '1', 'NumberOfPatientRelatedInstances'],\r\n    '1206': ['IS', '1', 'NumberOfStudyRelatedSeries'],\r\n    '1208': ['IS', '1', 'NumberOfStudyRelatedInstances'],\r\n    '1209': ['IS', '1', 'NumberOfSeriesRelatedInstances'],\r\n    '3100': ['CS', '1-n', 'SourceImageIDs'],\r\n    '3401': ['CS', '1', 'ModifyingDeviceID'],\r\n    '3402': ['CS', '1', 'ModifiedImageID'],\r\n    '3403': ['DA', '1', 'ModifiedImageDate'],\r\n    '3404': ['LO', '1', 'ModifyingDeviceManufacturer'],\r\n    '3405': ['TM', '1', 'ModifiedImageTime'],\r\n    '3406': ['LO', '1', 'ModifiedImageDescription'],\r\n    '4000': ['LT', '1', 'ImageComments'],\r\n    '5000': ['AT', '1-n', 'OriginalImageIdentification'],\r\n    '5002': ['LO', '1-n', 'OriginalImageIdentificationNomenclature'],\r\n    '9056': ['SH', '1', 'StackID'],\r\n    '9057': ['UL', '1', 'InStackPositionNumber'],\r\n    '9071': ['SQ', '1', 'FrameAnatomySequence'],\r\n    '9072': ['CS', '1', 'FrameLaterality'],\r\n    '9111': ['SQ', '1', 'FrameContentSequence'],\r\n    '9113': ['SQ', '1', 'PlanePositionSequence'],\r\n    '9116': ['SQ', '1', 'PlaneOrientationSequence'],\r\n    '9128': ['UL', '1', 'TemporalPositionIndex'],\r\n    '9153': ['FD', '1', 'NominalCardiacTriggerDelayTime'],\r\n    '9154': ['FL', '1', 'NominalCardiacTriggerTimePriorToRPeak'],\r\n    '9155': ['FL', '1', 'ActualCardiacTriggerTimePriorToRPeak'],\r\n    '9156': ['US', '1', 'FrameAcquisitionNumber'],\r\n    '9157': ['UL', '1-n', 'DimensionIndexValues'],\r\n    '9158': ['LT', '1', 'FrameComments'],\r\n    '9161': ['UI', '1', 'ConcatenationUID'],\r\n    '9162': ['US', '1', 'InConcatenationNumber'],\r\n    '9163': ['US', '1', 'InConcatenationTotalNumber'],\r\n    '9164': ['UI', '1', 'DimensionOrganizationUID'],\r\n    '9165': ['AT', '1', 'DimensionIndexPointer'],\r\n    '9167': ['AT', '1', 'FunctionalGroupPointer'],\r\n    '9170': ['SQ', '1', 'UnassignedSharedConvertedAttributesSequence'],\r\n    '9171': ['SQ', '1', 'UnassignedPerFrameConvertedAttributesSequence'],\r\n    '9172': ['SQ', '1', 'ConversionSourceAttributesSequence'],\r\n    '9213': ['LO', '1', 'DimensionIndexPrivateCreator'],\r\n    '9221': ['SQ', '1', 'DimensionOrganizationSequence'],\r\n    '9222': ['SQ', '1', 'DimensionIndexSequence'],\r\n    '9228': ['UL', '1', 'ConcatenationFrameOffsetNumber'],\r\n    '9238': ['LO', '1', 'FunctionalGroupPrivateCreator'],\r\n    '9241': ['FL', '1', 'NominalPercentageOfCardiacPhase'],\r\n    '9245': ['FL', '1', 'NominalPercentageOfRespiratoryPhase'],\r\n    '9246': ['FL', '1', 'StartingRespiratoryAmplitude'],\r\n    '9247': ['CS', '1', 'StartingRespiratoryPhase'],\r\n    '9248': ['FL', '1', 'EndingRespiratoryAmplitude'],\r\n    '9249': ['CS', '1', 'EndingRespiratoryPhase'],\r\n    '9250': ['CS', '1', 'RespiratoryTriggerType'],\r\n    '9251': ['FD', '1', 'RRIntervalTimeNominal'],\r\n    '9252': ['FD', '1', 'ActualCardiacTriggerDelayTime'],\r\n    '9253': ['SQ', '1', 'RespiratorySynchronizationSequence'],\r\n    '9254': ['FD', '1', 'RespiratoryIntervalTime'],\r\n    '9255': ['FD', '1', 'NominalRespiratoryTriggerDelayTime'],\r\n    '9256': ['FD', '1', 'RespiratoryTriggerDelayThreshold'],\r\n    '9257': ['FD', '1', 'ActualRespiratoryTriggerDelayTime'],\r\n    '9301': ['FD', '3', 'ImagePositionVolume'],\r\n    '9302': ['FD', '6', 'ImageOrientationVolume'],\r\n    '9307': ['CS', '1', 'UltrasoundAcquisitionGeometry'],\r\n    '9308': ['FD', '3', 'ApexPosition'],\r\n    '9309': ['FD', '16', 'VolumeToTransducerMappingMatrix'],\r\n    '930A': ['FD', '16', 'VolumeToTableMappingMatrix'],\r\n    '930B': ['CS', '1', 'VolumeToTransducerRelationship'],\r\n    '930C': ['CS', '1', 'PatientFrameOfReferenceSource'],\r\n    '930D': ['FD', '1', 'TemporalPositionTimeOffset'],\r\n    '930E': ['SQ', '1', 'PlanePositionVolumeSequence'],\r\n    '930F': ['SQ', '1', 'PlaneOrientationVolumeSequence'],\r\n    '9310': ['SQ', '1', 'TemporalPositionSequence'],\r\n    '9311': ['CS', '1', 'DimensionOrganizationType'],\r\n    '9312': ['UI', '1', 'VolumeFrameOfReferenceUID'],\r\n    '9313': ['UI', '1', 'TableFrameOfReferenceUID'],\r\n    '9421': ['LO', '1', 'DimensionDescriptionLabel'],\r\n    '9450': ['SQ', '1', 'PatientOrientationInFrameSequence'],\r\n    '9453': ['LO', '1', 'FrameLabel'],\r\n    '9518': ['US', '1-n', 'AcquisitionIndex'],\r\n    '9529': ['SQ', '1', 'ContributingSOPInstancesReferenceSequence'],\r\n    '9536': ['US', '1', 'ReconstructionIndex']\r\n  },\r\n  '0022': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['US', '1', 'LightPathFilterPassThroughWavelength'],\r\n    '0002': ['US', '2', 'LightPathFilterPassBand'],\r\n    '0003': ['US', '1', 'ImagePathFilterPassThroughWavelength'],\r\n    '0004': ['US', '2', 'ImagePathFilterPassBand'],\r\n    '0005': ['CS', '1', 'PatientEyeMovementCommanded'],\r\n    '0006': ['SQ', '1', 'PatientEyeMovementCommandCodeSequence'],\r\n    '0007': ['FL', '1', 'SphericalLensPower'],\r\n    '0008': ['FL', '1', 'CylinderLensPower'],\r\n    '0009': ['FL', '1', 'CylinderAxis'],\r\n    '000A': ['FL', '1', 'EmmetropicMagnification'],\r\n    '000B': ['FL', '1', 'IntraOcularPressure'],\r\n    '000C': ['FL', '1', 'HorizontalFieldOfView'],\r\n    '000D': ['CS', '1', 'PupilDilated'],\r\n    '000E': ['FL', '1', 'DegreeOfDilation'],\r\n    '0010': ['FL', '1', 'StereoBaselineAngle'],\r\n    '0011': ['FL', '1', 'StereoBaselineDisplacement'],\r\n    '0012': ['FL', '1', 'StereoHorizontalPixelOffset'],\r\n    '0013': ['FL', '1', 'StereoVerticalPixelOffset'],\r\n    '0014': ['FL', '1', 'StereoRotation'],\r\n    '0015': ['SQ', '1', 'AcquisitionDeviceTypeCodeSequence'],\r\n    '0016': ['SQ', '1', 'IlluminationTypeCodeSequence'],\r\n    '0017': ['SQ', '1', 'LightPathFilterTypeStackCodeSequence'],\r\n    '0018': ['SQ', '1', 'ImagePathFilterTypeStackCodeSequence'],\r\n    '0019': ['SQ', '1', 'LensesCodeSequence'],\r\n    '001A': ['SQ', '1', 'ChannelDescriptionCodeSequence'],\r\n    '001B': ['SQ', '1', 'RefractiveStateSequence'],\r\n    '001C': ['SQ', '1', 'MydriaticAgentCodeSequence'],\r\n    '001D': ['SQ', '1', 'RelativeImagePositionCodeSequence'],\r\n    '001E': ['FL', '1', 'CameraAngleOfView'],\r\n    '0020': ['SQ', '1', 'StereoPairsSequence'],\r\n    '0021': ['SQ', '1', 'LeftImageSequence'],\r\n    '0022': ['SQ', '1', 'RightImageSequence'],\r\n    '0028': ['CS', '1', 'StereoPairsPresent'],\r\n    '0030': ['FL', '1', 'AxialLengthOfTheEye'],\r\n    '0031': ['SQ', '1', 'OphthalmicFrameLocationSequence'],\r\n    '0032': ['FL', '2-2n', 'ReferenceCoordinates'],\r\n    '0035': ['FL', '1', 'DepthSpatialResolution'],\r\n    '0036': ['FL', '1', 'MaximumDepthDistortion'],\r\n    '0037': ['FL', '1', 'AlongScanSpatialResolution'],\r\n    '0038': ['FL', '1', 'MaximumAlongScanDistortion'],\r\n    '0039': ['CS', '1', 'OphthalmicImageOrientation'],\r\n    '0041': ['FL', '1', 'DepthOfTransverseImage'],\r\n    '0042': ['SQ', '1', 'MydriaticAgentConcentrationUnitsSequence'],\r\n    '0048': ['FL', '1', 'AcrossScanSpatialResolution'],\r\n    '0049': ['FL', '1', 'MaximumAcrossScanDistortion'],\r\n    '004E': ['DS', '1', 'MydriaticAgentConcentration'],\r\n    '0055': ['FL', '1', 'IlluminationWaveLength'],\r\n    '0056': ['FL', '1', 'IlluminationPower'],\r\n    '0057': ['FL', '1', 'IlluminationBandwidth'],\r\n    '0058': ['SQ', '1', 'MydriaticAgentSequence'],\r\n    '1007': ['SQ', '1', 'OphthalmicAxialMeasurementsRightEyeSequence'],\r\n    '1008': ['SQ', '1', 'OphthalmicAxialMeasurementsLeftEyeSequence'],\r\n    '1009': ['CS', '1', 'OphthalmicAxialMeasurementsDeviceType'],\r\n    '1010': ['CS', '1', 'OphthalmicAxialLengthMeasurementsType'],\r\n    '1012': ['SQ', '1', 'OphthalmicAxialLengthSequence'],\r\n    '1019': ['FL', '1', 'OphthalmicAxialLength'],\r\n    '1024': ['SQ', '1', 'LensStatusCodeSequence'],\r\n    '1025': ['SQ', '1', 'VitreousStatusCodeSequence'],\r\n    '1028': ['SQ', '1', 'IOLFormulaCodeSequence'],\r\n    '1029': ['LO', '1', 'IOLFormulaDetail'],\r\n    '1033': ['FL', '1', 'KeratometerIndex'],\r\n    '1035': ['SQ', '1', 'SourceOfOphthalmicAxialLengthCodeSequence'],\r\n    '1036': ['SQ', '1', 'SourceOfCornealSizeDataCodeSequence'],\r\n    '1037': ['FL', '1', 'TargetRefraction'],\r\n    '1039': ['CS', '1', 'RefractiveProcedureOccurred'],\r\n    '1040': ['SQ', '1', 'RefractiveSurgeryTypeCodeSequence'],\r\n    '1044': ['SQ', '1', 'OphthalmicUltrasoundMethodCodeSequence'],\r\n    '1045': ['SQ', '1', 'SurgicallyInducedAstigmatismSequence'],\r\n    '1046': ['CS', '1', 'TypeOfOpticalCorrection'],\r\n    '1047': ['SQ', '1', 'ToricIOLPowerSequence'],\r\n    '1048': ['SQ', '1', 'PredictedToricErrorSequence'],\r\n    '1049': ['CS', '1', 'PreSelectedForImplantation'],\r\n    '104A': ['SQ', '1', 'ToricIOLPowerForExactEmmetropiaSequence'],\r\n    '104B': ['SQ', '1', 'ToricIOLPowerForExactTargetRefractionSequence'],\r\n    '1050': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsSequence'],\r\n    '1053': ['FL', '1', 'IOLPower'],\r\n    '1054': ['FL', '1', 'PredictedRefractiveError'],\r\n    '1059': ['FL', '1', 'OphthalmicAxialLengthVelocity'],\r\n    '1065': ['LO', '1', 'LensStatusDescription'],\r\n    '1066': ['LO', '1', 'VitreousStatusDescription'],\r\n    '1090': ['SQ', '1', 'IOLPowerSequence'],\r\n    '1092': ['SQ', '1', 'LensConstantSequence'],\r\n    '1093': ['LO', '1', 'IOLManufacturer'],\r\n    '1094': ['LO', '1', 'LensConstantDescription'],\r\n    '1095': ['LO', '1', 'ImplantName'],\r\n    '1096': ['SQ', '1', 'KeratometryMeasurementTypeCodeSequence'],\r\n    '1097': ['LO', '1', 'ImplantPartNumber'],\r\n    '1100': ['SQ', '1', 'ReferencedOphthalmicAxialMeasurementsSequence'],\r\n    '1101': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsSegmentNameCodeSequence'],\r\n    '1103': ['SQ', '1', 'RefractiveErrorBeforeRefractiveSurgeryCodeSequence'],\r\n    '1121': ['FL', '1', 'IOLPowerForExactEmmetropia'],\r\n    '1122': ['FL', '1', 'IOLPowerForExactTargetRefraction'],\r\n    '1125': ['SQ', '1', 'AnteriorChamberDepthDefinitionCodeSequence'],\r\n    '1127': ['SQ', '1', 'LensThicknessSequence'],\r\n    '1128': ['SQ', '1', 'AnteriorChamberDepthSequence'],\r\n    '112A': ['SQ', '1', 'CalculationCommentSequence'],\r\n    '112B': ['CS', '1', 'CalculationCommentType'],\r\n    '112C': ['LT', '1', 'CalculationComment'],\r\n    '1130': ['FL', '1', 'LensThickness'],\r\n    '1131': ['FL', '1', 'AnteriorChamberDepth'],\r\n    '1132': ['SQ', '1', 'SourceOfLensThicknessDataCodeSequence'],\r\n    '1133': ['SQ', '1', 'SourceOfAnteriorChamberDepthDataCodeSequence'],\r\n    '1134': ['SQ', '1', 'SourceOfRefractiveMeasurementsSequence'],\r\n    '1135': ['SQ', '1', 'SourceOfRefractiveMeasurementsCodeSequence'],\r\n    '1140': ['CS', '1', 'OphthalmicAxialLengthMeasurementModified'],\r\n    '1150': ['SQ', '1', 'OphthalmicAxialLengthDataSourceCodeSequence'],\r\n    '1153': ['SQ', '1', 'OphthalmicAxialLengthAcquisitionMethodCodeSequence'],\r\n    '1155': ['FL', '1', 'SignalToNoiseRatio'],\r\n    '1159': ['LO', '1', 'OphthalmicAxialLengthDataSourceDescription'],\r\n    '1210': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsTotalLengthSequence'],\r\n    '1211': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsSegmentalLengthSequence'],\r\n    '1212': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsLengthSummationSequence'],\r\n    '1220': ['SQ', '1', 'UltrasoundOphthalmicAxialLengthMeasurementsSequence'],\r\n    '1225': ['SQ', '1', 'OpticalOphthalmicAxialLengthMeasurementsSequence'],\r\n    '1230': ['SQ', '1', 'UltrasoundSelectedOphthalmicAxialLengthSequence'],\r\n    '1250': ['SQ', '1', 'OphthalmicAxialLengthSelectionMethodCodeSequence'],\r\n    '1255': ['SQ', '1', 'OpticalSelectedOphthalmicAxialLengthSequence'],\r\n    '1257': ['SQ', '1', 'SelectedSegmentalOphthalmicAxialLengthSequence'],\r\n    '1260': ['SQ', '1', 'SelectedTotalOphthalmicAxialLengthSequence'],\r\n    '1262': ['SQ', '1', 'OphthalmicAxialLengthQualityMetricSequence'],\r\n    '1265': ['SQ', '1', 'OphthalmicAxialLengthQualityMetricTypeCodeSequence'],\r\n    '1273': ['LO', '1', 'OphthalmicAxialLengthQualityMetricTypeDescription'],\r\n    '1300': ['SQ', '1', 'IntraocularLensCalculationsRightEyeSequence'],\r\n    '1310': ['SQ', '1', 'IntraocularLensCalculationsLeftEyeSequence'],\r\n    '1330': ['SQ', '1', 'ReferencedOphthalmicAxialLengthMeasurementQCImageSequence'],\r\n    '1415': ['CS', '1', 'OphthalmicMappingDeviceType'],\r\n    '1420': ['SQ', '1', 'AcquisitionMethodCodeSequence'],\r\n    '1423': ['SQ', '1', 'AcquisitionMethodAlgorithmSequence'],\r\n    '1436': ['SQ', '1', 'OphthalmicThicknessMapTypeCodeSequence'],\r\n    '1443': ['SQ', '1', 'OphthalmicThicknessMappingNormalsSequence'],\r\n    '1445': ['SQ', '1', 'RetinalThicknessDefinitionCodeSequence'],\r\n    '1450': ['SQ', '1', 'PixelValueMappingToCodedConceptSequence'],\r\n    '1452': ['xs', '1', 'MappedPixelValue'],\r\n    '1454': ['LO', '1', 'PixelValueMappingExplanation'],\r\n    '1458': ['SQ', '1', 'OphthalmicThicknessMapQualityThresholdSequence'],\r\n    '1460': ['FL', '1', 'OphthalmicThicknessMapThresholdQualityRating'],\r\n    '1463': ['FL', '2', 'AnatomicStructureReferencePoint'],\r\n    '1465': ['SQ', '1', 'RegistrationToLocalizerSequence'],\r\n    '1466': ['CS', '1', 'RegisteredLocalizerUnits'],\r\n    '1467': ['FL', '2', 'RegisteredLocalizerTopLeftHandCorner'],\r\n    '1468': ['FL', '2', 'RegisteredLocalizerBottomRightHandCorner'],\r\n    '1470': ['SQ', '1', 'OphthalmicThicknessMapQualityRatingSequence'],\r\n    '1472': ['SQ', '1', 'RelevantOPTAttributesSequence'],\r\n    '1512': ['SQ', '1', 'TransformationMethodCodeSequence'],\r\n    '1513': ['SQ', '1', 'TransformationAlgorithmSequence'],\r\n    '1515': ['CS', '1', 'OphthalmicAxialLengthMethod'],\r\n    '1517': ['FL', '1', 'OphthalmicFOV'],\r\n    '1518': ['SQ', '1', 'TwoDimensionalToThreeDimensionalMapSequence'],\r\n    '1525': ['SQ', '1', 'WideFieldOphthalmicPhotographyQualityRatingSequence'],\r\n    '1526': ['SQ', '1', 'WideFieldOphthalmicPhotographyQualityThresholdSequence'],\r\n    '1527': ['FL', '1', 'WideFieldOphthalmicPhotographyThresholdQualityRating'],\r\n    '1528': ['FL', '1', 'XCoordinatesCenterPixelViewAngle'],\r\n    '1529': ['FL', '1', 'YCoordinatesCenterPixelViewAngle'],\r\n    '1530': ['UL', '1', 'NumberOfMapPoints'],\r\n    '1531': ['OF', '1', 'TwoDimensionalToThreeDimensionalMapData'],\r\n    '1612': ['SQ', '1', 'DerivationAlgorithmSequence'],\r\n    '1615': ['SQ', '1', 'OphthalmicImageTypeCodeSequence'],\r\n    '1616': ['LO', '1', 'OphthalmicImageTypeDescription'],\r\n    '1618': ['SQ', '1', 'ScanPatternTypeCodeSequence'],\r\n    '1620': ['SQ', '1', 'ReferencedSurfaceMeshIdentificationSequence'],\r\n    '1622': ['CS', '1', 'OphthalmicVolumetricPropertiesFlag'],\r\n    '1624': ['FL', '1', 'OphthalmicAnatomicReferencePointXCoordinate'],\r\n    '1626': ['FL', '1', 'OphthalmicAnatomicReferencePointYCoordinate'],\r\n    '1628': ['SQ', '1', 'OphthalmicEnFaceImageQualityRatingSequence'],\r\n    '1630': ['DS', '1', 'QualityThreshold'],\r\n    '1640': ['SQ', '1', 'OCTBscanAnalysisAcquisitionParametersSequence'],\r\n    '1642': ['UL', '1', 'NumberOfBscansPerFrame'],\r\n    '1643': ['FL', '1', 'BscanSlabThickness'],\r\n    '1644': ['FL', '1', 'DistanceBetweenBscanSlabs'],\r\n    '1645': ['FL', '1', 'BscanCycleTime'],\r\n    '1646': ['FL', '1-n', 'BscanCycleTimeVector'],\r\n    '1649': ['FL', '1', 'AscanRate'],\r\n    '1650': ['FL', '1', 'BscanRate'],\r\n    '1658': ['UL', '1', 'SurfaceMeshZPixelOffset']\r\n  },\r\n  '0024': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['FL', '1', 'VisualFieldHorizontalExtent'],\r\n    '0011': ['FL', '1', 'VisualFieldVerticalExtent'],\r\n    '0012': ['CS', '1', 'VisualFieldShape'],\r\n    '0016': ['SQ', '1', 'ScreeningTestModeCodeSequence'],\r\n    '0018': ['FL', '1', 'MaximumStimulusLuminance'],\r\n    '0020': ['FL', '1', 'BackgroundLuminance'],\r\n    '0021': ['SQ', '1', 'StimulusColorCodeSequence'],\r\n    '0024': ['SQ', '1', 'BackgroundIlluminationColorCodeSequence'],\r\n    '0025': ['FL', '1', 'StimulusArea'],\r\n    '0028': ['FL', '1', 'StimulusPresentationTime'],\r\n    '0032': ['SQ', '1', 'FixationSequence'],\r\n    '0033': ['SQ', '1', 'FixationMonitoringCodeSequence'],\r\n    '0034': ['SQ', '1', 'VisualFieldCatchTrialSequence'],\r\n    '0035': ['US', '1', 'FixationCheckedQuantity'],\r\n    '0036': ['US', '1', 'PatientNotProperlyFixatedQuantity'],\r\n    '0037': ['CS', '1', 'PresentedVisualStimuliDataFlag'],\r\n    '0038': ['US', '1', 'NumberOfVisualStimuli'],\r\n    '0039': ['CS', '1', 'ExcessiveFixationLossesDataFlag'],\r\n    '0040': ['CS', '1', 'ExcessiveFixationLosses'],\r\n    '0042': ['US', '1', 'StimuliRetestingQuantity'],\r\n    '0044': ['LT', '1', 'CommentsOnPatientPerformanceOfVisualField'],\r\n    '0045': ['CS', '1', 'FalseNegativesEstimateFlag'],\r\n    '0046': ['FL', '1', 'FalseNegativesEstimate'],\r\n    '0048': ['US', '1', 'NegativeCatchTrialsQuantity'],\r\n    '0050': ['US', '1', 'FalseNegativesQuantity'],\r\n    '0051': ['CS', '1', 'ExcessiveFalseNegativesDataFlag'],\r\n    '0052': ['CS', '1', 'ExcessiveFalseNegatives'],\r\n    '0053': ['CS', '1', 'FalsePositivesEstimateFlag'],\r\n    '0054': ['FL', '1', 'FalsePositivesEstimate'],\r\n    '0055': ['CS', '1', 'CatchTrialsDataFlag'],\r\n    '0056': ['US', '1', 'PositiveCatchTrialsQuantity'],\r\n    '0057': ['CS', '1', 'TestPointNormalsDataFlag'],\r\n    '0058': ['SQ', '1', 'TestPointNormalsSequence'],\r\n    '0059': ['CS', '1', 'GlobalDeviationProbabilityNormalsFlag'],\r\n    '0060': ['US', '1', 'FalsePositivesQuantity'],\r\n    '0061': ['CS', '1', 'ExcessiveFalsePositivesDataFlag'],\r\n    '0062': ['CS', '1', 'ExcessiveFalsePositives'],\r\n    '0063': ['CS', '1', 'VisualFieldTestNormalsFlag'],\r\n    '0064': ['SQ', '1', 'ResultsNormalsSequence'],\r\n    '0065': ['SQ', '1', 'AgeCorrectedSensitivityDeviationAlgorithmSequence'],\r\n    '0066': ['FL', '1', 'GlobalDeviationFromNormal'],\r\n    '0067': ['SQ', '1', 'GeneralizedDefectSensitivityDeviationAlgorithmSequence'],\r\n    '0068': ['FL', '1', 'LocalizedDeviationFromNormal'],\r\n    '0069': ['LO', '1', 'PatientReliabilityIndicator'],\r\n    '0070': ['FL', '1', 'VisualFieldMeanSensitivity'],\r\n    '0071': ['FL', '1', 'GlobalDeviationProbability'],\r\n    '0072': ['CS', '1', 'LocalDeviationProbabilityNormalsFlag'],\r\n    '0073': ['FL', '1', 'LocalizedDeviationProbability'],\r\n    '0074': ['CS', '1', 'ShortTermFluctuationCalculated'],\r\n    '0075': ['FL', '1', 'ShortTermFluctuation'],\r\n    '0076': ['CS', '1', 'ShortTermFluctuationProbabilityCalculated'],\r\n    '0077': ['FL', '1', 'ShortTermFluctuationProbability'],\r\n    '0078': ['CS', '1', 'CorrectedLocalizedDeviationFromNormalCalculated'],\r\n    '0079': ['FL', '1', 'CorrectedLocalizedDeviationFromNormal'],\r\n    '0080': ['CS', '1', 'CorrectedLocalizedDeviationFromNormalProbabilityCalculated'],\r\n    '0081': ['FL', '1', 'CorrectedLocalizedDeviationFromNormalProbability'],\r\n    '0083': ['SQ', '1', 'GlobalDeviationProbabilitySequence'],\r\n    '0085': ['SQ', '1', 'LocalizedDeviationProbabilitySequence'],\r\n    '0086': ['CS', '1', 'FovealSensitivityMeasured'],\r\n    '0087': ['FL', '1', 'FovealSensitivity'],\r\n    '0088': ['FL', '1', 'VisualFieldTestDuration'],\r\n    '0089': ['SQ', '1', 'VisualFieldTestPointSequence'],\r\n    '0090': ['FL', '1', 'VisualFieldTestPointXCoordinate'],\r\n    '0091': ['FL', '1', 'VisualFieldTestPointYCoordinate'],\r\n    '0092': ['FL', '1', 'AgeCorrectedSensitivityDeviationValue'],\r\n    '0093': ['CS', '1', 'StimulusResults'],\r\n    '0094': ['FL', '1', 'SensitivityValue'],\r\n    '0095': ['CS', '1', 'RetestStimulusSeen'],\r\n    '0096': ['FL', '1', 'RetestSensitivityValue'],\r\n    '0097': ['SQ', '1', 'VisualFieldTestPointNormalsSequence'],\r\n    '0098': ['FL', '1', 'QuantifiedDefect'],\r\n    '0100': ['FL', '1', 'AgeCorrectedSensitivityDeviationProbabilityValue'],\r\n    '0102': ['CS', '1', 'GeneralizedDefectCorrectedSensitivityDeviationFlag'],\r\n    '0103': ['FL', '1', 'GeneralizedDefectCorrectedSensitivityDeviationValue'],\r\n    '0104': ['FL', '1', 'GeneralizedDefectCorrectedSensitivityDeviationProbabilityValue'],\r\n    '0105': ['FL', '1', 'MinimumSensitivityValue'],\r\n    '0106': ['CS', '1', 'BlindSpotLocalized'],\r\n    '0107': ['FL', '1', 'BlindSpotXCoordinate'],\r\n    '0108': ['FL', '1', 'BlindSpotYCoordinate'],\r\n    '0110': ['SQ', '1', 'VisualAcuityMeasurementSequence'],\r\n    '0112': ['SQ', '1', 'RefractiveParametersUsedOnPatientSequence'],\r\n    '0113': ['CS', '1', 'MeasurementLaterality'],\r\n    '0114': ['SQ', '1', 'OphthalmicPatientClinicalInformationLeftEyeSequence'],\r\n    '0115': ['SQ', '1', 'OphthalmicPatientClinicalInformationRightEyeSequence'],\r\n    '0117': ['CS', '1', 'FovealPointNormativeDataFlag'],\r\n    '0118': ['FL', '1', 'FovealPointProbabilityValue'],\r\n    '0120': ['CS', '1', 'ScreeningBaselineMeasured'],\r\n    '0122': ['SQ', '1', 'ScreeningBaselineMeasuredSequence'],\r\n    '0124': ['CS', '1', 'ScreeningBaselineType'],\r\n    '0126': ['FL', '1', 'ScreeningBaselineValue'],\r\n    '0202': ['LO', '1', 'AlgorithmSource'],\r\n    '0306': ['LO', '1', 'DataSetName'],\r\n    '0307': ['LO', '1', 'DataSetVersion'],\r\n    '0308': ['LO', '1', 'DataSetSource'],\r\n    '0309': ['LO', '1', 'DataSetDescription'],\r\n    '0317': ['SQ', '1', 'VisualFieldTestReliabilityGlobalIndexSequence'],\r\n    '0320': ['SQ', '1', 'VisualFieldGlobalResultsIndexSequence'],\r\n    '0325': ['SQ', '1', 'DataObservationSequence'],\r\n    '0338': ['CS', '1', 'IndexNormalsFlag'],\r\n    '0341': ['FL', '1', 'IndexProbability'],\r\n    '0344': ['SQ', '1', 'IndexProbabilitySequence']\r\n  },\r\n  '0028': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0002': ['US', '1', 'SamplesPerPixel'],\r\n    '0003': ['US', '1', 'SamplesPerPixelUsed'],\r\n    '0004': ['CS', '1', 'PhotometricInterpretation'],\r\n    '0005': ['US', '1', 'ImageDimensions'],\r\n    '0006': ['US', '1', 'PlanarConfiguration'],\r\n    '0008': ['IS', '1', 'NumberOfFrames'],\r\n    '0009': ['AT', '1-n', 'FrameIncrementPointer'],\r\n    '000A': ['AT', '1-n', 'FrameDimensionPointer'],\r\n    '0010': ['US', '1', 'Rows'],\r\n    '0011': ['US', '1', 'Columns'],\r\n    '0012': ['US', '1', 'Planes'],\r\n    '0014': ['US', '1', 'UltrasoundColorDataPresent'],\r\n    '0020': ['', '', ''],\r\n    '0030': ['DS', '2', 'PixelSpacing'],\r\n    '0031': ['DS', '2', 'ZoomFactor'],\r\n    '0032': ['DS', '2', 'ZoomCenter'],\r\n    '0034': ['IS', '2', 'PixelAspectRatio'],\r\n    '0040': ['CS', '1', 'ImageFormat'],\r\n    '0050': ['LO', '1-n', 'ManipulatedImage'],\r\n    '0051': ['CS', '1-n', 'CorrectedImage'],\r\n    '005F': ['LO', '1', 'CompressionRecognitionCode'],\r\n    '0060': ['CS', '1', 'CompressionCode'],\r\n    '0061': ['SH', '1', 'CompressionOriginator'],\r\n    '0062': ['LO', '1', 'CompressionLabel'],\r\n    '0063': ['SH', '1', 'CompressionDescription'],\r\n    '0065': ['CS', '1-n', 'CompressionSequence'],\r\n    '0066': ['AT', '1-n', 'CompressionStepPointers'],\r\n    '0068': ['US', '1', 'RepeatInterval'],\r\n    '0069': ['US', '1', 'BitsGrouped'],\r\n    '0070': ['US', '1-n', 'PerimeterTable'],\r\n    '0071': ['xs', '1', 'PerimeterValue'],\r\n    '0080': ['US', '1', 'PredictorRows'],\r\n    '0081': ['US', '1', 'PredictorColumns'],\r\n    '0082': ['US', '1-n', 'PredictorConstants'],\r\n    '0090': ['CS', '1', 'BlockedPixels'],\r\n    '0091': ['US', '1', 'BlockRows'],\r\n    '0092': ['US', '1', 'BlockColumns'],\r\n    '0093': ['US', '1', 'RowOverlap'],\r\n    '0094': ['US', '1', 'ColumnOverlap'],\r\n    '0100': ['US', '1', 'BitsAllocated'],\r\n    '0101': ['US', '1', 'BitsStored'],\r\n    '0102': ['US', '1', 'HighBit'],\r\n    '0103': ['US', '1', 'PixelRepresentation'],\r\n    '0104': ['xs', '1', 'SmallestValidPixelValue'],\r\n    '0105': ['xs', '1', 'LargestValidPixelValue'],\r\n    '0106': ['xs', '1', 'SmallestImagePixelValue'],\r\n    '0107': ['xs', '1', 'LargestImagePixelValue'],\r\n    '0108': ['xs', '1', 'SmallestPixelValueInSeries'],\r\n    '0109': ['xs', '1', 'LargestPixelValueInSeries'],\r\n    '0110': ['xs', '1', 'SmallestImagePixelValueInPlane'],\r\n    '0111': ['xs', '1', 'LargestImagePixelValueInPlane'],\r\n    '0120': ['xs', '1', 'PixelPaddingValue'],\r\n    '0121': ['xs', '1', 'PixelPaddingRangeLimit'],\r\n    '0122': ['FL', '1', 'FloatPixelPaddingValue'],\r\n    '0123': ['FD', '1', 'DoubleFloatPixelPaddingValue'],\r\n    '0124': ['FL', '1', 'FloatPixelPaddingRangeLimit'],\r\n    '0125': ['FD', '1', 'DoubleFloatPixelPaddingRangeLimit'],\r\n    '0200': ['US', '1', 'ImageLocation'],\r\n    '0300': ['CS', '1', 'QualityControlImage'],\r\n    '0301': ['CS', '1', 'BurnedInAnnotation'],\r\n    '0302': ['CS', '1', 'RecognizableVisualFeatures'],\r\n    '0303': ['CS', '1', 'LongitudinalTemporalInformationModified'],\r\n    '0304': ['UI', '1', 'ReferencedColorPaletteInstanceUID'],\r\n    '0400': ['LO', '1', 'TransformLabel'],\r\n    '0401': ['LO', '1', 'TransformVersionNumber'],\r\n    '0402': ['US', '1', 'NumberOfTransformSteps'],\r\n    '0403': ['LO', '1-n', 'SequenceOfCompressedData'],\r\n    '0404': ['AT', '1-n', 'DetailsOfCoefficients'],\r\n    '04x0': ['US', '1', 'RowsForNthOrderCoefficients'],\r\n    '04x1': ['US', '1', 'ColumnsForNthOrderCoefficients'],\r\n    '04x2': ['LO', '1-n', 'CoefficientCoding'],\r\n    '04x3': ['AT', '1-n', 'CoefficientCodingPointers'],\r\n    '0700': ['LO', '1', 'DCTLabel'],\r\n    '0701': ['CS', '1-n', 'DataBlockDescription'],\r\n    '0702': ['AT', '1-n', 'DataBlock'],\r\n    '0710': ['US', '1', 'NormalizationFactorFormat'],\r\n    '0720': ['US', '1', 'ZonalMapNumberFormat'],\r\n    '0721': ['AT', '1-n', 'ZonalMapLocation'],\r\n    '0722': ['US', '1', 'ZonalMapFormat'],\r\n    '0730': ['US', '1', 'AdaptiveMapFormat'],\r\n    '0740': ['US', '1', 'CodeNumberFormat'],\r\n    '08x0': ['CS', '1-n', 'CodeLabel'],\r\n    '08x2': ['US', '1', 'NumberOfTables'],\r\n    '08x3': ['AT', '1-n', 'CodeTableLocation'],\r\n    '08x4': ['US', '1', 'BitsForCodeWord'],\r\n    '08x8': ['AT', '1-n', 'ImageDataLocation'],\r\n    '0A02': ['CS', '1', 'PixelSpacingCalibrationType'],\r\n    '0A04': ['LO', '1', 'PixelSpacingCalibrationDescription'],\r\n    '1040': ['CS', '1', 'PixelIntensityRelationship'],\r\n    '1041': ['SS', '1', 'PixelIntensityRelationshipSign'],\r\n    '1050': ['DS', '1-n', 'WindowCenter'],\r\n    '1051': ['DS', '1-n', 'WindowWidth'],\r\n    '1052': ['DS', '1', 'RescaleIntercept'],\r\n    '1053': ['DS', '1', 'RescaleSlope'],\r\n    '1054': ['LO', '1', 'RescaleType'],\r\n    '1055': ['LO', '1-n', 'WindowCenterWidthExplanation'],\r\n    '1056': ['CS', '1', 'VOILUTFunction'],\r\n    '1080': ['CS', '1', 'GrayScale'],\r\n    '1090': ['CS', '1', 'RecommendedViewingMode'],\r\n    '1100': ['xs', '3', 'GrayLookupTableDescriptor'],\r\n    '1101': ['xs', '3', 'RedPaletteColorLookupTableDescriptor'],\r\n    '1102': ['xs', '3', 'GreenPaletteColorLookupTableDescriptor'],\r\n    '1103': ['xs', '3', 'BluePaletteColorLookupTableDescriptor'],\r\n    '1104': ['US', '3', 'AlphaPaletteColorLookupTableDescriptor'],\r\n    '1111': ['xs', '4', 'LargeRedPaletteColorLookupTableDescriptor'],\r\n    '1112': ['xs', '4', 'LargeGreenPaletteColorLookupTableDescriptor'],\r\n    '1113': ['xs', '4', 'LargeBluePaletteColorLookupTableDescriptor'],\r\n    '1199': ['UI', '1', 'PaletteColorLookupTableUID'],\r\n    '1200': ['xs', '1-n or 1', 'GrayLookupTableData'],\r\n    '1201': ['OW', '1', 'RedPaletteColorLookupTableData'],\r\n    '1202': ['OW', '1', 'GreenPaletteColorLookupTableData'],\r\n    '1203': ['OW', '1', 'BluePaletteColorLookupTableData'],\r\n    '1204': ['OW', '1', 'AlphaPaletteColorLookupTableData'],\r\n    '1211': ['OW', '1', 'LargeRedPaletteColorLookupTableData'],\r\n    '1212': ['OW', '1', 'LargeGreenPaletteColorLookupTableData'],\r\n    '1213': ['OW', '1', 'LargeBluePaletteColorLookupTableData'],\r\n    '1214': ['UI', '1', 'LargePaletteColorLookupTableUID'],\r\n    '1221': ['OW', '1', 'SegmentedRedPaletteColorLookupTableData'],\r\n    '1222': ['OW', '1', 'SegmentedGreenPaletteColorLookupTableData'],\r\n    '1223': ['OW', '1', 'SegmentedBluePaletteColorLookupTableData'],\r\n    '1224': ['OW', '1', 'SegmentedAlphaPaletteColorLookupTableData'],\r\n    '1230': ['SQ', '1', 'StoredValueColorRangeSequence'],\r\n    '1231': ['FD', '1', 'MinimumStoredValueMapped'],\r\n    '1232': ['FD', '1', 'MaximumStoredValueMapped'],\r\n    '1300': ['CS', '1', 'BreastImplantPresent'],\r\n    '1350': ['CS', '1', 'PartialView'],\r\n    '1351': ['ST', '1', 'PartialViewDescription'],\r\n    '1352': ['SQ', '1', 'PartialViewCodeSequence'],\r\n    '135A': ['CS', '1', 'SpatialLocationsPreserved'],\r\n    '1401': ['SQ', '1', 'DataFrameAssignmentSequence'],\r\n    '1402': ['CS', '1', 'DataPathAssignment'],\r\n    '1403': ['US', '1', 'BitsMappedToColorLookupTable'],\r\n    '1404': ['SQ', '1', 'BlendingLUT1Sequence'],\r\n    '1405': ['CS', '1', 'BlendingLUT1TransferFunction'],\r\n    '1406': ['FD', '1', 'BlendingWeightConstant'],\r\n    '1407': ['US', '3', 'BlendingLookupTableDescriptor'],\r\n    '1408': ['OW', '1', 'BlendingLookupTableData'],\r\n    '140B': ['SQ', '1', 'EnhancedPaletteColorLookupTableSequence'],\r\n    '140C': ['SQ', '1', 'BlendingLUT2Sequence'],\r\n    '140D': ['CS', '1', 'BlendingLUT2TransferFunction'],\r\n    '140E': ['CS', '1', 'DataPathID'],\r\n    '140F': ['CS', '1', 'RGBLUTTransferFunction'],\r\n    '1410': ['CS', '1', 'AlphaLUTTransferFunction'],\r\n    '2000': ['OB', '1', 'ICCProfile'],\r\n    '2002': ['CS', '1', 'ColorSpace'],\r\n    '2110': ['CS', '1', 'LossyImageCompression'],\r\n    '2112': ['DS', '1-n', 'LossyImageCompressionRatio'],\r\n    '2114': ['CS', '1-n', 'LossyImageCompressionMethod'],\r\n    '3000': ['SQ', '1', 'ModalityLUTSequence'],\r\n    '3002': ['xs', '3', 'LUTDescriptor'],\r\n    '3003': ['LO', '1', 'LUTExplanation'],\r\n    '3004': ['LO', '1', 'ModalityLUTType'],\r\n    '3006': ['xx', '1-n or 1', 'LUTData'],\r\n    '3010': ['SQ', '1', 'VOILUTSequence'],\r\n    '3110': ['SQ', '1', 'SoftcopyVOILUTSequence'],\r\n    '4000': ['LT', '1', 'ImagePresentationComments'],\r\n    '5000': ['SQ', '1', 'BiPlaneAcquisitionSequence'],\r\n    '6010': ['US', '1', 'RepresentativeFrameNumber'],\r\n    '6020': ['US', '1-n', 'FrameNumbersOfInterest'],\r\n    '6022': ['LO', '1-n', 'FrameOfInterestDescription'],\r\n    '6023': ['CS', '1-n', 'FrameOfInterestType'],\r\n    '6030': ['US', '1-n', 'MaskPointers'],\r\n    '6040': ['US', '1-n', 'RWavePointer'],\r\n    '6100': ['SQ', '1', 'MaskSubtractionSequence'],\r\n    '6101': ['CS', '1', 'MaskOperation'],\r\n    '6102': ['US', '2-2n', 'ApplicableFrameRange'],\r\n    '6110': ['US', '1-n', 'MaskFrameNumbers'],\r\n    '6112': ['US', '1', 'ContrastFrameAveraging'],\r\n    '6114': ['FL', '2', 'MaskSubPixelShift'],\r\n    '6120': ['SS', '1', 'TIDOffset'],\r\n    '6190': ['ST', '1', 'MaskOperationExplanation'],\r\n    '7000': ['SQ', '1', 'EquipmentAdministratorSequence'],\r\n    '7001': ['US', '1', 'NumberOfDisplaySubsystems'],\r\n    '7002': ['US', '1', 'CurrentConfigurationID'],\r\n    '7003': ['US', '1', 'DisplaySubsystemID'],\r\n    '7004': ['SH', '1', 'DisplaySubsystemName'],\r\n    '7005': ['LO', '1', 'DisplaySubsystemDescription'],\r\n    '7006': ['CS', '1', 'SystemStatus'],\r\n    '7007': ['LO', '1', 'SystemStatusComment'],\r\n    '7008': ['SQ', '1', 'TargetLuminanceCharacteristicsSequence'],\r\n    '7009': ['US', '1', 'LuminanceCharacteristicsID'],\r\n    '700A': ['SQ', '1', 'DisplaySubsystemConfigurationSequence'],\r\n    '700B': ['US', '1', 'ConfigurationID'],\r\n    '700C': ['SH', '1', 'ConfigurationName'],\r\n    '700D': ['LO', '1', 'ConfigurationDescription'],\r\n    '700E': ['US', '1', 'ReferencedTargetLuminanceCharacteristicsID'],\r\n    '700F': ['SQ', '1', 'QAResultsSequence'],\r\n    '7010': ['SQ', '1', 'DisplaySubsystemQAResultsSequence'],\r\n    '7011': ['SQ', '1', 'ConfigurationQAResultsSequence'],\r\n    '7012': ['SQ', '1', 'MeasurementEquipmentSequence'],\r\n    '7013': ['CS', '1-n', 'MeasurementFunctions'],\r\n    '7014': ['CS', '1', 'MeasurementEquipmentType'],\r\n    '7015': ['SQ', '1', 'VisualEvaluationResultSequence'],\r\n    '7016': ['SQ', '1', 'DisplayCalibrationResultSequence'],\r\n    '7017': ['US', '1', 'DDLValue'],\r\n    '7018': ['FL', '2', 'CIExyWhitePoint'],\r\n    '7019': ['CS', '1', 'DisplayFunctionType'],\r\n    '701A': ['FL', '1', 'GammaValue'],\r\n    '701B': ['US', '1', 'NumberOfLuminancePoints'],\r\n    '701C': ['SQ', '1', 'LuminanceResponseSequence'],\r\n    '701D': ['FL', '1', 'TargetMinimumLuminance'],\r\n    '701E': ['FL', '1', 'TargetMaximumLuminance'],\r\n    '701F': ['FL', '1', 'LuminanceValue'],\r\n    '7020': ['LO', '1', 'LuminanceResponseDescription'],\r\n    '7021': ['CS', '1', 'WhitePointFlag'],\r\n    '7022': ['SQ', '1', 'DisplayDeviceTypeCodeSequence'],\r\n    '7023': ['SQ', '1', 'DisplaySubsystemSequence'],\r\n    '7024': ['SQ', '1', 'LuminanceResultSequence'],\r\n    '7025': ['CS', '1', 'AmbientLightValueSource'],\r\n    '7026': ['CS', '1-n', 'MeasuredCharacteristics'],\r\n    '7027': ['SQ', '1', 'LuminanceUniformityResultSequence'],\r\n    '7028': ['SQ', '1', 'VisualEvaluationTestSequence'],\r\n    '7029': ['CS', '1', 'TestResult'],\r\n    '702A': ['LO', '1', 'TestResultComment'],\r\n    '702B': ['CS', '1', 'TestImageValidation'],\r\n    '702C': ['SQ', '1', 'TestPatternCodeSequence'],\r\n    '702D': ['SQ', '1', 'MeasurementPatternCodeSequence'],\r\n    '702E': ['SQ', '1', 'VisualEvaluationMethodCodeSequence'],\r\n    '7FE0': ['UR', '1', 'PixelDataProviderURL'],\r\n    '9001': ['UL', '1', 'DataPointRows'],\r\n    '9002': ['UL', '1', 'DataPointColumns'],\r\n    '9003': ['CS', '1', 'SignalDomainColumns'],\r\n    '9099': ['US', '1', 'LargestMonochromePixelValue'],\r\n    '9108': ['CS', '1', 'DataRepresentation'],\r\n    '9110': ['SQ', '1', 'PixelMeasuresSequence'],\r\n    '9132': ['SQ', '1', 'FrameVOILUTSequence'],\r\n    '9145': ['SQ', '1', 'PixelValueTransformationSequence'],\r\n    '9235': ['CS', '1', 'SignalDomainRows'],\r\n    '9411': ['FL', '1', 'DisplayFilterPercentage'],\r\n    '9415': ['SQ', '1', 'FramePixelShiftSequence'],\r\n    '9416': ['US', '1', 'SubtractionItemID'],\r\n    '9422': ['SQ', '1', 'PixelIntensityRelationshipLUTSequence'],\r\n    '9443': ['SQ', '1', 'FramePixelDataPropertiesSequence'],\r\n    '9444': ['CS', '1', 'GeometricalProperties'],\r\n    '9445': ['FL', '1', 'GeometricMaximumDistortion'],\r\n    '9446': ['CS', '1-n', 'ImageProcessingApplied'],\r\n    '9454': ['CS', '1', 'MaskSelectionMode'],\r\n    '9474': ['CS', '1', 'LUTFunction'],\r\n    '9478': ['FL', '1', 'MaskVisibilityPercentage'],\r\n    '9501': ['SQ', '1', 'PixelShiftSequence'],\r\n    '9502': ['SQ', '1', 'RegionPixelShiftSequence'],\r\n    '9503': ['SS', '2-2n', 'VerticesOfTheRegion'],\r\n    '9505': ['SQ', '1', 'MultiFramePresentationSequence'],\r\n    '9506': ['US', '2-2n', 'PixelShiftFrameRange'],\r\n    '9507': ['US', '2-2n', 'LUTFrameRange'],\r\n    '9520': ['DS', '16', 'ImageToEquipmentMappingMatrix'],\r\n    '9537': ['CS', '1', 'EquipmentCoordinateSystemIdentification']\r\n  },\r\n  '0032': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '000A': ['CS', '1', 'StudyStatusID'],\r\n    '000C': ['CS', '1', 'StudyPriorityID'],\r\n    '0012': ['LO', '1', 'StudyIDIssuer'],\r\n    '0032': ['DA', '1', 'StudyVerifiedDate'],\r\n    '0033': ['TM', '1', 'StudyVerifiedTime'],\r\n    '0034': ['DA', '1', 'StudyReadDate'],\r\n    '0035': ['TM', '1', 'StudyReadTime'],\r\n    '1000': ['DA', '1', 'ScheduledStudyStartDate'],\r\n    '1001': ['TM', '1', 'ScheduledStudyStartTime'],\r\n    '1010': ['DA', '1', 'ScheduledStudyStopDate'],\r\n    '1011': ['TM', '1', 'ScheduledStudyStopTime'],\r\n    '1020': ['LO', '1', 'ScheduledStudyLocation'],\r\n    '1021': ['AE', '1-n', 'ScheduledStudyLocationAETitle'],\r\n    '1030': ['LO', '1', 'ReasonForStudy'],\r\n    '1031': ['SQ', '1', 'RequestingPhysicianIdentificationSequence'],\r\n    '1032': ['PN', '1', 'RequestingPhysician'],\r\n    '1033': ['LO', '1', 'RequestingService'],\r\n    '1034': ['SQ', '1', 'RequestingServiceCodeSequence'],\r\n    '1040': ['DA', '1', 'StudyArrivalDate'],\r\n    '1041': ['TM', '1', 'StudyArrivalTime'],\r\n    '1050': ['DA', '1', 'StudyCompletionDate'],\r\n    '1051': ['TM', '1', 'StudyCompletionTime'],\r\n    '1055': ['CS', '1', 'StudyComponentStatusID'],\r\n    '1060': ['LO', '1', 'RequestedProcedureDescription'],\r\n    '1064': ['SQ', '1', 'RequestedProcedureCodeSequence'],\r\n    '1065': ['SQ', '1', 'RequestedLateralityCodeSequence'],\r\n    '1066': ['UT', '1', 'ReasonForVisit'],\r\n    '1067': ['SQ', '1', 'ReasonForVisitCodeSequence'],\r\n    '1070': ['LO', '1', 'RequestedContrastAgent'],\r\n    '4000': ['LT', '1', 'StudyComments']\r\n  },\r\n  '0034': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['SQ', '1', 'FlowIdentifierSequence'],\r\n    '0002': ['OB', '1', 'FlowIdentifier'],\r\n    '0003': ['UI', '1', 'FlowTransferSyntaxUID'],\r\n    '0004': ['UL', '1', 'FlowRTPSamplingRate'],\r\n    '0005': ['OB', '1', 'SourceIdentifier'],\r\n    '0007': ['OB', '1', 'FrameOriginTimestamp'],\r\n    '0008': ['CS', '1', 'IncludesImagingSubject'],\r\n    '0009': ['SQ', '1', 'FrameUsefulnessGroupSequence'],\r\n    '000A': ['SQ', '1', 'RealTimeBulkDataFlowSequence'],\r\n    '000B': ['SQ', '1', 'CameraPositionGroupSequence'],\r\n    '000C': ['CS', '1', 'IncludesInformation'],\r\n    '000D': ['SQ', '1', 'TimeOfFrameGroupSequence']\r\n  },\r\n  '0038': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0004': ['SQ', '1', 'ReferencedPatientAliasSequence'],\r\n    '0008': ['CS', '1', 'VisitStatusID'],\r\n    '0010': ['LO', '1', 'AdmissionID'],\r\n    '0011': ['LO', '1', 'IssuerOfAdmissionID'],\r\n    '0014': ['SQ', '1', 'IssuerOfAdmissionIDSequence'],\r\n    '0016': ['LO', '1', 'RouteOfAdmissions'],\r\n    '001A': ['DA', '1', 'ScheduledAdmissionDate'],\r\n    '001B': ['TM', '1', 'ScheduledAdmissionTime'],\r\n    '001C': ['DA', '1', 'ScheduledDischargeDate'],\r\n    '001D': ['TM', '1', 'ScheduledDischargeTime'],\r\n    '001E': ['LO', '1', 'ScheduledPatientInstitutionResidence'],\r\n    '0020': ['DA', '1', 'AdmittingDate'],\r\n    '0021': ['TM', '1', 'AdmittingTime'],\r\n    '0030': ['DA', '1', 'DischargeDate'],\r\n    '0032': ['TM', '1', 'DischargeTime'],\r\n    '0040': ['LO', '1', 'DischargeDiagnosisDescription'],\r\n    '0044': ['SQ', '1', 'DischargeDiagnosisCodeSequence'],\r\n    '0050': ['LO', '1', 'SpecialNeeds'],\r\n    '0060': ['LO', '1', 'ServiceEpisodeID'],\r\n    '0061': ['LO', '1', 'IssuerOfServiceEpisodeID'],\r\n    '0062': ['LO', '1', 'ServiceEpisodeDescription'],\r\n    '0064': ['SQ', '1', 'IssuerOfServiceEpisodeIDSequence'],\r\n    '0100': ['SQ', '1', 'PertinentDocumentsSequence'],\r\n    '0101': ['SQ', '1', 'PertinentResourcesSequence'],\r\n    '0102': ['LO', '1', 'ResourceDescription'],\r\n    '0300': ['LO', '1', 'CurrentPatientLocation'],\r\n    '0400': ['LO', '1', 'PatientInstitutionResidence'],\r\n    '0500': ['LO', '1', 'PatientState'],\r\n    '0502': ['SQ', '1', 'PatientClinicalTrialParticipationSequence'],\r\n    '4000': ['LT', '1', 'VisitComments']\r\n  },\r\n  '003A': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0004': ['CS', '1', 'WaveformOriginality'],\r\n    '0005': ['US', '1', 'NumberOfWaveformChannels'],\r\n    '0010': ['UL', '1', 'NumberOfWaveformSamples'],\r\n    '001A': ['DS', '1', 'SamplingFrequency'],\r\n    '0020': ['SH', '1', 'MultiplexGroupLabel'],\r\n    '0200': ['SQ', '1', 'ChannelDefinitionSequence'],\r\n    '0202': ['IS', '1', 'WaveformChannelNumber'],\r\n    '0203': ['SH', '1', 'ChannelLabel'],\r\n    '0205': ['CS', '1-n', 'ChannelStatus'],\r\n    '0208': ['SQ', '1', 'ChannelSourceSequence'],\r\n    '0209': ['SQ', '1', 'ChannelSourceModifiersSequence'],\r\n    '020A': ['SQ', '1', 'SourceWaveformSequence'],\r\n    '020C': ['LO', '1', 'ChannelDerivationDescription'],\r\n    '0210': ['DS', '1', 'ChannelSensitivity'],\r\n    '0211': ['SQ', '1', 'ChannelSensitivityUnitsSequence'],\r\n    '0212': ['DS', '1', 'ChannelSensitivityCorrectionFactor'],\r\n    '0213': ['DS', '1', 'ChannelBaseline'],\r\n    '0214': ['DS', '1', 'ChannelTimeSkew'],\r\n    '0215': ['DS', '1', 'ChannelSampleSkew'],\r\n    '0218': ['DS', '1', 'ChannelOffset'],\r\n    '021A': ['US', '1', 'WaveformBitsStored'],\r\n    '0220': ['DS', '1', 'FilterLowFrequency'],\r\n    '0221': ['DS', '1', 'FilterHighFrequency'],\r\n    '0222': ['DS', '1', 'NotchFilterFrequency'],\r\n    '0223': ['DS', '1', 'NotchFilterBandwidth'],\r\n    '0230': ['FL', '1', 'WaveformDataDisplayScale'],\r\n    '0231': ['US', '3', 'WaveformDisplayBackgroundCIELabValue'],\r\n    '0240': ['SQ', '1', 'WaveformPresentationGroupSequence'],\r\n    '0241': ['US', '1', 'PresentationGroupNumber'],\r\n    '0242': ['SQ', '1', 'ChannelDisplaySequence'],\r\n    '0244': ['US', '3', 'ChannelRecommendedDisplayCIELabValue'],\r\n    '0245': ['FL', '1', 'ChannelPosition'],\r\n    '0246': ['CS', '1', 'DisplayShadingFlag'],\r\n    '0247': ['FL', '1', 'FractionalChannelDisplayScale'],\r\n    '0248': ['FL', '1', 'AbsoluteChannelDisplayScale'],\r\n    '0300': ['SQ', '1', 'MultiplexedAudioChannelsDescriptionCodeSequence'],\r\n    '0301': ['IS', '1', 'ChannelIdentificationCode'],\r\n    '0302': ['CS', '1', 'ChannelMode'],\r\n    '0310': ['UI', '1', 'MultiplexGroupUID'],\r\n    '0311': ['DS', '1', 'PowerlineFrequency'],\r\n    '0312': ['SQ', '1', 'ChannelImpedanceSequence'],\r\n    '0313': ['DS', '1', 'ImpedanceValue'],\r\n    '0314': ['DT', '1', 'ImpedanceMeasurementDateTime'],\r\n    '0315': ['DS', '1', 'ImpedanceMeasurementFrequency'],\r\n    '0316': ['CS', '1', 'ImpedanceMeasurementCurrentType']\r\n  },\r\n  '0040': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['AE', '1-n', 'ScheduledStationAETitle'],\r\n    '0002': ['DA', '1', 'ScheduledProcedureStepStartDate'],\r\n    '0003': ['TM', '1', 'ScheduledProcedureStepStartTime'],\r\n    '0004': ['DA', '1', 'ScheduledProcedureStepEndDate'],\r\n    '0005': ['TM', '1', 'ScheduledProcedureStepEndTime'],\r\n    '0006': ['PN', '1', 'ScheduledPerformingPhysicianName'],\r\n    '0007': ['LO', '1', 'ScheduledProcedureStepDescription'],\r\n    '0008': ['SQ', '1', 'ScheduledProtocolCodeSequence'],\r\n    '0009': ['SH', '1', 'ScheduledProcedureStepID'],\r\n    '000A': ['SQ', '1', 'StageCodeSequence'],\r\n    '000B': ['SQ', '1', 'ScheduledPerformingPhysicianIdentificationSequence'],\r\n    '0010': ['SH', '1-n', 'ScheduledStationName'],\r\n    '0011': ['SH', '1', 'ScheduledProcedureStepLocation'],\r\n    '0012': ['LO', '1', 'PreMedication'],\r\n    '0020': ['CS', '1', 'ScheduledProcedureStepStatus'],\r\n    '0026': ['SQ', '1', 'OrderPlacerIdentifierSequence'],\r\n    '0027': ['SQ', '1', 'OrderFillerIdentifierSequence'],\r\n    '0031': ['UT', '1', 'LocalNamespaceEntityID'],\r\n    '0032': ['UT', '1', 'UniversalEntityID'],\r\n    '0033': ['CS', '1', 'UniversalEntityIDType'],\r\n    '0035': ['CS', '1', 'IdentifierTypeCode'],\r\n    '0036': ['SQ', '1', 'AssigningFacilitySequence'],\r\n    '0039': ['SQ', '1', 'AssigningJurisdictionCodeSequence'],\r\n    '003A': ['SQ', '1', 'AssigningAgencyOrDepartmentCodeSequence'],\r\n    '0100': ['SQ', '1', 'ScheduledProcedureStepSequence'],\r\n    '0220': ['SQ', '1', 'ReferencedNonImageCompositeSOPInstanceSequence'],\r\n    '0241': ['AE', '1', 'PerformedStationAETitle'],\r\n    '0242': ['SH', '1', 'PerformedStationName'],\r\n    '0243': ['SH', '1', 'PerformedLocation'],\r\n    '0244': ['DA', '1', 'PerformedProcedureStepStartDate'],\r\n    '0245': ['TM', '1', 'PerformedProcedureStepStartTime'],\r\n    '0250': ['DA', '1', 'PerformedProcedureStepEndDate'],\r\n    '0251': ['TM', '1', 'PerformedProcedureStepEndTime'],\r\n    '0252': ['CS', '1', 'PerformedProcedureStepStatus'],\r\n    '0253': ['SH', '1', 'PerformedProcedureStepID'],\r\n    '0254': ['LO', '1', 'PerformedProcedureStepDescription'],\r\n    '0255': ['LO', '1', 'PerformedProcedureTypeDescription'],\r\n    '0260': ['SQ', '1', 'PerformedProtocolCodeSequence'],\r\n    '0261': ['CS', '1', 'PerformedProtocolType'],\r\n    '0270': ['SQ', '1', 'ScheduledStepAttributesSequence'],\r\n    '0275': ['SQ', '1', 'RequestAttributesSequence'],\r\n    '0280': ['ST', '1', 'CommentsOnThePerformedProcedureStep'],\r\n    '0281': ['SQ', '1', 'PerformedProcedureStepDiscontinuationReasonCodeSequence'],\r\n    '0293': ['SQ', '1', 'QuantitySequence'],\r\n    '0294': ['DS', '1', 'Quantity'],\r\n    '0295': ['SQ', '1', 'MeasuringUnitsSequence'],\r\n    '0296': ['SQ', '1', 'BillingItemSequence'],\r\n    '0300': ['US', '1', 'TotalTimeOfFluoroscopy'],\r\n    '0301': ['US', '1', 'TotalNumberOfExposures'],\r\n    '0302': ['US', '1', 'EntranceDose'],\r\n    '0303': ['US', '1-2', 'ExposedArea'],\r\n    '0306': ['DS', '1', 'DistanceSourceToEntrance'],\r\n    '0307': ['DS', '1', 'DistanceSourceToSupport'],\r\n    '030E': ['SQ', '1', 'ExposureDoseSequence'],\r\n    '0310': ['ST', '1', 'CommentsOnRadiationDose'],\r\n    '0312': ['DS', '1', 'XRayOutput'],\r\n    '0314': ['DS', '1', 'HalfValueLayer'],\r\n    '0316': ['DS', '1', 'OrganDose'],\r\n    '0318': ['CS', '1', 'OrganExposed'],\r\n    '0320': ['SQ', '1', 'BillingProcedureStepSequence'],\r\n    '0321': ['SQ', '1', 'FilmConsumptionSequence'],\r\n    '0324': ['SQ', '1', 'BillingSuppliesAndDevicesSequence'],\r\n    '0330': ['SQ', '1', 'ReferencedProcedureStepSequence'],\r\n    '0340': ['SQ', '1', 'PerformedSeriesSequence'],\r\n    '0400': ['LT', '1', 'CommentsOnTheScheduledProcedureStep'],\r\n    '0440': ['SQ', '1', 'ProtocolContextSequence'],\r\n    '0441': ['SQ', '1', 'ContentItemModifierSequence'],\r\n    '0500': ['SQ', '1', 'ScheduledSpecimenSequence'],\r\n    '050A': ['LO', '1', 'SpecimenAccessionNumber'],\r\n    '0512': ['LO', '1', 'ContainerIdentifier'],\r\n    '0513': ['SQ', '1', 'IssuerOfTheContainerIdentifierSequence'],\r\n    '0515': ['SQ', '1', 'AlternateContainerIdentifierSequence'],\r\n    '0518': ['SQ', '1', 'ContainerTypeCodeSequence'],\r\n    '051A': ['LO', '1', 'ContainerDescription'],\r\n    '0520': ['SQ', '1', 'ContainerComponentSequence'],\r\n    '0550': ['SQ', '1', 'SpecimenSequence'],\r\n    '0551': ['LO', '1', 'SpecimenIdentifier'],\r\n    '0552': ['SQ', '1', 'SpecimenDescriptionSequenceTrial'],\r\n    '0553': ['ST', '1', 'SpecimenDescriptionTrial'],\r\n    '0554': ['UI', '1', 'SpecimenUID'],\r\n    '0555': ['SQ', '1', 'AcquisitionContextSequence'],\r\n    '0556': ['ST', '1', 'AcquisitionContextDescription'],\r\n    '0560': ['SQ', '1', 'SpecimenDescriptionSequence'],\r\n    '0562': ['SQ', '1', 'IssuerOfTheSpecimenIdentifierSequence'],\r\n    '059A': ['SQ', '1', 'SpecimenTypeCodeSequence'],\r\n    '0600': ['LO', '1', 'SpecimenShortDescription'],\r\n    '0602': ['UT', '1', 'SpecimenDetailedDescription'],\r\n    '0610': ['SQ', '1', 'SpecimenPreparationSequence'],\r\n    '0612': ['SQ', '1', 'SpecimenPreparationStepContentItemSequence'],\r\n    '0620': ['SQ', '1', 'SpecimenLocalizationContentItemSequence'],\r\n    '06FA': ['LO', '1', 'SlideIdentifier'],\r\n    '0710': ['SQ', '1', 'WholeSlideMicroscopyImageFrameTypeSequence'],\r\n    '071A': ['SQ', '1', 'ImageCenterPointCoordinatesSequence'],\r\n    '072A': ['DS', '1', 'XOffsetInSlideCoordinateSystem'],\r\n    '073A': ['DS', '1', 'YOffsetInSlideCoordinateSystem'],\r\n    '074A': ['DS', '1', 'ZOffsetInSlideCoordinateSystem'],\r\n    '08D8': ['SQ', '1', 'PixelSpacingSequence'],\r\n    '08DA': ['SQ', '1', 'CoordinateSystemAxisCodeSequence'],\r\n    '08EA': ['SQ', '1', 'MeasurementUnitsCodeSequence'],\r\n    '09F8': ['SQ', '1', 'VitalStainCodeSequenceTrial'],\r\n    '1001': ['SH', '1', 'RequestedProcedureID'],\r\n    '1002': ['LO', '1', 'ReasonForTheRequestedProcedure'],\r\n    '1003': ['SH', '1', 'RequestedProcedurePriority'],\r\n    '1004': ['LO', '1', 'PatientTransportArrangements'],\r\n    '1005': ['LO', '1', 'RequestedProcedureLocation'],\r\n    '1006': ['SH', '1', 'PlacerOrderNumberProcedure'],\r\n    '1007': ['SH', '1', 'FillerOrderNumberProcedure'],\r\n    '1008': ['LO', '1', 'ConfidentialityCode'],\r\n    '1009': ['SH', '1', 'ReportingPriority'],\r\n    '100A': ['SQ', '1', 'ReasonForRequestedProcedureCodeSequence'],\r\n    '1010': ['PN', '1-n', 'NamesOfIntendedRecipientsOfResults'],\r\n    '1011': ['SQ', '1', 'IntendedRecipientsOfResultsIdentificationSequence'],\r\n    '1012': ['SQ', '1', 'ReasonForPerformedProcedureCodeSequence'],\r\n    '1060': ['LO', '1', 'RequestedProcedureDescriptionTrial'],\r\n    '1101': ['SQ', '1', 'PersonIdentificationCodeSequence'],\r\n    '1102': ['ST', '1', 'PersonAddress'],\r\n    '1103': ['LO', '1-n', 'PersonTelephoneNumbers'],\r\n    '1104': ['LT', '1', 'PersonTelecomInformation'],\r\n    '1400': ['LT', '1', 'RequestedProcedureComments'],\r\n    '2001': ['LO', '1', 'ReasonForTheImagingServiceRequest'],\r\n    '2004': ['DA', '1', 'IssueDateOfImagingServiceRequest'],\r\n    '2005': ['TM', '1', 'IssueTimeOfImagingServiceRequest'],\r\n    '2006': ['SH', '1', 'PlacerOrderNumberImagingServiceRequestRetired'],\r\n    '2007': ['SH', '1', 'FillerOrderNumberImagingServiceRequestRetired'],\r\n    '2008': ['PN', '1', 'OrderEnteredBy'],\r\n    '2009': ['SH', '1', 'OrderEntererLocation'],\r\n    '2010': ['SH', '1', 'OrderCallbackPhoneNumber'],\r\n    '2011': ['LT', '1', 'OrderCallbackTelecomInformation'],\r\n    '2016': ['LO', '1', 'PlacerOrderNumberImagingServiceRequest'],\r\n    '2017': ['LO', '1', 'FillerOrderNumberImagingServiceRequest'],\r\n    '2400': ['LT', '1', 'ImagingServiceRequestComments'],\r\n    '3001': ['LO', '1', 'ConfidentialityConstraintOnPatientDataDescription'],\r\n    '4001': ['CS', '1', 'GeneralPurposeScheduledProcedureStepStatus'],\r\n    '4002': ['CS', '1', 'GeneralPurposePerformedProcedureStepStatus'],\r\n    '4003': ['CS', '1', 'GeneralPurposeScheduledProcedureStepPriority'],\r\n    '4004': ['SQ', '1', 'ScheduledProcessingApplicationsCodeSequence'],\r\n    '4005': ['DT', '1', 'ScheduledProcedureStepStartDateTime'],\r\n    '4006': ['CS', '1', 'MultipleCopiesFlag'],\r\n    '4007': ['SQ', '1', 'PerformedProcessingApplicationsCodeSequence'],\r\n    '4008': ['DT', '1', 'ScheduledProcedureStepExpirationDateTime'],\r\n    '4009': ['SQ', '1', 'HumanPerformerCodeSequence'],\r\n    '4010': ['DT', '1', 'ScheduledProcedureStepModificationDateTime'],\r\n    '4011': ['DT', '1', 'ExpectedCompletionDateTime'],\r\n    '4015': ['SQ', '1', 'ResultingGeneralPurposePerformedProcedureStepsSequence'],\r\n    '4016': ['SQ', '1', 'ReferencedGeneralPurposeScheduledProcedureStepSequence'],\r\n    '4018': ['SQ', '1', 'ScheduledWorkitemCodeSequence'],\r\n    '4019': ['SQ', '1', 'PerformedWorkitemCodeSequence'],\r\n    '4020': ['CS', '1', 'InputAvailabilityFlag'],\r\n    '4021': ['SQ', '1', 'InputInformationSequence'],\r\n    '4022': ['SQ', '1', 'RelevantInformationSequence'],\r\n    '4023': ['UI', '1', 'ReferencedGeneralPurposeScheduledProcedureStepTransactionUID'],\r\n    '4025': ['SQ', '1', 'ScheduledStationNameCodeSequence'],\r\n    '4026': ['SQ', '1', 'ScheduledStationClassCodeSequence'],\r\n    '4027': ['SQ', '1', 'ScheduledStationGeographicLocationCodeSequence'],\r\n    '4028': ['SQ', '1', 'PerformedStationNameCodeSequence'],\r\n    '4029': ['SQ', '1', 'PerformedStationClassCodeSequence'],\r\n    '4030': ['SQ', '1', 'PerformedStationGeographicLocationCodeSequence'],\r\n    '4031': ['SQ', '1', 'RequestedSubsequentWorkitemCodeSequence'],\r\n    '4032': ['SQ', '1', 'NonDICOMOutputCodeSequence'],\r\n    '4033': ['SQ', '1', 'OutputInformationSequence'],\r\n    '4034': ['SQ', '1', 'ScheduledHumanPerformersSequence'],\r\n    '4035': ['SQ', '1', 'ActualHumanPerformersSequence'],\r\n    '4036': ['LO', '1', 'HumanPerformerOrganization'],\r\n    '4037': ['PN', '1', 'HumanPerformerName'],\r\n    '4040': ['CS', '1', 'RawDataHandling'],\r\n    '4041': ['CS', '1', 'InputReadinessState'],\r\n    '4050': ['DT', '1', 'PerformedProcedureStepStartDateTime'],\r\n    '4051': ['DT', '1', 'PerformedProcedureStepEndDateTime'],\r\n    '4052': ['DT', '1', 'ProcedureStepCancellationDateTime'],\r\n    '4070': ['SQ', '1', 'OutputDestinationSequence'],\r\n    '4071': ['SQ', '1', 'DICOMStorageSequence'],\r\n    '4072': ['SQ', '1', 'STOWRSStorageSequence'],\r\n    '4073': ['UR', '1', 'StorageURL'],\r\n    '4074': ['SQ', '1', 'XDSStorageSequence'],\r\n    '8302': ['DS', '1', 'EntranceDoseInmGy'],\r\n    '8303': ['CS', '1', 'EntranceDoseDerivation'],\r\n    '9092': ['SQ', '1', 'ParametricMapFrameTypeSequence'],\r\n    '9094': ['SQ', '1', 'ReferencedImageRealWorldValueMappingSequence'],\r\n    '9096': ['SQ', '1', 'RealWorldValueMappingSequence'],\r\n    '9098': ['SQ', '1', 'PixelValueMappingCodeSequence'],\r\n    '9210': ['SH', '1', 'LUTLabel'],\r\n    '9211': ['xs', '1', 'RealWorldValueLastValueMapped'],\r\n    '9212': ['FD', '1-n', 'RealWorldValueLUTData'],\r\n    '9213': ['FD', '1', 'DoubleFloatRealWorldValueLastValueMapped'],\r\n    '9214': ['FD', '1', 'DoubleFloatRealWorldValueFirstValueMapped'],\r\n    '9216': ['xs', '1', 'RealWorldValueFirstValueMapped'],\r\n    '9220': ['SQ', '1', 'QuantityDefinitionSequence'],\r\n    '9224': ['FD', '1', 'RealWorldValueIntercept'],\r\n    '9225': ['FD', '1', 'RealWorldValueSlope'],\r\n    'A007': ['CS', '1', 'FindingsFlagTrial'],\r\n    'A010': ['CS', '1', 'RelationshipType'],\r\n    'A020': ['SQ', '1', 'FindingsSequenceTrial'],\r\n    'A021': ['UI', '1', 'FindingsGroupUIDTrial'],\r\n    'A022': ['UI', '1', 'ReferencedFindingsGroupUIDTrial'],\r\n    'A023': ['DA', '1', 'FindingsGroupRecordingDateTrial'],\r\n    'A024': ['TM', '1', 'FindingsGroupRecordingTimeTrial'],\r\n    'A026': ['SQ', '1', 'FindingsSourceCategoryCodeSequenceTrial'],\r\n    'A027': ['LO', '1', 'VerifyingOrganization'],\r\n    'A028': ['SQ', '1', 'DocumentingOrganizationIdentifierCodeSequenceTrial'],\r\n    'A030': ['DT', '1', 'VerificationDateTime'],\r\n    'A032': ['DT', '1', 'ObservationDateTime'],\r\n    'A033': ['DT', '1', 'ObservationStartDateTime'],\r\n    'A040': ['CS', '1', 'ValueType'],\r\n    'A043': ['SQ', '1', 'ConceptNameCodeSequence'],\r\n    'A047': ['LO', '1', 'MeasurementPrecisionDescriptionTrial'],\r\n    'A050': ['CS', '1', 'ContinuityOfContent'],\r\n    'A057': ['CS', '1-n', 'UrgencyOrPriorityAlertsTrial'],\r\n    'A060': ['LO', '1', 'SequencingIndicatorTrial'],\r\n    'A066': ['SQ', '1', 'DocumentIdentifierCodeSequenceTrial'],\r\n    'A067': ['PN', '1', 'DocumentAuthorTrial'],\r\n    'A068': ['SQ', '1', 'DocumentAuthorIdentifierCodeSequenceTrial'],\r\n    'A070': ['SQ', '1', 'IdentifierCodeSequenceTrial'],\r\n    'A073': ['SQ', '1', 'VerifyingObserverSequence'],\r\n    'A074': ['OB', '1', 'ObjectBinaryIdentifierTrial'],\r\n    'A075': ['PN', '1', 'VerifyingObserverName'],\r\n    'A076': ['SQ', '1', 'DocumentingObserverIdentifierCodeSequenceTrial'],\r\n    'A078': ['SQ', '1', 'AuthorObserverSequence'],\r\n    'A07A': ['SQ', '1', 'ParticipantSequence'],\r\n    'A07C': ['SQ', '1', 'CustodialOrganizationSequence'],\r\n    'A080': ['CS', '1', 'ParticipationType'],\r\n    'A082': ['DT', '1', 'ParticipationDateTime'],\r\n    'A084': ['CS', '1', 'ObserverType'],\r\n    'A085': ['SQ', '1', 'ProcedureIdentifierCodeSequenceTrial'],\r\n    'A088': ['SQ', '1', 'VerifyingObserverIdentificationCodeSequence'],\r\n    'A089': ['OB', '1', 'ObjectDirectoryBinaryIdentifierTrial'],\r\n    'A090': ['SQ', '1', 'EquivalentCDADocumentSequence'],\r\n    'A0B0': ['US', '2-2n', 'ReferencedWaveformChannels'],\r\n    'A110': ['DA', '1', 'DateOfDocumentOrVerbalTransactionTrial'],\r\n    'A112': ['TM', '1', 'TimeOfDocumentCreationOrVerbalTransactionTrial'],\r\n    'A120': ['DT', '1', 'DateTime'],\r\n    'A121': ['DA', '1', 'Date'],\r\n    'A122': ['TM', '1', 'Time'],\r\n    'A123': ['PN', '1', 'PersonName'],\r\n    'A124': ['UI', '1', 'UID'],\r\n    'A125': ['CS', '2', 'ReportStatusIDTrial'],\r\n    'A130': ['CS', '1', 'TemporalRangeType'],\r\n    'A132': ['UL', '1-n', 'ReferencedSamplePositions'],\r\n    'A136': ['US', '1-n', 'ReferencedFrameNumbers'],\r\n    'A138': ['DS', '1-n', 'ReferencedTimeOffsets'],\r\n    'A13A': ['DT', '1-n', 'ReferencedDateTime'],\r\n    'A160': ['UT', '1', 'TextValue'],\r\n    'A161': ['FD', '1-n', 'FloatingPointValue'],\r\n    'A162': ['SL', '1-n', 'RationalNumeratorValue'],\r\n    'A163': ['UL', '1-n', 'RationalDenominatorValue'],\r\n    'A167': ['SQ', '1', 'ObservationCategoryCodeSequenceTrial'],\r\n    'A168': ['SQ', '1', 'ConceptCodeSequence'],\r\n    'A16A': ['ST', '1', 'BibliographicCitationTrial'],\r\n    'A170': ['SQ', '1', 'PurposeOfReferenceCodeSequence'],\r\n    'A171': ['UI', '1', 'ObservationUID'],\r\n    'A172': ['UI', '1', 'ReferencedObservationUIDTrial'],\r\n    'A173': ['CS', '1', 'ReferencedObservationClassTrial'],\r\n    'A174': ['CS', '1', 'ReferencedObjectObservationClassTrial'],\r\n    'A180': ['US', '1', 'AnnotationGroupNumber'],\r\n    'A192': ['DA', '1', 'ObservationDateTrial'],\r\n    'A193': ['TM', '1', 'ObservationTimeTrial'],\r\n    'A194': ['CS', '1', 'MeasurementAutomationTrial'],\r\n    'A195': ['SQ', '1', 'ModifierCodeSequence'],\r\n    'A224': ['ST', '1', 'IdentificationDescriptionTrial'],\r\n    'A290': ['CS', '1', 'CoordinatesSetGeometricTypeTrial'],\r\n    'A296': ['SQ', '1', 'AlgorithmCodeSequenceTrial'],\r\n    'A297': ['ST', '1', 'AlgorithmDescriptionTrial'],\r\n    'A29A': ['SL', '2-2n', 'PixelCoordinatesSetTrial'],\r\n    'A300': ['SQ', '1', 'MeasuredValueSequence'],\r\n    'A301': ['SQ', '1', 'NumericValueQualifierCodeSequence'],\r\n    'A307': ['PN', '1', 'CurrentObserverTrial'],\r\n    'A30A': ['DS', '1-n', 'NumericValue'],\r\n    'A313': ['SQ', '1', 'ReferencedAccessionSequenceTrial'],\r\n    'A33A': ['ST', '1', 'ReportStatusCommentTrial'],\r\n    'A340': ['SQ', '1', 'ProcedureContextSequenceTrial'],\r\n    'A352': ['PN', '1', 'VerbalSourceTrial'],\r\n    'A353': ['ST', '1', 'AddressTrial'],\r\n    'A354': ['LO', '1', 'TelephoneNumberTrial'],\r\n    'A358': ['SQ', '1', 'VerbalSourceIdentifierCodeSequenceTrial'],\r\n    'A360': ['SQ', '1', 'PredecessorDocumentsSequence'],\r\n    'A370': ['SQ', '1', 'ReferencedRequestSequence'],\r\n    'A372': ['SQ', '1', 'PerformedProcedureCodeSequence'],\r\n    'A375': ['SQ', '1', 'CurrentRequestedProcedureEvidenceSequence'],\r\n    'A380': ['SQ', '1', 'ReportDetailSequenceTrial'],\r\n    'A385': ['SQ', '1', 'PertinentOtherEvidenceSequence'],\r\n    'A390': ['SQ', '1', 'HL7StructuredDocumentReferenceSequence'],\r\n    'A402': ['UI', '1', 'ObservationSubjectUIDTrial'],\r\n    'A403': ['CS', '1', 'ObservationSubjectClassTrial'],\r\n    'A404': ['SQ', '1', 'ObservationSubjectTypeCodeSequenceTrial'],\r\n    'A491': ['CS', '1', 'CompletionFlag'],\r\n    'A492': ['LO', '1', 'CompletionFlagDescription'],\r\n    'A493': ['CS', '1', 'VerificationFlag'],\r\n    'A494': ['CS', '1', 'ArchiveRequested'],\r\n    'A496': ['CS', '1', 'PreliminaryFlag'],\r\n    'A504': ['SQ', '1', 'ContentTemplateSequence'],\r\n    'A525': ['SQ', '1', 'IdenticalDocumentsSequence'],\r\n    'A600': ['CS', '1', 'ObservationSubjectContextFlagTrial'],\r\n    'A601': ['CS', '1', 'ObserverContextFlagTrial'],\r\n    'A603': ['CS', '1', 'ProcedureContextFlagTrial'],\r\n    'A730': ['SQ', '1', 'ContentSequence'],\r\n    'A731': ['SQ', '1', 'RelationshipSequenceTrial'],\r\n    'A732': ['SQ', '1', 'RelationshipTypeCodeSequenceTrial'],\r\n    'A744': ['SQ', '1', 'LanguageCodeSequenceTrial'],\r\n    'A801': ['SQ', '1', 'TabulatedValuesSequence'],\r\n    'A802': ['UL', '1', 'NumberOfTableRows'],\r\n    'A803': ['UL', '1', 'NumberOfTableColumns'],\r\n    'A804': ['UL', '1', 'TableRowNumber'],\r\n    'A805': ['UL', '1', 'TableColumnNumber'],\r\n    'A806': ['SQ', '1', 'TableRowDefinitionSequence'],\r\n    'A807': ['SQ', '1', 'TableColumnDefinitionSequence'],\r\n    'A808': ['SQ', '1', 'CellValuesSequence'],\r\n    'A992': ['ST', '1', 'UniformResourceLocatorTrial'],\r\n    'B020': ['SQ', '1', 'WaveformAnnotationSequence'],\r\n    'DB00': ['CS', '1', 'TemplateIdentifier'],\r\n    'DB06': ['DT', '1', 'TemplateVersion'],\r\n    'DB07': ['DT', '1', 'TemplateLocalVersion'],\r\n    'DB0B': ['CS', '1', 'TemplateExtensionFlag'],\r\n    'DB0C': ['UI', '1', 'TemplateExtensionOrganizationUID'],\r\n    'DB0D': ['UI', '1', 'TemplateExtensionCreatorUID'],\r\n    'DB73': ['UL', '1-n', 'ReferencedContentItemIdentifier'],\r\n    'E001': ['ST', '1', 'HL7InstanceIdentifier'],\r\n    'E004': ['DT', '1', 'HL7DocumentEffectiveTime'],\r\n    'E006': ['SQ', '1', 'HL7DocumentTypeCodeSequence'],\r\n    'E008': ['SQ', '1', 'DocumentClassCodeSequence'],\r\n    'E010': ['UR', '1', 'RetrieveURI'],\r\n    'E011': ['UI', '1', 'RetrieveLocationUID'],\r\n    'E020': ['CS', '1', 'TypeOfInstances'],\r\n    'E021': ['SQ', '1', 'DICOMRetrievalSequence'],\r\n    'E022': ['SQ', '1', 'DICOMMediaRetrievalSequence'],\r\n    'E023': ['SQ', '1', 'WADORetrievalSequence'],\r\n    'E024': ['SQ', '1', 'XDSRetrievalSequence'],\r\n    'E025': ['SQ', '1', 'WADORSRetrievalSequence'],\r\n    'E030': ['UI', '1', 'RepositoryUniqueID'],\r\n    'E031': ['UI', '1', 'HomeCommunityID']\r\n  },\r\n  '0042': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['ST', '1', 'DocumentTitle'],\r\n    '0011': ['OB', '1', 'EncapsulatedDocument'],\r\n    '0012': ['LO', '1', 'MIMETypeOfEncapsulatedDocument'],\r\n    '0013': ['SQ', '1', 'SourceInstanceSequence'],\r\n    '0014': ['LO', '1-n', 'ListOfMIMETypes'],\r\n    '0015': ['UL', '1', 'EncapsulatedDocumentLength']\r\n  },\r\n  '0044': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['ST', '1', 'ProductPackageIdentifier'],\r\n    '0002': ['CS', '1', 'SubstanceAdministrationApproval'],\r\n    '0003': ['LT', '1', 'ApprovalStatusFurtherDescription'],\r\n    '0004': ['DT', '1', 'ApprovalStatusDateTime'],\r\n    '0007': ['SQ', '1', 'ProductTypeCodeSequence'],\r\n    '0008': ['LO', '1-n', 'ProductName'],\r\n    '0009': ['LT', '1', 'ProductDescription'],\r\n    '000A': ['LO', '1', 'ProductLotIdentifier'],\r\n    '000B': ['DT', '1', 'ProductExpirationDateTime'],\r\n    '0010': ['DT', '1', 'SubstanceAdministrationDateTime'],\r\n    '0011': ['LO', '1', 'SubstanceAdministrationNotes'],\r\n    '0012': ['LO', '1', 'SubstanceAdministrationDeviceID'],\r\n    '0013': ['SQ', '1', 'ProductParameterSequence'],\r\n    '0019': ['SQ', '1', 'SubstanceAdministrationParameterSequence'],\r\n    '0100': ['SQ', '1', 'ApprovalSequence'],\r\n    '0101': ['SQ', '1', 'AssertionCodeSequence'],\r\n    '0102': ['UI', '1', 'AssertionUID'],\r\n    '0103': ['SQ', '1', 'AsserterIdentificationSequence'],\r\n    '0104': ['DT', '1', 'AssertionDateTime'],\r\n    '0105': ['DT', '1', 'AssertionExpirationDateTime'],\r\n    '0106': ['UT', '1', 'AssertionComments'],\r\n    '0107': ['SQ', '1', 'RelatedAssertionSequence'],\r\n    '0108': ['UI', '1', 'ReferencedAssertionUID'],\r\n    '0109': ['SQ', '1', 'ApprovalSubjectSequence'],\r\n    '010A': ['SQ', '1', 'OrganizationalRoleCodeSequence']\r\n  },\r\n  '0046': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0012': ['LO', '1', 'LensDescription'],\r\n    '0014': ['SQ', '1', 'RightLensSequence'],\r\n    '0015': ['SQ', '1', 'LeftLensSequence'],\r\n    '0016': ['SQ', '1', 'UnspecifiedLateralityLensSequence'],\r\n    '0018': ['SQ', '1', 'CylinderSequence'],\r\n    '0028': ['SQ', '1', 'PrismSequence'],\r\n    '0030': ['FD', '1', 'HorizontalPrismPower'],\r\n    '0032': ['CS', '1', 'HorizontalPrismBase'],\r\n    '0034': ['FD', '1', 'VerticalPrismPower'],\r\n    '0036': ['CS', '1', 'VerticalPrismBase'],\r\n    '0038': ['CS', '1', 'LensSegmentType'],\r\n    '0040': ['FD', '1', 'OpticalTransmittance'],\r\n    '0042': ['FD', '1', 'ChannelWidth'],\r\n    '0044': ['FD', '1', 'PupilSize'],\r\n    '0046': ['FD', '1', 'CornealSize'],\r\n    '0047': ['SQ', '1', 'CornealSizeSequence'],\r\n    '0050': ['SQ', '1', 'AutorefractionRightEyeSequence'],\r\n    '0052': ['SQ', '1', 'AutorefractionLeftEyeSequence'],\r\n    '0060': ['FD', '1', 'DistancePupillaryDistance'],\r\n    '0062': ['FD', '1', 'NearPupillaryDistance'],\r\n    '0063': ['FD', '1', 'IntermediatePupillaryDistance'],\r\n    '0064': ['FD', '1', 'OtherPupillaryDistance'],\r\n    '0070': ['SQ', '1', 'KeratometryRightEyeSequence'],\r\n    '0071': ['SQ', '1', 'KeratometryLeftEyeSequence'],\r\n    '0074': ['SQ', '1', 'SteepKeratometricAxisSequence'],\r\n    '0075': ['FD', '1', 'RadiusOfCurvature'],\r\n    '0076': ['FD', '1', 'KeratometricPower'],\r\n    '0077': ['FD', '1', 'KeratometricAxis'],\r\n    '0080': ['SQ', '1', 'FlatKeratometricAxisSequence'],\r\n    '0092': ['CS', '1', 'BackgroundColor'],\r\n    '0094': ['CS', '1', 'Optotype'],\r\n    '0095': ['CS', '1', 'OptotypePresentation'],\r\n    '0097': ['SQ', '1', 'SubjectiveRefractionRightEyeSequence'],\r\n    '0098': ['SQ', '1', 'SubjectiveRefractionLeftEyeSequence'],\r\n    '0100': ['SQ', '1', 'AddNearSequence'],\r\n    '0101': ['SQ', '1', 'AddIntermediateSequence'],\r\n    '0102': ['SQ', '1', 'AddOtherSequence'],\r\n    '0104': ['FD', '1', 'AddPower'],\r\n    '0106': ['FD', '1', 'ViewingDistance'],\r\n    '0110': ['SQ', '1', 'CorneaMeasurementsSequence'],\r\n    '0111': ['SQ', '1', 'SourceOfCorneaMeasurementDataCodeSequence'],\r\n    '0112': ['SQ', '1', 'SteepCornealAxisSequence'],\r\n    '0113': ['SQ', '1', 'FlatCornealAxisSequence'],\r\n    '0114': ['FD', '1', 'CornealPower'],\r\n    '0115': ['FD', '1', 'CornealAxis'],\r\n    '0116': ['SQ', '1', 'CorneaMeasurementMethodCodeSequence'],\r\n    '0117': ['FL', '1', 'RefractiveIndexOfCornea'],\r\n    '0118': ['FL', '1', 'RefractiveIndexOfAqueousHumor'],\r\n    '0121': ['SQ', '1', 'VisualAcuityTypeCodeSequence'],\r\n    '0122': ['SQ', '1', 'VisualAcuityRightEyeSequence'],\r\n    '0123': ['SQ', '1', 'VisualAcuityLeftEyeSequence'],\r\n    '0124': ['SQ', '1', 'VisualAcuityBothEyesOpenSequence'],\r\n    '0125': ['CS', '1', 'ViewingDistanceType'],\r\n    '0135': ['SS', '2', 'VisualAcuityModifiers'],\r\n    '0137': ['FD', '1', 'DecimalVisualAcuity'],\r\n    '0139': ['LO', '1', 'OptotypeDetailedDefinition'],\r\n    '0145': ['SQ', '1', 'ReferencedRefractiveMeasurementsSequence'],\r\n    '0146': ['FD', '1', 'SpherePower'],\r\n    '0147': ['FD', '1', 'CylinderPower'],\r\n    '0201': ['CS', '1', 'CornealTopographySurface'],\r\n    '0202': ['FL', '2', 'CornealVertexLocation'],\r\n    '0203': ['FL', '1', 'PupilCentroidXCoordinate'],\r\n    '0204': ['FL', '1', 'PupilCentroidYCoordinate'],\r\n    '0205': ['FL', '1', 'EquivalentPupilRadius'],\r\n    '0207': ['SQ', '1', 'CornealTopographyMapTypeCodeSequence'],\r\n    '0208': ['IS', '2-2n', 'VerticesOfTheOutlineOfPupil'],\r\n    '0210': ['SQ', '1', 'CornealTopographyMappingNormalsSequence'],\r\n    '0211': ['SQ', '1', 'MaximumCornealCurvatureSequence'],\r\n    '0212': ['FL', '1', 'MaximumCornealCurvature'],\r\n    '0213': ['FL', '2', 'MaximumCornealCurvatureLocation'],\r\n    '0215': ['SQ', '1', 'MinimumKeratometricSequence'],\r\n    '0218': ['SQ', '1', 'SimulatedKeratometricCylinderSequence'],\r\n    '0220': ['FL', '1', 'AverageCornealPower'],\r\n    '0224': ['FL', '1', 'CornealISValue'],\r\n    '0227': ['FL', '1', 'AnalyzedArea'],\r\n    '0230': ['FL', '1', 'SurfaceRegularityIndex'],\r\n    '0232': ['FL', '1', 'SurfaceAsymmetryIndex'],\r\n    '0234': ['FL', '1', 'CornealEccentricityIndex'],\r\n    '0236': ['FL', '1', 'KeratoconusPredictionIndex'],\r\n    '0238': ['FL', '1', 'DecimalPotentialVisualAcuity'],\r\n    '0242': ['CS', '1', 'CornealTopographyMapQualityEvaluation'],\r\n    '0244': ['SQ', '1', 'SourceImageCornealProcessedDataSequence'],\r\n    '0247': ['FL', '3', 'CornealPointLocation'],\r\n    '0248': ['CS', '1', 'CornealPointEstimated'],\r\n    '0249': ['FL', '1', 'AxialPower'],\r\n    '0250': ['FL', '1', 'TangentialPower'],\r\n    '0251': ['FL', '1', 'RefractivePower'],\r\n    '0252': ['FL', '1', 'RelativeElevation'],\r\n    '0253': ['FL', '1', 'CornealWavefront']\r\n  },\r\n  '0048': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['FL', '1', 'ImagedVolumeWidth'],\r\n    '0002': ['FL', '1', 'ImagedVolumeHeight'],\r\n    '0003': ['FL', '1', 'ImagedVolumeDepth'],\r\n    '0006': ['UL', '1', 'TotalPixelMatrixColumns'],\r\n    '0007': ['UL', '1', 'TotalPixelMatrixRows'],\r\n    '0008': ['SQ', '1', 'TotalPixelMatrixOriginSequence'],\r\n    '0010': ['CS', '1', 'SpecimenLabelInImage'],\r\n    '0011': ['CS', '1', 'FocusMethod'],\r\n    '0012': ['CS', '1', 'ExtendedDepthOfField'],\r\n    '0013': ['US', '1', 'NumberOfFocalPlanes'],\r\n    '0014': ['FL', '1', 'DistanceBetweenFocalPlanes'],\r\n    '0015': ['US', '3', 'RecommendedAbsentPixelCIELabValue'],\r\n    '0100': ['SQ', '1', 'IlluminatorTypeCodeSequence'],\r\n    '0102': ['DS', '6', 'ImageOrientationSlide'],\r\n    '0105': ['SQ', '1', 'OpticalPathSequence'],\r\n    '0106': ['SH', '1', 'OpticalPathIdentifier'],\r\n    '0107': ['ST', '1', 'OpticalPathDescription'],\r\n    '0108': ['SQ', '1', 'IlluminationColorCodeSequence'],\r\n    '0110': ['SQ', '1', 'SpecimenReferenceSequence'],\r\n    '0111': ['DS', '1', 'CondenserLensPower'],\r\n    '0112': ['DS', '1', 'ObjectiveLensPower'],\r\n    '0113': ['DS', '1', 'ObjectiveLensNumericalAperture'],\r\n    '0120': ['SQ', '1', 'PaletteColorLookupTableSequence'],\r\n    '0200': ['SQ', '1', 'ReferencedImageNavigationSequence'],\r\n    '0201': ['US', '2', 'TopLeftHandCornerOfLocalizerArea'],\r\n    '0202': ['US', '2', 'BottomRightHandCornerOfLocalizerArea'],\r\n    '0207': ['SQ', '1', 'OpticalPathIdentificationSequence'],\r\n    '021A': ['SQ', '1', 'PlanePositionSlideSequence'],\r\n    '021E': ['SL', '1', 'ColumnPositionInTotalImagePixelMatrix'],\r\n    '021F': ['SL', '1', 'RowPositionInTotalImagePixelMatrix'],\r\n    '0301': ['CS', '1', 'PixelOriginInterpretation'],\r\n    '0302': ['UL', '1', 'NumberOfOpticalPaths'],\r\n    '0303': ['UL', '1', 'TotalPixelMatrixFocalPlanes']\r\n  },\r\n  '0050': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0004': ['CS', '1', 'CalibrationImage'],\r\n    '0010': ['SQ', '1', 'DeviceSequence'],\r\n    '0012': ['SQ', '1', 'ContainerComponentTypeCodeSequence'],\r\n    '0013': ['FD', '1', 'ContainerComponentThickness'],\r\n    '0014': ['DS', '1', 'DeviceLength'],\r\n    '0015': ['FD', '1', 'ContainerComponentWidth'],\r\n    '0016': ['DS', '1', 'DeviceDiameter'],\r\n    '0017': ['CS', '1', 'DeviceDiameterUnits'],\r\n    '0018': ['DS', '1', 'DeviceVolume'],\r\n    '0019': ['DS', '1', 'InterMarkerDistance'],\r\n    '001A': ['CS', '1', 'ContainerComponentMaterial'],\r\n    '001B': ['LO', '1', 'ContainerComponentID'],\r\n    '001C': ['FD', '1', 'ContainerComponentLength'],\r\n    '001D': ['FD', '1', 'ContainerComponentDiameter'],\r\n    '001E': ['LO', '1', 'ContainerComponentDescription'],\r\n    '0020': ['LO', '1', 'DeviceDescription'],\r\n    '0021': ['ST', '1', 'LongDeviceDescription']\r\n  },\r\n  '0052': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['FL', '1', 'ContrastBolusIngredientPercentByVolume'],\r\n    '0002': ['FD', '1', 'OCTFocalDistance'],\r\n    '0003': ['FD', '1', 'BeamSpotSize'],\r\n    '0004': ['FD', '1', 'EffectiveRefractiveIndex'],\r\n    '0006': ['CS', '1', 'OCTAcquisitionDomain'],\r\n    '0007': ['FD', '1', 'OCTOpticalCenterWavelength'],\r\n    '0008': ['FD', '1', 'AxialResolution'],\r\n    '0009': ['FD', '1', 'RangingDepth'],\r\n    '0011': ['FD', '1', 'ALineRate'],\r\n    '0012': ['US', '1', 'ALinesPerFrame'],\r\n    '0013': ['FD', '1', 'CatheterRotationalRate'],\r\n    '0014': ['FD', '1', 'ALinePixelSpacing'],\r\n    '0016': ['SQ', '1', 'ModeOfPercutaneousAccessSequence'],\r\n    '0025': ['SQ', '1', 'IntravascularOCTFrameTypeSequence'],\r\n    '0026': ['CS', '1', 'OCTZOffsetApplied'],\r\n    '0027': ['SQ', '1', 'IntravascularFrameContentSequence'],\r\n    '0028': ['FD', '1', 'IntravascularLongitudinalDistance'],\r\n    '0029': ['SQ', '1', 'IntravascularOCTFrameContentSequence'],\r\n    '0030': ['SS', '1', 'OCTZOffsetCorrection'],\r\n    '0031': ['CS', '1', 'CatheterDirectionOfRotation'],\r\n    '0033': ['FD', '1', 'SeamLineLocation'],\r\n    '0034': ['FD', '1', 'FirstALineLocation'],\r\n    '0036': ['US', '1', 'SeamLineIndex'],\r\n    '0038': ['US', '1', 'NumberOfPaddedALines'],\r\n    '0039': ['CS', '1', 'InterpolationType'],\r\n    '003A': ['CS', '1', 'RefractiveIndexApplied']\r\n  },\r\n  '0054': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['US', '1-n', 'EnergyWindowVector'],\r\n    '0011': ['US', '1', 'NumberOfEnergyWindows'],\r\n    '0012': ['SQ', '1', 'EnergyWindowInformationSequence'],\r\n    '0013': ['SQ', '1', 'EnergyWindowRangeSequence'],\r\n    '0014': ['DS', '1', 'EnergyWindowLowerLimit'],\r\n    '0015': ['DS', '1', 'EnergyWindowUpperLimit'],\r\n    '0016': ['SQ', '1', 'RadiopharmaceuticalInformationSequence'],\r\n    '0017': ['IS', '1', 'ResidualSyringeCounts'],\r\n    '0018': ['SH', '1', 'EnergyWindowName'],\r\n    '0020': ['US', '1-n', 'DetectorVector'],\r\n    '0021': ['US', '1', 'NumberOfDetectors'],\r\n    '0022': ['SQ', '1', 'DetectorInformationSequence'],\r\n    '0030': ['US', '1-n', 'PhaseVector'],\r\n    '0031': ['US', '1', 'NumberOfPhases'],\r\n    '0032': ['SQ', '1', 'PhaseInformationSequence'],\r\n    '0033': ['US', '1', 'NumberOfFramesInPhase'],\r\n    '0036': ['IS', '1', 'PhaseDelay'],\r\n    '0038': ['IS', '1', 'PauseBetweenFrames'],\r\n    '0039': ['CS', '1', 'PhaseDescription'],\r\n    '0050': ['US', '1-n', 'RotationVector'],\r\n    '0051': ['US', '1', 'NumberOfRotations'],\r\n    '0052': ['SQ', '1', 'RotationInformationSequence'],\r\n    '0053': ['US', '1', 'NumberOfFramesInRotation'],\r\n    '0060': ['US', '1-n', 'RRIntervalVector'],\r\n    '0061': ['US', '1', 'NumberOfRRIntervals'],\r\n    '0062': ['SQ', '1', 'GatedInformationSequence'],\r\n    '0063': ['SQ', '1', 'DataInformationSequence'],\r\n    '0070': ['US', '1-n', 'TimeSlotVector'],\r\n    '0071': ['US', '1', 'NumberOfTimeSlots'],\r\n    '0072': ['SQ', '1', 'TimeSlotInformationSequence'],\r\n    '0073': ['DS', '1', 'TimeSlotTime'],\r\n    '0080': ['US', '1-n', 'SliceVector'],\r\n    '0081': ['US', '1', 'NumberOfSlices'],\r\n    '0090': ['US', '1-n', 'AngularViewVector'],\r\n    '0100': ['US', '1-n', 'TimeSliceVector'],\r\n    '0101': ['US', '1', 'NumberOfTimeSlices'],\r\n    '0200': ['DS', '1', 'StartAngle'],\r\n    '0202': ['CS', '1', 'TypeOfDetectorMotion'],\r\n    '0210': ['IS', '1-n', 'TriggerVector'],\r\n    '0211': ['US', '1', 'NumberOfTriggersInPhase'],\r\n    '0220': ['SQ', '1', 'ViewCodeSequence'],\r\n    '0222': ['SQ', '1', 'ViewModifierCodeSequence'],\r\n    '0300': ['SQ', '1', 'RadionuclideCodeSequence'],\r\n    '0302': ['SQ', '1', 'AdministrationRouteCodeSequence'],\r\n    '0304': ['SQ', '1', 'RadiopharmaceuticalCodeSequence'],\r\n    '0306': ['SQ', '1', 'CalibrationDataSequence'],\r\n    '0308': ['US', '1', 'EnergyWindowNumber'],\r\n    '0400': ['SH', '1', 'ImageID'],\r\n    '0410': ['SQ', '1', 'PatientOrientationCodeSequence'],\r\n    '0412': ['SQ', '1', 'PatientOrientationModifierCodeSequence'],\r\n    '0414': ['SQ', '1', 'PatientGantryRelationshipCodeSequence'],\r\n    '0500': ['CS', '1', 'SliceProgressionDirection'],\r\n    '0501': ['CS', '1', 'ScanProgressionDirection'],\r\n    '1000': ['CS', '2', 'SeriesType'],\r\n    '1001': ['CS', '1', 'Units'],\r\n    '1002': ['CS', '1', 'CountsSource'],\r\n    '1004': ['CS', '1', 'ReprojectionMethod'],\r\n    '1006': ['CS', '1', 'SUVType'],\r\n    '1100': ['CS', '1', 'RandomsCorrectionMethod'],\r\n    '1101': ['LO', '1', 'AttenuationCorrectionMethod'],\r\n    '1102': ['CS', '1', 'DecayCorrection'],\r\n    '1103': ['LO', '1', 'ReconstructionMethod'],\r\n    '1104': ['LO', '1', 'DetectorLinesOfResponseUsed'],\r\n    '1105': ['LO', '1', 'ScatterCorrectionMethod'],\r\n    '1200': ['DS', '1', 'AxialAcceptance'],\r\n    '1201': ['IS', '2', 'AxialMash'],\r\n    '1202': ['IS', '1', 'TransverseMash'],\r\n    '1203': ['DS', '2', 'DetectorElementSize'],\r\n    '1210': ['DS', '1', 'CoincidenceWindowWidth'],\r\n    '1220': ['CS', '1-n', 'SecondaryCountsType'],\r\n    '1300': ['DS', '1', 'FrameReferenceTime'],\r\n    '1310': ['IS', '1', 'PrimaryPromptsCountsAccumulated'],\r\n    '1311': ['IS', '1-n', 'SecondaryCountsAccumulated'],\r\n    '1320': ['DS', '1', 'SliceSensitivityFactor'],\r\n    '1321': ['DS', '1', 'DecayFactor'],\r\n    '1322': ['DS', '1', 'DoseCalibrationFactor'],\r\n    '1323': ['DS', '1', 'ScatterFractionFactor'],\r\n    '1324': ['DS', '1', 'DeadTimeFactor'],\r\n    '1330': ['US', '1', 'ImageIndex'],\r\n    '1400': ['CS', '1-n', 'CountsIncluded'],\r\n    '1401': ['CS', '1', 'DeadTimeCorrectionFlag']\r\n  },\r\n  '0060': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '3000': ['SQ', '1', 'HistogramSequence'],\r\n    '3002': ['US', '1', 'HistogramNumberOfBins'],\r\n    '3004': ['xs', '1', 'HistogramFirstBinValue'],\r\n    '3006': ['xs', '1', 'HistogramLastBinValue'],\r\n    '3008': ['US', '1', 'HistogramBinWidth'],\r\n    '3010': ['LO', '1', 'HistogramExplanation'],\r\n    '3020': ['UL', '1-n', 'HistogramData']\r\n  },\r\n  '0062': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['CS', '1', 'SegmentationType'],\r\n    '0002': ['SQ', '1', 'SegmentSequence'],\r\n    '0003': ['SQ', '1', 'SegmentedPropertyCategoryCodeSequence'],\r\n    '0004': ['US', '1', 'SegmentNumber'],\r\n    '0005': ['LO', '1', 'SegmentLabel'],\r\n    '0006': ['ST', '1', 'SegmentDescription'],\r\n    '0007': ['SQ', '1', 'SegmentationAlgorithmIdentificationSequence'],\r\n    '0008': ['CS', '1', 'SegmentAlgorithmType'],\r\n    '0009': ['LO', '1-n', 'SegmentAlgorithmName'],\r\n    '000A': ['SQ', '1', 'SegmentIdentificationSequence'],\r\n    '000B': ['US', '1-n', 'ReferencedSegmentNumber'],\r\n    '000C': ['US', '1', 'RecommendedDisplayGrayscaleValue'],\r\n    '000D': ['US', '3', 'RecommendedDisplayCIELabValue'],\r\n    '000E': ['US', '1', 'MaximumFractionalValue'],\r\n    '000F': ['SQ', '1', 'SegmentedPropertyTypeCodeSequence'],\r\n    '0010': ['CS', '1', 'SegmentationFractionalType'],\r\n    '0011': ['SQ', '1', 'SegmentedPropertyTypeModifierCodeSequence'],\r\n    '0012': ['SQ', '1', 'UsedSegmentsSequence'],\r\n    '0013': ['CS', '1', 'SegmentsOverlap'],\r\n    '0020': ['UT', '1', 'TrackingID'],\r\n    '0021': ['UI', '1', 'TrackingUID']\r\n  },\r\n  '0064': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0002': ['SQ', '1', 'DeformableRegistrationSequence'],\r\n    '0003': ['UI', '1', 'SourceFrameOfReferenceUID'],\r\n    '0005': ['SQ', '1', 'DeformableRegistrationGridSequence'],\r\n    '0007': ['UL', '3', 'GridDimensions'],\r\n    '0008': ['FD', '3', 'GridResolution'],\r\n    '0009': ['OF', '1', 'VectorGridData'],\r\n    '000F': ['SQ', '1', 'PreDeformationMatrixRegistrationSequence'],\r\n    '0010': ['SQ', '1', 'PostDeformationMatrixRegistrationSequence']\r\n  },\r\n  '0066': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['UL', '1', 'NumberOfSurfaces'],\r\n    '0002': ['SQ', '1', 'SurfaceSequence'],\r\n    '0003': ['UL', '1', 'SurfaceNumber'],\r\n    '0004': ['LT', '1', 'SurfaceComments'],\r\n    '0009': ['CS', '1', 'SurfaceProcessing'],\r\n    '000A': ['FL', '1', 'SurfaceProcessingRatio'],\r\n    '000B': ['LO', '1', 'SurfaceProcessingDescription'],\r\n    '000C': ['FL', '1', 'RecommendedPresentationOpacity'],\r\n    '000D': ['CS', '1', 'RecommendedPresentationType'],\r\n    '000E': ['CS', '1', 'FiniteVolume'],\r\n    '0010': ['CS', '1', 'Manifold'],\r\n    '0011': ['SQ', '1', 'SurfacePointsSequence'],\r\n    '0012': ['SQ', '1', 'SurfacePointsNormalsSequence'],\r\n    '0013': ['SQ', '1', 'SurfaceMeshPrimitivesSequence'],\r\n    '0015': ['UL', '1', 'NumberOfSurfacePoints'],\r\n    '0016': ['OF', '1', 'PointCoordinatesData'],\r\n    '0017': ['FL', '3', 'PointPositionAccuracy'],\r\n    '0018': ['FL', '1', 'MeanPointDistance'],\r\n    '0019': ['FL', '1', 'MaximumPointDistance'],\r\n    '001A': ['FL', '6', 'PointsBoundingBoxCoordinates'],\r\n    '001B': ['FL', '3', 'AxisOfRotation'],\r\n    '001C': ['FL', '3', 'CenterOfRotation'],\r\n    '001E': ['UL', '1', 'NumberOfVectors'],\r\n    '001F': ['US', '1', 'VectorDimensionality'],\r\n    '0020': ['FL', '1-n', 'VectorAccuracy'],\r\n    '0021': ['OF', '1', 'VectorCoordinateData'],\r\n    '0022': ['OD', '1', 'DoublePointCoordinatesData'],\r\n    '0023': ['OW', '1', 'TrianglePointIndexList'],\r\n    '0024': ['OW', '1', 'EdgePointIndexList'],\r\n    '0025': ['OW', '1', 'VertexPointIndexList'],\r\n    '0026': ['SQ', '1', 'TriangleStripSequence'],\r\n    '0027': ['SQ', '1', 'TriangleFanSequence'],\r\n    '0028': ['SQ', '1', 'LineSequence'],\r\n    '0029': ['OW', '1', 'PrimitivePointIndexList'],\r\n    '002A': ['UL', '1', 'SurfaceCount'],\r\n    '002B': ['SQ', '1', 'ReferencedSurfaceSequence'],\r\n    '002C': ['UL', '1', 'ReferencedSurfaceNumber'],\r\n    '002D': ['SQ', '1', 'SegmentSurfaceGenerationAlgorithmIdentificationSequence'],\r\n    '002E': ['SQ', '1', 'SegmentSurfaceSourceInstanceSequence'],\r\n    '002F': ['SQ', '1', 'AlgorithmFamilyCodeSequence'],\r\n    '0030': ['SQ', '1', 'AlgorithmNameCodeSequence'],\r\n    '0031': ['LO', '1', 'AlgorithmVersion'],\r\n    '0032': ['LT', '1', 'AlgorithmParameters'],\r\n    '0034': ['SQ', '1', 'FacetSequence'],\r\n    '0035': ['SQ', '1', 'SurfaceProcessingAlgorithmIdentificationSequence'],\r\n    '0036': ['LO', '1', 'AlgorithmName'],\r\n    '0037': ['FL', '1', 'RecommendedPointRadius'],\r\n    '0038': ['FL', '1', 'RecommendedLineThickness'],\r\n    '0040': ['OL', '1', 'LongPrimitivePointIndexList'],\r\n    '0041': ['OL', '1', 'LongTrianglePointIndexList'],\r\n    '0042': ['OL', '1', 'LongEdgePointIndexList'],\r\n    '0043': ['OL', '1', 'LongVertexPointIndexList'],\r\n    '0101': ['SQ', '1', 'TrackSetSequence'],\r\n    '0102': ['SQ', '1', 'TrackSequence'],\r\n    '0103': ['OW', '1', 'RecommendedDisplayCIELabValueList'],\r\n    '0104': ['SQ', '1', 'TrackingAlgorithmIdentificationSequence'],\r\n    '0105': ['UL', '1', 'TrackSetNumber'],\r\n    '0106': ['LO', '1', 'TrackSetLabel'],\r\n    '0107': ['UT', '1', 'TrackSetDescription'],\r\n    '0108': ['SQ', '1', 'TrackSetAnatomicalTypeCodeSequence'],\r\n    '0121': ['SQ', '1', 'MeasurementsSequence'],\r\n    '0124': ['SQ', '1', 'TrackSetStatisticsSequence'],\r\n    '0125': ['OF', '1', 'FloatingPointValues'],\r\n    '0129': ['OL', '1', 'TrackPointIndexList'],\r\n    '0130': ['SQ', '1', 'TrackStatisticsSequence'],\r\n    '0132': ['SQ', '1', 'MeasurementValuesSequence'],\r\n    '0133': ['SQ', '1', 'DiffusionAcquisitionCodeSequence'],\r\n    '0134': ['SQ', '1', 'DiffusionModelCodeSequence']\r\n  },\r\n  '0068': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '6210': ['LO', '1', 'ImplantSize'],\r\n    '6221': ['LO', '1', 'ImplantTemplateVersion'],\r\n    '6222': ['SQ', '1', 'ReplacedImplantTemplateSequence'],\r\n    '6223': ['CS', '1', 'ImplantType'],\r\n    '6224': ['SQ', '1', 'DerivationImplantTemplateSequence'],\r\n    '6225': ['SQ', '1', 'OriginalImplantTemplateSequence'],\r\n    '6226': ['DT', '1', 'EffectiveDateTime'],\r\n    '6230': ['SQ', '1', 'ImplantTargetAnatomySequence'],\r\n    '6260': ['SQ', '1', 'InformationFromManufacturerSequence'],\r\n    '6265': ['SQ', '1', 'NotificationFromManufacturerSequence'],\r\n    '6270': ['DT', '1', 'InformationIssueDateTime'],\r\n    '6280': ['ST', '1', 'InformationSummary'],\r\n    '62A0': ['SQ', '1', 'ImplantRegulatoryDisapprovalCodeSequence'],\r\n    '62A5': ['FD', '1', 'OverallTemplateSpatialTolerance'],\r\n    '62C0': ['SQ', '1', 'HPGLDocumentSequence'],\r\n    '62D0': ['US', '1', 'HPGLDocumentID'],\r\n    '62D5': ['LO', '1', 'HPGLDocumentLabel'],\r\n    '62E0': ['SQ', '1', 'ViewOrientationCodeSequence'],\r\n    '62F0': ['SQ', '1', 'ViewOrientationModifierCodeSequence'],\r\n    '62F2': ['FD', '1', 'HPGLDocumentScaling'],\r\n    '6300': ['OB', '1', 'HPGLDocument'],\r\n    '6310': ['US', '1', 'HPGLContourPenNumber'],\r\n    '6320': ['SQ', '1', 'HPGLPenSequence'],\r\n    '6330': ['US', '1', 'HPGLPenNumber'],\r\n    '6340': ['LO', '1', 'HPGLPenLabel'],\r\n    '6345': ['ST', '1', 'HPGLPenDescription'],\r\n    '6346': ['FD', '2', 'RecommendedRotationPoint'],\r\n    '6347': ['FD', '4', 'BoundingRectangle'],\r\n    '6350': ['US', '1-n', 'ImplantTemplate3DModelSurfaceNumber'],\r\n    '6360': ['SQ', '1', 'SurfaceModelDescriptionSequence'],\r\n    '6380': ['LO', '1', 'SurfaceModelLabel'],\r\n    '6390': ['FD', '1', 'SurfaceModelScalingFactor'],\r\n    '63A0': ['SQ', '1', 'MaterialsCodeSequence'],\r\n    '63A4': ['SQ', '1', 'CoatingMaterialsCodeSequence'],\r\n    '63A8': ['SQ', '1', 'ImplantTypeCodeSequence'],\r\n    '63AC': ['SQ', '1', 'FixationMethodCodeSequence'],\r\n    '63B0': ['SQ', '1', 'MatingFeatureSetsSequence'],\r\n    '63C0': ['US', '1', 'MatingFeatureSetID'],\r\n    '63D0': ['LO', '1', 'MatingFeatureSetLabel'],\r\n    '63E0': ['SQ', '1', 'MatingFeatureSequence'],\r\n    '63F0': ['US', '1', 'MatingFeatureID'],\r\n    '6400': ['SQ', '1', 'MatingFeatureDegreeOfFreedomSequence'],\r\n    '6410': ['US', '1', 'DegreeOfFreedomID'],\r\n    '6420': ['CS', '1', 'DegreeOfFreedomType'],\r\n    '6430': ['SQ', '1', 'TwoDMatingFeatureCoordinatesSequence'],\r\n    '6440': ['US', '1', 'ReferencedHPGLDocumentID'],\r\n    '6450': ['FD', '2', 'TwoDMatingPoint'],\r\n    '6460': ['FD', '4', 'TwoDMatingAxes'],\r\n    '6470': ['SQ', '1', 'TwoDDegreeOfFreedomSequence'],\r\n    '6490': ['FD', '3', 'ThreeDDegreeOfFreedomAxis'],\r\n    '64A0': ['FD', '2', 'RangeOfFreedom'],\r\n    '64C0': ['FD', '3', 'ThreeDMatingPoint'],\r\n    '64D0': ['FD', '9', 'ThreeDMatingAxes'],\r\n    '64F0': ['FD', '3', 'TwoDDegreeOfFreedomAxis'],\r\n    '6500': ['SQ', '1', 'PlanningLandmarkPointSequence'],\r\n    '6510': ['SQ', '1', 'PlanningLandmarkLineSequence'],\r\n    '6520': ['SQ', '1', 'PlanningLandmarkPlaneSequence'],\r\n    '6530': ['US', '1', 'PlanningLandmarkID'],\r\n    '6540': ['LO', '1', 'PlanningLandmarkDescription'],\r\n    '6545': ['SQ', '1', 'PlanningLandmarkIdentificationCodeSequence'],\r\n    '6550': ['SQ', '1', 'TwoDPointCoordinatesSequence'],\r\n    '6560': ['FD', '2', 'TwoDPointCoordinates'],\r\n    '6590': ['FD', '3', 'ThreeDPointCoordinates'],\r\n    '65A0': ['SQ', '1', 'TwoDLineCoordinatesSequence'],\r\n    '65B0': ['FD', '4', 'TwoDLineCoordinates'],\r\n    '65D0': ['FD', '6', 'ThreeDLineCoordinates'],\r\n    '65E0': ['SQ', '1', 'TwoDPlaneCoordinatesSequence'],\r\n    '65F0': ['FD', '4', 'TwoDPlaneIntersection'],\r\n    '6610': ['FD', '3', 'ThreeDPlaneOrigin'],\r\n    '6620': ['FD', '3', 'ThreeDPlaneNormal'],\r\n    '7001': ['CS', '1', 'ModelModification'],\r\n    '7002': ['CS', '1', 'ModelMirroring'],\r\n    '7003': ['SQ', '1', 'ModelUsageCodeSequence'],\r\n    '7004': ['UI', '1', 'ModelGroupUID'],\r\n    '7005': ['UR', '1', 'RelativeURIReferenceWithinEncapsulatedDocument']\r\n  },\r\n  '006A': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['CS', '1', 'AnnotationCoordinateType'],\r\n    '0002': ['SQ', '1', 'AnnotationGroupSequence'],\r\n    '0003': ['UI', '1', 'AnnotationGroupUID'],\r\n    '0005': ['LO', '1', 'AnnotationGroupLabel'],\r\n    '0006': ['UT', '1', 'AnnotationGroupDescription'],\r\n    '0007': ['CS', '1', 'AnnotationGroupGenerationType'],\r\n    '0008': ['SQ', '1', 'AnnotationGroupAlgorithmIdentificationSequence'],\r\n    '0009': ['SQ', '1', 'AnnotationPropertyCategoryCodeSequence'],\r\n    '000A': ['SQ', '1', 'AnnotationPropertyTypeCodeSequence'],\r\n    '000B': ['SQ', '1', 'AnnotationPropertyTypeModifierCodeSequence'],\r\n    '000C': ['UL', '1', 'NumberOfAnnotations'],\r\n    '000D': ['CS', '1', 'AnnotationAppliesToAllOpticalPaths'],\r\n    '000E': ['SH', '1-n', 'ReferencedOpticalPathIdentifier'],\r\n    '000F': ['CS', '1', 'AnnotationAppliesToAllZPlanes'],\r\n    '0010': ['FD', '1-n', 'CommonZCoordinateValue'],\r\n    '0011': ['OL', '1', 'AnnotationIndexList']\r\n  },\r\n  '0070': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['SQ', '1', 'GraphicAnnotationSequence'],\r\n    '0002': ['CS', '1', 'GraphicLayer'],\r\n    '0003': ['CS', '1', 'BoundingBoxAnnotationUnits'],\r\n    '0004': ['CS', '1', 'AnchorPointAnnotationUnits'],\r\n    '0005': ['CS', '1', 'GraphicAnnotationUnits'],\r\n    '0006': ['ST', '1', 'UnformattedTextValue'],\r\n    '0008': ['SQ', '1', 'TextObjectSequence'],\r\n    '0009': ['SQ', '1', 'GraphicObjectSequence'],\r\n    '0010': ['FL', '2', 'BoundingBoxTopLeftHandCorner'],\r\n    '0011': ['FL', '2', 'BoundingBoxBottomRightHandCorner'],\r\n    '0012': ['CS', '1', 'BoundingBoxTextHorizontalJustification'],\r\n    '0014': ['FL', '2', 'AnchorPoint'],\r\n    '0015': ['CS', '1', 'AnchorPointVisibility'],\r\n    '0020': ['US', '1', 'GraphicDimensions'],\r\n    '0021': ['US', '1', 'NumberOfGraphicPoints'],\r\n    '0022': ['FL', '2-n', 'GraphicData'],\r\n    '0023': ['CS', '1', 'GraphicType'],\r\n    '0024': ['CS', '1', 'GraphicFilled'],\r\n    '0040': ['IS', '1', 'ImageRotationRetired'],\r\n    '0041': ['CS', '1', 'ImageHorizontalFlip'],\r\n    '0042': ['US', '1', 'ImageRotation'],\r\n    '0050': ['US', '2', 'DisplayedAreaTopLeftHandCornerTrial'],\r\n    '0051': ['US', '2', 'DisplayedAreaBottomRightHandCornerTrial'],\r\n    '0052': ['SL', '2', 'DisplayedAreaTopLeftHandCorner'],\r\n    '0053': ['SL', '2', 'DisplayedAreaBottomRightHandCorner'],\r\n    '005A': ['SQ', '1', 'DisplayedAreaSelectionSequence'],\r\n    '0060': ['SQ', '1', 'GraphicLayerSequence'],\r\n    '0062': ['IS', '1', 'GraphicLayerOrder'],\r\n    '0066': ['US', '1', 'GraphicLayerRecommendedDisplayGrayscaleValue'],\r\n    '0067': ['US', '3', 'GraphicLayerRecommendedDisplayRGBValue'],\r\n    '0068': ['LO', '1', 'GraphicLayerDescription'],\r\n    '0080': ['CS', '1', 'ContentLabel'],\r\n    '0081': ['LO', '1', 'ContentDescription'],\r\n    '0082': ['DA', '1', 'PresentationCreationDate'],\r\n    '0083': ['TM', '1', 'PresentationCreationTime'],\r\n    '0084': ['PN', '1', 'ContentCreatorName'],\r\n    '0086': ['SQ', '1', 'ContentCreatorIdentificationCodeSequence'],\r\n    '0087': ['SQ', '1', 'AlternateContentDescriptionSequence'],\r\n    '0100': ['CS', '1', 'PresentationSizeMode'],\r\n    '0101': ['DS', '2', 'PresentationPixelSpacing'],\r\n    '0102': ['IS', '2', 'PresentationPixelAspectRatio'],\r\n    '0103': ['FL', '1', 'PresentationPixelMagnificationRatio'],\r\n    '0207': ['LO', '1', 'GraphicGroupLabel'],\r\n    '0208': ['ST', '1', 'GraphicGroupDescription'],\r\n    '0209': ['SQ', '1', 'CompoundGraphicSequence'],\r\n    '0226': ['UL', '1', 'CompoundGraphicInstanceID'],\r\n    '0227': ['LO', '1', 'FontName'],\r\n    '0228': ['CS', '1', 'FontNameType'],\r\n    '0229': ['LO', '1', 'CSSFontName'],\r\n    '0230': ['FD', '1', 'RotationAngle'],\r\n    '0231': ['SQ', '1', 'TextStyleSequence'],\r\n    '0232': ['SQ', '1', 'LineStyleSequence'],\r\n    '0233': ['SQ', '1', 'FillStyleSequence'],\r\n    '0234': ['SQ', '1', 'GraphicGroupSequence'],\r\n    '0241': ['US', '3', 'TextColorCIELabValue'],\r\n    '0242': ['CS', '1', 'HorizontalAlignment'],\r\n    '0243': ['CS', '1', 'VerticalAlignment'],\r\n    '0244': ['CS', '1', 'ShadowStyle'],\r\n    '0245': ['FL', '1', 'ShadowOffsetX'],\r\n    '0246': ['FL', '1', 'ShadowOffsetY'],\r\n    '0247': ['US', '3', 'ShadowColorCIELabValue'],\r\n    '0248': ['CS', '1', 'Underlined'],\r\n    '0249': ['CS', '1', 'Bold'],\r\n    '0250': ['CS', '1', 'Italic'],\r\n    '0251': ['US', '3', 'PatternOnColorCIELabValue'],\r\n    '0252': ['US', '3', 'PatternOffColorCIELabValue'],\r\n    '0253': ['FL', '1', 'LineThickness'],\r\n    '0254': ['CS', '1', 'LineDashingStyle'],\r\n    '0255': ['UL', '1', 'LinePattern'],\r\n    '0256': ['OB', '1', 'FillPattern'],\r\n    '0257': ['CS', '1', 'FillMode'],\r\n    '0258': ['FL', '1', 'ShadowOpacity'],\r\n    '0261': ['FL', '1', 'GapLength'],\r\n    '0262': ['FL', '1', 'DiameterOfVisibility'],\r\n    '0273': ['FL', '2', 'RotationPoint'],\r\n    '0274': ['CS', '1', 'TickAlignment'],\r\n    '0278': ['CS', '1', 'ShowTickLabel'],\r\n    '0279': ['CS', '1', 'TickLabelAlignment'],\r\n    '0282': ['CS', '1', 'CompoundGraphicUnits'],\r\n    '0284': ['FL', '1', 'PatternOnOpacity'],\r\n    '0285': ['FL', '1', 'PatternOffOpacity'],\r\n    '0287': ['SQ', '1', 'MajorTicksSequence'],\r\n    '0288': ['FL', '1', 'TickPosition'],\r\n    '0289': ['SH', '1', 'TickLabel'],\r\n    '0294': ['CS', '1', 'CompoundGraphicType'],\r\n    '0295': ['UL', '1', 'GraphicGroupID'],\r\n    '0306': ['CS', '1', 'ShapeType'],\r\n    '0308': ['SQ', '1', 'RegistrationSequence'],\r\n    '0309': ['SQ', '1', 'MatrixRegistrationSequence'],\r\n    '030A': ['SQ', '1', 'MatrixSequence'],\r\n    '030B': ['FD', '16', 'FrameOfReferenceToDisplayedCoordinateSystemTransformationMatrix'],\r\n    '030C': ['CS', '1', 'FrameOfReferenceTransformationMatrixType'],\r\n    '030D': ['SQ', '1', 'RegistrationTypeCodeSequence'],\r\n    '030F': ['ST', '1', 'FiducialDescription'],\r\n    '0310': ['SH', '1', 'FiducialIdentifier'],\r\n    '0311': ['SQ', '1', 'FiducialIdentifierCodeSequence'],\r\n    '0312': ['FD', '1', 'ContourUncertaintyRadius'],\r\n    '0314': ['SQ', '1', 'UsedFiducialsSequence'],\r\n    '0318': ['SQ', '1', 'GraphicCoordinatesDataSequence'],\r\n    '031A': ['UI', '1', 'FiducialUID'],\r\n    '031B': ['UI', '1', 'ReferencedFiducialUID'],\r\n    '031C': ['SQ', '1', 'FiducialSetSequence'],\r\n    '031E': ['SQ', '1', 'FiducialSequence'],\r\n    '031F': ['SQ', '1', 'FiducialsPropertyCategoryCodeSequence'],\r\n    '0401': ['US', '3', 'GraphicLayerRecommendedDisplayCIELabValue'],\r\n    '0402': ['SQ', '1', 'BlendingSequence'],\r\n    '0403': ['FL', '1', 'RelativeOpacity'],\r\n    '0404': ['SQ', '1', 'ReferencedSpatialRegistrationSequence'],\r\n    '0405': ['CS', '1', 'BlendingPosition'],\r\n    '1101': ['UI', '1', 'PresentationDisplayCollectionUID'],\r\n    '1102': ['UI', '1', 'PresentationSequenceCollectionUID'],\r\n    '1103': ['US', '1', 'PresentationSequencePositionIndex'],\r\n    '1104': ['SQ', '1', 'RenderedImageReferenceSequence'],\r\n    '1201': ['SQ', '1', 'VolumetricPresentationStateInputSequence'],\r\n    '1202': ['CS', '1', 'PresentationInputType'],\r\n    '1203': ['US', '1', 'InputSequencePositionIndex'],\r\n    '1204': ['CS', '1', 'Crop'],\r\n    '1205': ['US', '1-n', 'CroppingSpecificationIndex'],\r\n    '1206': ['CS', '1', 'CompositingMethod'],\r\n    '1207': ['US', '1', 'VolumetricPresentationInputNumber'],\r\n    '1208': ['CS', '1', 'ImageVolumeGeometry'],\r\n    '1209': ['UI', '1', 'VolumetricPresentationInputSetUID'],\r\n    '120A': ['SQ', '1', 'VolumetricPresentationInputSetSequence'],\r\n    '120B': ['CS', '1', 'GlobalCrop'],\r\n    '120C': ['US', '1-n', 'GlobalCroppingSpecificationIndex'],\r\n    '120D': ['CS', '1', 'RenderingMethod'],\r\n    '1301': ['SQ', '1', 'VolumeCroppingSequence'],\r\n    '1302': ['CS', '1', 'VolumeCroppingMethod'],\r\n    '1303': ['FD', '6', 'BoundingBoxCrop'],\r\n    '1304': ['SQ', '1', 'ObliqueCroppingPlaneSequence'],\r\n    '1305': ['FD', '4', 'Plane'],\r\n    '1306': ['FD', '3', 'PlaneNormal'],\r\n    '1309': ['US', '1', 'CroppingSpecificationNumber'],\r\n    '1501': ['CS', '1', 'MultiPlanarReconstructionStyle'],\r\n    '1502': ['CS', '1', 'MPRThicknessType'],\r\n    '1503': ['FD', '1', 'MPRSlabThickness'],\r\n    '1505': ['FD', '3', 'MPRTopLeftHandCorner'],\r\n    '1507': ['FD', '3', 'MPRViewWidthDirection'],\r\n    '1508': ['FD', '1', 'MPRViewWidth'],\r\n    '150C': ['UL', '1', 'NumberOfVolumetricCurvePoints'],\r\n    '150D': ['OD', '1', 'VolumetricCurvePoints'],\r\n    '1511': ['FD', '3', 'MPRViewHeightDirection'],\r\n    '1512': ['FD', '1', 'MPRViewHeight'],\r\n    '1602': ['CS', '1', 'RenderProjection'],\r\n    '1603': ['FD', '3', 'ViewpointPosition'],\r\n    '1604': ['FD', '3', 'ViewpointLookAtPoint'],\r\n    '1605': ['FD', '3', 'ViewpointUpDirection'],\r\n    '1606': ['FD', '6', 'RenderFieldOfView'],\r\n    '1607': ['FD', '1', 'SamplingStepSize'],\r\n    '1701': ['CS', '1', 'ShadingStyle'],\r\n    '1702': ['FD', '1', 'AmbientReflectionIntensity'],\r\n    '1703': ['FD', '3', 'LightDirection'],\r\n    '1704': ['FD', '1', 'DiffuseReflectionIntensity'],\r\n    '1705': ['FD', '1', 'SpecularReflectionIntensity'],\r\n    '1706': ['FD', '1', 'Shininess'],\r\n    '1801': ['SQ', '1', 'PresentationStateClassificationComponentSequence'],\r\n    '1802': ['CS', '1', 'ComponentType'],\r\n    '1803': ['SQ', '1', 'ComponentInputSequence'],\r\n    '1804': ['US', '1', 'VolumetricPresentationInputIndex'],\r\n    '1805': ['SQ', '1', 'PresentationStateCompositorComponentSequence'],\r\n    '1806': ['SQ', '1', 'WeightingTransferFunctionSequence'],\r\n    '1807': ['US', '3', 'WeightingLookupTableDescriptor'],\r\n    '1808': ['OB', '1', 'WeightingLookupTableData'],\r\n    '1901': ['SQ', '1', 'VolumetricAnnotationSequence'],\r\n    '1903': ['SQ', '1', 'ReferencedStructuredContextSequence'],\r\n    '1904': ['UI', '1', 'ReferencedContentItem'],\r\n    '1905': ['SQ', '1', 'VolumetricPresentationInputAnnotationSequence'],\r\n    '1907': ['CS', '1', 'AnnotationClipping'],\r\n    '1A01': ['CS', '1', 'PresentationAnimationStyle'],\r\n    '1A03': ['FD', '1', 'RecommendedAnimationRate'],\r\n    '1A04': ['SQ', '1', 'AnimationCurveSequence'],\r\n    '1A05': ['FD', '1', 'AnimationStepSize'],\r\n    '1A06': ['FD', '1', 'SwivelRange'],\r\n    '1A07': ['OD', '1', 'VolumetricCurveUpDirections'],\r\n    '1A08': ['SQ', '1', 'VolumeStreamSequence'],\r\n    '1A09': ['LO', '1', 'RGBATransferFunctionDescription'],\r\n    '1B01': ['SQ', '1', 'AdvancedBlendingSequence'],\r\n    '1B02': ['US', '1', 'BlendingInputNumber'],\r\n    '1B03': ['SQ', '1', 'BlendingDisplayInputSequence'],\r\n    '1B04': ['SQ', '1', 'BlendingDisplaySequence'],\r\n    '1B06': ['CS', '1', 'BlendingMode'],\r\n    '1B07': ['CS', '1', 'TimeSeriesBlending'],\r\n    '1B08': ['CS', '1', 'GeometryForDisplay'],\r\n    '1B11': ['SQ', '1', 'ThresholdSequence'],\r\n    '1B12': ['SQ', '1', 'ThresholdValueSequence'],\r\n    '1B13': ['CS', '1', 'ThresholdType'],\r\n    '1B14': ['FD', '1', 'ThresholdValue']\r\n  },\r\n  '0072': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0002': ['SH', '1', 'HangingProtocolName'],\r\n    '0004': ['LO', '1', 'HangingProtocolDescription'],\r\n    '0006': ['CS', '1', 'HangingProtocolLevel'],\r\n    '0008': ['LO', '1', 'HangingProtocolCreator'],\r\n    '000A': ['DT', '1', 'HangingProtocolCreationDateTime'],\r\n    '000C': ['SQ', '1', 'HangingProtocolDefinitionSequence'],\r\n    '000E': ['SQ', '1', 'HangingProtocolUserIdentificationCodeSequence'],\r\n    '0010': ['LO', '1', 'HangingProtocolUserGroupName'],\r\n    '0012': ['SQ', '1', 'SourceHangingProtocolSequence'],\r\n    '0014': ['US', '1', 'NumberOfPriorsReferenced'],\r\n    '0020': ['SQ', '1', 'ImageSetsSequence'],\r\n    '0022': ['SQ', '1', 'ImageSetSelectorSequence'],\r\n    '0024': ['CS', '1', 'ImageSetSelectorUsageFlag'],\r\n    '0026': ['AT', '1', 'SelectorAttribute'],\r\n    '0028': ['US', '1', 'SelectorValueNumber'],\r\n    '0030': ['SQ', '1', 'TimeBasedImageSetsSequence'],\r\n    '0032': ['US', '1', 'ImageSetNumber'],\r\n    '0034': ['CS', '1', 'ImageSetSelectorCategory'],\r\n    '0038': ['US', '2', 'RelativeTime'],\r\n    '003A': ['CS', '1', 'RelativeTimeUnits'],\r\n    '003C': ['SS', '2', 'AbstractPriorValue'],\r\n    '003E': ['SQ', '1', 'AbstractPriorCodeSequence'],\r\n    '0040': ['LO', '1', 'ImageSetLabel'],\r\n    '0050': ['CS', '1', 'SelectorAttributeVR'],\r\n    '0052': ['AT', '1-n', 'SelectorSequencePointer'],\r\n    '0054': ['LO', '1-n', 'SelectorSequencePointerPrivateCreator'],\r\n    '0056': ['LO', '1', 'SelectorAttributePrivateCreator'],\r\n    '005E': ['AE', '1-n', 'SelectorAEValue'],\r\n    '005F': ['AS', '1-n', 'SelectorASValue'],\r\n    '0060': ['AT', '1-n', 'SelectorATValue'],\r\n    '0061': ['DA', '1-n', 'SelectorDAValue'],\r\n    '0062': ['CS', '1-n', 'SelectorCSValue'],\r\n    '0063': ['DT', '1-n', 'SelectorDTValue'],\r\n    '0064': ['IS', '1-n', 'SelectorISValue'],\r\n    '0065': ['OB', '1', 'SelectorOBValue'],\r\n    '0066': ['LO', '1-n', 'SelectorLOValue'],\r\n    '0067': ['OF', '1', 'SelectorOFValue'],\r\n    '0068': ['LT', '1', 'SelectorLTValue'],\r\n    '0069': ['OW', '1', 'SelectorOWValue'],\r\n    '006A': ['PN', '1-n', 'SelectorPNValue'],\r\n    '006B': ['TM', '1-n', 'SelectorTMValue'],\r\n    '006C': ['SH', '1-n', 'SelectorSHValue'],\r\n    '006D': ['UN', '1', 'SelectorUNValue'],\r\n    '006E': ['ST', '1', 'SelectorSTValue'],\r\n    '006F': ['UC', '1-n', 'SelectorUCValue'],\r\n    '0070': ['UT', '1', 'SelectorUTValue'],\r\n    '0071': ['UR', '1', 'SelectorURValue'],\r\n    '0072': ['DS', '1-n', 'SelectorDSValue'],\r\n    '0073': ['OD', '1', 'SelectorODValue'],\r\n    '0074': ['FD', '1-n', 'SelectorFDValue'],\r\n    '0075': ['OL', '1', 'SelectorOLValue'],\r\n    '0076': ['FL', '1-n', 'SelectorFLValue'],\r\n    '0078': ['UL', '1-n', 'SelectorULValue'],\r\n    '007A': ['US', '1-n', 'SelectorUSValue'],\r\n    '007C': ['SL', '1-n', 'SelectorSLValue'],\r\n    '007E': ['SS', '1-n', 'SelectorSSValue'],\r\n    '007F': ['UI', '1-n', 'SelectorUIValue'],\r\n    '0080': ['SQ', '1', 'SelectorCodeSequenceValue'],\r\n    '0081': ['OV', '1', 'SelectorOVValue'],\r\n    '0082': ['SV', '1-n', 'SelectorSVValue'],\r\n    '0083': ['UV', '1-n', 'SelectorUVValue'],\r\n    '0100': ['US', '1', 'NumberOfScreens'],\r\n    '0102': ['SQ', '1', 'NominalScreenDefinitionSequence'],\r\n    '0104': ['US', '1', 'NumberOfVerticalPixels'],\r\n    '0106': ['US', '1', 'NumberOfHorizontalPixels'],\r\n    '0108': ['FD', '4', 'DisplayEnvironmentSpatialPosition'],\r\n    '010A': ['US', '1', 'ScreenMinimumGrayscaleBitDepth'],\r\n    '010C': ['US', '1', 'ScreenMinimumColorBitDepth'],\r\n    '010E': ['US', '1', 'ApplicationMaximumRepaintTime'],\r\n    '0200': ['SQ', '1', 'DisplaySetsSequence'],\r\n    '0202': ['US', '1', 'DisplaySetNumber'],\r\n    '0203': ['LO', '1', 'DisplaySetLabel'],\r\n    '0204': ['US', '1', 'DisplaySetPresentationGroup'],\r\n    '0206': ['LO', '1', 'DisplaySetPresentationGroupDescription'],\r\n    '0208': ['CS', '1', 'PartialDataDisplayHandling'],\r\n    '0210': ['SQ', '1', 'SynchronizedScrollingSequence'],\r\n    '0212': ['US', '2-n', 'DisplaySetScrollingGroup'],\r\n    '0214': ['SQ', '1', 'NavigationIndicatorSequence'],\r\n    '0216': ['US', '1', 'NavigationDisplaySet'],\r\n    '0218': ['US', '1-n', 'ReferenceDisplaySets'],\r\n    '0300': ['SQ', '1', 'ImageBoxesSequence'],\r\n    '0302': ['US', '1', 'ImageBoxNumber'],\r\n    '0304': ['CS', '1', 'ImageBoxLayoutType'],\r\n    '0306': ['US', '1', 'ImageBoxTileHorizontalDimension'],\r\n    '0308': ['US', '1', 'ImageBoxTileVerticalDimension'],\r\n    '0310': ['CS', '1', 'ImageBoxScrollDirection'],\r\n    '0312': ['CS', '1', 'ImageBoxSmallScrollType'],\r\n    '0314': ['US', '1', 'ImageBoxSmallScrollAmount'],\r\n    '0316': ['CS', '1', 'ImageBoxLargeScrollType'],\r\n    '0318': ['US', '1', 'ImageBoxLargeScrollAmount'],\r\n    '0320': ['US', '1', 'ImageBoxOverlapPriority'],\r\n    '0330': ['FD', '1', 'CineRelativeToRealTime'],\r\n    '0400': ['SQ', '1', 'FilterOperationsSequence'],\r\n    '0402': ['CS', '1', 'FilterByCategory'],\r\n    '0404': ['CS', '1', 'FilterByAttributePresence'],\r\n    '0406': ['CS', '1', 'FilterByOperator'],\r\n    '0420': ['US', '3', 'StructuredDisplayBackgroundCIELabValue'],\r\n    '0421': ['US', '3', 'EmptyImageBoxCIELabValue'],\r\n    '0422': ['SQ', '1', 'StructuredDisplayImageBoxSequence'],\r\n    '0424': ['SQ', '1', 'StructuredDisplayTextBoxSequence'],\r\n    '0427': ['SQ', '1', 'ReferencedFirstFrameSequence'],\r\n    '0430': ['SQ', '1', 'ImageBoxSynchronizationSequence'],\r\n    '0432': ['US', '2-n', 'SynchronizedImageBoxList'],\r\n    '0434': ['CS', '1', 'TypeOfSynchronization'],\r\n    '0500': ['CS', '1', 'BlendingOperationType'],\r\n    '0510': ['CS', '1', 'ReformattingOperationType'],\r\n    '0512': ['FD', '1', 'ReformattingThickness'],\r\n    '0514': ['FD', '1', 'ReformattingInterval'],\r\n    '0516': ['CS', '1', 'ReformattingOperationInitialViewDirection'],\r\n    '0520': ['CS', '1-n', 'ThreeDRenderingType'],\r\n    '0600': ['SQ', '1', 'SortingOperationsSequence'],\r\n    '0602': ['CS', '1', 'SortByCategory'],\r\n    '0604': ['CS', '1', 'SortingDirection'],\r\n    '0700': ['CS', '2', 'DisplaySetPatientOrientation'],\r\n    '0702': ['CS', '1', 'VOIType'],\r\n    '0704': ['CS', '1', 'PseudoColorType'],\r\n    '0705': ['SQ', '1', 'PseudoColorPaletteInstanceReferenceSequence'],\r\n    '0706': ['CS', '1', 'ShowGrayscaleInverted'],\r\n    '0710': ['CS', '1', 'ShowImageTrueSizeFlag'],\r\n    '0712': ['CS', '1', 'ShowGraphicAnnotationFlag'],\r\n    '0714': ['CS', '1', 'ShowPatientDemographicsFlag'],\r\n    '0716': ['CS', '1', 'ShowAcquisitionTechniquesFlag'],\r\n    '0717': ['CS', '1', 'DisplaySetHorizontalJustification'],\r\n    '0718': ['CS', '1', 'DisplaySetVerticalJustification']\r\n  },\r\n  '0074': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0120': ['FD', '1', 'ContinuationStartMeterset'],\r\n    '0121': ['FD', '1', 'ContinuationEndMeterset'],\r\n    '1000': ['CS', '1', 'ProcedureStepState'],\r\n    '1002': ['SQ', '1', 'ProcedureStepProgressInformationSequence'],\r\n    '1004': ['DS', '1', 'ProcedureStepProgress'],\r\n    '1006': ['ST', '1', 'ProcedureStepProgressDescription'],\r\n    '1007': ['SQ', '1', 'ProcedureStepProgressParametersSequence'],\r\n    '1008': ['SQ', '1', 'ProcedureStepCommunicationsURISequence'],\r\n    '100A': ['UR', '1', 'ContactURI'],\r\n    '100C': ['LO', '1', 'ContactDisplayName'],\r\n    '100E': ['SQ', '1', 'ProcedureStepDiscontinuationReasonCodeSequence'],\r\n    '1020': ['SQ', '1', 'BeamTaskSequence'],\r\n    '1022': ['CS', '1', 'BeamTaskType'],\r\n    '1024': ['IS', '1', 'BeamOrderIndexTrial'],\r\n    '1025': ['CS', '1', 'AutosequenceFlag'],\r\n    '1026': ['FD', '1', 'TableTopVerticalAdjustedPosition'],\r\n    '1027': ['FD', '1', 'TableTopLongitudinalAdjustedPosition'],\r\n    '1028': ['FD', '1', 'TableTopLateralAdjustedPosition'],\r\n    '102A': ['FD', '1', 'PatientSupportAdjustedAngle'],\r\n    '102B': ['FD', '1', 'TableTopEccentricAdjustedAngle'],\r\n    '102C': ['FD', '1', 'TableTopPitchAdjustedAngle'],\r\n    '102D': ['FD', '1', 'TableTopRollAdjustedAngle'],\r\n    '1030': ['SQ', '1', 'DeliveryVerificationImageSequence'],\r\n    '1032': ['CS', '1', 'VerificationImageTiming'],\r\n    '1034': ['CS', '1', 'DoubleExposureFlag'],\r\n    '1036': ['CS', '1', 'DoubleExposureOrdering'],\r\n    '1038': ['DS', '1', 'DoubleExposureMetersetTrial'],\r\n    '103A': ['DS', '4', 'DoubleExposureFieldDeltaTrial'],\r\n    '1040': ['SQ', '1', 'RelatedReferenceRTImageSequence'],\r\n    '1042': ['SQ', '1', 'GeneralMachineVerificationSequence'],\r\n    '1044': ['SQ', '1', 'ConventionalMachineVerificationSequence'],\r\n    '1046': ['SQ', '1', 'IonMachineVerificationSequence'],\r\n    '1048': ['SQ', '1', 'FailedAttributesSequence'],\r\n    '104A': ['SQ', '1', 'OverriddenAttributesSequence'],\r\n    '104C': ['SQ', '1', 'ConventionalControlPointVerificationSequence'],\r\n    '104E': ['SQ', '1', 'IonControlPointVerificationSequence'],\r\n    '1050': ['SQ', '1', 'AttributeOccurrenceSequence'],\r\n    '1052': ['AT', '1', 'AttributeOccurrencePointer'],\r\n    '1054': ['UL', '1', 'AttributeItemSelector'],\r\n    '1056': ['LO', '1', 'AttributeOccurrencePrivateCreator'],\r\n    '1057': ['IS', '1-n', 'SelectorSequencePointerItems'],\r\n    '1200': ['CS', '1', 'ScheduledProcedureStepPriority'],\r\n    '1202': ['LO', '1', 'WorklistLabel'],\r\n    '1204': ['LO', '1', 'ProcedureStepLabel'],\r\n    '1210': ['SQ', '1', 'ScheduledProcessingParametersSequence'],\r\n    '1212': ['SQ', '1', 'PerformedProcessingParametersSequence'],\r\n    '1216': ['SQ', '1', 'UnifiedProcedureStepPerformedProcedureSequence'],\r\n    '1220': ['SQ', '1', 'RelatedProcedureStepSequence'],\r\n    '1222': ['LO', '1', 'ProcedureStepRelationshipType'],\r\n    '1224': ['SQ', '1', 'ReplacedProcedureStepSequence'],\r\n    '1230': ['LO', '1', 'DeletionLock'],\r\n    '1234': ['AE', '1', 'ReceivingAE'],\r\n    '1236': ['AE', '1', 'RequestingAE'],\r\n    '1238': ['LT', '1', 'ReasonForCancellation'],\r\n    '1242': ['CS', '1', 'SCPStatus'],\r\n    '1244': ['CS', '1', 'SubscriptionListStatus'],\r\n    '1246': ['CS', '1', 'UnifiedProcedureStepListStatus'],\r\n    '1324': ['UL', '1', 'BeamOrderIndex'],\r\n    '1338': ['FD', '1', 'DoubleExposureMeterset'],\r\n    '133A': ['FD', '4', 'DoubleExposureFieldDelta'],\r\n    '1401': ['SQ', '1', 'BrachyTaskSequence'],\r\n    '1402': ['DS', '1', 'ContinuationStartTotalReferenceAirKerma'],\r\n    '1403': ['DS', '1', 'ContinuationEndTotalReferenceAirKerma'],\r\n    '1404': ['IS', '1', 'ContinuationPulseNumber'],\r\n    '1405': ['SQ', '1', 'ChannelDeliveryOrderSequence'],\r\n    '1406': ['IS', '1', 'ReferencedChannelNumber'],\r\n    '1407': ['DS', '1', 'StartCumulativeTimeWeight'],\r\n    '1408': ['DS', '1', 'EndCumulativeTimeWeight'],\r\n    '1409': ['SQ', '1', 'OmittedChannelSequence'],\r\n    '140A': ['CS', '1', 'ReasonForChannelOmission'],\r\n    '140B': ['LO', '1', 'ReasonForChannelOmissionDescription'],\r\n    '140C': ['IS', '1', 'ChannelDeliveryOrderIndex'],\r\n    '140D': ['SQ', '1', 'ChannelDeliveryContinuationSequence'],\r\n    '140E': ['SQ', '1', 'OmittedApplicationSetupSequence']\r\n  },\r\n  '0076': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['LO', '1', 'ImplantAssemblyTemplateName'],\r\n    '0003': ['LO', '1', 'ImplantAssemblyTemplateIssuer'],\r\n    '0006': ['LO', '1', 'ImplantAssemblyTemplateVersion'],\r\n    '0008': ['SQ', '1', 'ReplacedImplantAssemblyTemplateSequence'],\r\n    '000A': ['CS', '1', 'ImplantAssemblyTemplateType'],\r\n    '000C': ['SQ', '1', 'OriginalImplantAssemblyTemplateSequence'],\r\n    '000E': ['SQ', '1', 'DerivationImplantAssemblyTemplateSequence'],\r\n    '0010': ['SQ', '1', 'ImplantAssemblyTemplateTargetAnatomySequence'],\r\n    '0020': ['SQ', '1', 'ProcedureTypeCodeSequence'],\r\n    '0030': ['LO', '1', 'SurgicalTechnique'],\r\n    '0032': ['SQ', '1', 'ComponentTypesSequence'],\r\n    '0034': ['SQ', '1', 'ComponentTypeCodeSequence'],\r\n    '0036': ['CS', '1', 'ExclusiveComponentType'],\r\n    '0038': ['CS', '1', 'MandatoryComponentType'],\r\n    '0040': ['SQ', '1', 'ComponentSequence'],\r\n    '0055': ['US', '1', 'ComponentID'],\r\n    '0060': ['SQ', '1', 'ComponentAssemblySequence'],\r\n    '0070': ['US', '1', 'Component1ReferencedID'],\r\n    '0080': ['US', '1', 'Component1ReferencedMatingFeatureSetID'],\r\n    '0090': ['US', '1', 'Component1ReferencedMatingFeatureID'],\r\n    '00A0': ['US', '1', 'Component2ReferencedID'],\r\n    '00B0': ['US', '1', 'Component2ReferencedMatingFeatureSetID'],\r\n    '00C0': ['US', '1', 'Component2ReferencedMatingFeatureID']\r\n  },\r\n  '0078': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['LO', '1', 'ImplantTemplateGroupName'],\r\n    '0010': ['ST', '1', 'ImplantTemplateGroupDescription'],\r\n    '0020': ['LO', '1', 'ImplantTemplateGroupIssuer'],\r\n    '0024': ['LO', '1', 'ImplantTemplateGroupVersion'],\r\n    '0026': ['SQ', '1', 'ReplacedImplantTemplateGroupSequence'],\r\n    '0028': ['SQ', '1', 'ImplantTemplateGroupTargetAnatomySequence'],\r\n    '002A': ['SQ', '1', 'ImplantTemplateGroupMembersSequence'],\r\n    '002E': ['US', '1', 'ImplantTemplateGroupMemberID'],\r\n    '0050': ['FD', '3', 'ThreeDImplantTemplateGroupMemberMatchingPoint'],\r\n    '0060': ['FD', '9', 'ThreeDImplantTemplateGroupMemberMatchingAxes'],\r\n    '0070': ['SQ', '1', 'ImplantTemplateGroupMemberMatching2DCoordinatesSequence'],\r\n    '0090': ['FD', '2', 'TwoDImplantTemplateGroupMemberMatchingPoint'],\r\n    '00A0': ['FD', '4', 'TwoDImplantTemplateGroupMemberMatchingAxes'],\r\n    '00B0': ['SQ', '1', 'ImplantTemplateGroupVariationDimensionSequence'],\r\n    '00B2': ['LO', '1', 'ImplantTemplateGroupVariationDimensionName'],\r\n    '00B4': ['SQ', '1', 'ImplantTemplateGroupVariationDimensionRankSequence'],\r\n    '00B6': ['US', '1', 'ReferencedImplantTemplateGroupMemberID'],\r\n    '00B8': ['US', '1', 'ImplantTemplateGroupVariationDimensionRank']\r\n  },\r\n  '0080': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['SQ', '1', 'SurfaceScanAcquisitionTypeCodeSequence'],\r\n    '0002': ['SQ', '1', 'SurfaceScanModeCodeSequence'],\r\n    '0003': ['SQ', '1', 'RegistrationMethodCodeSequence'],\r\n    '0004': ['FD', '1', 'ShotDurationTime'],\r\n    '0005': ['FD', '1', 'ShotOffsetTime'],\r\n    '0006': ['US', '1-n', 'SurfacePointPresentationValueData'],\r\n    '0007': ['US', '3-3n', 'SurfacePointColorCIELabValueData'],\r\n    '0008': ['SQ', '1', 'UVMappingSequence'],\r\n    '0009': ['SH', '1', 'TextureLabel'],\r\n    '0010': ['OF', '1', 'UValueData'],\r\n    '0011': ['OF', '1', 'VValueData'],\r\n    '0012': ['SQ', '1', 'ReferencedTextureSequence'],\r\n    '0013': ['SQ', '1', 'ReferencedSurfaceDataSequence']\r\n  },\r\n  '0082': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['CS', '1', 'AssessmentSummary'],\r\n    '0003': ['UT', '1', 'AssessmentSummaryDescription'],\r\n    '0004': ['SQ', '1', 'AssessedSOPInstanceSequence'],\r\n    '0005': ['SQ', '1', 'ReferencedComparisonSOPInstanceSequence'],\r\n    '0006': ['UL', '1', 'NumberOfAssessmentObservations'],\r\n    '0007': ['SQ', '1', 'AssessmentObservationsSequence'],\r\n    '0008': ['CS', '1', 'ObservationSignificance'],\r\n    '000A': ['UT', '1', 'ObservationDescription'],\r\n    '000C': ['SQ', '1', 'StructuredConstraintObservationSequence'],\r\n    '0010': ['SQ', '1', 'AssessedAttributeValueSequence'],\r\n    '0016': ['LO', '1', 'AssessmentSetID'],\r\n    '0017': ['SQ', '1', 'AssessmentRequesterSequence'],\r\n    '0018': ['LO', '1', 'SelectorAttributeName'],\r\n    '0019': ['LO', '1', 'SelectorAttributeKeyword'],\r\n    '0021': ['SQ', '1', 'AssessmentTypeCodeSequence'],\r\n    '0022': ['SQ', '1', 'ObservationBasisCodeSequence'],\r\n    '0023': ['LO', '1', 'AssessmentLabel'],\r\n    '0032': ['CS', '1', 'ConstraintType'],\r\n    '0033': ['UT', '1', 'SpecificationSelectionGuidance'],\r\n    '0034': ['SQ', '1', 'ConstraintValueSequence'],\r\n    '0035': ['SQ', '1', 'RecommendedDefaultValueSequence'],\r\n    '0036': ['CS', '1', 'ConstraintViolationSignificance'],\r\n    '0037': ['UT', '1', 'ConstraintViolationCondition'],\r\n    '0038': ['CS', '1', 'ModifiableConstraintFlag']\r\n  },\r\n  '0088': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0130': ['SH', '1', 'StorageMediaFileSetID'],\r\n    '0140': ['UI', '1', 'StorageMediaFileSetUID'],\r\n    '0200': ['SQ', '1', 'IconImageSequence'],\r\n    '0904': ['LO', '1', 'TopicTitle'],\r\n    '0906': ['ST', '1', 'TopicSubject'],\r\n    '0910': ['LO', '1', 'TopicAuthor'],\r\n    '0912': ['LO', '1-32', 'TopicKeywords']\r\n  },\r\n  '0100': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0410': ['CS', '1', 'SOPInstanceStatus'],\r\n    '0420': ['DT', '1', 'SOPAuthorizationDateTime'],\r\n    '0424': ['LT', '1', 'SOPAuthorizationComment'],\r\n    '0426': ['LO', '1', 'AuthorizationEquipmentCertificationNumber']\r\n  },\r\n  '0400': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0005': ['US', '1', 'MACIDNumber'],\r\n    '0010': ['UI', '1', 'MACCalculationTransferSyntaxUID'],\r\n    '0015': ['CS', '1', 'MACAlgorithm'],\r\n    '0020': ['AT', '1-n', 'DataElementsSigned'],\r\n    '0100': ['UI', '1', 'DigitalSignatureUID'],\r\n    '0105': ['DT', '1', 'DigitalSignatureDateTime'],\r\n    '0110': ['CS', '1', 'CertificateType'],\r\n    '0115': ['OB', '1', 'CertificateOfSigner'],\r\n    '0120': ['OB', '1', 'Signature'],\r\n    '0305': ['CS', '1', 'CertifiedTimestampType'],\r\n    '0310': ['OB', '1', 'CertifiedTimestamp'],\r\n    '0315': ['FL', '1', ''],\r\n    '0401': ['SQ', '1', 'DigitalSignaturePurposeCodeSequence'],\r\n    '0402': ['SQ', '1', 'ReferencedDigitalSignatureSequence'],\r\n    '0403': ['SQ', '1', 'ReferencedSOPInstanceMACSequence'],\r\n    '0404': ['OB', '1', 'MAC'],\r\n    '0500': ['SQ', '1', 'EncryptedAttributesSequence'],\r\n    '0510': ['UI', '1', 'EncryptedContentTransferSyntaxUID'],\r\n    '0520': ['OB', '1', 'EncryptedContent'],\r\n    '0550': ['SQ', '1', 'ModifiedAttributesSequence'],\r\n    '0551': ['SQ', '1', 'NonconformingModifiedAttributesSequence'],\r\n    '0552': ['OB', '1', 'NonconformingDataElementValue'],\r\n    '0561': ['SQ', '1', 'OriginalAttributesSequence'],\r\n    '0562': ['DT', '1', 'AttributeModificationDateTime'],\r\n    '0563': ['LO', '1', 'ModifyingSystem'],\r\n    '0564': ['LO', '1', 'SourceOfPreviousValues'],\r\n    '0565': ['CS', '1', 'ReasonForTheAttributeModification'],\r\n    '0600': ['CS', '1', 'InstanceOriginStatus']\r\n  },\r\n  '1000': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['US', '3', 'EscapeTriplet'],\r\n    '0011': ['US', '3', 'RunLengthTriplet'],\r\n    '0012': ['US', '1', 'HuffmanTableSize'],\r\n    '0013': ['US', '3', 'HuffmanTableTriplet'],\r\n    '0014': ['US', '1', 'ShiftTableSize'],\r\n    '0015': ['US', '3', 'ShiftTableTriplet']\r\n  },\r\n  '1010': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0004': ['US', '1-n', 'ZonalMap']\r\n  },\r\n  '2000': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['IS', '1', 'NumberOfCopies'],\r\n    '001E': ['SQ', '1', 'PrinterConfigurationSequence'],\r\n    '0020': ['CS', '1', 'PrintPriority'],\r\n    '0030': ['CS', '1', 'MediumType'],\r\n    '0040': ['CS', '1', 'FilmDestination'],\r\n    '0050': ['LO', '1', 'FilmSessionLabel'],\r\n    '0060': ['IS', '1', 'MemoryAllocation'],\r\n    '0061': ['IS', '1', 'MaximumMemoryAllocation'],\r\n    '0062': ['CS', '1', 'ColorImagePrintingFlag'],\r\n    '0063': ['CS', '1', 'CollationFlag'],\r\n    '0065': ['CS', '1', 'AnnotationFlag'],\r\n    '0067': ['CS', '1', 'ImageOverlayFlag'],\r\n    '0069': ['CS', '1', 'PresentationLUTFlag'],\r\n    '006A': ['CS', '1', 'ImageBoxPresentationLUTFlag'],\r\n    '00A0': ['US', '1', 'MemoryBitDepth'],\r\n    '00A1': ['US', '1', 'PrintingBitDepth'],\r\n    '00A2': ['SQ', '1', 'MediaInstalledSequence'],\r\n    '00A4': ['SQ', '1', 'OtherMediaAvailableSequence'],\r\n    '00A8': ['SQ', '1', 'SupportedImageDisplayFormatsSequence'],\r\n    '0500': ['SQ', '1', 'ReferencedFilmBoxSequence'],\r\n    '0510': ['SQ', '1', 'ReferencedStoredPrintSequence']\r\n  },\r\n  '2010': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['ST', '1', 'ImageDisplayFormat'],\r\n    '0030': ['CS', '1', 'AnnotationDisplayFormatID'],\r\n    '0040': ['CS', '1', 'FilmOrientation'],\r\n    '0050': ['CS', '1', 'FilmSizeID'],\r\n    '0052': ['CS', '1', 'PrinterResolutionID'],\r\n    '0054': ['CS', '1', 'DefaultPrinterResolutionID'],\r\n    '0060': ['CS', '1', 'MagnificationType'],\r\n    '0080': ['CS', '1', 'SmoothingType'],\r\n    '00A6': ['CS', '1', 'DefaultMagnificationType'],\r\n    '00A7': ['CS', '1-n', 'OtherMagnificationTypesAvailable'],\r\n    '00A8': ['CS', '1', 'DefaultSmoothingType'],\r\n    '00A9': ['CS', '1-n', 'OtherSmoothingTypesAvailable'],\r\n    '0100': ['CS', '1', 'BorderDensity'],\r\n    '0110': ['CS', '1', 'EmptyImageDensity'],\r\n    '0120': ['US', '1', 'MinDensity'],\r\n    '0130': ['US', '1', 'MaxDensity'],\r\n    '0140': ['CS', '1', 'Trim'],\r\n    '0150': ['ST', '1', 'ConfigurationInformation'],\r\n    '0152': ['LT', '1', 'ConfigurationInformationDescription'],\r\n    '0154': ['IS', '1', 'MaximumCollatedFilms'],\r\n    '015E': ['US', '1', 'Illumination'],\r\n    '0160': ['US', '1', 'ReflectedAmbientLight'],\r\n    '0376': ['DS', '2', 'PrinterPixelSpacing'],\r\n    '0500': ['SQ', '1', 'ReferencedFilmSessionSequence'],\r\n    '0510': ['SQ', '1', 'ReferencedImageBoxSequence'],\r\n    '0520': ['SQ', '1', 'ReferencedBasicAnnotationBoxSequence']\r\n  },\r\n  '2020': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['US', '1', 'ImageBoxPosition'],\r\n    '0020': ['CS', '1', 'Polarity'],\r\n    '0030': ['DS', '1', 'RequestedImageSize'],\r\n    '0040': ['CS', '1', 'RequestedDecimateCropBehavior'],\r\n    '0050': ['CS', '1', 'RequestedResolutionID'],\r\n    '00A0': ['CS', '1', 'RequestedImageSizeFlag'],\r\n    '00A2': ['CS', '1', 'DecimateCropResult'],\r\n    '0110': ['SQ', '1', 'BasicGrayscaleImageSequence'],\r\n    '0111': ['SQ', '1', 'BasicColorImageSequence'],\r\n    '0130': ['SQ', '1', 'ReferencedImageOverlayBoxSequence'],\r\n    '0140': ['SQ', '1', 'ReferencedVOILUTBoxSequence']\r\n  },\r\n  '2030': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['US', '1', 'AnnotationPosition'],\r\n    '0020': ['LO', '1', 'TextString']\r\n  },\r\n  '2040': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['SQ', '1', 'ReferencedOverlayPlaneSequence'],\r\n    '0011': ['US', '1-99', 'ReferencedOverlayPlaneGroups'],\r\n    '0020': ['SQ', '1', 'OverlayPixelDataSequence'],\r\n    '0060': ['CS', '1', 'OverlayMagnificationType'],\r\n    '0070': ['CS', '1', 'OverlaySmoothingType'],\r\n    '0072': ['CS', '1', 'OverlayOrImageMagnification'],\r\n    '0074': ['US', '1', 'MagnifyToNumberOfColumns'],\r\n    '0080': ['CS', '1', 'OverlayForegroundDensity'],\r\n    '0082': ['CS', '1', 'OverlayBackgroundDensity'],\r\n    '0090': ['CS', '1', 'OverlayMode'],\r\n    '0100': ['CS', '1', 'ThresholdDensity'],\r\n    '0500': ['SQ', '1', 'ReferencedImageBoxSequenceRetired']\r\n  },\r\n  '2050': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['SQ', '1', 'PresentationLUTSequence'],\r\n    '0020': ['CS', '1', 'PresentationLUTShape'],\r\n    '0500': ['SQ', '1', 'ReferencedPresentationLUTSequence']\r\n  },\r\n  '2100': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['SH', '1', 'PrintJobID'],\r\n    '0020': ['CS', '1', 'ExecutionStatus'],\r\n    '0030': ['CS', '1', 'ExecutionStatusInfo'],\r\n    '0040': ['DA', '1', 'CreationDate'],\r\n    '0050': ['TM', '1', 'CreationTime'],\r\n    '0070': ['AE', '1', 'Originator'],\r\n    '0140': ['AE', '1', 'DestinationAE'],\r\n    '0160': ['SH', '1', 'OwnerID'],\r\n    '0170': ['IS', '1', 'NumberOfFilms'],\r\n    '0500': ['SQ', '1', 'ReferencedPrintJobSequencePullStoredPrint']\r\n  },\r\n  '2110': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['CS', '1', 'PrinterStatus'],\r\n    '0020': ['CS', '1', 'PrinterStatusInfo'],\r\n    '0030': ['LO', '1', 'PrinterName'],\r\n    '0099': ['SH', '1', 'PrintQueueID']\r\n  },\r\n  '2120': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['CS', '1', 'QueueStatus'],\r\n    '0050': ['SQ', '1', 'PrintJobDescriptionSequence'],\r\n    '0070': ['SQ', '1', 'ReferencedPrintJobSequence']\r\n  },\r\n  '2130': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['SQ', '1', 'PrintManagementCapabilitiesSequence'],\r\n    '0015': ['SQ', '1', 'PrinterCharacteristicsSequence'],\r\n    '0030': ['SQ', '1', 'FilmBoxContentSequence'],\r\n    '0040': ['SQ', '1', 'ImageBoxContentSequence'],\r\n    '0050': ['SQ', '1', 'AnnotationContentSequence'],\r\n    '0060': ['SQ', '1', 'ImageOverlayBoxContentSequence'],\r\n    '0080': ['SQ', '1', 'PresentationLUTContentSequence'],\r\n    '00A0': ['SQ', '1', 'ProposedStudySequence'],\r\n    '00C0': ['SQ', '1', 'OriginalImageSequence']\r\n  },\r\n  '2200': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['CS', '1', 'LabelUsingInformationExtractedFromInstances'],\r\n    '0002': ['UT', '1', 'LabelText'],\r\n    '0003': ['CS', '1', 'LabelStyleSelection'],\r\n    '0004': ['LT', '1', 'MediaDisposition'],\r\n    '0005': ['LT', '1', 'BarcodeValue'],\r\n    '0006': ['CS', '1', 'BarcodeSymbology'],\r\n    '0007': ['CS', '1', 'AllowMediaSplitting'],\r\n    '0008': ['CS', '1', 'IncludeNonDICOMObjects'],\r\n    '0009': ['CS', '1', 'IncludeDisplayApplication'],\r\n    '000A': ['CS', '1', 'PreserveCompositeInstancesAfterMediaCreation'],\r\n    '000B': ['US', '1', 'TotalNumberOfPiecesOfMediaCreated'],\r\n    '000C': ['LO', '1', 'RequestedMediaApplicationProfile'],\r\n    '000D': ['SQ', '1', 'ReferencedStorageMediaSequence'],\r\n    '000E': ['AT', '1-n', 'FailureAttributes'],\r\n    '000F': ['CS', '1', 'AllowLossyCompression'],\r\n    '0020': ['CS', '1', 'RequestPriority']\r\n  },\r\n  '3002': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0002': ['SH', '1', 'RTImageLabel'],\r\n    '0003': ['LO', '1', 'RTImageName'],\r\n    '0004': ['ST', '1', 'RTImageDescription'],\r\n    '000A': ['CS', '1', 'ReportedValuesOrigin'],\r\n    '000C': ['CS', '1', 'RTImagePlane'],\r\n    '000D': ['DS', '3', 'XRayImageReceptorTranslation'],\r\n    '000E': ['DS', '1', 'XRayImageReceptorAngle'],\r\n    '0010': ['DS', '6', 'RTImageOrientation'],\r\n    '0011': ['DS', '2', 'ImagePlanePixelSpacing'],\r\n    '0012': ['DS', '2', 'RTImagePosition'],\r\n    '0020': ['SH', '1', 'RadiationMachineName'],\r\n    '0022': ['DS', '1', 'RadiationMachineSAD'],\r\n    '0024': ['DS', '1', 'RadiationMachineSSD'],\r\n    '0026': ['DS', '1', 'RTImageSID'],\r\n    '0028': ['DS', '1', 'SourceToReferenceObjectDistance'],\r\n    '0029': ['IS', '1', 'FractionNumber'],\r\n    '0030': ['SQ', '1', 'ExposureSequence'],\r\n    '0032': ['DS', '1', 'MetersetExposure'],\r\n    '0034': ['DS', '4', 'DiaphragmPosition'],\r\n    '0040': ['SQ', '1', 'FluenceMapSequence'],\r\n    '0041': ['CS', '1', 'FluenceDataSource'],\r\n    '0042': ['DS', '1', 'FluenceDataScale'],\r\n    '0050': ['SQ', '1', 'PrimaryFluenceModeSequence'],\r\n    '0051': ['CS', '1', 'FluenceMode'],\r\n    '0052': ['SH', '1', 'FluenceModeID']\r\n  },\r\n  '3004': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['CS', '1', 'DVHType'],\r\n    '0002': ['CS', '1', 'DoseUnits'],\r\n    '0004': ['CS', '1', 'DoseType'],\r\n    '0005': ['CS', '1', 'SpatialTransformOfDose'],\r\n    '0006': ['LO', '1', 'DoseComment'],\r\n    '0008': ['DS', '3', 'NormalizationPoint'],\r\n    '000A': ['CS', '1', 'DoseSummationType'],\r\n    '000C': ['DS', '2-n', 'GridFrameOffsetVector'],\r\n    '000E': ['DS', '1', 'DoseGridScaling'],\r\n    '0010': ['SQ', '1', 'RTDoseROISequence'],\r\n    '0012': ['DS', '1', 'DoseValue'],\r\n    '0014': ['CS', '1-3', 'TissueHeterogeneityCorrection'],\r\n    '0040': ['DS', '3', 'DVHNormalizationPoint'],\r\n    '0042': ['DS', '1', 'DVHNormalizationDoseValue'],\r\n    '0050': ['SQ', '1', 'DVHSequence'],\r\n    '0052': ['DS', '1', 'DVHDoseScaling'],\r\n    '0054': ['CS', '1', 'DVHVolumeUnits'],\r\n    '0056': ['IS', '1', 'DVHNumberOfBins'],\r\n    '0058': ['DS', '2-2n', 'DVHData'],\r\n    '0060': ['SQ', '1', 'DVHReferencedROISequence'],\r\n    '0062': ['CS', '1', 'DVHROIContributionType'],\r\n    '0070': ['DS', '1', 'DVHMinimumDose'],\r\n    '0072': ['DS', '1', 'DVHMaximumDose'],\r\n    '0074': ['DS', '1', 'DVHMeanDose']\r\n  },\r\n  '3006': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0002': ['SH', '1', 'StructureSetLabel'],\r\n    '0004': ['LO', '1', 'StructureSetName'],\r\n    '0006': ['ST', '1', 'StructureSetDescription'],\r\n    '0008': ['DA', '1', 'StructureSetDate'],\r\n    '0009': ['TM', '1', 'StructureSetTime'],\r\n    '0010': ['SQ', '1', 'ReferencedFrameOfReferenceSequence'],\r\n    '0012': ['SQ', '1', 'RTReferencedStudySequence'],\r\n    '0014': ['SQ', '1', 'RTReferencedSeriesSequence'],\r\n    '0016': ['SQ', '1', 'ContourImageSequence'],\r\n    '0018': ['SQ', '1', 'PredecessorStructureSetSequence'],\r\n    '0020': ['SQ', '1', 'StructureSetROISequence'],\r\n    '0022': ['IS', '1', 'ROINumber'],\r\n    '0024': ['UI', '1', 'ReferencedFrameOfReferenceUID'],\r\n    '0026': ['LO', '1', 'ROIName'],\r\n    '0028': ['ST', '1', 'ROIDescription'],\r\n    '002A': ['IS', '3', 'ROIDisplayColor'],\r\n    '002C': ['DS', '1', 'ROIVolume'],\r\n    '0030': ['SQ', '1', 'RTRelatedROISequence'],\r\n    '0033': ['CS', '1', 'RTROIRelationship'],\r\n    '0036': ['CS', '1', 'ROIGenerationAlgorithm'],\r\n    '0037': ['SQ', '1', 'ROIDerivationAlgorithmIdentificationSequence'],\r\n    '0038': ['LO', '1', 'ROIGenerationDescription'],\r\n    '0039': ['SQ', '1', 'ROIContourSequence'],\r\n    '0040': ['SQ', '1', 'ContourSequence'],\r\n    '0042': ['CS', '1', 'ContourGeometricType'],\r\n    '0044': ['DS', '1', 'ContourSlabThickness'],\r\n    '0045': ['DS', '3', 'ContourOffsetVector'],\r\n    '0046': ['IS', '1', 'NumberOfContourPoints'],\r\n    '0048': ['IS', '1', 'ContourNumber'],\r\n    '0049': ['IS', '1-n', 'AttachedContours'],\r\n    '004A': ['SQ', '1', 'SourcePixelPlanesCharacteristicsSequence'],\r\n    '0050': ['DS', '3-3n', 'ContourData'],\r\n    '0080': ['SQ', '1', 'RTROIObservationsSequence'],\r\n    '0082': ['IS', '1', 'ObservationNumber'],\r\n    '0084': ['IS', '1', 'ReferencedROINumber'],\r\n    '0085': ['SH', '1', 'ROIObservationLabel'],\r\n    '0086': ['SQ', '1', 'RTROIIdentificationCodeSequence'],\r\n    '0088': ['ST', '1', 'ROIObservationDescription'],\r\n    '00A0': ['SQ', '1', 'RelatedRTROIObservationsSequence'],\r\n    '00A4': ['CS', '1', 'RTROIInterpretedType'],\r\n    '00A6': ['PN', '1', 'ROIInterpreter'],\r\n    '00B0': ['SQ', '1', 'ROIPhysicalPropertiesSequence'],\r\n    '00B2': ['CS', '1', 'ROIPhysicalProperty'],\r\n    '00B4': ['DS', '1', 'ROIPhysicalPropertyValue'],\r\n    '00B6': ['SQ', '1', 'ROIElementalCompositionSequence'],\r\n    '00B7': ['US', '1', 'ROIElementalCompositionAtomicNumber'],\r\n    '00B8': ['FL', '1', 'ROIElementalCompositionAtomicMassFraction'],\r\n    '00B9': ['SQ', '1', 'AdditionalRTROIIdentificationCodeSequence'],\r\n    '00C0': ['SQ', '1', 'FrameOfReferenceRelationshipSequence'],\r\n    '00C2': ['UI', '1', 'RelatedFrameOfReferenceUID'],\r\n    '00C4': ['CS', '1', 'FrameOfReferenceTransformationType'],\r\n    '00C6': ['DS', '16', 'FrameOfReferenceTransformationMatrix'],\r\n    '00C8': ['LO', '1', 'FrameOfReferenceTransformationComment'],\r\n    '00C9': ['SQ', '1', 'PatientLocationCoordinatesSequence'],\r\n    '00CA': ['SQ', '1', 'PatientLocationCoordinatesCodeSequence'],\r\n    '00CB': ['SQ', '1', 'PatientSupportPositionSequence']\r\n  },\r\n  '3008': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['SQ', '1', 'MeasuredDoseReferenceSequence'],\r\n    '0012': ['ST', '1', 'MeasuredDoseDescription'],\r\n    '0014': ['CS', '1', 'MeasuredDoseType'],\r\n    '0016': ['DS', '1', 'MeasuredDoseValue'],\r\n    '0020': ['SQ', '1', 'TreatmentSessionBeamSequence'],\r\n    '0021': ['SQ', '1', 'TreatmentSessionIonBeamSequence'],\r\n    '0022': ['IS', '1', 'CurrentFractionNumber'],\r\n    '0024': ['DA', '1', 'TreatmentControlPointDate'],\r\n    '0025': ['TM', '1', 'TreatmentControlPointTime'],\r\n    '002A': ['CS', '1', 'TreatmentTerminationStatus'],\r\n    '002B': ['SH', '1', 'TreatmentTerminationCode'],\r\n    '002C': ['CS', '1', 'TreatmentVerificationStatus'],\r\n    '0030': ['SQ', '1', 'ReferencedTreatmentRecordSequence'],\r\n    '0032': ['DS', '1', 'SpecifiedPrimaryMeterset'],\r\n    '0033': ['DS', '1', 'SpecifiedSecondaryMeterset'],\r\n    '0036': ['DS', '1', 'DeliveredPrimaryMeterset'],\r\n    '0037': ['DS', '1', 'DeliveredSecondaryMeterset'],\r\n    '003A': ['DS', '1', 'SpecifiedTreatmentTime'],\r\n    '003B': ['DS', '1', 'DeliveredTreatmentTime'],\r\n    '0040': ['SQ', '1', 'ControlPointDeliverySequence'],\r\n    '0041': ['SQ', '1', 'IonControlPointDeliverySequence'],\r\n    '0042': ['DS', '1', 'SpecifiedMeterset'],\r\n    '0044': ['DS', '1', 'DeliveredMeterset'],\r\n    '0045': ['FL', '1', 'MetersetRateSet'],\r\n    '0046': ['FL', '1', 'MetersetRateDelivered'],\r\n    '0047': ['FL', '1-n', 'ScanSpotMetersetsDelivered'],\r\n    '0048': ['DS', '1', 'DoseRateDelivered'],\r\n    '0050': ['SQ', '1', 'TreatmentSummaryCalculatedDoseReferenceSequence'],\r\n    '0052': ['DS', '1', 'CumulativeDoseToDoseReference'],\r\n    '0054': ['DA', '1', 'FirstTreatmentDate'],\r\n    '0056': ['DA', '1', 'MostRecentTreatmentDate'],\r\n    '005A': ['IS', '1', 'NumberOfFractionsDelivered'],\r\n    '0060': ['SQ', '1', 'OverrideSequence'],\r\n    '0061': ['AT', '1', 'ParameterSequencePointer'],\r\n    '0062': ['AT', '1', 'OverrideParameterPointer'],\r\n    '0063': ['IS', '1', 'ParameterItemIndex'],\r\n    '0064': ['IS', '1', 'MeasuredDoseReferenceNumber'],\r\n    '0065': ['AT', '1', 'ParameterPointer'],\r\n    '0066': ['ST', '1', 'OverrideReason'],\r\n    '0067': ['US', '1', 'ParameterValueNumber'],\r\n    '0068': ['SQ', '1', 'CorrectedParameterSequence'],\r\n    '006A': ['FL', '1', 'CorrectionValue'],\r\n    '0070': ['SQ', '1', 'CalculatedDoseReferenceSequence'],\r\n    '0072': ['IS', '1', 'CalculatedDoseReferenceNumber'],\r\n    '0074': ['ST', '1', 'CalculatedDoseReferenceDescription'],\r\n    '0076': ['DS', '1', 'CalculatedDoseReferenceDoseValue'],\r\n    '0078': ['DS', '1', 'StartMeterset'],\r\n    '007A': ['DS', '1', 'EndMeterset'],\r\n    '0080': ['SQ', '1', 'ReferencedMeasuredDoseReferenceSequence'],\r\n    '0082': ['IS', '1', 'ReferencedMeasuredDoseReferenceNumber'],\r\n    '0090': ['SQ', '1', 'ReferencedCalculatedDoseReferenceSequence'],\r\n    '0092': ['IS', '1', 'ReferencedCalculatedDoseReferenceNumber'],\r\n    '00A0': ['SQ', '1', 'BeamLimitingDeviceLeafPairsSequence'],\r\n    '00B0': ['SQ', '1', 'RecordedWedgeSequence'],\r\n    '00C0': ['SQ', '1', 'RecordedCompensatorSequence'],\r\n    '00D0': ['SQ', '1', 'RecordedBlockSequence'],\r\n    '00D1': ['SQ', '1', 'RecordedBlockSlabSequence'],\r\n    '00E0': ['SQ', '1', 'TreatmentSummaryMeasuredDoseReferenceSequence'],\r\n    '00F0': ['SQ', '1', 'RecordedSnoutSequence'],\r\n    '00F2': ['SQ', '1', 'RecordedRangeShifterSequence'],\r\n    '00F4': ['SQ', '1', 'RecordedLateralSpreadingDeviceSequence'],\r\n    '00F6': ['SQ', '1', 'RecordedRangeModulatorSequence'],\r\n    '0100': ['SQ', '1', 'RecordedSourceSequence'],\r\n    '0105': ['LO', '1', 'SourceSerialNumber'],\r\n    '0110': ['SQ', '1', 'TreatmentSessionApplicationSetupSequence'],\r\n    '0116': ['CS', '1', 'ApplicationSetupCheck'],\r\n    '0120': ['SQ', '1', 'RecordedBrachyAccessoryDeviceSequence'],\r\n    '0122': ['IS', '1', 'ReferencedBrachyAccessoryDeviceNumber'],\r\n    '0130': ['SQ', '1', 'RecordedChannelSequence'],\r\n    '0132': ['DS', '1', 'SpecifiedChannelTotalTime'],\r\n    '0134': ['DS', '1', 'DeliveredChannelTotalTime'],\r\n    '0136': ['IS', '1', 'SpecifiedNumberOfPulses'],\r\n    '0138': ['IS', '1', 'DeliveredNumberOfPulses'],\r\n    '013A': ['DS', '1', 'SpecifiedPulseRepetitionInterval'],\r\n    '013C': ['DS', '1', 'DeliveredPulseRepetitionInterval'],\r\n    '0140': ['SQ', '1', 'RecordedSourceApplicatorSequence'],\r\n    '0142': ['IS', '1', 'ReferencedSourceApplicatorNumber'],\r\n    '0150': ['SQ', '1', 'RecordedChannelShieldSequence'],\r\n    '0152': ['IS', '1', 'ReferencedChannelShieldNumber'],\r\n    '0160': ['SQ', '1', 'BrachyControlPointDeliveredSequence'],\r\n    '0162': ['DA', '1', 'SafePositionExitDate'],\r\n    '0164': ['TM', '1', 'SafePositionExitTime'],\r\n    '0166': ['DA', '1', 'SafePositionReturnDate'],\r\n    '0168': ['TM', '1', 'SafePositionReturnTime'],\r\n    '0171': ['SQ', '1', 'PulseSpecificBrachyControlPointDeliveredSequence'],\r\n    '0172': ['US', '1', 'PulseNumber'],\r\n    '0173': ['SQ', '1', 'BrachyPulseControlPointDeliveredSequence'],\r\n    '0200': ['CS', '1', 'CurrentTreatmentStatus'],\r\n    '0202': ['ST', '1', 'TreatmentStatusComment'],\r\n    '0220': ['SQ', '1', 'FractionGroupSummarySequence'],\r\n    '0223': ['IS', '1', 'ReferencedFractionNumber'],\r\n    '0224': ['CS', '1', 'FractionGroupType'],\r\n    '0230': ['CS', '1', 'BeamStopperPosition'],\r\n    '0240': ['SQ', '1', 'FractionStatusSummarySequence'],\r\n    '0250': ['DA', '1', 'TreatmentDate'],\r\n    '0251': ['TM', '1', 'TreatmentTime']\r\n  },\r\n  '300A': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0002': ['SH', '1', 'RTPlanLabel'],\r\n    '0003': ['LO', '1', 'RTPlanName'],\r\n    '0004': ['ST', '1', 'RTPlanDescription'],\r\n    '0006': ['DA', '1', 'RTPlanDate'],\r\n    '0007': ['TM', '1', 'RTPlanTime'],\r\n    '0009': ['LO', '1-n', 'TreatmentProtocols'],\r\n    '000A': ['CS', '1', 'PlanIntent'],\r\n    '000B': ['LO', '1-n', 'TreatmentSites'],\r\n    '000C': ['CS', '1', 'RTPlanGeometry'],\r\n    '000E': ['ST', '1', 'PrescriptionDescription'],\r\n    '0010': ['SQ', '1', 'DoseReferenceSequence'],\r\n    '0012': ['IS', '1', 'DoseReferenceNumber'],\r\n    '0013': ['UI', '1', 'DoseReferenceUID'],\r\n    '0014': ['CS', '1', 'DoseReferenceStructureType'],\r\n    '0015': ['CS', '1', 'NominalBeamEnergyUnit'],\r\n    '0016': ['LO', '1', 'DoseReferenceDescription'],\r\n    '0018': ['DS', '3', 'DoseReferencePointCoordinates'],\r\n    '001A': ['DS', '1', 'NominalPriorDose'],\r\n    '0020': ['CS', '1', 'DoseReferenceType'],\r\n    '0021': ['DS', '1', 'ConstraintWeight'],\r\n    '0022': ['DS', '1', 'DeliveryWarningDose'],\r\n    '0023': ['DS', '1', 'DeliveryMaximumDose'],\r\n    '0025': ['DS', '1', 'TargetMinimumDose'],\r\n    '0026': ['DS', '1', 'TargetPrescriptionDose'],\r\n    '0027': ['DS', '1', 'TargetMaximumDose'],\r\n    '0028': ['DS', '1', 'TargetUnderdoseVolumeFraction'],\r\n    '002A': ['DS', '1', 'OrganAtRiskFullVolumeDose'],\r\n    '002B': ['DS', '1', 'OrganAtRiskLimitDose'],\r\n    '002C': ['DS', '1', 'OrganAtRiskMaximumDose'],\r\n    '002D': ['DS', '1', 'OrganAtRiskOverdoseVolumeFraction'],\r\n    '0040': ['SQ', '1', 'ToleranceTableSequence'],\r\n    '0042': ['IS', '1', 'ToleranceTableNumber'],\r\n    '0043': ['SH', '1', 'ToleranceTableLabel'],\r\n    '0044': ['DS', '1', 'GantryAngleTolerance'],\r\n    '0046': ['DS', '1', 'BeamLimitingDeviceAngleTolerance'],\r\n    '0048': ['SQ', '1', 'BeamLimitingDeviceToleranceSequence'],\r\n    '004A': ['DS', '1', 'BeamLimitingDevicePositionTolerance'],\r\n    '004B': ['FL', '1', 'SnoutPositionTolerance'],\r\n    '004C': ['DS', '1', 'PatientSupportAngleTolerance'],\r\n    '004E': ['DS', '1', 'TableTopEccentricAngleTolerance'],\r\n    '004F': ['FL', '1', 'TableTopPitchAngleTolerance'],\r\n    '0050': ['FL', '1', 'TableTopRollAngleTolerance'],\r\n    '0051': ['DS', '1', 'TableTopVerticalPositionTolerance'],\r\n    '0052': ['DS', '1', 'TableTopLongitudinalPositionTolerance'],\r\n    '0053': ['DS', '1', 'TableTopLateralPositionTolerance'],\r\n    '0055': ['CS', '1', 'RTPlanRelationship'],\r\n    '0070': ['SQ', '1', 'FractionGroupSequence'],\r\n    '0071': ['IS', '1', 'FractionGroupNumber'],\r\n    '0072': ['LO', '1', 'FractionGroupDescription'],\r\n    '0078': ['IS', '1', 'NumberOfFractionsPlanned'],\r\n    '0079': ['IS', '1', 'NumberOfFractionPatternDigitsPerDay'],\r\n    '007A': ['IS', '1', 'RepeatFractionCycleLength'],\r\n    '007B': ['LT', '1', 'FractionPattern'],\r\n    '0080': ['IS', '1', 'NumberOfBeams'],\r\n    '0082': ['DS', '3', 'BeamDoseSpecificationPoint'],\r\n    '0083': ['UI', '1', 'ReferencedDoseReferenceUID'],\r\n    '0084': ['DS', '1', 'BeamDose'],\r\n    '0086': ['DS', '1', 'BeamMeterset'],\r\n    '0088': ['FL', '1', 'BeamDosePointDepth'],\r\n    '0089': ['FL', '1', 'BeamDosePointEquivalentDepth'],\r\n    '008A': ['FL', '1', 'BeamDosePointSSD'],\r\n    '008B': ['CS', '1', 'BeamDoseMeaning'],\r\n    '008C': ['SQ', '1', 'BeamDoseVerificationControlPointSequence'],\r\n    '008D': ['FL', '1', 'AverageBeamDosePointDepth'],\r\n    '008E': ['FL', '1', 'AverageBeamDosePointEquivalentDepth'],\r\n    '008F': ['FL', '1', 'AverageBeamDosePointSSD'],\r\n    '0090': ['CS', '1', 'BeamDoseType'],\r\n    '0091': ['DS', '1', 'AlternateBeamDose'],\r\n    '0092': ['CS', '1', 'AlternateBeamDoseType'],\r\n    '0093': ['CS', '1', 'DepthValueAveragingFlag'],\r\n    '0094': ['DS', '1', 'BeamDosePointSourceToExternalContourDistance'],\r\n    '00A0': ['IS', '1', 'NumberOfBrachyApplicationSetups'],\r\n    '00A2': ['DS', '3', 'BrachyApplicationSetupDoseSpecificationPoint'],\r\n    '00A4': ['DS', '1', 'BrachyApplicationSetupDose'],\r\n    '00B0': ['SQ', '1', 'BeamSequence'],\r\n    '00B2': ['SH', '1', 'TreatmentMachineName'],\r\n    '00B3': ['CS', '1', 'PrimaryDosimeterUnit'],\r\n    '00B4': ['DS', '1', 'SourceAxisDistance'],\r\n    '00B6': ['SQ', '1', 'BeamLimitingDeviceSequence'],\r\n    '00B8': ['CS', '1', 'RTBeamLimitingDeviceType'],\r\n    '00BA': ['DS', '1', 'SourceToBeamLimitingDeviceDistance'],\r\n    '00BB': ['FL', '1', 'IsocenterToBeamLimitingDeviceDistance'],\r\n    '00BC': ['IS', '1', 'NumberOfLeafJawPairs'],\r\n    '00BE': ['DS', '3-n', 'LeafPositionBoundaries'],\r\n    '00C0': ['IS', '1', 'BeamNumber'],\r\n    '00C2': ['LO', '1', 'BeamName'],\r\n    '00C3': ['ST', '1', 'BeamDescription'],\r\n    '00C4': ['CS', '1', 'BeamType'],\r\n    '00C5': ['FD', '1', 'BeamDeliveryDurationLimit'],\r\n    '00C6': ['CS', '1', 'RadiationType'],\r\n    '00C7': ['CS', '1', 'HighDoseTechniqueType'],\r\n    '00C8': ['IS', '1', 'ReferenceImageNumber'],\r\n    '00CA': ['SQ', '1', 'PlannedVerificationImageSequence'],\r\n    '00CC': ['LO', '1-n', 'ImagingDeviceSpecificAcquisitionParameters'],\r\n    '00CE': ['CS', '1', 'TreatmentDeliveryType'],\r\n    '00D0': ['IS', '1', 'NumberOfWedges'],\r\n    '00D1': ['SQ', '1', 'WedgeSequence'],\r\n    '00D2': ['IS', '1', 'WedgeNumber'],\r\n    '00D3': ['CS', '1', 'WedgeType'],\r\n    '00D4': ['SH', '1', 'WedgeID'],\r\n    '00D5': ['IS', '1', 'WedgeAngle'],\r\n    '00D6': ['DS', '1', 'WedgeFactor'],\r\n    '00D7': ['FL', '1', 'TotalWedgeTrayWaterEquivalentThickness'],\r\n    '00D8': ['DS', '1', 'WedgeOrientation'],\r\n    '00D9': ['FL', '1', 'IsocenterToWedgeTrayDistance'],\r\n    '00DA': ['DS', '1', 'SourceToWedgeTrayDistance'],\r\n    '00DB': ['FL', '1', 'WedgeThinEdgePosition'],\r\n    '00DC': ['SH', '1', 'BolusID'],\r\n    '00DD': ['ST', '1', 'BolusDescription'],\r\n    '00DE': ['DS', '1', 'EffectiveWedgeAngle'],\r\n    '00E0': ['IS', '1', 'NumberOfCompensators'],\r\n    '00E1': ['SH', '1', 'MaterialID'],\r\n    '00E2': ['DS', '1', 'TotalCompensatorTrayFactor'],\r\n    '00E3': ['SQ', '1', 'CompensatorSequence'],\r\n    '00E4': ['IS', '1', 'CompensatorNumber'],\r\n    '00E5': ['SH', '1', 'CompensatorID'],\r\n    '00E6': ['DS', '1', 'SourceToCompensatorTrayDistance'],\r\n    '00E7': ['IS', '1', 'CompensatorRows'],\r\n    '00E8': ['IS', '1', 'CompensatorColumns'],\r\n    '00E9': ['DS', '2', 'CompensatorPixelSpacing'],\r\n    '00EA': ['DS', '2', 'CompensatorPosition'],\r\n    '00EB': ['DS', '1-n', 'CompensatorTransmissionData'],\r\n    '00EC': ['DS', '1-n', 'CompensatorThicknessData'],\r\n    '00ED': ['IS', '1', 'NumberOfBoli'],\r\n    '00EE': ['CS', '1', 'CompensatorType'],\r\n    '00EF': ['SH', '1', 'CompensatorTrayID'],\r\n    '00F0': ['IS', '1', 'NumberOfBlocks'],\r\n    '00F2': ['DS', '1', 'TotalBlockTrayFactor'],\r\n    '00F3': ['FL', '1', 'TotalBlockTrayWaterEquivalentThickness'],\r\n    '00F4': ['SQ', '1', 'BlockSequence'],\r\n    '00F5': ['SH', '1', 'BlockTrayID'],\r\n    '00F6': ['DS', '1', 'SourceToBlockTrayDistance'],\r\n    '00F7': ['FL', '1', 'IsocenterToBlockTrayDistance'],\r\n    '00F8': ['CS', '1', 'BlockType'],\r\n    '00F9': ['LO', '1', 'AccessoryCode'],\r\n    '00FA': ['CS', '1', 'BlockDivergence'],\r\n    '00FB': ['CS', '1', 'BlockMountingPosition'],\r\n    '00FC': ['IS', '1', 'BlockNumber'],\r\n    '00FE': ['LO', '1', 'BlockName'],\r\n    '0100': ['DS', '1', 'BlockThickness'],\r\n    '0102': ['DS', '1', 'BlockTransmission'],\r\n    '0104': ['IS', '1', 'BlockNumberOfPoints'],\r\n    '0106': ['DS', '2-2n', 'BlockData'],\r\n    '0107': ['SQ', '1', 'ApplicatorSequence'],\r\n    '0108': ['SH', '1', 'ApplicatorID'],\r\n    '0109': ['CS', '1', 'ApplicatorType'],\r\n    '010A': ['LO', '1', 'ApplicatorDescription'],\r\n    '010C': ['DS', '1', 'CumulativeDoseReferenceCoefficient'],\r\n    '010E': ['DS', '1', 'FinalCumulativeMetersetWeight'],\r\n    '0110': ['IS', '1', 'NumberOfControlPoints'],\r\n    '0111': ['SQ', '1', 'ControlPointSequence'],\r\n    '0112': ['IS', '1', 'ControlPointIndex'],\r\n    '0114': ['DS', '1', 'NominalBeamEnergy'],\r\n    '0115': ['DS', '1', 'DoseRateSet'],\r\n    '0116': ['SQ', '1', 'WedgePositionSequence'],\r\n    '0118': ['CS', '1', 'WedgePosition'],\r\n    '011A': ['SQ', '1', 'BeamLimitingDevicePositionSequence'],\r\n    '011C': ['DS', '2-2n', 'LeafJawPositions'],\r\n    '011E': ['DS', '1', 'GantryAngle'],\r\n    '011F': ['CS', '1', 'GantryRotationDirection'],\r\n    '0120': ['DS', '1', 'BeamLimitingDeviceAngle'],\r\n    '0121': ['CS', '1', 'BeamLimitingDeviceRotationDirection'],\r\n    '0122': ['DS', '1', 'PatientSupportAngle'],\r\n    '0123': ['CS', '1', 'PatientSupportRotationDirection'],\r\n    '0124': ['DS', '1', 'TableTopEccentricAxisDistance'],\r\n    '0125': ['DS', '1', 'TableTopEccentricAngle'],\r\n    '0126': ['CS', '1', 'TableTopEccentricRotationDirection'],\r\n    '0128': ['DS', '1', 'TableTopVerticalPosition'],\r\n    '0129': ['DS', '1', 'TableTopLongitudinalPosition'],\r\n    '012A': ['DS', '1', 'TableTopLateralPosition'],\r\n    '012C': ['DS', '3', 'IsocenterPosition'],\r\n    '012E': ['DS', '3', 'SurfaceEntryPoint'],\r\n    '0130': ['DS', '1', 'SourceToSurfaceDistance'],\r\n    '0131': ['FL', '1', 'AverageBeamDosePointSourceToExternalContourDistance'],\r\n    '0132': ['FL', '1', 'SourceToExternalContourDistance'],\r\n    '0133': ['FL', '3', 'ExternalContourEntryPoint'],\r\n    '0134': ['DS', '1', 'CumulativeMetersetWeight'],\r\n    '0140': ['FL', '1', 'TableTopPitchAngle'],\r\n    '0142': ['CS', '1', 'TableTopPitchRotationDirection'],\r\n    '0144': ['FL', '1', 'TableTopRollAngle'],\r\n    '0146': ['CS', '1', 'TableTopRollRotationDirection'],\r\n    '0148': ['FL', '1', 'HeadFixationAngle'],\r\n    '014A': ['FL', '1', 'GantryPitchAngle'],\r\n    '014C': ['CS', '1', 'GantryPitchRotationDirection'],\r\n    '014E': ['FL', '1', 'GantryPitchAngleTolerance'],\r\n    '0150': ['CS', '1', 'FixationEye'],\r\n    '0151': ['DS', '1', 'ChairHeadFramePosition'],\r\n    '0152': ['DS', '1', 'HeadFixationAngleTolerance'],\r\n    '0153': ['DS', '1', 'ChairHeadFramePositionTolerance'],\r\n    '0154': ['DS', '1', 'FixationLightAzimuthalAngleTolerance'],\r\n    '0155': ['DS', '1', 'FixationLightPolarAngleTolerance'],\r\n    '0180': ['SQ', '1', 'PatientSetupSequence'],\r\n    '0182': ['IS', '1', 'PatientSetupNumber'],\r\n    '0183': ['LO', '1', 'PatientSetupLabel'],\r\n    '0184': ['LO', '1', 'PatientAdditionalPosition'],\r\n    '0190': ['SQ', '1', 'FixationDeviceSequence'],\r\n    '0192': ['CS', '1', 'FixationDeviceType'],\r\n    '0194': ['SH', '1', 'FixationDeviceLabel'],\r\n    '0196': ['ST', '1', 'FixationDeviceDescription'],\r\n    '0198': ['SH', '1', 'FixationDevicePosition'],\r\n    '0199': ['FL', '1', 'FixationDevicePitchAngle'],\r\n    '019A': ['FL', '1', 'FixationDeviceRollAngle'],\r\n    '01A0': ['SQ', '1', 'ShieldingDeviceSequence'],\r\n    '01A2': ['CS', '1', 'ShieldingDeviceType'],\r\n    '01A4': ['SH', '1', 'ShieldingDeviceLabel'],\r\n    '01A6': ['ST', '1', 'ShieldingDeviceDescription'],\r\n    '01A8': ['SH', '1', 'ShieldingDevicePosition'],\r\n    '01B0': ['CS', '1', 'SetupTechnique'],\r\n    '01B2': ['ST', '1', 'SetupTechniqueDescription'],\r\n    '01B4': ['SQ', '1', 'SetupDeviceSequence'],\r\n    '01B6': ['CS', '1', 'SetupDeviceType'],\r\n    '01B8': ['SH', '1', 'SetupDeviceLabel'],\r\n    '01BA': ['ST', '1', 'SetupDeviceDescription'],\r\n    '01BC': ['DS', '1', 'SetupDeviceParameter'],\r\n    '01D0': ['ST', '1', 'SetupReferenceDescription'],\r\n    '01D2': ['DS', '1', 'TableTopVerticalSetupDisplacement'],\r\n    '01D4': ['DS', '1', 'TableTopLongitudinalSetupDisplacement'],\r\n    '01D6': ['DS', '1', 'TableTopLateralSetupDisplacement'],\r\n    '0200': ['CS', '1', 'BrachyTreatmentTechnique'],\r\n    '0202': ['CS', '1', 'BrachyTreatmentType'],\r\n    '0206': ['SQ', '1', 'TreatmentMachineSequence'],\r\n    '0210': ['SQ', '1', 'SourceSequence'],\r\n    '0212': ['IS', '1', 'SourceNumber'],\r\n    '0214': ['CS', '1', 'SourceType'],\r\n    '0216': ['LO', '1', 'SourceManufacturer'],\r\n    '0218': ['DS', '1', 'ActiveSourceDiameter'],\r\n    '021A': ['DS', '1', 'ActiveSourceLength'],\r\n    '021B': ['SH', '1', 'SourceModelID'],\r\n    '021C': ['LO', '1', 'SourceDescription'],\r\n    '0222': ['DS', '1', 'SourceEncapsulationNominalThickness'],\r\n    '0224': ['DS', '1', 'SourceEncapsulationNominalTransmission'],\r\n    '0226': ['LO', '1', 'SourceIsotopeName'],\r\n    '0228': ['DS', '1', 'SourceIsotopeHalfLife'],\r\n    '0229': ['CS', '1', 'SourceStrengthUnits'],\r\n    '022A': ['DS', '1', 'ReferenceAirKermaRate'],\r\n    '022B': ['DS', '1', 'SourceStrength'],\r\n    '022C': ['DA', '1', 'SourceStrengthReferenceDate'],\r\n    '022E': ['TM', '1', 'SourceStrengthReferenceTime'],\r\n    '0230': ['SQ', '1', 'ApplicationSetupSequence'],\r\n    '0232': ['CS', '1', 'ApplicationSetupType'],\r\n    '0234': ['IS', '1', 'ApplicationSetupNumber'],\r\n    '0236': ['LO', '1', 'ApplicationSetupName'],\r\n    '0238': ['LO', '1', 'ApplicationSetupManufacturer'],\r\n    '0240': ['IS', '1', 'TemplateNumber'],\r\n    '0242': ['SH', '1', 'TemplateType'],\r\n    '0244': ['LO', '1', 'TemplateName'],\r\n    '0250': ['DS', '1', 'TotalReferenceAirKerma'],\r\n    '0260': ['SQ', '1', 'BrachyAccessoryDeviceSequence'],\r\n    '0262': ['IS', '1', 'BrachyAccessoryDeviceNumber'],\r\n    '0263': ['SH', '1', 'BrachyAccessoryDeviceID'],\r\n    '0264': ['CS', '1', 'BrachyAccessoryDeviceType'],\r\n    '0266': ['LO', '1', 'BrachyAccessoryDeviceName'],\r\n    '026A': ['DS', '1', 'BrachyAccessoryDeviceNominalThickness'],\r\n    '026C': ['DS', '1', 'BrachyAccessoryDeviceNominalTransmission'],\r\n    '0271': ['DS', '1', 'ChannelEffectiveLength'],\r\n    '0272': ['DS', '1', 'ChannelInnerLength'],\r\n    '0273': ['SH', '1', 'AfterloaderChannelID'],\r\n    '0274': ['DS', '1', 'SourceApplicatorTipLength'],\r\n    '0280': ['SQ', '1', 'ChannelSequence'],\r\n    '0282': ['IS', '1', 'ChannelNumber'],\r\n    '0284': ['DS', '1', 'ChannelLength'],\r\n    '0286': ['DS', '1', 'ChannelTotalTime'],\r\n    '0288': ['CS', '1', 'SourceMovementType'],\r\n    '028A': ['IS', '1', 'NumberOfPulses'],\r\n    '028C': ['DS', '1', 'PulseRepetitionInterval'],\r\n    '0290': ['IS', '1', 'SourceApplicatorNumber'],\r\n    '0291': ['SH', '1', 'SourceApplicatorID'],\r\n    '0292': ['CS', '1', 'SourceApplicatorType'],\r\n    '0294': ['LO', '1', 'SourceApplicatorName'],\r\n    '0296': ['DS', '1', 'SourceApplicatorLength'],\r\n    '0298': ['LO', '1', 'SourceApplicatorManufacturer'],\r\n    '029C': ['DS', '1', 'SourceApplicatorWallNominalThickness'],\r\n    '029E': ['DS', '1', 'SourceApplicatorWallNominalTransmission'],\r\n    '02A0': ['DS', '1', 'SourceApplicatorStepSize'],\r\n    '02A1': ['IS', '1', 'ApplicatorShapeReferencedROINumber'],\r\n    '02A2': ['IS', '1', 'TransferTubeNumber'],\r\n    '02A4': ['DS', '1', 'TransferTubeLength'],\r\n    '02B0': ['SQ', '1', 'ChannelShieldSequence'],\r\n    '02B2': ['IS', '1', 'ChannelShieldNumber'],\r\n    '02B3': ['SH', '1', 'ChannelShieldID'],\r\n    '02B4': ['LO', '1', 'ChannelShieldName'],\r\n    '02B8': ['DS', '1', 'ChannelShieldNominalThickness'],\r\n    '02BA': ['DS', '1', 'ChannelShieldNominalTransmission'],\r\n    '02C8': ['DS', '1', 'FinalCumulativeTimeWeight'],\r\n    '02D0': ['SQ', '1', 'BrachyControlPointSequence'],\r\n    '02D2': ['DS', '1', 'ControlPointRelativePosition'],\r\n    '02D4': ['DS', '3', 'ControlPoint3DPosition'],\r\n    '02D6': ['DS', '1', 'CumulativeTimeWeight'],\r\n    '02E0': ['CS', '1', 'CompensatorDivergence'],\r\n    '02E1': ['CS', '1', 'CompensatorMountingPosition'],\r\n    '02E2': ['DS', '1-n', 'SourceToCompensatorDistance'],\r\n    '02E3': ['FL', '1', 'TotalCompensatorTrayWaterEquivalentThickness'],\r\n    '02E4': ['FL', '1', 'IsocenterToCompensatorTrayDistance'],\r\n    '02E5': ['FL', '1', 'CompensatorColumnOffset'],\r\n    '02E6': ['FL', '1-n', 'IsocenterToCompensatorDistances'],\r\n    '02E7': ['FL', '1', 'CompensatorRelativeStoppingPowerRatio'],\r\n    '02E8': ['FL', '1', 'CompensatorMillingToolDiameter'],\r\n    '02EA': ['SQ', '1', 'IonRangeCompensatorSequence'],\r\n    '02EB': ['LT', '1', 'CompensatorDescription'],\r\n    '0302': ['IS', '1', 'RadiationMassNumber'],\r\n    '0304': ['IS', '1', 'RadiationAtomicNumber'],\r\n    '0306': ['SS', '1', 'RadiationChargeState'],\r\n    '0308': ['CS', '1', 'ScanMode'],\r\n    '0309': ['CS', '1', 'ModulatedScanModeType'],\r\n    '030A': ['FL', '2', 'VirtualSourceAxisDistances'],\r\n    '030C': ['SQ', '1', 'SnoutSequence'],\r\n    '030D': ['FL', '1', 'SnoutPosition'],\r\n    '030F': ['SH', '1', 'SnoutID'],\r\n    '0312': ['IS', '1', 'NumberOfRangeShifters'],\r\n    '0314': ['SQ', '1', 'RangeShifterSequence'],\r\n    '0316': ['IS', '1', 'RangeShifterNumber'],\r\n    '0318': ['SH', '1', 'RangeShifterID'],\r\n    '0320': ['CS', '1', 'RangeShifterType'],\r\n    '0322': ['LO', '1', 'RangeShifterDescription'],\r\n    '0330': ['IS', '1', 'NumberOfLateralSpreadingDevices'],\r\n    '0332': ['SQ', '1', 'LateralSpreadingDeviceSequence'],\r\n    '0334': ['IS', '1', 'LateralSpreadingDeviceNumber'],\r\n    '0336': ['SH', '1', 'LateralSpreadingDeviceID'],\r\n    '0338': ['CS', '1', 'LateralSpreadingDeviceType'],\r\n    '033A': ['LO', '1', 'LateralSpreadingDeviceDescription'],\r\n    '033C': ['FL', '1', 'LateralSpreadingDeviceWaterEquivalentThickness'],\r\n    '0340': ['IS', '1', 'NumberOfRangeModulators'],\r\n    '0342': ['SQ', '1', 'RangeModulatorSequence'],\r\n    '0344': ['IS', '1', 'RangeModulatorNumber'],\r\n    '0346': ['SH', '1', 'RangeModulatorID'],\r\n    '0348': ['CS', '1', 'RangeModulatorType'],\r\n    '034A': ['LO', '1', 'RangeModulatorDescription'],\r\n    '034C': ['SH', '1', 'BeamCurrentModulationID'],\r\n    '0350': ['CS', '1', 'PatientSupportType'],\r\n    '0352': ['SH', '1', 'PatientSupportID'],\r\n    '0354': ['LO', '1', 'PatientSupportAccessoryCode'],\r\n    '0355': ['LO', '1', 'TrayAccessoryCode'],\r\n    '0356': ['FL', '1', 'FixationLightAzimuthalAngle'],\r\n    '0358': ['FL', '1', 'FixationLightPolarAngle'],\r\n    '035A': ['FL', '1', 'MetersetRate'],\r\n    '0360': ['SQ', '1', 'RangeShifterSettingsSequence'],\r\n    '0362': ['LO', '1', 'RangeShifterSetting'],\r\n    '0364': ['FL', '1', 'IsocenterToRangeShifterDistance'],\r\n    '0366': ['FL', '1', 'RangeShifterWaterEquivalentThickness'],\r\n    '0370': ['SQ', '1', 'LateralSpreadingDeviceSettingsSequence'],\r\n    '0372': ['LO', '1', 'LateralSpreadingDeviceSetting'],\r\n    '0374': ['FL', '1', 'IsocenterToLateralSpreadingDeviceDistance'],\r\n    '0380': ['SQ', '1', 'RangeModulatorSettingsSequence'],\r\n    '0382': ['FL', '1', 'RangeModulatorGatingStartValue'],\r\n    '0384': ['FL', '1', 'RangeModulatorGatingStopValue'],\r\n    '0386': ['FL', '1', 'RangeModulatorGatingStartWaterEquivalentThickness'],\r\n    '0388': ['FL', '1', 'RangeModulatorGatingStopWaterEquivalentThickness'],\r\n    '038A': ['FL', '1', 'IsocenterToRangeModulatorDistance'],\r\n    '038F': ['FL', '1-n', 'ScanSpotTimeOffset'],\r\n    '0390': ['SH', '1', 'ScanSpotTuneID'],\r\n    '0391': ['IS', '1-n', 'ScanSpotPrescribedIndices'],\r\n    '0392': ['IS', '1', 'NumberOfScanSpotPositions'],\r\n    '0393': ['CS', '1', 'ScanSpotReordered'],\r\n    '0394': ['FL', '1-n', 'ScanSpotPositionMap'],\r\n    '0395': ['CS', '1', 'ScanSpotReorderingAllowed'],\r\n    '0396': ['FL', '1-n', 'ScanSpotMetersetWeights'],\r\n    '0398': ['FL', '2', 'ScanningSpotSize'],\r\n    '0399': ['FL', '2-2n', 'ScanSpotSizesDelivered'],\r\n    '039A': ['IS', '1', 'NumberOfPaintings'],\r\n    '03A0': ['SQ', '1', 'IonToleranceTableSequence'],\r\n    '03A2': ['SQ', '1', 'IonBeamSequence'],\r\n    '03A4': ['SQ', '1', 'IonBeamLimitingDeviceSequence'],\r\n    '03A6': ['SQ', '1', 'IonBlockSequence'],\r\n    '03A8': ['SQ', '1', 'IonControlPointSequence'],\r\n    '03AA': ['SQ', '1', 'IonWedgeSequence'],\r\n    '03AC': ['SQ', '1', 'IonWedgePositionSequence'],\r\n    '0401': ['SQ', '1', 'ReferencedSetupImageSequence'],\r\n    '0402': ['ST', '1', 'SetupImageComment'],\r\n    '0410': ['SQ', '1', 'MotionSynchronizationSequence'],\r\n    '0412': ['FL', '3', 'ControlPointOrientation'],\r\n    '0420': ['SQ', '1', 'GeneralAccessorySequence'],\r\n    '0421': ['SH', '1', 'GeneralAccessoryID'],\r\n    '0422': ['ST', '1', 'GeneralAccessoryDescription'],\r\n    '0423': ['CS', '1', 'GeneralAccessoryType'],\r\n    '0424': ['IS', '1', 'GeneralAccessoryNumber'],\r\n    '0425': ['FL', '1', 'SourceToGeneralAccessoryDistance'],\r\n    '0426': ['DS', '1', 'IsocenterToGeneralAccessoryDistance'],\r\n    '0431': ['SQ', '1', 'ApplicatorGeometrySequence'],\r\n    '0432': ['CS', '1', 'ApplicatorApertureShape'],\r\n    '0433': ['FL', '1', 'ApplicatorOpening'],\r\n    '0434': ['FL', '1', 'ApplicatorOpeningX'],\r\n    '0435': ['FL', '1', 'ApplicatorOpeningY'],\r\n    '0436': ['FL', '1', 'SourceToApplicatorMountingPositionDistance'],\r\n    '0440': ['IS', '1', 'NumberOfBlockSlabItems'],\r\n    '0441': ['SQ', '1', 'BlockSlabSequence'],\r\n    '0442': ['DS', '1', 'BlockSlabThickness'],\r\n    '0443': ['US', '1', 'BlockSlabNumber'],\r\n    '0450': ['SQ', '1', 'DeviceMotionControlSequence'],\r\n    '0451': ['CS', '1', 'DeviceMotionExecutionMode'],\r\n    '0452': ['CS', '1', 'DeviceMotionObservationMode'],\r\n    '0453': ['SQ', '1', 'DeviceMotionParameterCodeSequence'],\r\n    '0501': ['FL', '1', 'DistalDepthFraction'],\r\n    '0502': ['FL', '1', 'DistalDepth'],\r\n    '0503': ['FL', '2', 'NominalRangeModulationFractions'],\r\n    '0504': ['FL', '2', 'NominalRangeModulatedRegionDepths'],\r\n    '0505': ['SQ', '1', 'DepthDoseParametersSequence'],\r\n    '0506': ['SQ', '1', 'DeliveredDepthDoseParametersSequence'],\r\n    '0507': ['FL', '1', 'DeliveredDistalDepthFraction'],\r\n    '0508': ['FL', '1', 'DeliveredDistalDepth'],\r\n    '0509': ['FL', '2', 'DeliveredNominalRangeModulationFractions'],\r\n    '0510': ['FL', '2', 'DeliveredNominalRangeModulatedRegionDepths'],\r\n    '0511': ['CS', '1', 'DeliveredReferenceDoseDefinition'],\r\n    '0512': ['CS', '1', 'ReferenceDoseDefinition'],\r\n    '0600': ['US', '1', 'RTControlPointIndex'],\r\n    '0601': ['US', '1', 'RadiationGenerationModeIndex'],\r\n    '0602': ['US', '1', 'ReferencedDefinedDeviceIndex'],\r\n    '0603': ['US', '1', 'RadiationDoseIdentificationIndex'],\r\n    '0604': ['US', '1', 'NumberOfRTControlPoints'],\r\n    '0605': ['US', '1', 'ReferencedRadiationGenerationModeIndex'],\r\n    '0606': ['US', '1', 'TreatmentPositionIndex'],\r\n    '0607': ['US', '1', 'ReferencedDeviceIndex'],\r\n    '0608': ['LO', '1', 'TreatmentPositionGroupLabel'],\r\n    '0609': ['UI', '1', 'TreatmentPositionGroupUID'],\r\n    '060A': ['SQ', '1', 'TreatmentPositionGroupSequence'],\r\n    '060B': ['US', '1', 'ReferencedTreatmentPositionIndex'],\r\n    '060C': ['US', '1', 'ReferencedRadiationDoseIdentificationIndex'],\r\n    '060D': ['FD', '1', 'RTAccessoryHolderWaterEquivalentThickness'],\r\n    '060E': ['US', '1', 'ReferencedRTAccessoryHolderDeviceIndex'],\r\n    '060F': ['CS', '1', 'RTAccessoryHolderSlotExistenceFlag'],\r\n    '0610': ['SQ', '1', 'RTAccessoryHolderSlotSequence'],\r\n    '0611': ['LO', '1', 'RTAccessoryHolderSlotID'],\r\n    '0612': ['FD', '1', 'RTAccessoryHolderSlotDistance'],\r\n    '0613': ['FD', '1', 'RTAccessorySlotDistance'],\r\n    '0614': ['SQ', '1', 'RTAccessoryHolderDefinitionSequence'],\r\n    '0615': ['LO', '1', 'RTAccessoryDeviceSlotID'],\r\n    '0616': ['SQ', '1', 'RTRadiationSequence'],\r\n    '0617': ['SQ', '1', 'RadiationDoseSequence'],\r\n    '0618': ['SQ', '1', 'RadiationDoseIdentificationSequence'],\r\n    '0619': ['LO', '1', 'RadiationDoseIdentificationLabel'],\r\n    '061A': ['CS', '1', 'ReferenceDoseType'],\r\n    '061B': ['CS', '1', 'PrimaryDoseValueIndicator'],\r\n    '061C': ['SQ', '1', 'DoseValuesSequence'],\r\n    '061D': ['CS', '1-n', 'DoseValuePurpose'],\r\n    '061E': ['FD', '3', 'ReferenceDosePointCoordinates'],\r\n    '061F': ['SQ', '1', 'RadiationDoseValuesParametersSequence'],\r\n    '0620': ['SQ', '1', 'MetersetToDoseMappingSequence'],\r\n    '0621': ['SQ', '1', 'ExpectedInVivoMeasurementValuesSequence'],\r\n    '0622': ['US', '1', 'ExpectedInVivoMeasurementValueIndex'],\r\n    '0623': ['LO', '1', 'RadiationDoseInVivoMeasurementLabel'],\r\n    '0624': ['FD', '2', 'RadiationDoseCentralAxisDisplacement'],\r\n    '0625': ['FD', '1', 'RadiationDoseValue'],\r\n    '0626': ['FD', '1', 'RadiationDoseSourceToSkinDistance'],\r\n    '0627': ['FD', '3', 'RadiationDoseMeasurementPointCoordinates'],\r\n    '0628': ['FD', '1', 'RadiationDoseSourceToExternalContourDistance'],\r\n    '0629': ['SQ', '1', 'RTToleranceSetSequence'],\r\n    '062A': ['LO', '1', 'RTToleranceSetLabel'],\r\n    '062B': ['SQ', '1', 'AttributeToleranceValuesSequence'],\r\n    '062C': ['FD', '1', 'ToleranceValue'],\r\n    '062D': ['SQ', '1', 'PatientSupportPositionToleranceSequence'],\r\n    '062E': ['FD', '1', 'TreatmentTimeLimit'],\r\n    '062F': ['SQ', '1', 'CArmPhotonElectronControlPointSequence'],\r\n    '0630': ['SQ', '1', 'ReferencedRTRadiationSequence'],\r\n    '0631': ['SQ', '1', 'ReferencedRTInstanceSequence'],\r\n    '0632': ['SQ', '1', 'ReferencedRTPatientSetupSequence'],\r\n    '0634': ['FD', '1', 'SourceToPatientSurfaceDistance'],\r\n    '0635': ['SQ', '1', 'TreatmentMachineSpecialModeCodeSequence'],\r\n    '0636': ['US', '1', 'IntendedNumberOfFractions'],\r\n    '0637': ['CS', '1', 'RTRadiationSetIntent'],\r\n    '0638': ['CS', '1', 'RTRadiationPhysicalAndGeometricContentDetailFlag'],\r\n    '0639': ['CS', '1', 'RTRecordFlag'],\r\n    '063A': ['SQ', '1', 'TreatmentDeviceIdentificationSequence'],\r\n    '063B': ['SQ', '1', 'ReferencedRTPhysicianIntentSequence'],\r\n    '063C': ['FD', '1', 'CumulativeMeterset'],\r\n    '063D': ['FD', '1', 'DeliveryRate'],\r\n    '063E': ['SQ', '1', 'DeliveryRateUnitSequence'],\r\n    '063F': ['SQ', '1', 'TreatmentPositionSequence'],\r\n    '0640': ['FD', '1', 'RadiationSourceAxisDistance'],\r\n    '0641': ['US', '1', 'NumberOfRTBeamLimitingDevices'],\r\n    '0642': ['FD', '1', 'RTBeamLimitingDeviceProximalDistance'],\r\n    '0643': ['FD', '1', 'RTBeamLimitingDeviceDistalDistance'],\r\n    '0644': ['SQ', '1', 'ParallelRTBeamDelimiterDeviceOrientationLabelCodeSequence'],\r\n    '0645': ['FD', '1', 'BeamModifierOrientationAngle'],\r\n    '0646': ['SQ', '1', 'FixedRTBeamDelimiterDeviceSequence'],\r\n    '0647': ['SQ', '1', 'ParallelRTBeamDelimiterDeviceSequence'],\r\n    '0648': ['US', '1', 'NumberOfParallelRTBeamDelimiters'],\r\n    '0649': ['FD', '2-n', 'ParallelRTBeamDelimiterBoundaries'],\r\n    '064A': ['FD', '2-n', 'ParallelRTBeamDelimiterPositions'],\r\n    '064B': ['FD', '2', 'RTBeamLimitingDeviceOffset'],\r\n    '064C': ['SQ', '1', 'RTBeamDelimiterGeometrySequence'],\r\n    '064D': ['SQ', '1', 'RTBeamLimitingDeviceDefinitionSequence'],\r\n    '064E': ['CS', '1', 'ParallelRTBeamDelimiterOpeningMode'],\r\n    '064F': ['CS', '1-n', 'ParallelRTBeamDelimiterLeafMountingSide'],\r\n    '0650': ['UI', '1', 'PatientSetupUID'],\r\n    '0651': ['SQ', '1', 'WedgeDefinitionSequence'],\r\n    '0652': ['FD', '1', 'RadiationBeamWedgeAngle'],\r\n    '0653': ['FD', '1', 'RadiationBeamWedgeThinEdgeDistance'],\r\n    '0654': ['FD', '1', 'RadiationBeamEffectiveWedgeAngle'],\r\n    '0655': ['US', '1', 'NumberOfWedgePositions'],\r\n    '0656': ['SQ', '1', 'RTBeamLimitingDeviceOpeningSequence'],\r\n    '0657': ['US', '1', 'NumberOfRTBeamLimitingDeviceOpenings'],\r\n    '0658': ['SQ', '1', 'RadiationDosimeterUnitSequence'],\r\n    '0659': ['SQ', '1', 'RTDeviceDistanceReferenceLocationCodeSequence'],\r\n    '065A': ['SQ', '1', 'RadiationDeviceConfigurationAndCommissioningKeySequence'],\r\n    '065B': ['SQ', '1', 'PatientSupportPositionParameterSequence'],\r\n    '065C': ['CS', '1', 'PatientSupportPositionSpecificationMethod'],\r\n    '065D': ['SQ', '1', 'PatientSupportPositionDeviceParameterSequence'],\r\n    '065E': ['US', '1', 'DeviceOrderIndex'],\r\n    '065F': ['US', '1', 'PatientSupportPositionParameterOrderIndex'],\r\n    '0660': ['SQ', '1', 'PatientSupportPositionDeviceToleranceSequence'],\r\n    '0661': ['US', '1', 'PatientSupportPositionToleranceOrderIndex'],\r\n    '0662': ['SQ', '1', 'CompensatorDefinitionSequence'],\r\n    '0663': ['CS', '1', 'CompensatorMapOrientation'],\r\n    '0664': ['OF', '1', 'CompensatorProximalThicknessMap'],\r\n    '0665': ['OF', '1', 'CompensatorDistalThicknessMap'],\r\n    '0666': ['FD', '1', 'CompensatorBasePlaneOffset'],\r\n    '0667': ['SQ', '1', 'CompensatorShapeFabricationCodeSequence'],\r\n    '0668': ['SQ', '1', 'CompensatorShapeSequence'],\r\n    '0669': ['FD', '1', 'RadiationBeamCompensatorMillingToolDiameter'],\r\n    '066A': ['SQ', '1', 'BlockDefinitionSequence'],\r\n    '066B': ['OF', '1', 'BlockEdgeData'],\r\n    '066C': ['CS', '1', 'BlockOrientation'],\r\n    '066D': ['FD', '1', 'RadiationBeamBlockThickness'],\r\n    '066E': ['FD', '1', 'RadiationBeamBlockSlabThickness'],\r\n    '066F': ['SQ', '1', 'BlockEdgeDataSequence'],\r\n    '0670': ['US', '1', 'NumberOfRTAccessoryHolders'],\r\n    '0671': ['SQ', '1', 'GeneralAccessoryDefinitionSequence'],\r\n    '0672': ['US', '1', 'NumberOfGeneralAccessories'],\r\n    '0673': ['SQ', '1', 'BolusDefinitionSequence'],\r\n    '0674': ['US', '1', 'NumberOfBoluses'],\r\n    '0675': ['UI', '1', 'EquipmentFrameOfReferenceUID'],\r\n    '0676': ['ST', '1', 'EquipmentFrameOfReferenceDescription'],\r\n    '0677': ['SQ', '1', 'EquipmentReferencePointCoordinatesSequence'],\r\n    '0678': ['SQ', '1', 'EquipmentReferencePointCodeSequence'],\r\n    '0679': ['FD', '1', 'RTBeamLimitingDeviceAngle'],\r\n    '067A': ['FD', '1', 'SourceRollAngle'],\r\n    '067B': ['SQ', '1', 'RadiationGenerationModeSequence'],\r\n    '067C': ['SH', '1', 'RadiationGenerationModeLabel'],\r\n    '067D': ['ST', '1', 'RadiationGenerationModeDescription'],\r\n    '067E': ['SQ', '1', 'RadiationGenerationModeMachineCodeSequence'],\r\n    '067F': ['SQ', '1', 'RadiationTypeCodeSequence'],\r\n    '0680': ['DS', '1', 'NominalEnergy'],\r\n    '0681': ['DS', '1', 'MinimumNominalEnergy'],\r\n    '0682': ['DS', '1', 'MaximumNominalEnergy'],\r\n    '0683': ['SQ', '1', 'RadiationFluenceModifierCodeSequence'],\r\n    '0684': ['SQ', '1', 'EnergyUnitCodeSequence'],\r\n    '0685': ['US', '1', 'NumberOfRadiationGenerationModes'],\r\n    '0686': ['SQ', '1', 'PatientSupportDevicesSequence'],\r\n    '0687': ['US', '1', 'NumberOfPatientSupportDevices'],\r\n    '0688': ['FD', '1', 'RTBeamModifierDefinitionDistance'],\r\n    '0689': ['SQ', '1', 'BeamAreaLimitSequence'],\r\n    '068A': ['SQ', '1', 'ReferencedRTPrescriptionSequence'],\r\n    '0700': ['UI', '1', 'TreatmentSessionUID'],\r\n    '0701': ['CS', '1', 'RTRadiationUsage'],\r\n    '0702': ['SQ', '1', 'ReferencedRTRadiationSetSequence'],\r\n    '0703': ['SQ', '1', 'ReferencedRTRadiationRecordSequence'],\r\n    '0704': ['US', '1', 'RTRadiationSetDeliveryNumber'],\r\n    '0705': ['US', '1', 'ClinicalFractionNumber'],\r\n    '0706': ['CS', '1', 'RTTreatmentFractionCompletionStatus'],\r\n    '0707': ['CS', '1', 'RTRadiationSetUsage'],\r\n    '0708': ['CS', '1', 'TreatmentDeliveryContinuationFlag'],\r\n    '0709': ['CS', '1', 'TreatmentRecordContentOrigin'],\r\n    '0714': ['CS', '1', 'RTTreatmentTerminationStatus'],\r\n    '0715': ['SQ', '1', 'RTTreatmentTerminationReasonCodeSequence'],\r\n    '0716': ['SQ', '1', 'MachineSpecificTreatmentTerminationCodeSequence'],\r\n    '0722': ['SQ', '1', 'RTRadiationSalvageRecordControlPointSequence'],\r\n    '0723': ['CS', '1', 'StartingMetersetValueKnownFlag'],\r\n    '0730': ['ST', '1', 'TreatmentTerminationDescription'],\r\n    '0731': ['SQ', '1', 'TreatmentToleranceViolationSequence'],\r\n    '0732': ['CS', '1', 'TreatmentToleranceViolationCategory'],\r\n    '0733': ['SQ', '1', 'TreatmentToleranceViolationAttributeSequence'],\r\n    '0734': ['ST', '1', 'TreatmentToleranceViolationDescription'],\r\n    '0735': ['ST', '1', 'TreatmentToleranceViolationIdentification'],\r\n    '0736': ['DT', '1', 'TreatmentToleranceViolationDateTime'],\r\n    '073A': ['DT', '1', 'RecordedRTControlPointDateTime'],\r\n    '073B': ['US', '1', 'ReferencedRadiationRTControlPointIndex'],\r\n    '073E': ['SQ', '1', 'AlternateValueSequence'],\r\n    '073F': ['SQ', '1', 'ConfirmationSequence'],\r\n    '0740': ['SQ', '1', 'InterlockSequence'],\r\n    '0741': ['DT', '1', 'InterlockDateTime'],\r\n    '0742': ['ST', '1', 'InterlockDescription'],\r\n    '0743': ['SQ', '1', 'InterlockOriginatingDeviceSequence'],\r\n    '0744': ['SQ', '1', 'InterlockCodeSequence'],\r\n    '0745': ['SQ', '1', 'InterlockResolutionCodeSequence'],\r\n    '0746': ['SQ', '1', 'InterlockResolutionUserSequence'],\r\n    '0760': ['DT', '1', 'OverrideDateTime'],\r\n    '0761': ['SQ', '1', 'TreatmentToleranceViolationTypeCodeSequence'],\r\n    '0762': ['SQ', '1', 'TreatmentToleranceViolationCauseCodeSequence'],\r\n    '0772': ['SQ', '1', 'MeasuredMetersetToDoseMappingSequence'],\r\n    '0773': ['US', '1', 'ReferencedExpectedInVivoMeasurementValueIndex'],\r\n    '0774': ['SQ', '1', 'DoseMeasurementDeviceCodeSequence'],\r\n    '0780': ['SQ', '1', 'AdditionalParameterRecordingInstanceSequence'],\r\n    '0782': ['US', '1', ''],\r\n    '0783': ['ST', '1', 'InterlockOriginDescription'],\r\n    '0784': ['SQ', '1', 'RTPatientPositionScopeSequence'],\r\n    '0785': ['UI', '1', 'ReferencedTreatmentPositionGroupUID'],\r\n    '0786': ['US', '1', 'RadiationOrderIndex'],\r\n    '0787': ['SQ', '1', 'OmittedRadiationSequence'],\r\n    '0788': ['SQ', '1', 'ReasonForOmissionCodeSequence'],\r\n    '0789': ['SQ', '1', 'RTDeliveryStartPatientPositionSequence'],\r\n    '078A': ['SQ', '1', 'RTTreatmentPreparationPatientPositionSequence'],\r\n    '078B': ['SQ', '1', 'ReferencedRTTreatmentPreparationSequence'],\r\n    '078C': ['SQ', '1', 'ReferencedPatientSetupPhotoSequence'],\r\n    '078D': ['SQ', '1', 'PatientTreatmentPreparationMethodCodeSequence'],\r\n    '078E': ['LT', '1', 'PatientTreatmentPreparationProcedureParameterDescription'],\r\n    '078F': ['SQ', '1', 'PatientTreatmentPreparationDeviceSequence'],\r\n    '0790': ['SQ', '1', 'PatientTreatmentPreparationProcedureSequence'],\r\n    '0791': ['SQ', '1', 'PatientTreatmentPreparationProcedureCodeSequence'],\r\n    '0792': ['LT', '1', 'PatientTreatmentPreparationMethodDescription'],\r\n    '0793': ['SQ', '1', 'PatientTreatmentPreparationProcedureParameterSequence'],\r\n    '0794': ['LT', '1', 'PatientSetupPhotoDescription'],\r\n    '0795': ['US', '1', 'PatientTreatmentPreparationProcedureIndex'],\r\n    '0796': ['US', '1', 'ReferencedPatientSetupProcedureIndex'],\r\n    '0797': ['SQ', '1', 'RTRadiationTaskSequence'],\r\n    '0798': ['SQ', '1', 'RTPatientPositionDisplacementSequence'],\r\n    '0799': ['SQ', '1', 'RTPatientPositionSequence'],\r\n    '079A': ['LO', '1', 'DisplacementReferenceLabel'],\r\n    '079B': ['FD', '16', 'DisplacementMatrix'],\r\n    '079C': ['SQ', '1', 'PatientSupportDisplacementSequence'],\r\n    '079D': ['SQ', '1', 'DisplacementReferenceLocationCodeSequence'],\r\n    '079E': ['CS', '1', 'RTRadiationSetDeliveryUsage']\r\n  },\r\n  '300C': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0002': ['SQ', '1', 'ReferencedRTPlanSequence'],\r\n    '0004': ['SQ', '1', 'ReferencedBeamSequence'],\r\n    '0006': ['IS', '1', 'ReferencedBeamNumber'],\r\n    '0007': ['IS', '1', 'ReferencedReferenceImageNumber'],\r\n    '0008': ['DS', '1', 'StartCumulativeMetersetWeight'],\r\n    '0009': ['DS', '1', 'EndCumulativeMetersetWeight'],\r\n    '000A': ['SQ', '1', 'ReferencedBrachyApplicationSetupSequence'],\r\n    '000C': ['IS', '1', 'ReferencedBrachyApplicationSetupNumber'],\r\n    '000E': ['IS', '1', 'ReferencedSourceNumber'],\r\n    '0020': ['SQ', '1', 'ReferencedFractionGroupSequence'],\r\n    '0022': ['IS', '1', 'ReferencedFractionGroupNumber'],\r\n    '0040': ['SQ', '1', 'ReferencedVerificationImageSequence'],\r\n    '0042': ['SQ', '1', 'ReferencedReferenceImageSequence'],\r\n    '0050': ['SQ', '1', 'ReferencedDoseReferenceSequence'],\r\n    '0051': ['IS', '1', 'ReferencedDoseReferenceNumber'],\r\n    '0055': ['SQ', '1', 'BrachyReferencedDoseReferenceSequence'],\r\n    '0060': ['SQ', '1', 'ReferencedStructureSetSequence'],\r\n    '006A': ['IS', '1', 'ReferencedPatientSetupNumber'],\r\n    '0080': ['SQ', '1', 'ReferencedDoseSequence'],\r\n    '00A0': ['IS', '1', 'ReferencedToleranceTableNumber'],\r\n    '00B0': ['SQ', '1', 'ReferencedBolusSequence'],\r\n    '00C0': ['IS', '1', 'ReferencedWedgeNumber'],\r\n    '00D0': ['IS', '1', 'ReferencedCompensatorNumber'],\r\n    '00E0': ['IS', '1', 'ReferencedBlockNumber'],\r\n    '00F0': ['IS', '1', 'ReferencedControlPointIndex'],\r\n    '00F2': ['SQ', '1', 'ReferencedControlPointSequence'],\r\n    '00F4': ['IS', '1', 'ReferencedStartControlPointIndex'],\r\n    '00F6': ['IS', '1', 'ReferencedStopControlPointIndex'],\r\n    '0100': ['IS', '1', 'ReferencedRangeShifterNumber'],\r\n    '0102': ['IS', '1', 'ReferencedLateralSpreadingDeviceNumber'],\r\n    '0104': ['IS', '1', 'ReferencedRangeModulatorNumber'],\r\n    '0111': ['SQ', '1', 'OmittedBeamTaskSequence'],\r\n    '0112': ['CS', '1', 'ReasonForOmission'],\r\n    '0113': ['LO', '1', 'ReasonForOmissionDescription'],\r\n    '0114': ['SQ', '1', 'PrescriptionOverviewSequence'],\r\n    '0115': ['FL', '1', 'TotalPrescriptionDose'],\r\n    '0116': ['SQ', '1', 'PlanOverviewSequence'],\r\n    '0117': ['US', '1', 'PlanOverviewIndex'],\r\n    '0118': ['US', '1', 'ReferencedPlanOverviewIndex'],\r\n    '0119': ['US', '1', 'NumberOfFractionsIncluded'],\r\n    '0120': ['SQ', '1', 'DoseCalibrationConditionsSequence'],\r\n    '0121': ['FD', '1', 'AbsorbedDoseToMetersetRatio'],\r\n    '0122': ['FD', '2', 'DelineatedRadiationFieldSize'],\r\n    '0123': ['CS', '1', 'DoseCalibrationConditionsVerifiedFlag'],\r\n    '0124': ['FD', '1', 'CalibrationReferencePointDepth'],\r\n    '0125': ['SQ', '1', 'GatingBeamHoldTransitionSequence'],\r\n    '0126': ['CS', '1', 'BeamHoldTransition'],\r\n    '0127': ['DT', '1', 'BeamHoldTransitionDateTime'],\r\n    '0128': ['SQ', '1', 'BeamHoldOriginatingDeviceSequence']\r\n  },\r\n  '300E': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0002': ['CS', '1', 'ApprovalStatus'],\r\n    '0004': ['DA', '1', 'ReviewDate'],\r\n    '0005': ['TM', '1', 'ReviewTime'],\r\n    '0008': ['PN', '1', 'ReviewerName']\r\n  },\r\n  '3010': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['SQ', '1', 'RadiobiologicalDoseEffectSequence'],\r\n    '0002': ['CS', '1', 'RadiobiologicalDoseEffectFlag'],\r\n    '0003': ['SQ', '1', 'EffectiveDoseCalculationMethodCategoryCodeSequence'],\r\n    '0004': ['SQ', '1', 'EffectiveDoseCalculationMethodCodeSequence'],\r\n    '0005': ['LO', '1', 'EffectiveDoseCalculationMethodDescription'],\r\n    '0006': ['UI', '1', 'ConceptualVolumeUID'],\r\n    '0007': ['SQ', '1', 'OriginatingSOPInstanceReferenceSequence'],\r\n    '0008': ['SQ', '1', 'ConceptualVolumeConstituentSequence'],\r\n    '0009': ['SQ', '1', 'EquivalentConceptualVolumeInstanceReferenceSequence'],\r\n    '000A': ['SQ', '1', 'EquivalentConceptualVolumesSequence'],\r\n    '000B': ['UI', '1', 'ReferencedConceptualVolumeUID'],\r\n    '000C': ['UT', '1', 'ConceptualVolumeCombinationExpression'],\r\n    '000D': ['US', '1', 'ConceptualVolumeConstituentIndex'],\r\n    '000E': ['CS', '1', 'ConceptualVolumeCombinationFlag'],\r\n    '000F': ['ST', '1', 'ConceptualVolumeCombinationDescription'],\r\n    '0010': ['CS', '1', 'ConceptualVolumeSegmentationDefinedFlag'],\r\n    '0011': ['SQ', '1', 'ConceptualVolumeSegmentationReferenceSequence'],\r\n    '0012': ['SQ', '1', 'ConceptualVolumeConstituentSegmentationReferenceSequence'],\r\n    '0013': ['UI', '1', 'ConstituentConceptualVolumeUID'],\r\n    '0014': ['SQ', '1', 'DerivationConceptualVolumeSequence'],\r\n    '0015': ['UI', '1', 'SourceConceptualVolumeUID'],\r\n    '0016': ['SQ', '1', 'ConceptualVolumeDerivationAlgorithmSequence'],\r\n    '0017': ['ST', '1', 'ConceptualVolumeDescription'],\r\n    '0018': ['SQ', '1', 'SourceConceptualVolumeSequence'],\r\n    '0019': ['SQ', '1', 'AuthorIdentificationSequence'],\r\n    '001A': ['LO', '1', 'ManufacturerModelVersion'],\r\n    '001B': ['UC', '1', 'DeviceAlternateIdentifier'],\r\n    '001C': ['CS', '1', 'DeviceAlternateIdentifierType'],\r\n    '001D': ['LT', '1', 'DeviceAlternateIdentifierFormat'],\r\n    '001E': ['LO', '1', 'SegmentationCreationTemplateLabel'],\r\n    '001F': ['UI', '1', 'SegmentationTemplateUID'],\r\n    '0020': ['US', '1', 'ReferencedSegmentReferenceIndex'],\r\n    '0021': ['SQ', '1', 'SegmentReferenceSequence'],\r\n    '0022': ['US', '1', 'SegmentReferenceIndex'],\r\n    '0023': ['SQ', '1', 'DirectSegmentReferenceSequence'],\r\n    '0024': ['SQ', '1', 'CombinationSegmentReferenceSequence'],\r\n    '0025': ['SQ', '1', 'ConceptualVolumeSequence'],\r\n    '0026': ['SQ', '1', 'SegmentedRTAccessoryDeviceSequence'],\r\n    '0027': ['SQ', '1', 'SegmentCharacteristicsSequence'],\r\n    '0028': ['SQ', '1', 'RelatedSegmentCharacteristicsSequence'],\r\n    '0029': ['US', '1', 'SegmentCharacteristicsPrecedence'],\r\n    '002A': ['SQ', '1', 'RTSegmentAnnotationSequence'],\r\n    '002B': ['SQ', '1', 'SegmentAnnotationCategoryCodeSequence'],\r\n    '002C': ['SQ', '1', 'SegmentAnnotationTypeCodeSequence'],\r\n    '002D': ['LO', '1', 'DeviceLabel'],\r\n    '002E': ['SQ', '1', 'DeviceTypeCodeSequence'],\r\n    '002F': ['SQ', '1', 'SegmentAnnotationTypeModifierCodeSequence'],\r\n    '0030': ['SQ', '1', 'PatientEquipmentRelationshipCodeSequence'],\r\n    '0031': ['UI', '1', 'ReferencedFiducialsUID'],\r\n    '0032': ['SQ', '1', 'PatientTreatmentOrientationSequence'],\r\n    '0033': ['SH', '1', 'UserContentLabel'],\r\n    '0034': ['LO', '1', 'UserContentLongLabel'],\r\n    '0035': ['SH', '1', 'EntityLabel'],\r\n    '0036': ['LO', '1', 'EntityName'],\r\n    '0037': ['ST', '1', 'EntityDescription'],\r\n    '0038': ['LO', '1', 'EntityLongLabel'],\r\n    '0039': ['US', '1', 'DeviceIndex'],\r\n    '003A': ['US', '1', 'RTTreatmentPhaseIndex'],\r\n    '003B': ['UI', '1', 'RTTreatmentPhaseUID'],\r\n    '003C': ['US', '1', 'RTPrescriptionIndex'],\r\n    '003D': ['US', '1', 'RTSegmentAnnotationIndex'],\r\n    '003E': ['US', '1', 'BasisRTTreatmentPhaseIndex'],\r\n    '003F': ['US', '1', 'RelatedRTTreatmentPhaseIndex'],\r\n    '0040': ['US', '1', 'ReferencedRTTreatmentPhaseIndex'],\r\n    '0041': ['US', '1', 'ReferencedRTPrescriptionIndex'],\r\n    '0042': ['US', '1', 'ReferencedParentRTPrescriptionIndex'],\r\n    '0043': ['ST', '1', 'ManufacturerDeviceIdentifier'],\r\n    '0044': ['SQ', '1', 'InstanceLevelReferencedPerformedProcedureStepSequence'],\r\n    '0045': ['CS', '1', 'RTTreatmentPhaseIntentPresenceFlag'],\r\n    '0046': ['CS', '1', 'RadiotherapyTreatmentType'],\r\n    '0047': ['CS', '1-n', 'TeletherapyRadiationType'],\r\n    '0048': ['CS', '1-n', 'BrachytherapySourceType'],\r\n    '0049': ['SQ', '1', 'ReferencedRTTreatmentPhaseSequence'],\r\n    '004A': ['SQ', '1', 'ReferencedDirectSegmentInstanceSequence'],\r\n    '004B': ['SQ', '1', 'IntendedRTTreatmentPhaseSequence'],\r\n    '004C': ['DA', '1', 'IntendedPhaseStartDate'],\r\n    '004D': ['DA', '1', 'IntendedPhaseEndDate'],\r\n    '004E': ['SQ', '1', 'RTTreatmentPhaseIntervalSequence'],\r\n    '004F': ['CS', '1', 'TemporalRelationshipIntervalAnchor'],\r\n    '0050': ['FD', '1', 'MinimumNumberOfIntervalDays'],\r\n    '0051': ['FD', '1', 'MaximumNumberOfIntervalDays'],\r\n    '0052': ['UI', '1-n', 'PertinentSOPClassesInStudy'],\r\n    '0053': ['UI', '1-n', 'PertinentSOPClassesInSeries'],\r\n    '0054': ['LO', '1', 'RTPrescriptionLabel'],\r\n    '0055': ['SQ', '1', 'RTPhysicianIntentPredecessorSequence'],\r\n    '0056': ['LO', '1', 'RTTreatmentApproachLabel'],\r\n    '0057': ['SQ', '1', 'RTPhysicianIntentSequence'],\r\n    '0058': ['US', '1', 'RTPhysicianIntentIndex'],\r\n    '0059': ['CS', '1', 'RTTreatmentIntentType'],\r\n    '005A': ['UT', '1', 'RTPhysicianIntentNarrative'],\r\n    '005B': ['SQ', '1', 'RTProtocolCodeSequence'],\r\n    '005C': ['ST', '1', 'ReasonForSuperseding'],\r\n    '005D': ['SQ', '1', 'RTDiagnosisCodeSequence'],\r\n    '005E': ['US', '1', 'ReferencedRTPhysicianIntentIndex'],\r\n    '005F': ['SQ', '1', 'RTPhysicianIntentInputInstanceSequence'],\r\n    '0060': ['SQ', '1', 'RTAnatomicPrescriptionSequence'],\r\n    '0061': ['UT', '1', 'PriorTreatmentDoseDescription'],\r\n    '0062': ['SQ', '1', 'PriorTreatmentReferenceSequence'],\r\n    '0063': ['CS', '1', 'DosimetricObjectiveEvaluationScope'],\r\n    '0064': ['SQ', '1', 'TherapeuticRoleCategoryCodeSequence'],\r\n    '0065': ['SQ', '1', 'TherapeuticRoleTypeCodeSequence'],\r\n    '0066': ['US', '1', 'ConceptualVolumeOptimizationPrecedence'],\r\n    '0067': ['SQ', '1', 'ConceptualVolumeCategoryCodeSequence'],\r\n    '0068': ['CS', '1', 'ConceptualVolumeBlockingConstraint'],\r\n    '0069': ['SQ', '1', 'ConceptualVolumeTypeCodeSequence'],\r\n    '006A': ['SQ', '1', 'ConceptualVolumeTypeModifierCodeSequence'],\r\n    '006B': ['SQ', '1', 'RTPrescriptionSequence'],\r\n    '006C': ['SQ', '1', 'DosimetricObjectiveSequence'],\r\n    '006D': ['SQ', '1', 'DosimetricObjectiveTypeCodeSequence'],\r\n    '006E': ['UI', '1', 'DosimetricObjectiveUID'],\r\n    '006F': ['UI', '1', 'ReferencedDosimetricObjectiveUID'],\r\n    '0070': ['SQ', '1', 'DosimetricObjectiveParameterSequence'],\r\n    '0071': ['SQ', '1', 'ReferencedDosimetricObjectivesSequence'],\r\n    '0073': ['CS', '1', 'AbsoluteDosimetricObjectiveFlag'],\r\n    '0074': ['FD', '1', 'DosimetricObjectiveWeight'],\r\n    '0075': ['CS', '1', 'DosimetricObjectivePurpose'],\r\n    '0076': ['SQ', '1', 'PlanningInputInformationSequence'],\r\n    '0077': ['LO', '1', 'TreatmentSite'],\r\n    '0078': ['SQ', '1', 'TreatmentSiteCodeSequence'],\r\n    '0079': ['SQ', '1', 'FractionPatternSequence'],\r\n    '007A': ['UT', '1', 'TreatmentTechniqueNotes'],\r\n    '007B': ['UT', '1', 'PrescriptionNotes'],\r\n    '007C': ['IS', '1', 'NumberOfIntervalFractions'],\r\n    '007D': ['US', '1', 'NumberOfFractions'],\r\n    '007E': ['US', '1', 'IntendedDeliveryDuration'],\r\n    '007F': ['UT', '1', 'FractionationNotes'],\r\n    '0080': ['SQ', '1', 'RTTreatmentTechniqueCodeSequence'],\r\n    '0081': ['SQ', '1', 'PrescriptionNotesSequence'],\r\n    '0082': ['SQ', '1', 'FractionBasedRelationshipSequence'],\r\n    '0083': ['CS', '1', 'FractionBasedRelationshipIntervalAnchor'],\r\n    '0084': ['FD', '1', 'MinimumHoursBetweenFractions'],\r\n    '0085': ['TM', '1-n', 'IntendedFractionStartTime'],\r\n    '0086': ['LT', '1', 'IntendedStartDayOfWeek'],\r\n    '0087': ['SQ', '1', 'WeekdayFractionPatternSequence'],\r\n    '0088': ['SQ', '1', 'DeliveryTimeStructureCodeSequence'],\r\n    '0089': ['SQ', '1', 'TreatmentSiteModifierCodeSequence'],\r\n    '0090': ['CS', '1', 'RoboticBaseLocationIndicator'],\r\n    '0091': ['SQ', '1', 'RoboticPathNodeSetCodeSequence'],\r\n    '0092': ['UL', '1', 'RoboticNodeIdentifier'],\r\n    '0093': ['FD', '3', 'RTTreatmentSourceCoordinates'],\r\n    '0094': ['FD', '1', 'RadiationSourceCoordinateSystemYawAngle'],\r\n    '0095': ['FD', '1', 'RadiationSourceCoordinateSystemRollAngle'],\r\n    '0096': ['FD', '1', 'RadiationSourceCoordinateSystemPitchAngle'],\r\n    '0097': ['SQ', '1', 'RoboticPathControlPointSequence'],\r\n    '0098': ['SQ', '1', 'TomotherapeuticControlPointSequence'],\r\n    '0099': ['FD', '1-n', 'TomotherapeuticLeafOpenDurations'],\r\n    '009A': ['FD', '1-n', 'TomotherapeuticLeafInitialClosedDurations']\r\n  },\r\n  '4000': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['LT', '1', 'Arbitrary'],\r\n    '4000': ['LT', '1', 'TextComments']\r\n  },\r\n  '4008': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0040': ['SH', '1', 'ResultsID'],\r\n    '0042': ['LO', '1', 'ResultsIDIssuer'],\r\n    '0050': ['SQ', '1', 'ReferencedInterpretationSequence'],\r\n    '00FF': ['CS', '1', 'ReportProductionStatusTrial'],\r\n    '0100': ['DA', '1', 'InterpretationRecordedDate'],\r\n    '0101': ['TM', '1', 'InterpretationRecordedTime'],\r\n    '0102': ['PN', '1', 'InterpretationRecorder'],\r\n    '0103': ['LO', '1', 'ReferenceToRecordedSound'],\r\n    '0108': ['DA', '1', 'InterpretationTranscriptionDate'],\r\n    '0109': ['TM', '1', 'InterpretationTranscriptionTime'],\r\n    '010A': ['PN', '1', 'InterpretationTranscriber'],\r\n    '010B': ['ST', '1', 'InterpretationText'],\r\n    '010C': ['PN', '1', 'InterpretationAuthor'],\r\n    '0111': ['SQ', '1', 'InterpretationApproverSequence'],\r\n    '0112': ['DA', '1', 'InterpretationApprovalDate'],\r\n    '0113': ['TM', '1', 'InterpretationApprovalTime'],\r\n    '0114': ['PN', '1', 'PhysicianApprovingInterpretation'],\r\n    '0115': ['LT', '1', 'InterpretationDiagnosisDescription'],\r\n    '0117': ['SQ', '1', 'InterpretationDiagnosisCodeSequence'],\r\n    '0118': ['SQ', '1', 'ResultsDistributionListSequence'],\r\n    '0119': ['PN', '1', 'DistributionName'],\r\n    '011A': ['LO', '1', 'DistributionAddress'],\r\n    '0200': ['SH', '1', 'InterpretationID'],\r\n    '0202': ['LO', '1', 'InterpretationIDIssuer'],\r\n    '0210': ['CS', '1', 'InterpretationTypeID'],\r\n    '0212': ['CS', '1', 'InterpretationStatusID'],\r\n    '0300': ['ST', '1', 'Impressions'],\r\n    '4000': ['ST', '1', 'ResultsComments']\r\n  },\r\n  '4010': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['CS', '1', 'LowEnergyDetectors'],\r\n    '0002': ['CS', '1', 'HighEnergyDetectors'],\r\n    '0004': ['SQ', '1', 'DetectorGeometrySequence'],\r\n    '1001': ['SQ', '1', 'ThreatROIVoxelSequence'],\r\n    '1004': ['FL', '3', 'ThreatROIBase'],\r\n    '1005': ['FL', '3', 'ThreatROIExtents'],\r\n    '1006': ['OB', '1', 'ThreatROIBitmap'],\r\n    '1007': ['SH', '1', 'RouteSegmentID'],\r\n    '1008': ['CS', '1', 'GantryType'],\r\n    '1009': ['CS', '1', 'OOIOwnerType'],\r\n    '100A': ['SQ', '1', 'RouteSegmentSequence'],\r\n    '1010': ['US', '1', 'PotentialThreatObjectID'],\r\n    '1011': ['SQ', '1', 'ThreatSequence'],\r\n    '1012': ['CS', '1', 'ThreatCategory'],\r\n    '1013': ['LT', '1', 'ThreatCategoryDescription'],\r\n    '1014': ['CS', '1', 'ATDAbilityAssessment'],\r\n    '1015': ['CS', '1', 'ATDAssessmentFlag'],\r\n    '1016': ['FL', '1', 'ATDAssessmentProbability'],\r\n    '1017': ['FL', '1', 'Mass'],\r\n    '1018': ['FL', '1', 'Density'],\r\n    '1019': ['FL', '1', 'ZEffective'],\r\n    '101A': ['SH', '1', 'BoardingPassID'],\r\n    '101B': ['FL', '3', 'CenterOfMass'],\r\n    '101C': ['FL', '3', 'CenterOfPTO'],\r\n    '101D': ['FL', '6-n', 'BoundingPolygon'],\r\n    '101E': ['SH', '1', 'RouteSegmentStartLocationID'],\r\n    '101F': ['SH', '1', 'RouteSegmentEndLocationID'],\r\n    '1020': ['CS', '1', 'RouteSegmentLocationIDType'],\r\n    '1021': ['CS', '1-n', 'AbortReason'],\r\n    '1023': ['FL', '1', 'VolumeOfPTO'],\r\n    '1024': ['CS', '1', 'AbortFlag'],\r\n    '1025': ['DT', '1', 'RouteSegmentStartTime'],\r\n    '1026': ['DT', '1', 'RouteSegmentEndTime'],\r\n    '1027': ['CS', '1', 'TDRType'],\r\n    '1028': ['CS', '1', 'InternationalRouteSegment'],\r\n    '1029': ['LO', '1-n', 'ThreatDetectionAlgorithmAndVersion'],\r\n    '102A': ['SH', '1', 'AssignedLocation'],\r\n    '102B': ['DT', '1', 'AlarmDecisionTime'],\r\n    '1031': ['CS', '1', 'AlarmDecision'],\r\n    '1033': ['US', '1', 'NumberOfTotalObjects'],\r\n    '1034': ['US', '1', 'NumberOfAlarmObjects'],\r\n    '1037': ['SQ', '1', 'PTORepresentationSequence'],\r\n    '1038': ['SQ', '1', 'ATDAssessmentSequence'],\r\n    '1039': ['CS', '1', 'TIPType'],\r\n    '103A': ['CS', '1', 'DICOSVersion'],\r\n    '1041': ['DT', '1', 'OOIOwnerCreationTime'],\r\n    '1042': ['CS', '1', 'OOIType'],\r\n    '1043': ['FL', '3', 'OOISize'],\r\n    '1044': ['CS', '1', 'AcquisitionStatus'],\r\n    '1045': ['SQ', '1', 'BasisMaterialsCodeSequence'],\r\n    '1046': ['CS', '1', 'PhantomType'],\r\n    '1047': ['SQ', '1', 'OOIOwnerSequence'],\r\n    '1048': ['CS', '1', 'ScanType'],\r\n    '1051': ['LO', '1', 'ItineraryID'],\r\n    '1052': ['SH', '1', 'ItineraryIDType'],\r\n    '1053': ['LO', '1', 'ItineraryIDAssigningAuthority'],\r\n    '1054': ['SH', '1', 'RouteID'],\r\n    '1055': ['SH', '1', 'RouteIDAssigningAuthority'],\r\n    '1056': ['CS', '1', 'InboundArrivalType'],\r\n    '1058': ['SH', '1', 'CarrierID'],\r\n    '1059': ['CS', '1', 'CarrierIDAssigningAuthority'],\r\n    '1060': ['FL', '3', 'SourceOrientation'],\r\n    '1061': ['FL', '3', 'SourcePosition'],\r\n    '1062': ['FL', '1', 'BeltHeight'],\r\n    '1064': ['SQ', '1', 'AlgorithmRoutingCodeSequence'],\r\n    '1067': ['CS', '1', 'TransportClassification'],\r\n    '1068': ['LT', '1', 'OOITypeDescriptor'],\r\n    '1069': ['FL', '1', 'TotalProcessingTime'],\r\n    '106C': ['OB', '1', 'DetectorCalibrationData'],\r\n    '106D': ['CS', '1', 'AdditionalScreeningPerformed'],\r\n    '106E': ['CS', '1', 'AdditionalInspectionSelectionCriteria'],\r\n    '106F': ['SQ', '1', 'AdditionalInspectionMethodSequence'],\r\n    '1070': ['CS', '1', 'AITDeviceType'],\r\n    '1071': ['SQ', '1', 'QRMeasurementsSequence'],\r\n    '1072': ['SQ', '1', 'TargetMaterialSequence'],\r\n    '1073': ['FD', '1', 'SNRThreshold'],\r\n    '1075': ['DS', '1', 'ImageScaleRepresentation'],\r\n    '1076': ['SQ', '1', 'ReferencedPTOSequence'],\r\n    '1077': ['SQ', '1', 'ReferencedTDRInstanceSequence'],\r\n    '1078': ['ST', '1', 'PTOLocationDescription'],\r\n    '1079': ['SQ', '1', 'AnomalyLocatorIndicatorSequence'],\r\n    '107A': ['FL', '3', 'AnomalyLocatorIndicator'],\r\n    '107B': ['SQ', '1', 'PTORegionSequence'],\r\n    '107C': ['CS', '1', 'InspectionSelectionCriteria'],\r\n    '107D': ['SQ', '1', 'SecondaryInspectionMethodSequence'],\r\n    '107E': ['DS', '6', 'PRCSToRCSOrientation']\r\n  },\r\n  '4FFE': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['SQ', '1', 'MACParametersSequence']\r\n  },\r\n  '5000': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0005': ['US', '1', 'CurveDimensions'],\r\n    '0010': ['US', '1', 'NumberOfPoints'],\r\n    '0020': ['CS', '1', 'TypeOfData'],\r\n    '0022': ['LO', '1', 'CurveDescription'],\r\n    '0030': ['SH', '1-n', 'AxisUnits'],\r\n    '0040': ['SH', '1-n', 'AxisLabels'],\r\n    '0103': ['US', '1', 'DataValueRepresentation'],\r\n    '0104': ['US', '1-n', 'MinimumCoordinateValue'],\r\n    '0105': ['US', '1-n', 'MaximumCoordinateValue'],\r\n    '0106': ['SH', '1-n', 'CurveRange'],\r\n    '0110': ['US', '1-n', 'CurveDataDescriptor'],\r\n    '0112': ['US', '1-n', 'CoordinateStartValue'],\r\n    '0114': ['US', '1-n', 'CoordinateStepValue'],\r\n    '1001': ['CS', '1', 'CurveActivationLayer'],\r\n    '2000': ['US', '1', 'AudioType'],\r\n    '2002': ['US', '1', 'AudioSampleFormat'],\r\n    '2004': ['US', '1', 'NumberOfChannels'],\r\n    '2006': ['UL', '1', 'NumberOfSamples'],\r\n    '2008': ['UL', '1', 'SampleRate'],\r\n    '200A': ['UL', '1', 'TotalTime'],\r\n    '200C': ['ox', '1', 'AudioSampleData'],\r\n    '200E': ['LT', '1', 'AudioComments'],\r\n    '2500': ['LO', '1', 'CurveLabel'],\r\n    '2600': ['SQ', '1', 'CurveReferencedOverlaySequence'],\r\n    '2610': ['US', '1', 'CurveReferencedOverlayGroup'],\r\n    '3000': ['ox', '1', 'CurveData']\r\n  },\r\n  '5200': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '9229': ['SQ', '1', 'SharedFunctionalGroupsSequence'],\r\n    '9230': ['SQ', '1', 'PerFrameFunctionalGroupsSequence']\r\n  },\r\n  '5400': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0100': ['SQ', '1', 'WaveformSequence'],\r\n    '0110': ['ox', '1', 'ChannelMinimumValue'],\r\n    '0112': ['ox', '1', 'ChannelMaximumValue'],\r\n    '1004': ['US', '1', 'WaveformBitsAllocated'],\r\n    '1006': ['CS', '1', 'WaveformSampleInterpretation'],\r\n    '100A': ['ox', '1', 'WaveformPaddingValue'],\r\n    '1010': ['ox', '1', 'WaveformData']\r\n  },\r\n  '5600': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['OF', '1', 'FirstOrderPhaseCorrectionAngle'],\r\n    '0020': ['OF', '1', 'SpectroscopyData']\r\n  },\r\n  '6000': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['US', '1', 'OverlayRows'],\r\n    '0011': ['US', '1', 'OverlayColumns'],\r\n    '0012': ['US', '1', 'OverlayPlanes'],\r\n    '0015': ['IS', '1', 'NumberOfFramesInOverlay'],\r\n    '0022': ['LO', '1', 'OverlayDescription'],\r\n    '0040': ['CS', '1', 'OverlayType'],\r\n    '0045': ['LO', '1', 'OverlaySubtype'],\r\n    '0050': ['SS', '2', 'OverlayOrigin'],\r\n    '0051': ['US', '1', 'ImageFrameOrigin'],\r\n    '0052': ['US', '1', 'OverlayPlaneOrigin'],\r\n    '0060': ['CS', '1', 'OverlayCompressionCode'],\r\n    '0061': ['SH', '1', 'OverlayCompressionOriginator'],\r\n    '0062': ['SH', '1', 'OverlayCompressionLabel'],\r\n    '0063': ['CS', '1', 'OverlayCompressionDescription'],\r\n    '0066': ['AT', '1-n', 'OverlayCompressionStepPointers'],\r\n    '0068': ['US', '1', 'OverlayRepeatInterval'],\r\n    '0069': ['US', '1', 'OverlayBitsGrouped'],\r\n    '0100': ['US', '1', 'OverlayBitsAllocated'],\r\n    '0102': ['US', '1', 'OverlayBitPosition'],\r\n    '0110': ['CS', '1', 'OverlayFormat'],\r\n    '0200': ['US', '1', 'OverlayLocation'],\r\n    '0800': ['CS', '1-n', 'OverlayCodeLabel'],\r\n    '0802': ['US', '1', 'OverlayNumberOfTables'],\r\n    '0803': ['AT', '1-n', 'OverlayCodeTableLocation'],\r\n    '0804': ['US', '1', 'OverlayBitsForCodeWord'],\r\n    '1001': ['CS', '1', 'OverlayActivationLayer'],\r\n    '1100': ['US', '1', 'OverlayDescriptorGray'],\r\n    '1101': ['US', '1', 'OverlayDescriptorRed'],\r\n    '1102': ['US', '1', 'OverlayDescriptorGreen'],\r\n    '1103': ['US', '1', 'OverlayDescriptorBlue'],\r\n    '1200': ['US', '1-n', 'OverlaysGray'],\r\n    '1201': ['US', '1-n', 'OverlaysRed'],\r\n    '1202': ['US', '1-n', 'OverlaysGreen'],\r\n    '1203': ['US', '1-n', 'OverlaysBlue'],\r\n    '1301': ['IS', '1', 'ROIArea'],\r\n    '1302': ['DS', '1', 'ROIMean'],\r\n    '1303': ['DS', '1', 'ROIStandardDeviation'],\r\n    '1500': ['LO', '1', 'OverlayLabel'],\r\n    '3000': ['ox', '1', 'OverlayData'],\r\n    '4000': ['LT', '1', 'OverlayComments']\r\n  },\r\n  '7F00': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0010': ['ox', '1', 'VariablePixelData'],\r\n    '0011': ['US', '1', 'VariableNextDataGroup'],\r\n    '0020': ['OW', '1', 'VariableCoefficientsSDVN'],\r\n    '0030': ['OW', '1', 'VariableCoefficientsSDHN'],\r\n    '0040': ['OW', '1', 'VariableCoefficientsSDDN']\r\n  },\r\n  '7FE0': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    '0001': ['OV', '1', 'ExtendedOffsetTable'],\r\n    '0002': ['OV', '1', 'ExtendedOffsetTableLengths'],\r\n    '0008': ['OF', '1', 'FloatPixelData'],\r\n    '0009': ['OD', '1', 'DoubleFloatPixelData'],\r\n    '0010': ['ox', '1', 'PixelData'],\r\n    '0020': ['OW', '1', 'CoefficientsSDVN'],\r\n    '0030': ['OW', '1', 'CoefficientsSDHN'],\r\n    '0040': ['OW', '1', 'CoefficientsSDDN']\r\n  },\r\n  'FFFA': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    'FFFA': ['SQ', '1', 'DigitalSignaturesSequence']\r\n  },\r\n  'FFFC': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    'FFFC': ['OB', '1', 'DataSetTrailingPadding']\r\n  },\r\n  'FFFE': {\r\n    '0000': ['UL', '1', 'GenericGroupLength'],\r\n    'E000': ['NONE', '1', 'Item'],\r\n    'E00D': ['NONE', '1', 'ItemDelimitationItem'],\r\n    'E0DD': ['NONE', '1', 'SequenceDelimitationItem']\r\n  }\r\n}; // Dictionary\r\n\r\n/**\r\n * Add tags to the dictionary.\r\n *\r\n * @param {string} group The group key.\r\n * @param {object} tags The tags to add.\r\n */\r\nexport function addTagsToDictionary(group, tags) {\r\n  // TODO: add checks!\r\n  dictionary[group] = tags;\r\n}\r\n\r\n// taken from gdcm-2.6.1\\Source\\DataDictionary\\GroupName.dic\r\n// -> removed duplicates (commented)\r\nexport const tagGroups = {\r\n  '0000': 'Command',\r\n  '0002': 'Meta Element',\r\n  '0004': 'File Set',\r\n  //'0004': 'Directory',\r\n  '0008': 'Identifying',\r\n  '0009': 'SPI Identifying',\r\n  '0010': 'Patient',\r\n  '0012': 'Clinical Trial',\r\n  '0018': 'Acquisition',\r\n  '0019': 'SPI Acquisition',\r\n  '0020': 'Image',\r\n  '0021': 'SPI Image',\r\n  '0022': 'Ophtalmology',\r\n  '0028': 'Image Presentation',\r\n  '0032': 'Study',\r\n  '0038': 'Visit',\r\n  '003A': 'Waveform',\r\n  '0040': 'Procedure',\r\n  //'0040': ''Modality Worklist',\r\n  '0042': 'Encapsulated Document',\r\n  '0050': 'Device Informations',\r\n  //'0050': 'XRay Angio Device',\r\n  '0054': 'Nuclear Medicine',\r\n  '0060': 'Histogram',\r\n  '0070': 'Presentation State',\r\n  '0072': 'Hanging Protocol',\r\n  '0088': 'Storage',\r\n  //'0088': 'Medicine',\r\n  '0100': 'Authorization',\r\n  '0400': 'Digital Signature',\r\n  '1000': 'Code Table',\r\n  '1010': 'Zonal Map',\r\n  '2000': 'Film Session',\r\n  '2010': 'Film Box',\r\n  '2020': 'Image Box',\r\n  '2030': 'Annotation',\r\n  '2040': 'Overlay Box',\r\n  '2050': 'Presentation LUT',\r\n  '2100': 'Print Job',\r\n  '2110': 'Printer',\r\n  '2120': 'Queue',\r\n  '2130': 'Print Content',\r\n  '2200': 'Media Creation',\r\n  '3002': 'RT Image',\r\n  '3004': 'RT Dose',\r\n  '3006': 'RT StructureSet',\r\n  '3008': 'RT Treatment',\r\n  '300A': 'RT Plan',\r\n  '300C': 'RT Relationship',\r\n  '300E': 'RT Approval',\r\n  '4000': 'Text',\r\n  '4008': 'Results',\r\n  '4FFE': 'MAC Parameters',\r\n  '5000': 'Curve',\r\n  '5002': 'Curve',\r\n  '5004': 'Curve',\r\n  '5006': 'Curve',\r\n  '5008': 'Curve',\r\n  '500A': 'Curve',\r\n  '500C': 'Curve',\r\n  '500E': 'Curve',\r\n  '5400': 'Waveform Data',\r\n  '6000': 'Overlays',\r\n  '6002': 'Overlays',\r\n  '6004': 'Overlays',\r\n  '6008': 'Overlays',\r\n  '600A': 'Overlays',\r\n  '600C': 'Overlays',\r\n  '600E': 'Overlays',\r\n  'FFFC': 'Generic',\r\n  '7FE0': 'Pixel Data',\r\n  'FFFF': 'Unknown'\r\n};\r\n\r\n// Value Representation (VR) with 32bit Value Length (VL)\r\n// Added locally used 'ox'\r\n// see http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/chapter_7.html#table_7.1-1\r\nconst vr32bitVL = {\r\n  OB: true,\r\n  OD: true,\r\n  OF: true,\r\n  OL: true,\r\n  OV: true,\r\n  OW: true,\r\n  SQ: true,\r\n  SV: true,\r\n  UC: true,\r\n  UN: true,\r\n  UR: true,\r\n  UT: true,\r\n  UV: true,\r\n  ox: true\r\n};\r\n\r\n/**\r\n * Does the input Value Representation (VR) have a 32bit Value Length (VL).\r\n *\r\n * @param {string} vr The data Value Representation (VR).\r\n * @returns {boolean} True if this VR has a 32-bit VL.\r\n */\r\nexport function is32bitVLVR(vr) {\r\n  return typeof vr32bitVL[vr] !== 'undefined';\r\n}\r\n\r\n// String VR with extended or replaced default character repertoire defined in\r\n// Specific Character Set (0008,0005)\r\n// see https://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/chapter_6.html#sect_6.1.2.2\r\nconst vrCharSetString = {\r\n  SH: true,\r\n  LO: true,\r\n  UC: true,\r\n  ST: true,\r\n  LT: true,\r\n  UT: true,\r\n  PN: true\r\n};\r\n\r\n/**\r\n * Does the input Value Representation (VR) have an special character repertoire.\r\n *\r\n * @param {string} vr The data VR.\r\n * @returns {boolean} True if this VR has a special char set.\r\n */\r\nexport function isCharSetStringVR(vr) {\r\n  return typeof vrCharSetString[vr] !== 'undefined';\r\n}\r\n\r\n// VR types\r\n// see https://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/sect_6.2.html#table_6.2-1\r\nexport const vrTypes = {\r\n  AE: 'string',\r\n  AS: 'string',\r\n  AT: undefined,\r\n  CS: 'string',\r\n  DA: 'string',\r\n  DS: 'string',\r\n  DT: 'string',\r\n  FL: 'Float32',\r\n  FD: 'Float64',\r\n  IS: 'string',\r\n  LO: 'string',\r\n  LT: 'string',\r\n  OB: 'Uint8',\r\n  OD: 'Uint64',\r\n  OF: 'Uint32',\r\n  OL: 'Uint32',\r\n  OV: 'Uint64',\r\n  OW: 'Uint16',\r\n  PN: 'string',\r\n  SH: 'string',\r\n  SL: 'Int32',\r\n  SQ: undefined,\r\n  SS: 'Int16',\r\n  ST: 'string',\r\n  SV: 'Int64',\r\n  TM: 'string',\r\n  UC: 'string',\r\n  UI: 'string',\r\n  UL: 'Uint32',\r\n  UN: 'Uint8',\r\n  UR: 'string',\r\n  US: 'Uint16',\r\n  UT: 'string',\r\n  UV: 'Uint64'\r\n};\r\n","import {\r\n  dictionary,\r\n  tagGroups\r\n} from './dictionary';\r\n\r\n/**\r\n * Immutable tag.\r\n */\r\nexport class Tag {\r\n\r\n  /**\r\n   * The tag group.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #group;\r\n\r\n  /**\r\n   * The tag element.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #element;\r\n\r\n  /**\r\n   * @param {string} group The tag group as '####'.\r\n   * @param {string} element The tag element as '####'.\r\n   */\r\n  constructor(group, element) {\r\n    if (!group || typeof group === 'undefined') {\r\n      throw new Error('Cannot create tag with no group.');\r\n    }\r\n    if (group.length !== 4) {\r\n      throw new Error('Cannot create tag with badly sized group: ' + group);\r\n    }\r\n    if (!element || typeof element === 'undefined') {\r\n      throw new Error('Cannot create tag with no element.');\r\n    }\r\n    if (element.length !== 4) {\r\n      throw new Error('Cannot create tag with badly sized element: ' + element);\r\n    }\r\n    this.#group = group;\r\n    this.#element = element;\r\n  }\r\n\r\n  /**\r\n   * Get the tag group.\r\n   *\r\n   * @returns {string} The tag group.\r\n   */\r\n  getGroup() {\r\n    return this.#group;\r\n  }\r\n\r\n  /**\r\n   * Get the tag element.\r\n   *\r\n   * @returns {string} The tag element.\r\n   */\r\n  getElement() {\r\n    return this.#element;\r\n  }\r\n\r\n  /**\r\n   * Get as string representation of the tag: 'key: name'.\r\n   *\r\n   * @returns {string} A string representing the tag.\r\n   */\r\n  toString() {\r\n    return this.getKey() + ': ' + this.getNameFromDictionary();\r\n  }\r\n\r\n  /**\r\n   * Check for Tag equality.\r\n   *\r\n   * @param {Tag} rhs The other tag to compare to.\r\n   * @returns {boolean} True if both tags are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      typeof rhs !== 'undefined' &&\r\n      this.#group === rhs.getGroup() &&\r\n      this.#element === rhs.getElement();\r\n  }\r\n\r\n  /**\r\n   * Get the group-element key used to store DICOM elements.\r\n   *\r\n   * @returns {string} The key as '########'.\r\n   */\r\n  getKey() {\r\n    return this.#group + this.#element;\r\n  }\r\n\r\n  /**\r\n   * Get the group name as defined in TagGroups.\r\n   *\r\n   * @returns {string} The name.\r\n   */\r\n  getGroupName() {\r\n    return tagGroups[this.#group];\r\n  }\r\n\r\n  /**\r\n   * Does this tag have a VR.\r\n   * Basically not the Item, ItemDelimitationItem nor\r\n   *  SequenceDelimitationItem tags.\r\n   *\r\n   * @returns {boolean} True if this tag has a VR.\r\n   */\r\n  isWithVR() {\r\n    return !(this.#group === 'FFFE' &&\r\n      (this.#element === 'E000' ||\r\n      this.#element === 'E00D' ||\r\n      this.#element === 'E0DD')\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Is the tag group a private tag group ?\r\n   * see: http://dicom.nema.org/medical/dicom/2015a/output/html/part05.html#sect_7.8\r\n   *\r\n   * @returns {boolean} True if the tag group is private,\r\n   *   ie if its group is an odd number.\r\n   */\r\n  isPrivate() {\r\n    return parseInt(this.#group, 16) % 2 === 1;\r\n  }\r\n\r\n  /**\r\n   * Get the tag info from the dicom dictionary.\r\n   *\r\n   * @returns {Array|undefined} The info as [vr, multiplicity, name].\r\n   */\r\n  getInfoFromDictionary() {\r\n    let info;\r\n    if (typeof dictionary[this.#group] !== 'undefined' &&\r\n      typeof dictionary[this.#group][this.#element] !==\r\n        'undefined') {\r\n      info = dictionary[this.#group][this.#element];\r\n    }\r\n    return info;\r\n  }\r\n\r\n  /**\r\n   * Get the tag Value Representation (VR) from the dicom dictionary.\r\n   *\r\n   * @returns {string|undefined} The VR.\r\n   */\r\n  getVrFromDictionary() {\r\n    let vr;\r\n    const info = this.getInfoFromDictionary();\r\n    if (typeof info !== 'undefined') {\r\n      vr = info[0];\r\n    }\r\n    return vr;\r\n  }\r\n\r\n  /**\r\n   * Get the tag name from the dicom dictionary.\r\n   *\r\n   * @returns {string|undefined} The VR.\r\n   */\r\n  getNameFromDictionary() {\r\n    let name;\r\n    const info = this.getInfoFromDictionary();\r\n    if (typeof info !== 'undefined') {\r\n      name = info[2];\r\n    }\r\n    return name;\r\n  }\r\n\r\n} // Tag class\r\n\r\n/**\r\n * Tag compare function.\r\n *\r\n * @param {Tag} a The first tag.\r\n * @param {Tag} b The second tag.\r\n * @returns {number} The result of the tag comparison,\r\n *   positive for b before a, negative for a before b and\r\n *   zero to keep same order.\r\n */\r\nexport function tagCompareFunction(a, b) {\r\n  // first by group\r\n  let res = parseInt(a.getGroup(), 16) - parseInt(b.getGroup(), 16);\r\n  if (res === 0) {\r\n    // by element if same group\r\n    res = parseInt(a.getElement(), 16) - parseInt(b.getElement(), 16);\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Split a group-element key used to store DICOM elements.\r\n *\r\n * @param {string} key The key in form \"00280102\" as generated by tag::getKey.\r\n * @returns {Tag} The DICOM tag.\r\n */\r\nexport function getTagFromKey(key) {\r\n  if (!key || typeof key === 'undefined') {\r\n    throw new Error('Cannot create tag with no key.');\r\n  }\r\n  if (key.length !== 8) {\r\n    throw new Error('Cannot create tag with badly sized key: ' + key);\r\n  }\r\n  return new Tag(key.substring(0, 4), key.substring(4, 8));\r\n}\r\n\r\n/**\r\n * Get the TransferSyntaxUID Tag.\r\n *\r\n * @returns {Tag} The tag.\r\n */\r\nexport function getTransferSyntaxUIDTag() {\r\n  return new Tag('0002', '0010');\r\n}\r\n\r\n/**\r\n * Get the FileMetaInformationGroupLength Tag.\r\n *\r\n * @returns {Tag} The tag.\r\n */\r\nexport function getFileMetaInformationGroupLengthTag() {\r\n  return new Tag('0002', '0000');\r\n}\r\n\r\n/**\r\n * Is the input tag the FileMetaInformationGroupLength Tag.\r\n *\r\n * @param {Tag} tag The tag to test.\r\n * @returns {boolean} True if the asked tag.\r\n */\r\nexport function isFileMetaInformationGroupLengthTag(tag) {\r\n  return tag.equals(getFileMetaInformationGroupLengthTag());\r\n}\r\n\r\n/**\r\n * Get the Item Tag.\r\n *\r\n * @returns {Tag} The tag.\r\n */\r\nexport function getItemTag() {\r\n  return new Tag('FFFE', 'E000');\r\n}\r\n\r\n/**\r\n * Is the input tag the Item Tag.\r\n *\r\n * @param {Tag} tag The tag to test.\r\n * @returns {boolean} True if the asked tag.\r\n */\r\nexport function isItemTag(tag) {\r\n  // faster than tag.equals(getItemTag());\r\n  return tag.getKey() === 'FFFEE000';\r\n}\r\n\r\n/**\r\n * Get the ItemDelimitationItem Tag.\r\n *\r\n * @returns {Tag} The tag.\r\n */\r\nexport function getItemDelimitationItemTag() {\r\n  return new Tag('FFFE', 'E00D');\r\n}\r\n\r\n/**\r\n * Is the input tag the ItemDelimitationItem Tag.\r\n *\r\n * @param {Tag} tag The tag to test.\r\n * @returns {boolean} True if the asked tag.\r\n */\r\nexport function isItemDelimitationItemTag(tag) {\r\n  // faster than tag.equals(getItemDelimitationItemTag());\r\n  return tag.getKey() === 'FFFEE00D';\r\n}\r\n\r\n/**\r\n * Get the SequenceDelimitationItem Tag.\r\n *\r\n * @returns {Tag} The tag.\r\n */\r\nexport function getSequenceDelimitationItemTag() {\r\n  return new Tag('FFFE', 'E0DD');\r\n}\r\n\r\n/**\r\n * Is the input tag the SequenceDelimitationItem Tag.\r\n *\r\n * @param {Tag} tag The tag to test.\r\n * @returns {boolean} True if the asked tag.\r\n */\r\nexport function isSequenceDelimitationItemTag(tag) {\r\n  // faster than tag.equals(getSequenceDelimitationItemTag());\r\n  return tag.getKey() === 'FFFEE0DD';\r\n}\r\n\r\n/**\r\n * Get the PixelData Tag.\r\n *\r\n * @returns {Tag} The tag.\r\n */\r\nexport function getPixelDataTag() {\r\n  return new Tag('7FE0', '0010');\r\n}\r\n\r\n/**\r\n * Is the input tag the PixelData Tag.\r\n *\r\n * @param {Tag} tag The tag to test.\r\n * @returns {boolean} True if the asked tag.\r\n */\r\nexport function isPixelDataTag(tag) {\r\n  // faster than tag.equals(getPixelDataTag());\r\n  return tag.getKey() === '7FE00010';\r\n}\r\n\r\n/**\r\n * Get a tag from the dictionary using a tag string name.\r\n *\r\n * @param {string} tagName The tag string name.\r\n * @returns {Tag|undefined} The tag object or null if not found.\r\n */\r\nexport function getTagFromDictionary(tagName) {\r\n  if (typeof tagName === 'undefined' || tagName === null) {\r\n    return null;\r\n  }\r\n  let group = null;\r\n  let element = null;\r\n  const dict = dictionary;\r\n  const keys0 = Object.keys(dict);\r\n  let keys1 = null;\r\n  let foundTag = false;\r\n  // search through dictionary\r\n  for (let k0 = 0, lenK0 = keys0.length; k0 < lenK0; ++k0) {\r\n    group = keys0[k0];\r\n    keys1 = Object.keys(dict[group]);\r\n    for (let k1 = 0, lenK1 = keys1.length; k1 < lenK1; ++k1) {\r\n      element = keys1[k1];\r\n      if (dict[group][element][2] === tagName) {\r\n        foundTag = true;\r\n        break;\r\n      }\r\n    }\r\n    if (foundTag) {\r\n      break;\r\n    }\r\n  }\r\n  let tag;\r\n  if (foundTag) {\r\n    tag = new Tag(group, element);\r\n  }\r\n  return tag;\r\n}\r\n","/**\r\n * Is the Native endianness Little Endian.\r\n *\r\n * @returns {boolean} True if little endian.\r\n */\r\nexport function isNativeLittleEndian() {\r\n  return new Int8Array(new Int16Array([1]).buffer)[0] > 0;\r\n}\r\n\r\n/**\r\n * Flip an array's endianness.\r\n * Inspired from [DataStream.js]{@link https://github.com/kig/DataStream.js}.\r\n *\r\n * @param {object} array The array to flip (modified).\r\n */\r\nfunction flipArrayEndianness(array) {\r\n  const blen = array.byteLength;\r\n  const u8 = new Uint8Array(array.buffer, array.byteOffset, blen);\r\n  const bpe = array.BYTES_PER_ELEMENT;\r\n  let tmp;\r\n  for (let i = 0; i < blen; i += bpe) {\r\n    for (let j = i + bpe - 1, k = i; j > k; j--, k++) {\r\n      tmp = u8[k];\r\n      u8[k] = u8[j];\r\n      u8[j] = tmp;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Data reader.\r\n */\r\nexport class DataReader {\r\n\r\n  /**\r\n   * The input buffer.\r\n   *\r\n   * @type {ArrayBuffer}\r\n   */\r\n  #buffer;\r\n\r\n  /**\r\n   * Is the endianness Little Endian.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isLittleEndian = true;\r\n\r\n  /**\r\n   * Is the Native endianness Little Endian.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isNativeLittleEndian = isNativeLittleEndian();\r\n\r\n  /**\r\n   * Flag to know if the TypedArray data needs flipping.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #needFlip;\r\n\r\n  /**\r\n   * The main data view.\r\n   *\r\n   * @type {DataView}\r\n   */\r\n  #view;\r\n\r\n  /**\r\n   * @param {ArrayBuffer} buffer The input array buffer.\r\n   * @param {boolean} [isLittleEndian] Flag to tell if the data is little\r\n   *   or big endian (default: true).\r\n   */\r\n  constructor(buffer, isLittleEndian) {\r\n    this.#buffer = buffer;\r\n    // Set endian flag if not defined.\r\n    if (typeof isLittleEndian !== 'undefined') {\r\n      this.#isLittleEndian = isLittleEndian;\r\n    }\r\n    this.#needFlip = (this.#isLittleEndian !== this.#isNativeLittleEndian);\r\n    this.#view = new DataView(buffer);\r\n  }\r\n\r\n  /**\r\n   * Read Uint16 (2 bytes) data.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @returns {number} The read data.\r\n   */\r\n  readUint16(byteOffset) {\r\n    return this.#view.getUint16(byteOffset, this.#isLittleEndian);\r\n  }\r\n\r\n  /**\r\n   * Read Int16 (2 bytes) data.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @returns {number} The read data.\r\n   */\r\n  readInt16(byteOffset) {\r\n    return this.#view.getInt16(byteOffset, this.#isLittleEndian);\r\n  }\r\n\r\n  /**\r\n   * Read Uint32 (4 bytes) data.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @returns {number} The read data.\r\n   */\r\n  readUint32(byteOffset) {\r\n    return this.#view.getUint32(byteOffset, this.#isLittleEndian);\r\n  }\r\n\r\n  /**\r\n   * Read BigUint64 (8 bytes) data.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @returns {bigint} The read data.\r\n   */\r\n  readBigUint64(byteOffset) {\r\n    return this.#view.getBigUint64(byteOffset, this.#isLittleEndian);\r\n  }\r\n\r\n  /**\r\n   * Read Int32 (4 bytes) data.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @returns {number} The read data.\r\n   */\r\n  readInt32(byteOffset) {\r\n    return this.#view.getInt32(byteOffset, this.#isLittleEndian);\r\n  }\r\n\r\n  /**\r\n   * Read BigInt64 (8 bytes) data.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @returns {bigint} The read data.\r\n   */\r\n  readBigInt64(byteOffset) {\r\n    return this.#view.getBigInt64(byteOffset, this.#isLittleEndian);\r\n  }\r\n\r\n  /**\r\n   * Read Float32 (4 bytes) data.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @returns {number} The read data.\r\n   */\r\n  readFloat32(byteOffset) {\r\n    return this.#view.getFloat32(byteOffset, this.#isLittleEndian);\r\n  }\r\n\r\n  /**\r\n   * Read Float64 (8 bytes) data.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @returns {number} The read data.\r\n   */\r\n  readFloat64(byteOffset) {\r\n    return this.#view.getFloat64(byteOffset, this.#isLittleEndian);\r\n  }\r\n\r\n  /**\r\n   * Read binary (0/1) array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {Uint8Array} The read data.\r\n   */\r\n  readBinaryArray(byteOffset, size) {\r\n    // input\r\n    const bitArray = new Uint8Array(this.#buffer, byteOffset, size);\r\n    // result\r\n    const byteArrayLength = 8 * bitArray.length;\r\n    const data = new Uint8Array(byteArrayLength);\r\n    let bitNumber = 0;\r\n    let bitIndex = 0;\r\n    for (let i = 0; i < byteArrayLength; ++i) {\r\n      bitNumber = i % 8;\r\n      bitIndex = Math.floor(i / 8);\r\n      // see https://stackoverflow.com/questions/4854207/get-a-specific-bit-from-byte/4854257\r\n      // @ts-ignore\r\n      data[i] = 255 * ((bitArray[bitIndex] & (1 << bitNumber)) !== 0);\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read Uint8 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {Uint8Array} The read data.\r\n   */\r\n  readUint8Array(byteOffset, size) {\r\n    return new Uint8Array(this.#buffer, byteOffset, size);\r\n  }\r\n\r\n  /**\r\n   * Read Int8 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {Int8Array} The read data.\r\n   */\r\n  readInt8Array(byteOffset, size) {\r\n    return new Int8Array(this.#buffer, byteOffset, size);\r\n  }\r\n\r\n  /**\r\n   * Read Uint16 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {Uint16Array} The read data.\r\n   */\r\n  readUint16Array(byteOffset, size) {\r\n    const bpe = Uint16Array.BYTES_PER_ELEMENT;\r\n    const arraySize = size / bpe;\r\n    let data = null;\r\n    // byteOffset should be a multiple of Uint16Array.BYTES_PER_ELEMENT (=2)\r\n    if (byteOffset % bpe === 0) {\r\n      data = new Uint16Array(this.#buffer, byteOffset, arraySize);\r\n      if (this.#needFlip) {\r\n        flipArrayEndianness(data);\r\n      }\r\n    } else {\r\n      data = new Uint16Array(arraySize);\r\n      let index = byteOffset;\r\n      for (let i = 0; i < arraySize; ++i) {\r\n        data[i] = this.readUint16(index);\r\n        index += bpe;\r\n      }\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read Int16 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {Int16Array} The read data.\r\n   */\r\n  readInt16Array(byteOffset, size) {\r\n    const bpe = Int16Array.BYTES_PER_ELEMENT;\r\n    const arraySize = size / bpe;\r\n    let data = null;\r\n    // byteOffset should be a multiple of Int16Array.BYTES_PER_ELEMENT (=2)\r\n    if (byteOffset % bpe === 0) {\r\n      data = new Int16Array(this.#buffer, byteOffset, arraySize);\r\n      if (this.#needFlip) {\r\n        flipArrayEndianness(data);\r\n      }\r\n    } else {\r\n      data = new Int16Array(arraySize);\r\n      let index = byteOffset;\r\n      for (let i = 0; i < arraySize; ++i) {\r\n        data[i] = this.readInt16(index);\r\n        index += bpe;\r\n      }\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read Uint32 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {Uint32Array} The read data.\r\n   */\r\n  readUint32Array(byteOffset, size) {\r\n    const bpe = Uint32Array.BYTES_PER_ELEMENT;\r\n    const arraySize = size / bpe;\r\n    let data = null;\r\n    // byteOffset should be a multiple of Uint32Array.BYTES_PER_ELEMENT (=4)\r\n    if (byteOffset % bpe === 0) {\r\n      data = new Uint32Array(this.#buffer, byteOffset, arraySize);\r\n      if (this.#needFlip) {\r\n        flipArrayEndianness(data);\r\n      }\r\n    } else {\r\n      data = new Uint32Array(arraySize);\r\n      let index = byteOffset;\r\n      for (let i = 0; i < arraySize; ++i) {\r\n        data[i] = this.readUint32(index);\r\n        index += bpe;\r\n      }\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read Uint64 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {BigUint64Array} The read data.\r\n   */\r\n  readUint64Array(byteOffset, size) {\r\n    const bpe = BigUint64Array.BYTES_PER_ELEMENT;\r\n    const arraySize = size / bpe;\r\n    let data = null;\r\n    // byteOffset should be a multiple of BigUint64Array.BYTES_PER_ELEMENT (=8)\r\n    if (byteOffset % bpe === 0) {\r\n      data = new BigUint64Array(this.#buffer, byteOffset, arraySize);\r\n      if (this.#needFlip) {\r\n        flipArrayEndianness(data);\r\n      }\r\n    } else {\r\n      data = new BigUint64Array(arraySize);\r\n      let index = byteOffset;\r\n      for (let i = 0; i < arraySize; ++i) {\r\n        data[i] = this.readBigUint64(index);\r\n        index += bpe;\r\n      }\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read Int32 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {Int32Array} The read data.\r\n   */\r\n  readInt32Array(byteOffset, size) {\r\n    const bpe = Int32Array.BYTES_PER_ELEMENT;\r\n    const arraySize = size / bpe;\r\n    let data = null;\r\n    // byteOffset should be a multiple of Int32Array.BYTES_PER_ELEMENT (=4)\r\n    if (byteOffset % bpe === 0) {\r\n      data = new Int32Array(this.#buffer, byteOffset, arraySize);\r\n      if (this.#needFlip) {\r\n        flipArrayEndianness(data);\r\n      }\r\n    } else {\r\n      data = new Int32Array(arraySize);\r\n      let index = byteOffset;\r\n      for (let i = 0; i < arraySize; ++i) {\r\n        data[i] = this.readInt32(index);\r\n        index += bpe;\r\n      }\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read Int64 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {BigInt64Array} The read data.\r\n   */\r\n  readInt64Array(byteOffset, size) {\r\n    const bpe = BigInt64Array.BYTES_PER_ELEMENT;\r\n    const arraySize = size / bpe;\r\n    let data = null;\r\n    // byteOffset should be a multiple of BigInt64Array.BYTES_PER_ELEMENT (=8)\r\n    if (byteOffset % bpe === 0) {\r\n      data = new BigInt64Array(this.#buffer, byteOffset, arraySize);\r\n      if (this.#needFlip) {\r\n        flipArrayEndianness(data);\r\n      }\r\n    } else {\r\n      data = new BigInt64Array(arraySize);\r\n      let index = byteOffset;\r\n      for (let i = 0; i < arraySize; ++i) {\r\n        data[i] = this.readBigInt64(index);\r\n        index += bpe;\r\n      }\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read Float32 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {Float32Array} The read data.\r\n   */\r\n  readFloat32Array(byteOffset, size) {\r\n    const bpe = Float32Array.BYTES_PER_ELEMENT;\r\n    const arraySize = size / bpe;\r\n    let data = null;\r\n    // byteOffset should be a multiple of Float32Array.BYTES_PER_ELEMENT (=4)\r\n    if (byteOffset % bpe === 0) {\r\n      data = new Float32Array(this.#buffer, byteOffset, arraySize);\r\n      if (this.#needFlip) {\r\n        flipArrayEndianness(data);\r\n      }\r\n    } else {\r\n      data = new Float32Array(arraySize);\r\n      let index = byteOffset;\r\n      for (let i = 0; i < arraySize; ++i) {\r\n        data[i] = this.readFloat32(index);\r\n        index += bpe;\r\n      }\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read Float64 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @param {number} size The size of the array.\r\n   * @returns {Float64Array} The read data.\r\n   */\r\n  readFloat64Array(byteOffset, size) {\r\n    const bpe = Float64Array.BYTES_PER_ELEMENT;\r\n    const arraySize = size / bpe;\r\n    let data = null;\r\n    // byteOffset should be a multiple of Float64Array.BYTES_PER_ELEMENT (=8)\r\n    if (byteOffset % bpe === 0) {\r\n      data = new Float64Array(this.#buffer, byteOffset, arraySize);\r\n      if (this.#needFlip) {\r\n        flipArrayEndianness(data);\r\n      }\r\n    } else {\r\n      data = new Float64Array(arraySize);\r\n      let index = byteOffset;\r\n      for (let i = 0; i < arraySize; ++i) {\r\n        data[i] = this.readFloat64(index);\r\n        index += bpe;\r\n      }\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read data as an hexadecimal string of length 4 (no '0x' prefix).\r\n   *\r\n   * @param {number} byteOffset The offset to start reading from.\r\n   * @returns {string} The read data ('####').\r\n   */\r\n  readHex(byteOffset) {\r\n    // read and convert to hex string\r\n    const str = this.readUint16(byteOffset).toString(16);\r\n    // return padded\r\n    return '0000'.substring(0, 4 - str.length) + str.toUpperCase();\r\n  }\r\n\r\n} // class DataReader\r\n","// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Tag} from './dicomTag';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * DICOM data element.\r\n */\r\nexport class DataElement {\r\n  /**\r\n   * The element Value Representation.\r\n   *\r\n   * @type {string}\r\n   */\r\n  vr;\r\n  /**\r\n   * The element value.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  value;\r\n\r\n  // [start] internal values\r\n  // only present during parsing or writing otherwise not set\r\n\r\n  /**\r\n   * The element dicom tag.\r\n   *\r\n   * @type {Tag}\r\n   */\r\n  tag;\r\n\r\n  /**\r\n   * The element Value Length.\r\n   *\r\n   * @type {number}\r\n   */\r\n  vl;\r\n\r\n  /**\r\n   * Flag to know if defined or undefined sequence length.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  undefinedLength;\r\n\r\n  /**\r\n   * The element start offset.\r\n   *\r\n   * @type {number}\r\n   */\r\n  startOffset;\r\n\r\n  /**\r\n   * The element end offset.\r\n   *\r\n   * @type {number}\r\n   */\r\n  endOffset;\r\n\r\n  /**\r\n   * The sequence items.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  items;\r\n\r\n  // [end] internal values\r\n\r\n  /**\r\n   * @param {string} vr The element VR (Value Representation).\r\n   */\r\n  constructor(vr) {\r\n    this.vr = vr;\r\n  }\r\n}","import {\r\n  Tag,\r\n  isSequenceDelimitationItemTag,\r\n  isItemDelimitationItemTag,\r\n  isPixelDataTag\r\n} from './dicomTag';\r\nimport {\r\n  is32bitVLVR,\r\n  isCharSetStringVR,\r\n  vrTypes,\r\n} from './dictionary';\r\nimport {DataReader} from './dataReader';\r\nimport {logger} from '../utils/logger';\r\nimport {arrayEquals} from '../utils/array';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {DataElement} from '../dicom/dataElement';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * List of DICOM data elements indexed via a 8 character string formed from\r\n * the group and element numbers.\r\n *\r\n * @typedef {Object<string, DataElement>} DataElements\r\n */\r\n\r\n/**\r\n * Get the version of the library.\r\n *\r\n * @returns {string} The version of the library.\r\n */\r\nexport function getDwvVersion() {\r\n  return '0.33.0-beta.16';\r\n}\r\n\r\n/**\r\n * Check that an input buffer includes the DICOM prefix 'DICM'\r\n * after the 128 bytes preamble.\r\n * Ref: [DICOM File Meta]{@link https://dicom.nema.org/dicom/2013/output/chtml/part10/chapter_7.html#sect_7.1}\r\n *\r\n * @param {ArrayBuffer} buffer The buffer to check.\r\n * @returns {boolean} True if the buffer includes the prefix.\r\n */\r\nexport function hasDicomPrefix(buffer) {\r\n  // check size: typed array constructor will throw RangeError if\r\n  // byteOffset + length * TypedArray.BYTES_PER_ELEMENT > buffer.byteLength\r\n  if (buffer.byteLength < 132) {\r\n    return false;\r\n  }\r\n  const prefixArray = new Uint8Array(buffer, 128, 4);\r\n  const stringReducer = function (previous, current) {\r\n    return previous += String.fromCharCode(current);\r\n  };\r\n  return prefixArray.reduce(stringReducer, '') === 'DICM';\r\n}\r\n\r\n// Zero-width space (u200B)\r\n// @ts-ignore\r\nconst ZWS = String.fromCharCode('u200B');\r\n\r\n/**\r\n * Clean string: remove zero-width space ending and trim.\r\n * Warning: no tests are done on the input, will fail if\r\n *   null or undefined or not string.\r\n * (exported for tests only)\r\n *\r\n * @param {string} inputStr The string to clean.\r\n * @returns {string} The cleaned string.\r\n */\r\nexport function cleanString(inputStr) {\r\n  let res = inputStr;\r\n  // get rid of ending zero-width space\r\n  const lastIndex = inputStr.length - 1;\r\n  if (inputStr[lastIndex] === ZWS) {\r\n    res = inputStr.substring(0, lastIndex);\r\n  }\r\n  // trim spaces\r\n  res = res.trim();\r\n  // return\r\n  return res;\r\n}\r\n\r\n/**\r\n * Get the utfLabel (used by the TextDecoder) from a character set term\r\n * References:\r\n * - DICOM [Value Encoding]{@link http://dicom.nema.org/dicom/2013/output/chtml/part05/chapter_6.html}\r\n * - DICOM [Specific Character Set]{@link http://dicom.nema.org/dicom/2013/output/chtml/part03/sect_C.12.html#sect_C.12.1.1.2}\r\n * - [TextDecoder#Parameters]{@link https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder/TextDecoder#Parameters}\r\n *\r\n * @param {string} charSetTerm The DICOM character set.\r\n * @returns {string} The corresponding UTF label.\r\n */\r\nfunction getUtfLabel(charSetTerm) {\r\n  let label = 'utf-8';\r\n  if (charSetTerm === 'ISO_IR 100') {\r\n    label = 'iso-8859-1';\r\n  } else if (charSetTerm === 'ISO_IR 101') {\r\n    label = 'iso-8859-2';\r\n  } else if (charSetTerm === 'ISO_IR 109') {\r\n    label = 'iso-8859-3';\r\n  } else if (charSetTerm === 'ISO_IR 110') {\r\n    label = 'iso-8859-4';\r\n  } else if (charSetTerm === 'ISO_IR 144') {\r\n    label = 'iso-8859-5';\r\n  } else if (charSetTerm === 'ISO_IR 127') {\r\n    label = 'iso-8859-6';\r\n  } else if (charSetTerm === 'ISO_IR 126') {\r\n    label = 'iso-8859-7';\r\n  } else if (charSetTerm === 'ISO_IR 138') {\r\n    label = 'iso-8859-8';\r\n  } else if (charSetTerm === 'ISO_IR 148') {\r\n    label = 'iso-8859-9';\r\n  } else if (charSetTerm === 'ISO_IR 13') {\r\n    label = 'shift-jis';\r\n  } else if (charSetTerm === 'ISO_IR 166') {\r\n    label = 'iso-8859-11';\r\n  } else if (charSetTerm === 'ISO 2022 IR 87') {\r\n    label = 'iso-2022-jp';\r\n  } else if (charSetTerm === 'ISO 2022 IR 149') {\r\n    // not supported by TextDecoder when it says it should...\r\n    //label = \"iso-2022-kr\";\r\n  } else if (charSetTerm === 'ISO 2022 IR 58') {\r\n    // not supported by TextDecoder...\r\n    //label = \"iso-2022-cn\";\r\n  } else if (charSetTerm === 'ISO_IR 192') {\r\n    label = 'utf-8';\r\n  } else if (charSetTerm === 'GB18030') {\r\n    label = 'gb18030';\r\n  } else if (charSetTerm === 'GB2312') {\r\n    label = 'gb2312';\r\n  } else if (charSetTerm === 'GBK') {\r\n    label = 'chinese';\r\n  }\r\n  return label;\r\n}\r\n\r\n/**\r\n * Default text decoder\r\n */\r\nclass DefaultTextDecoder {\r\n  /**\r\n   * Decode an input string buffer.\r\n   *\r\n   * @param {Uint8Array} buffer The buffer to decode.\r\n   * @returns {string} The decoded string.\r\n   */\r\n  decode(buffer) {\r\n    let result = '';\r\n    for (let i = 0, leni = buffer.length; i < leni; ++i) {\r\n      result += String.fromCharCode(buffer[i]);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * Get patient orientation label in the reverse direction.\r\n *\r\n * @param {string} ori Patient Orientation value.\r\n * @returns {string} Reverse Orientation Label.\r\n */\r\nexport function getReverseOrientation(ori) {\r\n  if (!ori) {\r\n    return null;\r\n  }\r\n  // reverse labels\r\n  const rlabels = {\r\n    L: 'R',\r\n    R: 'L',\r\n    A: 'P',\r\n    P: 'A',\r\n    H: 'F',\r\n    F: 'H'\r\n  };\r\n\r\n  let rori = '';\r\n  for (let n = 0; n < ori.length; n++) {\r\n    const o = ori.substring(n, n + 1);\r\n    const r = rlabels[o];\r\n    if (r) {\r\n      rori += r;\r\n    }\r\n  }\r\n  // return\r\n  return rori;\r\n}\r\n\r\n/**\r\n * Get the name of an image orientation patient.\r\n *\r\n * @param {Array} orientation The image orientation patient.\r\n * @returns {string} The orientation name: axial, coronal or sagittal.\r\n */\r\nexport function getOrientationName(orientation) {\r\n  const axialOrientation = [1, 0, 0, 0, 1, 0];\r\n  const coronalOrientation = [1, 0, 0, 0, 0, -1];\r\n  const sagittalOrientation = [0, 1, 0, 0, 0, -1];\r\n  let name;\r\n  if (arrayEquals(orientation, axialOrientation)) {\r\n    name = 'axial';\r\n  } else if (arrayEquals(orientation, coronalOrientation)) {\r\n    name = 'coronal';\r\n  } else if (arrayEquals(orientation, sagittalOrientation)) {\r\n    name = 'sagittal';\r\n  }\r\n  return name;\r\n}\r\n\r\n/**\r\n * Tell if a given syntax is an implicit one (element with no VR).\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {boolean} True if an implicit syntax.\r\n */\r\nexport function isImplicitTransferSyntax(syntax) {\r\n  return syntax === '1.2.840.10008.1.2';\r\n}\r\n\r\n/**\r\n * Tell if a given syntax is a big endian syntax.\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {boolean} True if a big endian syntax.\r\n */\r\nexport function isBigEndianTransferSyntax(syntax) {\r\n  return syntax === '1.2.840.10008.1.2.2';\r\n}\r\n\r\n/**\r\n * Tell if a given syntax is a JPEG baseline one.\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {boolean} True if a jpeg baseline syntax.\r\n */\r\nexport function isJpegBaselineTransferSyntax(syntax) {\r\n  return syntax === '1.2.840.10008.1.2.4.50' ||\r\n    syntax === '1.2.840.10008.1.2.4.51';\r\n}\r\n\r\n/**\r\n * Tell if a given syntax is a retired JPEG one.\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {boolean} True if a retired jpeg syntax.\r\n */\r\nfunction isJpegRetiredTransferSyntax(syntax) {\r\n  return (syntax.match(/1.2.840.10008.1.2.4.5/) !== null &&\r\n    !isJpegBaselineTransferSyntax(syntax) &&\r\n    !isJpegLosslessTransferSyntax(syntax)) ||\r\n    syntax.match(/1.2.840.10008.1.2.4.6/) !== null;\r\n}\r\n\r\n/**\r\n * Tell if a given syntax is a JPEG Lossless one.\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {boolean} True if a jpeg lossless syntax.\r\n */\r\nexport function isJpegLosslessTransferSyntax(syntax) {\r\n  return syntax === '1.2.840.10008.1.2.4.57' ||\r\n    syntax === '1.2.840.10008.1.2.4.70';\r\n}\r\n\r\n/**\r\n * Tell if a given syntax is a JPEG-LS one.\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {boolean} True if a jpeg-ls syntax.\r\n */\r\nfunction isJpeglsTransferSyntax(syntax) {\r\n  return syntax.match(/1.2.840.10008.1.2.4.8/) !== null;\r\n}\r\n\r\n/**\r\n * Tell if a given syntax is a JPEG 2000 one.\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {boolean} True if a jpeg 2000 syntax.\r\n */\r\nexport function isJpeg2000TransferSyntax(syntax) {\r\n  return syntax.match(/1.2.840.10008.1.2.4.9/) !== null;\r\n}\r\n\r\n/**\r\n * Tell if a given syntax is a RLE (Run-length encoding) one.\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {boolean} True if a RLE syntax.\r\n */\r\nfunction isRleTransferSyntax(syntax) {\r\n  return syntax.match(/1.2.840.10008.1.2.5/) !== null;\r\n}\r\n\r\n/**\r\n * Tell if a given syntax needs decompression.\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {string} The name of the decompression algorithm.\r\n */\r\nexport function getSyntaxDecompressionName(syntax) {\r\n  let algo = null;\r\n  if (isJpeg2000TransferSyntax(syntax)) {\r\n    algo = 'jpeg2000';\r\n  } else if (isJpegBaselineTransferSyntax(syntax)) {\r\n    algo = 'jpeg-baseline';\r\n  } else if (isJpegLosslessTransferSyntax(syntax)) {\r\n    algo = 'jpeg-lossless';\r\n  } else if (isRleTransferSyntax(syntax)) {\r\n    algo = 'rle';\r\n  }\r\n  return algo;\r\n}\r\n\r\n/**\r\n * Tell if a given syntax is supported for reading.\r\n *\r\n * @param {string} syntax The transfer syntax to test.\r\n * @returns {boolean} True if a supported syntax.\r\n */\r\nfunction isReadSupportedTransferSyntax(syntax) {\r\n\r\n  // Unsupported:\r\n  // \"1.2.840.10008.1.2.1.99\": Deflated Explicit VR - Little Endian\r\n  // \"1.2.840.10008.1.2.4.100\": MPEG2 Image Compression\r\n  // isJpegRetiredTransferSyntax(syntax): non supported JPEG\r\n  // isJpeglsTransferSyntax(syntax): JPEG-LS\r\n\r\n  return (syntax === '1.2.840.10008.1.2' || // Implicit VR - Little Endian\r\n    syntax === '1.2.840.10008.1.2.1' || // Explicit VR - Little Endian\r\n    syntax === '1.2.840.10008.1.2.2' || // Explicit VR - Big Endian\r\n    isJpegBaselineTransferSyntax(syntax) || // JPEG baseline\r\n    isJpegLosslessTransferSyntax(syntax) || // JPEG Lossless\r\n    isJpeg2000TransferSyntax(syntax) || // JPEG 2000\r\n    isRleTransferSyntax(syntax)); // RLE\r\n}\r\n\r\n/**\r\n * Get the transfer syntax name.\r\n * Reference: [UID Values]{@link http://dicom.nema.org/dicom/2013/output/chtml/part06/chapter_A.html}.\r\n *\r\n * @param {string} syntax The transfer syntax.\r\n * @returns {string} The name of the transfer syntax.\r\n */\r\nexport function getTransferSyntaxName(syntax) {\r\n  let name = 'Unknown';\r\n  if (syntax === '1.2.840.10008.1.2') {\r\n    // Implicit VR - Little Endian\r\n    name = 'Little Endian Implicit';\r\n  } else if (syntax === '1.2.840.10008.1.2.1') {\r\n    // Explicit VR - Little Endian\r\n    name = 'Little Endian Explicit';\r\n  } else if (syntax === '1.2.840.10008.1.2.1.99') {\r\n    // Deflated Explicit VR - Little Endian\r\n    name = 'Little Endian Deflated Explicit';\r\n  } else if (syntax === '1.2.840.10008.1.2.2') {\r\n    // Explicit VR - Big Endian\r\n    name = 'Big Endian Explicit';\r\n  } else if (isJpegBaselineTransferSyntax(syntax)) {\r\n    // JPEG baseline\r\n    if (syntax === '1.2.840.10008.1.2.4.50') {\r\n      name = 'JPEG Baseline';\r\n    } else { // *.51\r\n      name = 'JPEG Extended, Process 2+4';\r\n    }\r\n  } else if (isJpegLosslessTransferSyntax(syntax)) {\r\n    // JPEG Lossless\r\n    if (syntax === '1.2.840.10008.1.2.4.57') {\r\n      name = 'JPEG Lossless, Nonhierarchical (Processes 14)';\r\n    } else { // *.70\r\n      name = 'JPEG Lossless, Non-hierarchical, 1st Order Prediction';\r\n    }\r\n  } else if (isJpegRetiredTransferSyntax(syntax)) {\r\n    // Retired JPEG\r\n    name = 'Retired JPEG';\r\n  } else if (isJpeglsTransferSyntax(syntax)) {\r\n    // JPEG-LS\r\n    name = 'JPEG-LS';\r\n  } else if (isJpeg2000TransferSyntax(syntax)) {\r\n    // JPEG 2000\r\n    if (syntax === '1.2.840.10008.1.2.4.91') {\r\n      name = 'JPEG 2000 (Lossless or Lossy)';\r\n    } else { // *.90\r\n      name = 'JPEG 2000 (Lossless only)';\r\n    }\r\n  } else if (syntax === '1.2.840.10008.1.2.4.100') {\r\n    // MPEG2 Image Compression\r\n    name = 'MPEG2';\r\n  } else if (isRleTransferSyntax(syntax)) {\r\n    // RLE (lossless)\r\n    name = 'RLE';\r\n  }\r\n  // return\r\n  return name;\r\n}\r\n\r\n/**\r\n * Guess the transfer syntax from the first data element.\r\n * See https://github.com/ivmartel/dwv/issues/188\r\n *   (Allow to load DICOM with no DICM preamble) for more details.\r\n *\r\n * @param {DataElement} firstDataElement The first data element\r\n *   of the DICOM header.\r\n * @returns {DataElement} The transfer syntax data element.\r\n */\r\nfunction guessTransferSyntax(firstDataElement) {\r\n  const oEightGroupBigEndian = '0800';\r\n  const oEightGroupLittleEndian = '0008';\r\n  // check that group is 0008\r\n  const group = firstDataElement.tag.getGroup();\r\n  if (group !== oEightGroupBigEndian &&\r\n    group !== oEightGroupLittleEndian) {\r\n    throw new Error(\r\n      'Not a valid DICOM file (no magic DICM word found' +\r\n        ' and first element not in 0008 group)'\r\n    );\r\n  }\r\n  // reasonable assumption: 2 uppercase characters => explicit vr\r\n  const vr = firstDataElement.vr;\r\n  const vr0 = vr.charCodeAt(0);\r\n  const vr1 = vr.charCodeAt(1);\r\n  const implicit = (vr0 >= 65 && vr0 <= 90 && vr1 >= 65 && vr1 <= 90)\r\n    ? false : true;\r\n  // guess transfer syntax\r\n  let syntax = null;\r\n  if (group === oEightGroupLittleEndian) {\r\n    if (implicit) {\r\n      // ImplicitVRLittleEndian\r\n      syntax = '1.2.840.10008.1.2';\r\n    } else {\r\n      // ExplicitVRLittleEndian\r\n      syntax = '1.2.840.10008.1.2.1';\r\n    }\r\n  } else {\r\n    if (implicit) {\r\n      // ImplicitVRBigEndian: impossible\r\n      throw new Error(\r\n        'Not a valid DICOM file (no magic DICM word found' +\r\n        'and implicit VR big endian detected)'\r\n      );\r\n    } else {\r\n      // ExplicitVRBigEndian\r\n      syntax = '1.2.840.10008.1.2.2';\r\n    }\r\n  }\r\n  // set transfer syntax data element\r\n  const dataElement = new DataElement('UI');\r\n  dataElement.tag = new Tag('0002', '0010');\r\n  dataElement.value = [syntax];\r\n  dataElement.vl = dataElement.value[0].length;\r\n  dataElement.startOffset = firstDataElement.startOffset;\r\n  dataElement.endOffset = dataElement.startOffset + dataElement.vl;\r\n\r\n  return dataElement;\r\n}\r\n\r\n/**\r\n * Get the appropriate TypedArray in function of arguments.\r\n *\r\n * @param {number} bitsAllocated The number of bites used to store\r\n *   the data: [8, 16, 32].\r\n * @param {number} pixelRepresentation The pixel representation,\r\n *   0:unsigned;1:signed.\r\n * @param {number} size The size of the new array.\r\n * @returns {Uint8Array|Int8Array|Uint16Array|Int16Array|Uint32Array|Int32Array}\r\n *   The good typed array.\r\n */\r\nexport function getTypedArray(bitsAllocated, pixelRepresentation, size) {\r\n  let res = null;\r\n  try {\r\n    if (bitsAllocated === 8) {\r\n      if (pixelRepresentation === 0) {\r\n        res = new Uint8Array(size);\r\n      } else {\r\n        res = new Int8Array(size);\r\n      }\r\n    } else if (bitsAllocated === 16) {\r\n      if (pixelRepresentation === 0) {\r\n        res = new Uint16Array(size);\r\n      } else {\r\n        res = new Int16Array(size);\r\n      }\r\n    } else if (bitsAllocated === 32) {\r\n      if (pixelRepresentation === 0) {\r\n        res = new Uint32Array(size);\r\n      } else {\r\n        res = new Int32Array(size);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    if (error instanceof RangeError) {\r\n      const powerOf2 = Math.floor(Math.log(size) / Math.log(2));\r\n      logger.error('Cannot allocate array of size: ' +\r\n        size + ' (>2^' + powerOf2 + ').');\r\n    }\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Get the number of bytes occupied by a data element prefix,\r\n *   i.e. without its value.\r\n *\r\n * @param {string} vr The Value Representation of the element.\r\n * @param {boolean} isImplicit Does the data use implicit VR?\r\n * @returns {number} The size of the element prefix.\r\n * WARNING: this is valid for tags with a VR, if not sure use\r\n *   the 'isTagWithVR' function first.\r\n * Reference:\r\n * - [Data Element explicit]{@link http://dicom.nema.org/dicom/2013/output/chtml/part05/chapter_7.html#table_7.1-1},\r\n * - [Data Element implicit]{@link http://dicom.nema.org/dicom/2013/output/chtml/part05/sect_7.5.html#table_7.5-1}.\r\n *\r\n * | Tag | VR  | VL | Value |\r\n * | 4   | 2   | 2  | X     | -> regular explicit: 8 + X\r\n * | 4   | 2+2 | 4  | X     | -> 32bit VL: 12 + X\r\n *\r\n * | Tag | VL | Value |\r\n * | 4   | 4  | X     | -> implicit (32bit VL): 8 + X\r\n *\r\n * | Tag | Len | Value |\r\n * | 4   | 4   | X     | -> item: 8 + X\r\n */\r\nexport function getDataElementPrefixByteSize(vr, isImplicit) {\r\n  return isImplicit ? 8 : is32bitVLVR(vr) ? 12 : 8;\r\n}\r\n\r\n/**\r\n * Is the input VR a known VR.\r\n *\r\n * @param {string} vr The vr to test.\r\n * @returns {boolean} True if known.\r\n */\r\nfunction isKnownVR(vr) {\r\n  const extraVrTypes = ['NONE', 'ox', 'xx', 'xs'];\r\n  const knownTypes = Object.keys(vrTypes).concat(extraVrTypes);\r\n  return knownTypes.includes(vr);\r\n}\r\n\r\n/**\r\n * DicomParser class.\r\n *\r\n * @example\r\n * // XMLHttpRequest onload callback\r\n * const onload = function (event) {\r\n *   // setup the dicom parser\r\n *   const dicomParser = new dwv.DicomParser();\r\n *   // parse the buffer\r\n *   dicomParser.parse(event.target.response);\r\n *   // get the dicom tags\r\n *   const tags = dicomParser.getDicomElements();\r\n *   // display the modality\r\n *   const div = document.getElementById('dwv');\r\n *   div.appendChild(document.createTextNode(\r\n *     'Modality: ' + tags['00080060'].value[0]\r\n *   ));\r\n * };\r\n * // DICOM file request\r\n * const request = new XMLHttpRequest();\r\n * const url = 'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm';\r\n * request.open('GET', url);\r\n * request.responseType = 'arraybuffer';\r\n * request.onload = onload;\r\n * request.send();\r\n */\r\nexport class DicomParser {\r\n\r\n  /**\r\n   * The list of DICOM elements.\r\n   *\r\n   * @type {DataElements}\r\n   */\r\n  #dataElements = {};\r\n\r\n  /**\r\n   * Default character set (optional).\r\n   *\r\n   * @type {string}\r\n   */\r\n  #defaultCharacterSet;\r\n\r\n  /**\r\n   * Default text decoder.\r\n   *\r\n   * @type {DefaultTextDecoder}\r\n   */\r\n  #defaultTextDecoder = new DefaultTextDecoder();\r\n\r\n  /**\r\n   * Special text decoder.\r\n   *\r\n   * @type {DefaultTextDecoder|TextDecoder}\r\n   */\r\n  #textDecoder = this.#defaultTextDecoder;\r\n\r\n  /**\r\n   * Decode an input string buffer using the default text decoder.\r\n   *\r\n   * @param {Uint8Array} buffer The buffer to decode.\r\n   * @returns {string} The decoded string.\r\n   */\r\n  #decodeString(buffer) {\r\n    return this.#defaultTextDecoder.decode(buffer);\r\n  }\r\n\r\n  /**\r\n   * Decode an input string buffer using the 'special' text decoder.\r\n   *\r\n   * @param {Uint8Array} buffer The buffer to decode.\r\n   * @returns {string} The decoded string.\r\n   */\r\n  #decodeSpecialString(buffer) {\r\n    return this.#textDecoder.decode(buffer);\r\n  }\r\n\r\n  /**\r\n   * Get the default character set.\r\n   *\r\n   * @returns {string} The default character set.\r\n   */\r\n  getDefaultCharacterSet() {\r\n    return this.#defaultCharacterSet;\r\n  }\r\n\r\n  /**\r\n   * Set the default character set.\r\n   *\r\n   * @param {string} characterSet The input character set.\r\n   */\r\n  setDefaultCharacterSet(characterSet) {\r\n    this.#defaultCharacterSet = characterSet;\r\n  }\r\n\r\n  /**\r\n   * Set the text decoder character set.\r\n   *\r\n   * @param {string} characterSet The input character set.\r\n   */\r\n  setDecoderCharacterSet(characterSet) {\r\n    /**\r\n     * The text decoder.\r\n     *\r\n     * @external TextDecoder\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder\r\n     */\r\n    this.#textDecoder = new TextDecoder(characterSet);\r\n  }\r\n\r\n  // not using type DataElements since the typedef is not exported with the API\r\n\r\n  /**\r\n   * Get the DICOM data elements.\r\n   *\r\n   * @returns {Object<string, DataElement>} The data elements.\r\n   */\r\n  getDicomElements() {\r\n    return this.#dataElements;\r\n  }\r\n\r\n  /**\r\n   * Read a DICOM tag.\r\n   *\r\n   * @param {DataReader} reader The raw data reader.\r\n   * @param {number} offset The offset where to start to read.\r\n   * @returns {object} An object containing the tag and the end offset.\r\n   */\r\n  #readTag(reader, offset) {\r\n    // group\r\n    const group = reader.readHex(offset);\r\n    offset += Uint16Array.BYTES_PER_ELEMENT;\r\n    // element\r\n    const element = reader.readHex(offset);\r\n    offset += Uint16Array.BYTES_PER_ELEMENT;\r\n    // return\r\n    return {\r\n      tag: new Tag(group, element),\r\n      endOffset: offset\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Read an item data element.\r\n   *\r\n   * @param {DataReader} reader The raw data reader.\r\n   * @param {number} offset The offset where to start to read.\r\n   * @param {boolean} implicit Is the DICOM VR implicit?\r\n   * @returns {object} The item data as a list of data elements.\r\n   */\r\n  #readItemDataElement(reader, offset, implicit) {\r\n    const itemData = {};\r\n\r\n    // read the first item\r\n    let item = this.#readDataElement(reader, offset, implicit);\r\n    offset = item.endOffset;\r\n\r\n    // exit if it is a sequence delimitation item\r\n    if (isSequenceDelimitationItemTag(item.tag)) {\r\n      return {\r\n        data: itemData,\r\n        endOffset: item.endOffset,\r\n        isSeqDelim: true\r\n      };\r\n    }\r\n\r\n    // store item (mainly to keep vl)\r\n    itemData[item.tag.getKey()] = {\r\n      tag: item.tag,\r\n      vr: 'NONE',\r\n      vl: item.vl,\r\n      undefinedLength: item.undefinedLength\r\n    };\r\n\r\n    if (!item.undefinedLength) {\r\n      // explicit VR item: read until the end offset\r\n      const endOffset = offset;\r\n      offset -= item.vl;\r\n      while (offset < endOffset) {\r\n        item = this.#readDataElement(reader, offset, implicit);\r\n        offset = item.endOffset;\r\n        itemData[item.tag.getKey()] = item;\r\n      }\r\n    } else {\r\n      // implicit VR item: read until the item delimitation item\r\n      let isItemDelim = false;\r\n      while (!isItemDelim) {\r\n        item = this.#readDataElement(reader, offset, implicit);\r\n        offset = item.endOffset;\r\n        isItemDelim = isItemDelimitationItemTag(item.tag);\r\n        if (!isItemDelim) {\r\n          itemData[item.tag.getKey()] = item;\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      data: itemData,\r\n      endOffset: offset,\r\n      isSeqDelim: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Read the pixel item data element.\r\n   * Ref: [Single frame fragments]{@link http://dicom.nema.org/dicom/2013/output/chtml/part05/sect_A.4.html#table_A.4-1}.\r\n   *\r\n   * @param {DataReader} reader The raw data reader.\r\n   * @param {number} offset The offset where to start to read.\r\n   * @param {boolean} implicit Is the DICOM VR implicit?\r\n   * @returns {object} The item data as an array of data elements.\r\n   */\r\n  #readPixelItemDataElement(\r\n    reader, offset, implicit) {\r\n    const itemData = [];\r\n\r\n    // first item: basic offset table\r\n    let item = this.#readDataElement(reader, offset, implicit);\r\n    const offsetTableVl = item.vl;\r\n    offset = item.endOffset;\r\n\r\n    // read until the sequence delimitation item\r\n    let isSeqDelim = false;\r\n    while (!isSeqDelim) {\r\n      item = this.#readDataElement(reader, offset, implicit);\r\n      offset = item.endOffset;\r\n      isSeqDelim = isSequenceDelimitationItemTag(item.tag);\r\n      if (!isSeqDelim) {\r\n        // force pixel item vr to OB\r\n        item.vr = 'OB';\r\n        itemData.push(item);\r\n      }\r\n    }\r\n\r\n    return {\r\n      data: itemData,\r\n      endOffset: offset,\r\n      offsetTableVl: offsetTableVl\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Read a DICOM data element.\r\n   * Reference: [DICOM VRs]{@link http://dicom.nema.org/dicom/2013/output/chtml/part05/sect_6.2.html#table_6.2-1}.\r\n   *\r\n   * @param {DataReader} reader The raw data reader.\r\n   * @param {number} offset The offset where to start to read.\r\n   * @param {boolean} implicit Is the DICOM VR implicit?\r\n   * @returns {DataElement} The data element.\r\n   */\r\n  #readDataElement(reader, offset, implicit) {\r\n    // Tag: group, element\r\n    const readTagRes = this.#readTag(reader, offset);\r\n    const tag = readTagRes.tag;\r\n    offset = readTagRes.endOffset;\r\n\r\n    // Value Representation (VR)\r\n    let vr = null;\r\n    let is32bitVL = false;\r\n    if (tag.isWithVR()) {\r\n      // implicit VR\r\n      if (implicit) {\r\n        vr = tag.getVrFromDictionary();\r\n        if (typeof vr === 'undefined') {\r\n          vr = 'UN';\r\n        }\r\n        is32bitVL = true;\r\n      } else {\r\n        vr = this.#decodeString(reader.readUint8Array(offset, 2));\r\n        offset += 2 * Uint8Array.BYTES_PER_ELEMENT;\r\n        is32bitVL = is32bitVLVR(vr);\r\n        // reserved 2 bytes\r\n        if (is32bitVL) {\r\n          offset += 2 * Uint8Array.BYTES_PER_ELEMENT;\r\n        }\r\n      }\r\n    } else {\r\n      vr = 'NONE';\r\n      is32bitVL = true;\r\n    }\r\n\r\n    // check vr\r\n    if (!isKnownVR(vr)) {\r\n      logger.warn('Unknown VR: ' + vr +\r\n        ' (for tag ' + tag.getKey() + '), treating as \\'UN\\'');\r\n      vr = 'UN';\r\n    }\r\n\r\n    // Value Length (VL)\r\n    let vl = 0;\r\n    if (is32bitVL) {\r\n      vl = reader.readUint32(offset);\r\n      offset += Uint32Array.BYTES_PER_ELEMENT;\r\n    } else {\r\n      vl = reader.readUint16(offset);\r\n      offset += Uint16Array.BYTES_PER_ELEMENT;\r\n    }\r\n\r\n    // check the value of VL\r\n    let undefinedLength = false;\r\n    if (vl === 0xffffffff) {\r\n      undefinedLength = true;\r\n      vl = 0;\r\n    }\r\n\r\n    // treat private tag with unknown VR and zero VL as a sequence (see #799)\r\n    if (tag.isPrivate() && vr === 'UN' && vl === 0) {\r\n      vr = 'SQ';\r\n    }\r\n\r\n    let startOffset = offset;\r\n    let endOffset = startOffset + vl;\r\n\r\n    // read sequence elements\r\n    let data;\r\n    if (isPixelDataTag(tag) && undefinedLength) {\r\n      // pixel data sequence (implicit)\r\n      const pixItemData =\r\n        this.#readPixelItemDataElement(reader, offset, implicit);\r\n      offset = pixItemData.endOffset;\r\n      startOffset += pixItemData.offsetTableVl;\r\n      data = pixItemData.data;\r\n      endOffset = offset;\r\n      vl = offset - startOffset;\r\n    } else if (vr === 'SQ') {\r\n      // sequence\r\n      data = [];\r\n      let itemData;\r\n      if (!undefinedLength) {\r\n        if (vl !== 0) {\r\n          // explicit VR sequence: read until the end offset\r\n          const sqEndOffset = offset + vl;\r\n          while (offset < sqEndOffset) {\r\n            itemData = this.#readItemDataElement(reader, offset, implicit);\r\n            data.push(itemData.data);\r\n            offset = itemData.endOffset;\r\n          }\r\n          endOffset = offset;\r\n          vl = offset - startOffset;\r\n        }\r\n      } else {\r\n        // implicit VR sequence: read until the sequence delimitation item\r\n        let isSeqDelim = false;\r\n        while (!isSeqDelim) {\r\n          itemData = this.#readItemDataElement(reader, offset, implicit);\r\n          isSeqDelim = itemData.isSeqDelim;\r\n          offset = itemData.endOffset;\r\n          // do not store the delimitation item\r\n          if (!isSeqDelim) {\r\n            data.push(itemData.data);\r\n          }\r\n        }\r\n        endOffset = offset;\r\n        vl = offset - startOffset;\r\n      }\r\n    }\r\n\r\n    // return\r\n    const element = new DataElement(vr);\r\n    element.tag = tag;\r\n    element.vl = vl;\r\n    element.startOffset = startOffset;\r\n    element.endOffset = endOffset;\r\n    // only set if true (only for sequences and items)\r\n    if (undefinedLength) {\r\n      element.undefinedLength = undefinedLength;\r\n    }\r\n    if (data) {\r\n      element.items = data;\r\n    }\r\n    return element;\r\n  }\r\n\r\n  /**\r\n   * Interpret the data of an element.\r\n   *\r\n   * @param {DataElement} element The data element.\r\n   * @param {DataReader} reader The raw data reader.\r\n   * @param {number} [pixelRepresentation] PixelRepresentation 0->unsigned,\r\n   *   1->signed (needed for pixel data or VR=xs).\r\n   * @param {number} [bitsAllocated] Bits allocated (needed for pixel data).\r\n   * @returns {object} The interpreted data.\r\n   */\r\n  #interpretElement(\r\n    element, reader, pixelRepresentation, bitsAllocated) {\r\n\r\n    const tag = element.tag;\r\n    const vl = element.vl;\r\n    const vr = element.vr;\r\n    const offset = element.startOffset;\r\n\r\n    // data\r\n    let data = null;\r\n    const vrType = vrTypes[vr];\r\n    if (isPixelDataTag(tag)) {\r\n      if (element.undefinedLength) {\r\n        // implicit pixel data sequence\r\n        data = [];\r\n        for (let j = 0; j < element.items.length; ++j) {\r\n          data.push(this.#interpretElement(\r\n            element.items[j], reader,\r\n            pixelRepresentation, bitsAllocated));\r\n        }\r\n        // remove non parsed items\r\n        delete element.items;\r\n      } else {\r\n        // check bits allocated and VR\r\n        // https://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/sect_A.2.html\r\n        if (bitsAllocated > 8 && vr === 'OB') {\r\n          logger.warn(\r\n            'Reading DICOM pixel data with bitsAllocated>8 and OB VR.'\r\n          );\r\n        }\r\n        // read\r\n        data = [];\r\n        if (bitsAllocated === 1) {\r\n          data.push(reader.readBinaryArray(offset, vl));\r\n        } else if (bitsAllocated === 8) {\r\n          if (pixelRepresentation === 0) {\r\n            data.push(reader.readUint8Array(offset, vl));\r\n          } else {\r\n            data.push(reader.readInt8Array(offset, vl));\r\n          }\r\n        } else if (bitsAllocated === 16) {\r\n          if (pixelRepresentation === 0) {\r\n            data.push(reader.readUint16Array(offset, vl));\r\n          } else {\r\n            data.push(reader.readInt16Array(offset, vl));\r\n          }\r\n        } else {\r\n          throw new Error('Unsupported bits allocated: ' + bitsAllocated);\r\n        }\r\n      }\r\n    } else if (typeof vrType !== 'undefined') {\r\n      if (vrType === 'Uint8') {\r\n        data = reader.readUint8Array(offset, vl);\r\n      } else if (vrType === 'Uint16') {\r\n        data = reader.readUint16Array(offset, vl);\r\n        // keep as binary for 'O*' VR\r\n        if (vr[0] !== 'O') {\r\n          data = Array.from(data);\r\n        }\r\n      } else if (vrType === 'Uint32') {\r\n        data = reader.readUint32Array(offset, vl);\r\n        // keep as binary for 'O*' VR\r\n        if (vr[0] !== 'O') {\r\n          data = Array.from(data);\r\n        }\r\n      } else if (vrType === 'Uint64') {\r\n        data = reader.readUint64Array(offset, vl);\r\n      } else if (vrType === 'Int16') {\r\n        data = Array.from(reader.readInt16Array(offset, vl));\r\n      } else if (vrType === 'Int32') {\r\n        data = Array.from(reader.readInt32Array(offset, vl));\r\n      } else if (vrType === 'Int64') {\r\n        data = reader.readInt64Array(offset, vl);\r\n      } else if (vrType === 'Float32') {\r\n        data = Array.from(reader.readFloat32Array(offset, vl));\r\n      } else if (vrType === 'Float64') {\r\n        data = Array.from(reader.readFloat64Array(offset, vl));\r\n      } else if (vrType === 'string') {\r\n        const stream = reader.readUint8Array(offset, vl);\r\n        if (isCharSetStringVR(vr)) {\r\n          data = this.#decodeSpecialString(stream);\r\n        } else {\r\n          data = this.#decodeString(stream);\r\n        }\r\n        data = cleanString(data).split('\\\\');\r\n      } else {\r\n        throw Error('Unknown VR type: ' + vrType);\r\n      }\r\n    } else if (vr === 'xx') {\r\n      // US or OW\r\n      data = Array.from(reader.readUint16Array(offset, vl));\r\n    } else if (vr === 'ox') {\r\n      // OB or OW\r\n      if (bitsAllocated === 8) {\r\n        data = Array.from(reader.readUint8Array(offset, vl));\r\n      } else {\r\n        data = Array.from(reader.readUint16Array(offset, vl));\r\n      }\r\n    } else if (vr === 'xs') {\r\n      // (US or SS) or (US or SS or OW)\r\n      if (pixelRepresentation === 0) {\r\n        data = Array.from(reader.readUint16Array(offset, vl));\r\n      } else {\r\n        data = Array.from(reader.readInt16Array(offset, vl));\r\n      }\r\n    } else if (vr === 'AT') {\r\n      // attribute\r\n      const raw = reader.readUint16Array(offset, vl);\r\n      data = [];\r\n      for (let i = 0, leni = raw.length; i < leni; i += 2) {\r\n        const stri = raw[i].toString(16);\r\n        const stri1 = raw[i + 1].toString(16);\r\n        let str = '(';\r\n        str += '0000'.substring(0, 4 - stri.length) + stri.toUpperCase();\r\n        str += ',';\r\n        str += '0000'.substring(0, 4 - stri1.length) + stri1.toUpperCase();\r\n        str += ')';\r\n        data.push(str);\r\n      }\r\n    } else if (vr === 'SQ') {\r\n      // sequence\r\n      data = [];\r\n      for (let k = 0; k < element.items.length; ++k) {\r\n        const item = element.items[k];\r\n        const itemData = {};\r\n        const keys = Object.keys(item);\r\n        for (let l = 0; l < keys.length; ++l) {\r\n          const subElement = item[keys[l]];\r\n          subElement.value = this.#interpretElement(\r\n            subElement, reader,\r\n            pixelRepresentation, bitsAllocated);\r\n          delete subElement.tag;\r\n          delete subElement.vl;\r\n          delete subElement.startOffset;\r\n          delete subElement.endOffset;\r\n          itemData[keys[l]] = subElement;\r\n        }\r\n        data.push(itemData);\r\n      }\r\n      // remove non parsed elements\r\n      delete element.items;\r\n    } else if (vr === 'NONE') {\r\n      // no VR -> no data\r\n      data = [];\r\n    } else {\r\n      logger.warn('Unknown VR: ' + vr +\r\n        ' (for tag ' + element.tag.getKey() + ')');\r\n      // empty data...\r\n      data = [];\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Interpret the data of a list of elements.\r\n   *\r\n   * @param {DataElements} elements A list of data elements.\r\n   * @param {DataReader} reader The raw data reader.\r\n   * @param {number} pixelRepresentation PixelRepresentation 0->unsigned,\r\n   *   1->signed.\r\n   * @param {number} bitsAllocated Bits allocated.\r\n   */\r\n  #interpret(\r\n    elements, reader,\r\n    pixelRepresentation, bitsAllocated) {\r\n\r\n    const keys = Object.keys(elements);\r\n    for (let i = 0; i < keys.length; ++i) {\r\n      const element = elements[keys[i]];\r\n      if (typeof element.value === 'undefined') {\r\n        element.value = this.#interpretElement(\r\n          element, reader, pixelRepresentation, bitsAllocated);\r\n      }\r\n      // delete interpretation specific properties\r\n      delete element.tag;\r\n      delete element.vl;\r\n      delete element.startOffset;\r\n      delete element.endOffset;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Parse the complete DICOM file (given as input to the class).\r\n   * Fills in the member object 'dataElements'.\r\n   *\r\n   * @param {ArrayBuffer} buffer The input array buffer.\r\n   */\r\n  parse(buffer) {\r\n    let offset = 0;\r\n    let syntax = '';\r\n    let dataElement = null;\r\n    // default readers\r\n    const metaReader = new DataReader(buffer);\r\n    let dataReader = new DataReader(buffer);\r\n\r\n    // 128 -> 132: magic word\r\n    offset = 128;\r\n    const magicword = this.#decodeString(metaReader.readUint8Array(offset, 4));\r\n    offset += 4 * Uint8Array.BYTES_PER_ELEMENT;\r\n    if (magicword === 'DICM') {\r\n      // 0002, 0000: FileMetaInformationGroupLength (vr='UL')\r\n      dataElement = this.#readDataElement(metaReader, offset, false);\r\n      dataElement.value = this.#interpretElement(dataElement, metaReader);\r\n      // increment offset\r\n      offset = dataElement.endOffset;\r\n      // store the data element\r\n      this.#dataElements[dataElement.tag.getKey()] = dataElement;\r\n      // get meta length\r\n      const metaLength = dataElement.value[0];\r\n\r\n      // meta elements\r\n      const metaEnd = offset + metaLength;\r\n      while (offset < metaEnd) {\r\n        // get the data element\r\n        dataElement = this.#readDataElement(metaReader, offset, false);\r\n        offset = dataElement.endOffset;\r\n        // store the data element\r\n        this.#dataElements[dataElement.tag.getKey()] = dataElement;\r\n      }\r\n\r\n      // check the TransferSyntaxUID (has to be there!)\r\n      dataElement = this.#dataElements['00020010'];\r\n      if (typeof dataElement === 'undefined') {\r\n        throw new Error('Not a valid DICOM file (no TransferSyntaxUID found)');\r\n      }\r\n      dataElement.value = this.#interpretElement(dataElement, metaReader);\r\n      syntax = dataElement.value[0];\r\n\r\n    } else {\r\n      logger.warn('No DICM prefix, trying to guess tansfer syntax.');\r\n      // read first element\r\n      dataElement = this.#readDataElement(dataReader, 0, false);\r\n      // guess transfer syntax\r\n      const tsElement = guessTransferSyntax(dataElement);\r\n      // store\r\n      this.#dataElements[tsElement.tag.getKey()] = tsElement;\r\n      syntax = tsElement.value[0];\r\n      // reset offset\r\n      offset = 0;\r\n    }\r\n\r\n    // check transfer syntax support\r\n    if (!isReadSupportedTransferSyntax(syntax)) {\r\n      throw new Error('Unsupported DICOM transfer syntax: \\'' + syntax +\r\n        '\\' (' + getTransferSyntaxName(syntax) + ')');\r\n    }\r\n\r\n    // set implicit flag\r\n    let implicit = false;\r\n    if (isImplicitTransferSyntax(syntax)) {\r\n      implicit = true;\r\n    }\r\n\r\n    // Big Endian\r\n    if (isBigEndianTransferSyntax(syntax)) {\r\n      dataReader = new DataReader(buffer, false);\r\n    }\r\n\r\n    // DICOM data elements\r\n    while (offset < buffer.byteLength) {\r\n      // get the data element\r\n      dataElement = this.#readDataElement(dataReader, offset, implicit);\r\n      // increment offset\r\n      offset = dataElement.endOffset;\r\n      // store the data element\r\n      const key = dataElement.tag.getKey();\r\n      if (typeof this.#dataElements[key] === 'undefined') {\r\n        this.#dataElements[key] = dataElement;\r\n      } else {\r\n        logger.warn('Not saving duplicate tag: ' + key);\r\n      }\r\n    }\r\n\r\n    // safety checks...\r\n    if (isNaN(offset)) {\r\n      throw new Error('Problem while parsing, bad offset');\r\n    }\r\n    if (buffer.byteLength !== offset) {\r\n      logger.warn('Did not reach the end of the buffer: ' +\r\n        offset + ' != ' + buffer.byteLength);\r\n    }\r\n\r\n    //-------------------------------------------------\r\n    // values needed for data interpretation\r\n\r\n    // pixel specific\r\n    let pixelRepresentation = 0;\r\n    let bitsAllocated = 16;\r\n    if (typeof this.#dataElements['7FE00010'] !== 'undefined') {\r\n      // PixelRepresentation 0->unsigned, 1->signed\r\n      dataElement = this.#dataElements['00280103'];\r\n      if (typeof dataElement !== 'undefined') {\r\n        dataElement.value = this.#interpretElement(dataElement, dataReader);\r\n        pixelRepresentation = dataElement.value[0];\r\n      } else {\r\n        logger.warn(\r\n          'Reading DICOM pixel data with default pixelRepresentation.');\r\n      }\r\n\r\n      // BitsAllocated\r\n      dataElement = this.#dataElements['00280100'];\r\n      if (typeof dataElement !== 'undefined') {\r\n        dataElement.value = this.#interpretElement(dataElement, dataReader);\r\n        bitsAllocated = dataElement.value[0];\r\n      } else {\r\n        logger.warn('Reading DICOM pixel data with default bitsAllocated.');\r\n      }\r\n    }\r\n\r\n    // default character set\r\n    if (typeof this.#defaultCharacterSet !== 'undefined') {\r\n      this.setDecoderCharacterSet(this.#defaultCharacterSet);\r\n    }\r\n\r\n    // SpecificCharacterSet\r\n    dataElement = this.#dataElements['00080005'];\r\n    if (typeof dataElement !== 'undefined') {\r\n      dataElement.value = this.#interpretElement(dataElement, dataReader);\r\n      let charSetTerm;\r\n      if (dataElement.value.length === 1) {\r\n        charSetTerm = dataElement.value[0];\r\n      } else {\r\n        charSetTerm = dataElement.value[1];\r\n        logger.warn('Unsupported character set with code extensions: \\'' +\r\n          charSetTerm + '\\'.');\r\n      }\r\n      this.setDecoderCharacterSet(getUtfLabel(charSetTerm));\r\n    }\r\n\r\n    // interpret the dicom elements\r\n    this.#interpret(\r\n      this.#dataElements, dataReader,\r\n      pixelRepresentation, bitsAllocated\r\n    );\r\n\r\n    // handle fragmented pixel buffer\r\n    // Reference: http://dicom.nema.org/dicom/2013/output/chtml/part05/sect_8.2.html\r\n    // (third note, \"Depending on the transfer syntax...\")\r\n    dataElement = this.#dataElements['7FE00010'];\r\n    if (typeof dataElement !== 'undefined') {\r\n      if (dataElement.undefinedLength) {\r\n        let numberOfFrames = 1;\r\n        if (typeof this.#dataElements['00280008'] !== 'undefined') {\r\n          numberOfFrames = Number(this.#dataElements['00280008'].value[0]);\r\n        }\r\n        const pixItems = dataElement.value;\r\n        if (pixItems.length > 1 && pixItems.length > numberOfFrames) {\r\n          // concatenate pixel data items\r\n          // concat does not work on typed arrays\r\n          //this.pixelBuffer = this.pixelBuffer.concat( dataElement.data );\r\n          // manual concat...\r\n          const nItemPerFrame = pixItems.length / numberOfFrames;\r\n          const newPixItems = [];\r\n          let index = 0;\r\n          for (let f = 0; f < numberOfFrames; ++f) {\r\n            index = f * nItemPerFrame;\r\n            // calculate the size of a frame\r\n            let size = 0;\r\n            for (let i = 0; i < nItemPerFrame; ++i) {\r\n              size += pixItems[index + i].length;\r\n            }\r\n            // create new buffer\r\n            const newBuffer = new pixItems[0].constructor(size);\r\n            // fill new buffer\r\n            let fragOffset = 0;\r\n            for (let j = 0; j < nItemPerFrame; ++j) {\r\n              newBuffer.set(pixItems[index + j], fragOffset);\r\n              fragOffset += pixItems[index + j].length;\r\n            }\r\n            newPixItems[f] = newBuffer;\r\n          }\r\n          // store as pixel data\r\n          dataElement.value = newPixItems;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n} // class DicomParser\r\n","/**\r\n * ListenerHandler class: handles add/removing and firing listeners.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget#example\r\n */\r\nexport class ListenerHandler {\r\n  /**\r\n   * listeners.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #listeners = {};\r\n\r\n  /**\r\n   * Add an event listener.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {object} callback The method associated with the provided\r\n   *    event type, will be called with the fired event.\r\n   */\r\n  add(type, callback) {\r\n    // create array if not present\r\n    if (typeof this.#listeners[type] === 'undefined') {\r\n      this.#listeners[type] = [];\r\n    }\r\n    // add callback to listeners array\r\n    this.#listeners[type].push(callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {object} callback The method associated with the provided\r\n   *   event type.\r\n   */\r\n  remove(type, callback) {\r\n    // check if the type is present\r\n    if (typeof this.#listeners[type] === 'undefined') {\r\n      return;\r\n    }\r\n    // remove from listeners array\r\n    for (let i = 0; i < this.#listeners[type].length; ++i) {\r\n      if (this.#listeners[type][i] === callback) {\r\n        this.#listeners[type].splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  fireEvent = (event) => {\r\n    // check if they are listeners for the event type\r\n    if (typeof this.#listeners[event.type] === 'undefined') {\r\n      return;\r\n    }\r\n    // fire events from a copy of the listeners array\r\n    // to avoid interference from possible add/remove\r\n    const stack = this.#listeners[event.type].slice();\r\n    for (let i = 0; i < stack.length; ++i) {\r\n      stack[i](event);\r\n    }\r\n  };\r\n}\r\n","import {Index} from '../math/index';\r\nimport {Point2D} from '../math/point';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Image} from './image';\r\nimport {Point} from '../math/point';\r\nimport {Matrix33} from '../math/matrix';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Get an simple iterator for a given range for a one component data.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols\r\n * @param {Function} dataAccessor Function to access data.\r\n * @param {number} start The start of the range (included).\r\n * @param {number} end The end of the range (excluded).\r\n * @param {number} [increment] The increment between indicies (default=1).\r\n * @returns {object} An iterator folowing the iterator and iterable protocol.\r\n */\r\nexport function simpleRange(dataAccessor, start, end, increment) {\r\n  if (typeof increment === 'undefined') {\r\n    increment = 1;\r\n  }\r\n  let nextIndex = start;\r\n  // result\r\n  return {\r\n    next: function () {\r\n      if (nextIndex < end) {\r\n        const result = {\r\n          value: dataAccessor(nextIndex),\r\n          done: false,\r\n          index: nextIndex\r\n        };\r\n        nextIndex += increment;\r\n        return result;\r\n      }\r\n      return {\r\n        done: true,\r\n        index: end\r\n      };\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Get an iterator for a given range for a one component data.\r\n *\r\n * Using 'maxIter' and not an 'end' index since it fails in some edge cases\r\n * (for ex coronal2, ie zxy)\r\n *\r\n * @param {Function} dataAccessor Function to access data.\r\n * @param {number} start Zero-based index at which to start the iteration.\r\n * @param {number} maxIter The maximum number of iterations.\r\n * @param {number} increment Increment between indicies.\r\n * @param {number} blockMaxIter Number of applied increment after which\r\n *   blockIncrement is applied.\r\n * @param {number} blockIncrement Increment after blockMaxIter is reached,\r\n *   the value is from block start to the next block start.\r\n * @param {boolean} reverse1 If true, loop from end to start.\r\n *   WARN: don't forget to set the value of start as the last index!\r\n * @param {boolean} reverse2 If true, loop from block end to block start.\r\n * @returns {object} An iterator folowing the iterator and iterable protocol.\r\n */\r\nexport function range(dataAccessor, start, maxIter, increment,\r\n  blockMaxIter, blockIncrement, reverse1, reverse2) {\r\n  if (typeof reverse1 === 'undefined') {\r\n    reverse1 = false;\r\n  }\r\n  if (typeof reverse2 === 'undefined') {\r\n    reverse2 = false;\r\n  }\r\n\r\n  // first index of the iteration\r\n  let nextIndex = start;\r\n  // adapt first index and increments to reverse values\r\n  if (reverse1) {\r\n    blockIncrement *= -1;\r\n    if (reverse2) {\r\n      // start at end of line\r\n      nextIndex -= (blockMaxIter - 1) * increment;\r\n    } else {\r\n      increment *= -1;\r\n    }\r\n  } else {\r\n    if (reverse2) {\r\n      // start at end of line\r\n      nextIndex += (blockMaxIter - 1) * increment;\r\n      increment *= -1;\r\n    }\r\n  }\r\n  const finalBlockIncrement = blockIncrement - blockMaxIter * increment;\r\n\r\n  // counters\r\n  let mainCount = 0;\r\n  let blockCount = 0;\r\n  // result\r\n  return {\r\n    next: function () {\r\n      if (mainCount < maxIter) {\r\n        const result = {\r\n          value: dataAccessor(nextIndex),\r\n          done: false,\r\n          index: nextIndex\r\n        };\r\n        nextIndex += increment;\r\n        ++mainCount;\r\n        ++blockCount;\r\n        if (blockCount === blockMaxIter) {\r\n          blockCount = 0;\r\n          nextIndex += finalBlockIncrement;\r\n        }\r\n        return result;\r\n      }\r\n      return {\r\n        done: true,\r\n        index: nextIndex\r\n      };\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Get an iterator for a given range with bounds (for a one component data).\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols\r\n * @param {Function} dataAccessor Function to access data.\r\n * @param {number} start The start of the range (included).\r\n * @param {number} end The end of the range (excluded).\r\n * @param {number} increment The increment between indicies.\r\n * @param {number} regionSize The size of the region to iterate through.\r\n * @param {number} regionOffset The offset between regions.\r\n * @returns {object} An iterator folowing the iterator and iterable protocol.\r\n */\r\nexport function rangeRegion(\r\n  dataAccessor, start, end, increment, regionSize, regionOffset) {\r\n  let nextIndex = start;\r\n  let regionElementCount = 0;\r\n  // result\r\n  return {\r\n    next: function () {\r\n      if (nextIndex < end) {\r\n        const result = {\r\n          value: dataAccessor(nextIndex),\r\n          done: false,\r\n          index: nextIndex\r\n        };\r\n        regionElementCount += 1;\r\n        nextIndex += increment;\r\n        if (regionElementCount === regionSize) {\r\n          regionElementCount = 0;\r\n          nextIndex += regionOffset;\r\n        }\r\n        return result;\r\n      }\r\n      return {\r\n        done: true,\r\n        index: end\r\n      };\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Get an iterator for a given range with bounds (for a one component data).\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols\r\n * @param {Function} dataAccessor Function to access data.\r\n * @param {number} start The start of the range (included).\r\n * @param {number} end The end of the range (excluded).\r\n * @param {number} increment The increment between indicies.\r\n * @param {Array} regions An array of regions: [off0, size, off1].\r\n * @returns {object} An iterator folowing the iterator and iterable protocol.\r\n */\r\nexport function rangeRegions(\r\n  dataAccessor, start, end, increment, regions) {\r\n  let nextIndex = start;\r\n  let regionCount = 0;\r\n  let regionElementCount = 0;\r\n  // result\r\n  return {\r\n    next: function () {\r\n      if (nextIndex < end) {\r\n        const result = {\r\n          value: dataAccessor(nextIndex),\r\n          done: false,\r\n          index: nextIndex\r\n        };\r\n        regionElementCount += 1;\r\n        nextIndex += increment;\r\n        if (regionElementCount === regions[regionCount][1]) {\r\n          regionElementCount = 0;\r\n          // off1 of current group\r\n          nextIndex += regions[regionCount][2];\r\n          regionCount += 1;\r\n          // off0 of next group\r\n          if (regionCount < regions.length) {\r\n            nextIndex += regions[regionCount][0];\r\n          }\r\n        }\r\n        return result;\r\n      }\r\n      return {\r\n        done: true,\r\n        index: end\r\n      };\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Get an iterator for a given range for a 3 components data.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols\r\n * @param {Function} dataAccessor Function to access data.\r\n * @param {number} start The start of the range (included).\r\n * @param {number} end The end of the range (excluded).\r\n *   (end - start) needs to be a multiple of 3...\r\n * @param {number} increment The increment between indicies (default=1).\r\n * @param {boolean} isPlanar A flag to know if the data is planar\r\n *   (RRRR...GGGG...BBBB...) or not (RGBRGBRGBRGB...), defaults to false.\r\n * @returns {object} A 3 components iterator folowing the iterator and iterable\r\n *   protocol, the value is an array of size 3 with each component.\r\n */\r\nexport function simpleRange3d(\r\n  dataAccessor, start, end, increment, isPlanar) {\r\n  if (typeof increment === 'undefined') {\r\n    increment = 1;\r\n  }\r\n  if (typeof isPlanar === 'undefined') {\r\n    isPlanar = false;\r\n  }\r\n  let nextIndex = start;\r\n  let componentIncrement = 1;\r\n  if (isPlanar) {\r\n    componentIncrement = (end - start) / 3;\r\n  } else {\r\n    increment *= 3;\r\n  }\r\n  let nextIndex1 = nextIndex + componentIncrement;\r\n  let nextIndex2 = nextIndex + 2 * componentIncrement;\r\n\r\n  // result\r\n  return {\r\n    next: function () {\r\n      if (nextIndex < end) {\r\n        const result = {\r\n          value: [\r\n            dataAccessor(nextIndex),\r\n            dataAccessor(nextIndex1),\r\n            dataAccessor(nextIndex2)\r\n          ],\r\n          done: false,\r\n          index: [nextIndex, nextIndex1, nextIndex2]\r\n        };\r\n        nextIndex += increment;\r\n        nextIndex1 += increment;\r\n        nextIndex2 += increment;\r\n        return result;\r\n      }\r\n      return {\r\n        done: true,\r\n        index: [end]\r\n      };\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Get an iterator for a given range for a 3 components data.\r\n *\r\n * Using 'maxIter' and not an 'end' index since it fails in some edge cases\r\n * (for ex coronal2, ie zxy)\r\n *\r\n * @param {Function} dataAccessor Function to access data.\r\n * @param {number} start Zero-based index at which to start the iteration.\r\n * @param {number} maxIter The maximum number of iterations.\r\n * @param {number} increment Increment between indicies.\r\n * @param {number} blockMaxIter Number of applied increment after which\r\n *   blockIncrement is applied.\r\n * @param {number} blockIncrement Increment after blockMaxIter is reached,\r\n *   the value is from block start to the next block start.\r\n * @param {boolean} reverse1 If true, loop from end to start.\r\n *   WARN: don't forget to set the value of start as the last index!\r\n * @param {boolean} reverse2 If true, loop from block end to block start.\r\n * @param {boolean} isPlanar A flag to know if the data is planar\r\n *   (RRRR...GGGG...BBBB...) or not (RGBRGBRGBRGB...), defaults to false.\r\n * @returns {object} An iterator folowing the iterator and iterable protocol.\r\n */\r\nexport function range3d(dataAccessor, start, maxIter, increment,\r\n  blockMaxIter, blockIncrement, reverse1, reverse2, isPlanar) {\r\n  const iters = [];\r\n  if (isPlanar) {\r\n    iters.push(range(\r\n      dataAccessor, start, maxIter, increment,\r\n      blockMaxIter, blockIncrement, reverse1, reverse2\r\n    ));\r\n    iters.push(range(\r\n      dataAccessor, start + maxIter * increment, maxIter, increment,\r\n      blockMaxIter, blockIncrement, reverse1, reverse2\r\n    ));\r\n    iters.push(range(\r\n      dataAccessor, start + 2 * maxIter * increment, maxIter, increment,\r\n      blockMaxIter, blockIncrement, reverse1, reverse2\r\n    ));\r\n  } else {\r\n    increment *= 3;\r\n    blockIncrement *= 3;\r\n    iters.push(range(\r\n      dataAccessor, start, maxIter, increment,\r\n      blockMaxIter, blockIncrement, reverse1, reverse2\r\n    ));\r\n    iters.push(range(\r\n      dataAccessor, start + 1, maxIter, increment,\r\n      blockMaxIter, blockIncrement, reverse1, reverse2\r\n    ));\r\n    iters.push(range(\r\n      dataAccessor, start + 2, maxIter, increment,\r\n      blockMaxIter, blockIncrement, reverse1, reverse2\r\n    ));\r\n  }\r\n\r\n  // result\r\n  return {\r\n    next: function () {\r\n      const r0 = iters[0].next();\r\n      const r1 = iters[1].next();\r\n      const r2 = iters[2].next();\r\n      if (!r0.done) {\r\n        return {\r\n          value: [\r\n            r0.value,\r\n            r1.value,\r\n            r2.value\r\n          ],\r\n          done: false,\r\n          index: [\r\n            r0.index,\r\n            r1.index,\r\n            r2.index\r\n          ]\r\n        };\r\n      }\r\n      return {\r\n        done: true,\r\n        index: r2.index\r\n      };\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Get a list of values for a given iterator.\r\n *\r\n * @param {object} iterator The iterator to use to loop through data.\r\n * @returns {Array} The list of values.\r\n */\r\nexport function getIteratorValues(iterator) {\r\n  const values = [];\r\n  let ival = iterator.next();\r\n  while (!ival.done) {\r\n    values.push(ival.value);\r\n    ival = iterator.next();\r\n  }\r\n  return values;\r\n}\r\n\r\n/**\r\n * Get a slice index iterator.\r\n *\r\n * @param {Image} image The image to parse.\r\n * @param {Index} position The current position.\r\n * @param {boolean} isRescaled Flag for rescaled values (default false).\r\n * @param {Matrix33} viewOrientation The view orientation.\r\n * @returns {object} The slice iterator.\r\n */\r\nexport function getSliceIterator(\r\n  image, position, isRescaled, viewOrientation) {\r\n  const size = image.getGeometry().getSize();\r\n  // zero-ify non direction index\r\n  let dirMax2Index = 2;\r\n  if (viewOrientation && typeof viewOrientation !== 'undefined') {\r\n    dirMax2Index = viewOrientation.getColAbsMax(2).index;\r\n  }\r\n  const posValues = position.getValues();\r\n  // keep the main direction and any other than 3D\r\n  const indexFilter = function (element, index) {\r\n    return (index === dirMax2Index || index > 2) ? element : 0;\r\n  };\r\n  const posStart = new Index(posValues.map(indexFilter));\r\n  let start = size.indexToOffset(posStart);\r\n\r\n  // default to non rescaled data\r\n  if (typeof isRescaled === 'undefined') {\r\n    isRescaled = false;\r\n  }\r\n  let dataAccessor = null;\r\n  if (isRescaled) {\r\n    dataAccessor = function (offset) {\r\n      return image.getRescaledValueAtOffset(offset);\r\n    };\r\n  } else {\r\n    dataAccessor = function (offset) {\r\n      return image.getValueAtOffset(offset);\r\n    };\r\n  }\r\n\r\n  const ncols = size.get(0);\r\n  const nrows = size.get(1);\r\n  const nslices = size.get(2);\r\n  let sliceSize = size.getDimSize(2);\r\n\r\n  const ncomp = image.getNumberOfComponents();\r\n  const isPlanar = image.getPlanarConfiguration() === 1;\r\n  const getRange = function (\r\n    dataAccessor, start, maxIter, increment,\r\n    blockMaxIter, blockIncrement, reverse1, reverse2) {\r\n    if (ncomp === 1) {\r\n      return range(dataAccessor, start, maxIter, increment,\r\n        blockMaxIter, blockIncrement, reverse1, reverse2);\r\n    } else if (ncomp === 3) {\r\n      return range3d(dataAccessor, 3 * start, maxIter, increment,\r\n        blockMaxIter, blockIncrement, reverse1, reverse2, isPlanar);\r\n    }\r\n  };\r\n\r\n  let rangeObj = null;\r\n  if (viewOrientation && typeof viewOrientation !== 'undefined') {\r\n    const dirMax0 = viewOrientation.getColAbsMax(0);\r\n    const dirMax2 = viewOrientation.getColAbsMax(2);\r\n\r\n    // default reverse\r\n    const reverse1 = false;\r\n    const reverse2 = false;\r\n\r\n    let maxIter = null;\r\n    if (dirMax2.index === 2) {\r\n      // axial\r\n      maxIter = ncols * nrows;\r\n      if (dirMax0.index === 0) {\r\n        // xyz\r\n        rangeObj = getRange(dataAccessor,\r\n          start, maxIter, 1, ncols, ncols, reverse1, reverse2);\r\n      } else {\r\n        // yxz\r\n        rangeObj = getRange(dataAccessor,\r\n          start, maxIter, ncols, nrows, 1, reverse1, reverse2);\r\n      }\r\n    } else if (dirMax2.index === 0) {\r\n      // sagittal\r\n      maxIter = nslices * nrows;\r\n      if (dirMax0.index === 1) {\r\n        // yzx\r\n        rangeObj = getRange(dataAccessor,\r\n          start, maxIter, ncols, nrows, sliceSize, reverse1, reverse2);\r\n      } else {\r\n        // zyx\r\n        rangeObj = getRange(dataAccessor,\r\n          start, maxIter, sliceSize, nslices, ncols, reverse1, reverse2);\r\n      }\r\n    } else if (dirMax2.index === 1) {\r\n      // coronal\r\n      maxIter = nslices * ncols;\r\n      if (dirMax0.index === 0) {\r\n        // xzy\r\n        rangeObj = getRange(dataAccessor,\r\n          start, maxIter, 1, ncols, sliceSize, reverse1, reverse2);\r\n      } else {\r\n        // zxy\r\n        rangeObj = getRange(dataAccessor,\r\n          start, maxIter, sliceSize, nslices, 1, reverse1, reverse2);\r\n      }\r\n    } else {\r\n      throw new Error('Unknown direction: ' + dirMax2.index);\r\n    }\r\n  } else {\r\n    if (image.getNumberOfComponents() === 1) {\r\n      rangeObj = simpleRange(dataAccessor, start, start + sliceSize);\r\n    } else if (image.getNumberOfComponents() === 3) {\r\n      // 3 times bigger...\r\n      start *= 3;\r\n      sliceSize *= 3;\r\n      rangeObj = simpleRange3d(\r\n        dataAccessor, start, start + sliceSize, 1, isPlanar);\r\n    } else {\r\n      throw new Error('Unsupported number of components: ' +\r\n        image.getNumberOfComponents());\r\n    }\r\n  }\r\n\r\n  return rangeObj;\r\n}\r\n\r\n/**\r\n * Get a slice index iterator for a rectangular region.\r\n *\r\n * @param {Image} image The image to parse.\r\n * @param {Index} index The current position.\r\n * @param {boolean} isRescaled Flag for rescaled values (default false).\r\n * @param {Point2D} min The minimum position (optional).\r\n * @param {Point2D} max The maximum position (optional).\r\n * @returns {object} The slice iterator.\r\n */\r\nexport function getRegionSliceIterator(\r\n  image, index, isRescaled, min, max) {\r\n  if (image.getNumberOfComponents() !== 1) {\r\n    throw new Error('Unsupported number of components for region iterator: ' +\r\n      image.getNumberOfComponents());\r\n  }\r\n\r\n  // default to non rescaled data\r\n  if (typeof isRescaled === 'undefined') {\r\n    isRescaled = false;\r\n  }\r\n  let dataAccessor = null;\r\n  if (isRescaled) {\r\n    dataAccessor = function (offset) {\r\n      return image.getRescaledValueAtOffset(offset);\r\n    };\r\n  } else {\r\n    dataAccessor = function (offset) {\r\n      return image.getValueAtOffset(offset);\r\n    };\r\n  }\r\n\r\n  const size = image.getGeometry().getSize();\r\n  if (typeof min === 'undefined') {\r\n    min = new Point2D(0, 0);\r\n  }\r\n  if (typeof max === 'undefined') {\r\n    max = new Point2D(\r\n      size.get(0) - 1,\r\n      size.get(1)\r\n    );\r\n  }\r\n  // position to pixel for max: extra X is ok, remove extra Y\r\n  const startOffset = size.indexToOffset(index.getWithNew2D(\r\n    min.getX(), min.getY()\r\n  ));\r\n  const endOffset = size.indexToOffset(index.getWithNew2D(\r\n    max.getX(), max.getY() - 1\r\n  ));\r\n\r\n  // minimum 1 column\r\n  const rangeNumberOfColumns = Math.max(1, max.getX() - min.getX());\r\n  const rowIncrement = size.get(0) - rangeNumberOfColumns;\r\n\r\n  return rangeRegion(\r\n    dataAccessor, startOffset, endOffset + 1,\r\n    1, rangeNumberOfColumns, rowIncrement);\r\n}\r\n\r\n/**\r\n * Get a slice index iterator for a rectangular region.\r\n *\r\n * @param {Image} image The image to parse.\r\n * @param {Index} index The current position.\r\n * @param {boolean} isRescaled Flag for rescaled values (default false).\r\n * @param {Array} regions An array of regions.\r\n * @returns {object|undefined} The slice iterator.\r\n */\r\nexport function getVariableRegionSliceIterator(\r\n  image, index, isRescaled, regions) {\r\n  if (image.getNumberOfComponents() !== 1) {\r\n    throw new Error('Unsupported number of components for region iterator: ' +\r\n      image.getNumberOfComponents());\r\n  }\r\n\r\n  // default to non rescaled data\r\n  if (typeof isRescaled === 'undefined') {\r\n    isRescaled = false;\r\n  }\r\n  let dataAccessor = null;\r\n  if (isRescaled) {\r\n    dataAccessor = function (offset) {\r\n      return image.getRescaledValueAtOffset(offset);\r\n    };\r\n  } else {\r\n    dataAccessor = function (offset) {\r\n      return image.getValueAtOffset(offset);\r\n    };\r\n  }\r\n\r\n  const size = image.getGeometry().getSize();\r\n\r\n  const offsetRegions = [];\r\n  let region;\r\n  let min = null;\r\n  let max = null;\r\n  let regionIndex = null;\r\n  for (let i = 0; i < regions.length; ++i) {\r\n    region = regions[i];\r\n    const width = region[1][0] - region[0][0];\r\n    if (width !== 0) {\r\n      regionIndex = i;\r\n      if (!min) {\r\n        min = region[0];\r\n      }\r\n      offsetRegions.push([\r\n        region[0][0],\r\n        width,\r\n        size.get(0) - region[1][0]\r\n      ]);\r\n    }\r\n  }\r\n  if (regionIndex !== null) {\r\n    max = regions[regionIndex][1];\r\n  }\r\n\r\n  // exit if no offsets\r\n  if (offsetRegions.length === 0) {\r\n    return undefined;\r\n  }\r\n\r\n  const startOffset = size.indexToOffset(index.getWithNew2D(\r\n    min[0], min[1]\r\n  ));\r\n  const endOffset = size.indexToOffset(index.getWithNew2D(\r\n    max[0], max[1]\r\n  ));\r\n\r\n  return rangeRegions(\r\n    dataAccessor, startOffset, endOffset + 1,\r\n    1, offsetRegions);\r\n}\r\n\r\n/**\r\n * Get a colour iterator. The input array defines the colours and\r\n * their start index.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols\r\n * @param {Array} colours An array of {index, colour} pairs.\r\n * @param {number} end The end of the range (excluded).\r\n * @returns {object} An iterator folowing the iterator and iterable protocol.\r\n */\r\nexport function colourRange(colours, end) {\r\n  let nextIndex = 0;\r\n  let nextColourIndex = 0;\r\n  // result\r\n  return {\r\n    next: function () {\r\n      if (nextIndex < end) {\r\n        if (nextColourIndex + 1 < colours.length &&\r\n          nextIndex >= colours[nextColourIndex + 1].index) {\r\n          ++nextColourIndex;\r\n        }\r\n        const result = {\r\n          value: colours[nextColourIndex].colour,\r\n          done: false,\r\n          index: nextIndex\r\n        };\r\n        ++nextIndex;\r\n        return result;\r\n      }\r\n      return {\r\n        done: true,\r\n        index: end\r\n      };\r\n    }\r\n  };\r\n}\r\n","/**\r\n * Rescale Slope and Intercept\r\n */\r\nexport class RescaleSlopeAndIntercept {\r\n\r\n  /**\r\n   * The slope.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #slope;\r\n\r\n  /**\r\n   * The intercept.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #intercept;\r\n\r\n  /**\r\n   * @param {number} slope The slope of the RSI.\r\n   * @param {number} intercept The intercept of the RSI.\r\n   */\r\n  constructor(slope, intercept) {\r\n    /*// Check the rescale slope.\r\n      if(typeof(slope) === 'undefined') {\r\n          slope = 1;\r\n      }\r\n      // Check the rescale intercept.\r\n      if(typeof(intercept) === 'undefined') {\r\n          intercept = 0;\r\n      }*/\r\n    this.#slope = slope;\r\n    this.#intercept = intercept;\r\n  }\r\n\r\n  /**\r\n   * Get the slope of the RSI.\r\n   *\r\n   * @returns {number} The slope of the RSI.\r\n   */\r\n  getSlope() {\r\n    return this.#slope;\r\n  }\r\n\r\n  /**\r\n   * Get the intercept of the RSI.\r\n   *\r\n   * @returns {number} The intercept of the RSI.\r\n   */\r\n  getIntercept() {\r\n    return this.#intercept;\r\n  }\r\n\r\n  /**\r\n   * Apply the RSI on an input value.\r\n   *\r\n   * @param {number} value The input value.\r\n   * @returns {number} The value to rescale.\r\n   */\r\n  apply(value) {\r\n    return value * this.#slope + this.#intercept;\r\n  }\r\n\r\n  /**\r\n   * Check for RSI equality.\r\n   *\r\n   * @param {RescaleSlopeAndIntercept} rhs The other RSI to compare to.\r\n   * @returns {boolean} True if both RSI are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      typeof rhs !== 'undefined' &&\r\n      this.getSlope() === rhs.getSlope() &&\r\n      this.getIntercept() === rhs.getIntercept();\r\n  }\r\n\r\n  /**\r\n   * Is this RSI an ID RSI.\r\n   *\r\n   * @returns {boolean} True if the RSI has a slope of 1 and no intercept.\r\n   */\r\n  isID() {\r\n    return (this.getSlope() === 1 && this.getIntercept() === 0);\r\n  }\r\n\r\n} // class RescaleSlopeAndIntercept\r\n","import {Index} from '../math/index';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Matrix33} from '../math/matrix';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Immutable Size class.\r\n * Warning: the input array is NOT cloned, modifying it will\r\n *  modify the index values.\r\n */\r\nexport class Size {\r\n\r\n  /**\r\n   * The size values.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #values;\r\n\r\n  /**\r\n   * @param {Array} values The size values.\r\n   */\r\n  constructor(values) {\r\n    if (!values || typeof values === 'undefined') {\r\n      throw new Error('Cannot create size with no values.');\r\n    }\r\n    if (values.length === 0) {\r\n      throw new Error('Cannot create size with empty values.');\r\n    }\r\n    const valueCheck = function (val) {\r\n      return !isNaN(val) && val !== 0;\r\n    };\r\n    if (!values.every(valueCheck)) {\r\n      throw new Error('Cannot create size with non number or zero values.');\r\n    }\r\n    this.#values = values;\r\n  }\r\n\r\n  /**\r\n   * Get the size value at the given array index.\r\n   *\r\n   * @param {number} i The index to get.\r\n   * @returns {number} The value.\r\n   */\r\n  get(i) {\r\n    return this.#values[i];\r\n  }\r\n\r\n  /**\r\n   * Get the length of the index.\r\n   *\r\n   * @returns {number} The length.\r\n   */\r\n  length() {\r\n    return this.#values.length;\r\n  }\r\n\r\n  /**\r\n   * Get a string representation of the size.\r\n   *\r\n   * @returns {string} The Size as a string.\r\n   */\r\n  toString() {\r\n    return '(' + this.#values.toString() + ')';\r\n  }\r\n\r\n  /**\r\n   * Get the values of this index.\r\n   *\r\n   * @returns {Array} The array of values.\r\n   */\r\n  getValues() {\r\n    return this.#values.slice();\r\n  }\r\n\r\n  /**\r\n   * Check if a dimension exists and has more than one element.\r\n   *\r\n   * @param {number} dimension The dimension to check.\r\n   * @returns {boolean} True if the size is more than one.\r\n   */\r\n  moreThanOne(dimension) {\r\n    return this.length() >= dimension + 1 && this.get(dimension) !== 1;\r\n  }\r\n\r\n  /**\r\n   * Check if the associated data is scrollable in 3D.\r\n   *\r\n   * @param {Matrix33} [viewOrientation] The orientation matrix.\r\n   * @returns {boolean} True if scrollable.\r\n   */\r\n  canScroll3D(viewOrientation) {\r\n    let dimension = 2;\r\n    if (typeof viewOrientation !== 'undefined') {\r\n      dimension = viewOrientation.getThirdColMajorDirection();\r\n    }\r\n    return this.moreThanOne(dimension);\r\n  }\r\n\r\n  /**\r\n   * Check if the associated data is scrollable: either in 3D or\r\n   * in other directions.\r\n   *\r\n   * @param {Matrix33} viewOrientation The orientation matrix.\r\n   * @returns {boolean} True if scrollable.\r\n   */\r\n  canScroll(viewOrientation) {\r\n    let canScroll = this.canScroll3D(viewOrientation);\r\n    // check possible other dimensions\r\n    for (let i = 3; i < this.length(); ++i) {\r\n      canScroll = canScroll || this.moreThanOne(i);\r\n    }\r\n    return canScroll;\r\n  }\r\n\r\n  /**\r\n   * Get the size of a given dimension.\r\n   *\r\n   * @param {number} dimension The dimension.\r\n   * @param {number} [start] Optional start dimension to start counting from.\r\n   * @returns {number} The size.\r\n   */\r\n  getDimSize(dimension, start) {\r\n    if (dimension > this.length()) {\r\n      return null;\r\n    }\r\n    if (typeof start === 'undefined') {\r\n      start = 0;\r\n    } else {\r\n      if (start < 0 || start > dimension) {\r\n        throw new Error('Invalid start value for getDimSize');\r\n      }\r\n    }\r\n    let size = 1;\r\n    for (let i = start; i < dimension; ++i) {\r\n      size *= this.get(i);\r\n    }\r\n    return size;\r\n  }\r\n\r\n  /**\r\n   * Get the total size.\r\n   *\r\n   * @param {number} [start] Optional start dimension to base the offset on.\r\n   * @returns {number} The total size.\r\n   */\r\n  getTotalSize(start) {\r\n    return this.getDimSize(this.length(), start);\r\n  }\r\n\r\n  /**\r\n   * Check for equality.\r\n   *\r\n   * @param {Size} rhs The object to compare to.\r\n   * @returns {boolean} True if both objects are equal.\r\n   */\r\n  equals(rhs) {\r\n    // check input\r\n    if (!rhs) {\r\n      return false;\r\n    }\r\n    // check length\r\n    const length = this.length();\r\n    if (length !== rhs.length()) {\r\n      return false;\r\n    }\r\n    // check values\r\n    for (let i = 0; i < length; ++i) {\r\n      if (this.get(i) !== rhs.get(i)) {\r\n        return false;\r\n      }\r\n    }\r\n    // seems ok!\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Check that an index is within bounds.\r\n   *\r\n   * @param {Index} index The index to check.\r\n   * @param {Array} dirs Optional list of directions to check.\r\n   * @returns {boolean} True if the given coordinates are within bounds.\r\n   */\r\n  isInBounds(index, dirs) {\r\n    // check input\r\n    if (!index) {\r\n      return false;\r\n    }\r\n    // check length\r\n    const length = this.length();\r\n    if (length !== index.length()) {\r\n      return false;\r\n    }\r\n    // create dirs if not there\r\n    if (typeof dirs === 'undefined') {\r\n      dirs = [];\r\n      for (let j = 0; j < length; ++j) {\r\n        dirs.push(j);\r\n      }\r\n    } else {\r\n      for (let k = 0; k < length; ++k) {\r\n        if (dirs[k] > length - 1) {\r\n          throw new Error('Wrong input dir value: ' + dirs[k]);\r\n        }\r\n      }\r\n    }\r\n    // check values is 0 <= v < size\r\n    const inBound = function (value, size) {\r\n      return value >= 0 && value < size;\r\n    };\r\n    // check\r\n    for (let i = 0; i < dirs.length; ++i) {\r\n      if (!inBound(index.get(dirs[i]), this.get(dirs[i]))) {\r\n        return false;\r\n      }\r\n    }\r\n    // seems ok!\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Convert an index to an offset in memory.\r\n   *\r\n   * @param {Index} index The index to convert.\r\n   * @param {number} [start] Optional start dimension to base the offset on.\r\n   * @returns {number} The offset.\r\n   */\r\n  indexToOffset(index, start) {\r\n    // TODO check for equality\r\n    if (index.length() < this.length()) {\r\n      throw new Error('Incompatible index and size length');\r\n    }\r\n    if (typeof start === 'undefined') {\r\n      start = 0;\r\n    } else {\r\n      if (start < 0 || start > this.length() - 1) {\r\n        throw new Error('Invalid start value for indexToOffset');\r\n      }\r\n    }\r\n    let offset = 0;\r\n    for (let i = start; i < this.length(); ++i) {\r\n      offset += index.get(i) * this.getDimSize(i, start);\r\n    }\r\n    return offset;\r\n  }\r\n\r\n  /**\r\n   * Convert an offset in memory to an index.\r\n   *\r\n   * @param {number} offset The offset to convert.\r\n   * @returns {Index} The index.\r\n   */\r\n  offsetToIndex(offset) {\r\n    const values = new Array(this.length());\r\n    let off = offset;\r\n    let dimSize = 0;\r\n    for (let i = this.length() - 1; i > 0; --i) {\r\n      dimSize = this.getDimSize(i);\r\n      values[i] = Math.floor(off / dimSize);\r\n      off = off - values[i] * dimSize;\r\n    }\r\n    values[0] = off;\r\n    return new Index(values);\r\n  }\r\n\r\n  /**\r\n   * Get the 2D base of this size.\r\n   *\r\n   * @returns {object} The 2D base [0,1] as {x,y}.\r\n   */\r\n  get2D() {\r\n    return {\r\n      x: this.get(0),\r\n      y: this.get(1)\r\n    };\r\n  }\r\n\r\n} // Size class\r\n","/**\r\n * Immutable Spacing class.\r\n * Warning: the input array is NOT cloned, modifying it will\r\n *  modify the index values.\r\n */\r\nexport class Spacing {\r\n\r\n  /**\r\n   * The spacing values.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #values;\r\n\r\n  /**\r\n   * @param {Array} values The spacing values.\r\n   */\r\n  constructor(values) {\r\n    if (!values || typeof values === 'undefined') {\r\n      throw new Error('Cannot create spacing with no values.');\r\n    }\r\n    if (values.length === 0) {\r\n      throw new Error('Cannot create spacing with empty values.');\r\n    }\r\n    const valueCheck = function (val) {\r\n      return !isNaN(val) && val !== 0;\r\n    };\r\n    if (!values.every(valueCheck)) {\r\n      throw new Error('Cannot create spacing with non number or zero values.');\r\n    }\r\n    this.#values = values;\r\n  }\r\n\r\n  /**\r\n   * Get the spacing value at the given array index.\r\n   *\r\n   * @param {number} i The index to get.\r\n   * @returns {number} The value.\r\n   */\r\n  get(i) {\r\n    return this.#values[i];\r\n  }\r\n\r\n  /**\r\n   * Get the length of the spacing.\r\n   *\r\n   * @returns {number} The length.\r\n   */\r\n  length() {\r\n    return this.#values.length;\r\n  }\r\n\r\n  /**\r\n   * Get a string representation of the spacing.\r\n   *\r\n   * @returns {string} The spacing as a string.\r\n   */\r\n  toString() {\r\n    return '(' + this.#values.toString() + ')';\r\n  }\r\n\r\n  /**\r\n   * Get the values of this spacing.\r\n   *\r\n   * @returns {Array} The array of values.\r\n   */\r\n  getValues() {\r\n    return this.#values.slice();\r\n  }\r\n\r\n  /**\r\n   * Check for equality.\r\n   *\r\n   * @param {Spacing} rhs The object to compare to.\r\n   * @returns {boolean} True if both objects are equal.\r\n   */\r\n  equals(rhs) {\r\n    // check input\r\n    if (!rhs) {\r\n      return false;\r\n    }\r\n    // check length\r\n    const length = this.length();\r\n    if (length !== rhs.length()) {\r\n      return false;\r\n    }\r\n    // check values\r\n    for (let i = 0; i < length; ++i) {\r\n      if (this.get(i) !== rhs.get(i)) {\r\n        return false;\r\n      }\r\n    }\r\n    // seems ok!\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get the 2D base of this size.\r\n   *\r\n   * @returns {object} The 2D base [col,row] as {x,y}.\r\n   */\r\n  get2D() {\r\n    return {\r\n      x: this.get(0),\r\n      y: this.get(1)\r\n    };\r\n  }\r\n\r\n} // Spacing class\r\n","import {\r\n  BIG_EPSILON,\r\n  isSimilar,\r\n  getIdentityMat33\r\n} from '../math/matrix';\r\nimport {Point3D, Point} from '../math/point';\r\nimport {Vector3D} from '../math/vector';\r\nimport {Index} from '../math/index';\r\nimport {logger} from '../utils/logger';\r\nimport {Size} from './size';\r\nimport {Spacing} from './spacing';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Matrix33} from '../math/matrix';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * 2D/3D Geometry class.\r\n */\r\nexport class Geometry {\r\n\r\n  /**\r\n   * Array of origins.\r\n   *\r\n   * @type {Point3D[]}\r\n   */\r\n  #origins;\r\n\r\n  /**\r\n   * Data size.\r\n   *\r\n   * @type {Size}\r\n   */\r\n  #size;\r\n\r\n  /**\r\n   * Data spacing.\r\n   *\r\n   * @type {Spacing}\r\n   */\r\n  #spacing;\r\n\r\n  /**\r\n   * Local helper object for time points.\r\n   *\r\n   * @type {Object<string, Point3D[]>}\r\n   */\r\n  #timeOrigins = {};\r\n\r\n  /**\r\n   * Initial time index.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #initialTime;\r\n\r\n  /**\r\n   * Data orientation.\r\n   *\r\n   * @type {Matrix33}\r\n   */\r\n  #orientation = getIdentityMat33();\r\n\r\n  /**\r\n   * Flag to know if new origins were added.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #newOrigins = false;\r\n\r\n  /**\r\n   * @param {Point3D} origin The object origin (a 3D point).\r\n   * @param {Size} size The object size.\r\n   * @param {Spacing} spacing The object spacing.\r\n   * @param {Matrix33} [orientation] The object orientation (3*3 matrix,\r\n   *   default to 3*3 identity).\r\n   * @param {number} [time] Optional time index.\r\n   */\r\n  constructor(origin, size, spacing, orientation, time) {\r\n    this.#origins = [origin];\r\n    this.#size = size;\r\n    this.#spacing = spacing;\r\n    if (typeof time !== 'undefined') {\r\n      this.#initialTime = time;\r\n      this.#timeOrigins[time] = [origin];\r\n    }\r\n    // check input orientation\r\n    if (typeof orientation !== 'undefined') {\r\n      this.#orientation = orientation;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the time value that was passed at construction.\r\n   *\r\n   * @returns {number} The time value.\r\n   */\r\n  getInitialTime() {\r\n    return this.#initialTime;\r\n  }\r\n\r\n  /**\r\n   * Get the total number of slices.\r\n   * Can be different from what is stored in the size object\r\n   *  during a volume with time points creation process.\r\n   *\r\n   * @returns {number} The total count.\r\n   */\r\n  getCurrentTotalNumberOfSlices() {\r\n    const keys = Object.keys(this.#timeOrigins);\r\n    if (keys.length === 0) {\r\n      return this.#origins.length;\r\n    }\r\n    let count = 0;\r\n    for (let i = 0; i < keys.length; ++i) {\r\n      count += this.#timeOrigins[keys[i]].length;\r\n    }\r\n    return count;\r\n  }\r\n\r\n  /**\r\n   * Check if a time point has associated slices.\r\n   *\r\n   * @param {number} time The time point to check.\r\n   * @returns {boolean} True if slices are present.\r\n   */\r\n  hasSlicesAtTime(time) {\r\n    return typeof this.#timeOrigins[time] !== 'undefined';\r\n  }\r\n\r\n  /**\r\n   * Get the number of slices stored for time points preceding\r\n   * the input one.\r\n   *\r\n   * @param {number} time The time point to check.\r\n   * @returns {number|undefined} The count.\r\n   */\r\n  getCurrentNumberOfSlicesBeforeTime(time) {\r\n    const keys = Object.keys(this.#timeOrigins);\r\n    if (keys.length === 0) {\r\n      return undefined;\r\n    }\r\n    let count = 0;\r\n    for (let i = 0; i < keys.length; ++i) {\r\n      const key = keys[i];\r\n      if (parseInt(key, 10) === time) {\r\n        break;\r\n      }\r\n      count += this.#timeOrigins[key].length;\r\n    }\r\n    return count;\r\n  }\r\n\r\n  /**\r\n   * Get the object origin.\r\n   * This should be the lowest origin to ease calculations (?).\r\n   *\r\n   * @returns {Point3D} The object origin.\r\n   */\r\n  getOrigin() {\r\n    return this.#origins[0];\r\n  }\r\n\r\n  /**\r\n   * Get the object origins.\r\n   *\r\n   * @returns {Point3D[]} The object origins.\r\n   */\r\n  getOrigins() {\r\n    return this.#origins;\r\n  }\r\n\r\n  /**\r\n   * Check if a point is in the origin list.\r\n   *\r\n   * @param {Point3D} point3D The point to check.\r\n   * @param {number} tol The comparison tolerance\r\n   *   default to Number.EPSILON.\r\n   * @returns {boolean} True if in list.\r\n   */\r\n  includesOrigin(point3D, tol) {\r\n    for (let i = 0; i < this.#origins.length; ++i) {\r\n      if (this.#origins[i].isSimilar(point3D, tol)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get the object size.\r\n   * Warning: the size comes as stored in DICOM, meaning that it could\r\n   * be oriented.\r\n   *\r\n   * @param {Matrix33} [viewOrientation] The view orientation (optional)\r\n   * @returns {Size} The object size.\r\n   */\r\n  getSize(viewOrientation) {\r\n    let res = this.#size;\r\n    if (viewOrientation && typeof viewOrientation !== 'undefined') {\r\n      let values = getOrientedArray3D(\r\n        [\r\n          this.#size.get(0),\r\n          this.#size.get(1),\r\n          this.#size.get(2)\r\n        ],\r\n        viewOrientation);\r\n      values = values.map(Math.abs);\r\n      res = new Size(values.concat(this.#size.getValues().slice(3)));\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Calculate slice spacing from origins and replace current\r\n   *   if needed.\r\n   */\r\n  #updateSliceSpacing() {\r\n    const geoSliceSpacing = getSliceGeometrySpacing(\r\n      this.#origins,\r\n      this.#orientation\r\n    );\r\n    // update local if needed\r\n    if (typeof geoSliceSpacing !== 'undefined' &&\r\n      this.#spacing.get(2) !== geoSliceSpacing) {\r\n      logger.trace('Updating slice spacing.');\r\n      const values = this.#spacing.getValues();\r\n      values[2] = geoSliceSpacing;\r\n      this.#spacing = new Spacing(values);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the object spacing.\r\n   * Warning: the spacing comes as stored in DICOM, meaning that it could\r\n   * be oriented.\r\n   *\r\n   * @param {Matrix33} [viewOrientation] The view orientation (optional)\r\n   * @returns {Spacing} The object spacing.\r\n   */\r\n  getSpacing(viewOrientation) {\r\n    // update slice spacing after appendSlice\r\n    if (this.#newOrigins) {\r\n      this.#updateSliceSpacing();\r\n      this.#newOrigins = false;\r\n    }\r\n    let res = this.#spacing;\r\n    if (viewOrientation && typeof viewOrientation !== 'undefined') {\r\n      let orientedValues = getOrientedArray3D(\r\n        [\r\n          this.#spacing.get(0),\r\n          this.#spacing.get(1),\r\n          this.#spacing.get(2)\r\n        ],\r\n        viewOrientation);\r\n      orientedValues = orientedValues.map(Math.abs);\r\n      res = new Spacing(orientedValues);\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Get the image spacing in real world.\r\n   *\r\n   * @returns {Spacing} The object spacing.\r\n   */\r\n  getRealSpacing() {\r\n    // asOneAndZeros to not change spacing values...\r\n    return this.getSpacing(\r\n      this.#orientation.getInverse().asOneAndZeros()\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the object orientation.\r\n   *\r\n   * @returns {Matrix33} The object orientation.\r\n   */\r\n  getOrientation() {\r\n    return this.#orientation;\r\n  }\r\n\r\n  /**\r\n   * Get the slice position of a point in the current slice layout.\r\n   * Slice indices increase with decreasing origins (high index -> low origin),\r\n   * this simplified the handling of reconstruction since it means\r\n   * the displayed data is in the same 'direction' as the extracted data.\r\n   * As seen in the getOrigin method, the main origin is the lowest one.\r\n   * This implies that the index to world and reverse method do some flipping\r\n   * magic...\r\n   *\r\n   * @param {Point3D} point The point to evaluate.\r\n   * @param {number} time Optional time index.\r\n   * @returns {number} The slice index.\r\n   */\r\n  getSliceIndex(point, time) {\r\n    // cannot use this.worldToIndex(point).getK() since\r\n    // we cannot guaranty consecutive slices...\r\n\r\n    let localOrigins = this.#origins;\r\n    if (typeof time !== 'undefined') {\r\n      localOrigins = this.#timeOrigins[time];\r\n    }\r\n\r\n    // find the closest index\r\n    let closestSliceIndex = 0;\r\n    let minDist = point.getDistance(localOrigins[0]);\r\n    let dist = 0;\r\n    for (let i = 0; i < localOrigins.length; ++i) {\r\n      dist = point.getDistance(localOrigins[i]);\r\n      if (dist < minDist) {\r\n        minDist = dist;\r\n        closestSliceIndex = i;\r\n      }\r\n    }\r\n    const closestOrigin = localOrigins[closestSliceIndex];\r\n    // direction between the input point and the closest origin\r\n    const pointDir = point.minus(closestOrigin);\r\n    // use third orientation matrix column as base plane vector\r\n    const normal = new Vector3D(\r\n      this.#orientation.get(0, 2),\r\n      this.#orientation.get(1, 2),\r\n      this.#orientation.get(2, 2)\r\n    );\r\n    // a.dot(b) = ||a|| * ||b|| * cos(theta)\r\n    // (https://en.wikipedia.org/wiki/Dot_product#Geometric_definition)\r\n    // -> the sign of the dot product depends on the cosinus of\r\n    //    the angle between the vectors\r\n    //   -> >0 => vectors are codirectional\r\n    //   -> <0 => vectors are opposite\r\n    const dotProd = normal.dotProduct(pointDir);\r\n    // oposite vectors get higher index\r\n    const sliceIndex = dotProd > 0 ? closestSliceIndex + 1 : closestSliceIndex;\r\n    return sliceIndex;\r\n  }\r\n\r\n  /**\r\n   * Append an origin to the geometry.\r\n   *\r\n   * @param {Point3D} origin The origin to append.\r\n   * @param {number} index The index at which to append.\r\n   * @param {number} [time] Optional time index.\r\n   */\r\n  appendOrigin(origin, index, time) {\r\n    // equal callback\r\n    const equalToOrigin = function (element) {\r\n      return element.equals(origin);\r\n    };\r\n    if (typeof time !== 'undefined') {\r\n      // check if not already in list\r\n      const found = this.#timeOrigins[time].find(equalToOrigin);\r\n      if (typeof found !== 'undefined') {\r\n        throw new Error('Cannot append same time origin twice');\r\n      }\r\n      // add in origin array\r\n      this.#timeOrigins[time].splice(index, 0, origin);\r\n    }\r\n    if (typeof time === 'undefined' || time === this.#initialTime) {\r\n      // check if not already in list\r\n      const found = this.#origins.find(equalToOrigin);\r\n      if (typeof found !== 'undefined') {\r\n        throw new Error('Cannot append same origin twice');\r\n      }\r\n      // update flag\r\n      this.#newOrigins = true;\r\n      // add in origin array\r\n      this.#origins.splice(index, 0, origin);\r\n      // increment second dimension\r\n      const values = this.#size.getValues();\r\n      values[2] += 1;\r\n      this.#size = new Size(values);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Append a frame to the geometry.\r\n   *\r\n   * @param {Point3D} origin The origin to append.\r\n   * @param {number} time Optional time index.\r\n   */\r\n  appendFrame(origin, time) {\r\n    // add origin to list\r\n    this.#timeOrigins[time] = [origin];\r\n    // increment third dimension\r\n    const sizeValues = this.#size.getValues();\r\n    const spacingValues = this.#spacing.getValues();\r\n    if (sizeValues.length === 4) {\r\n      sizeValues[3] += 1;\r\n    } else {\r\n      sizeValues.push(2);\r\n      spacingValues.push(1);\r\n    }\r\n    this.#size = new Size(sizeValues);\r\n    this.#spacing = new Spacing(spacingValues);\r\n  }\r\n\r\n  /**\r\n   * Get a string representation of the geometry.\r\n   *\r\n   * @returns {string} The geometry as a string.\r\n   */\r\n  toString() {\r\n    return 'Origin: ' + this.getOrigin() +\r\n      ', Size: ' + this.getSize() +\r\n      ', Spacing: ' + this.getSpacing() +\r\n      ', Orientation: ' + this.getOrientation();\r\n  }\r\n\r\n  /**\r\n   * Check for equality.\r\n   *\r\n   * @param {Geometry} rhs The object to compare to.\r\n   * @returns {boolean} True if both objects are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      this.getOrigin().equals(rhs.getOrigin()) &&\r\n      this.getSize().equals(rhs.getSize()) &&\r\n      this.getSpacing().equals(rhs.getSpacing());\r\n  }\r\n\r\n  /**\r\n   * Check that a point is within bounds.\r\n   *\r\n   * @param {Point} point The point to check.\r\n   * @returns {boolean} True if the given coordinates are within bounds.\r\n   */\r\n  isInBounds(point) {\r\n    return this.isIndexInBounds(this.worldToIndex(point));\r\n  }\r\n\r\n  /**\r\n   * Check that a index is within bounds.\r\n   *\r\n   * @param {Index} index The index to check.\r\n   * @param {number[]} [dirs] Optional list of directions to check.\r\n   * @returns {boolean} True if the given coordinates are within bounds.\r\n   */\r\n  isIndexInBounds(index, dirs) {\r\n    return this.getSize().isInBounds(index, dirs);\r\n  }\r\n\r\n  /**\r\n   * Convert an index into world coordinates.\r\n   *\r\n   * @param {Index} index The index to convert.\r\n   * @returns {Point} The corresponding point.\r\n   */\r\n  indexToWorld(index) {\r\n    // apply spacing\r\n    // (spacing is oriented, apply before orientation)\r\n    const spacing = this.getSpacing();\r\n    const orientedPoint3D = new Point3D(\r\n      index.get(0) * spacing.get(0),\r\n      index.get(1) * spacing.get(1),\r\n      index.get(2) * spacing.get(2)\r\n    );\r\n    // de-orient\r\n    const point3D = this.getOrientation().multiplyPoint3D(orientedPoint3D);\r\n    // keep >3d values\r\n    const values = index.getValues();\r\n    const origin = this.getOrigin();\r\n    values[0] = origin.getX() + point3D.getX();\r\n    values[1] = origin.getY() + point3D.getY();\r\n    values[2] = origin.getZ() + point3D.getZ();\r\n    // return point\r\n    return new Point(values);\r\n  }\r\n\r\n  /**\r\n   * Convert a 3D point into world coordinates.\r\n   *\r\n   * @param {Point3D} point The 3D point to convert.\r\n   * @returns {Point3D} The corresponding world 3D point.\r\n   */\r\n  pointToWorld(point) {\r\n    // apply spacing\r\n    // (spacing is oriented, apply before orientation)\r\n    const spacing = this.getSpacing();\r\n    const orientedPoint3D = new Point3D(\r\n      point.getX() * spacing.get(0),\r\n      point.getY() * spacing.get(1),\r\n      point.getZ() * spacing.get(2)\r\n    );\r\n    // de-orient\r\n    const point3D = this.getOrientation().multiplyPoint3D(orientedPoint3D);\r\n    // return point3D\r\n    const origin = this.getOrigin();\r\n    return new Point3D(\r\n      origin.getX() + point3D.getX(),\r\n      origin.getY() + point3D.getY(),\r\n      origin.getZ() + point3D.getZ()\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Convert world coordinates into an index.\r\n   *\r\n   * @param {Point} point The point to convert.\r\n   * @returns {Index} The corresponding index.\r\n   */\r\n  worldToIndex(point) {\r\n    // compensate for origin\r\n    // (origin is not oriented, compensate before orientation)\r\n    // TODO: use slice origin...\r\n    const origin = this.getOrigin();\r\n    const point3D = new Point3D(\r\n      point.get(0) - origin.getX(),\r\n      point.get(1) - origin.getY(),\r\n      point.get(2) - origin.getZ()\r\n    );\r\n    // orient\r\n    const orientedPoint3D =\r\n      this.getOrientation().getInverse().multiplyPoint3D(point3D);\r\n    // keep >3d values\r\n    const values = point.getValues();\r\n    // apply spacing and round\r\n    const spacing = this.getSpacing();\r\n    values[0] = Math.round(orientedPoint3D.getX() / spacing.get(0));\r\n    values[1] = Math.round(orientedPoint3D.getY() / spacing.get(1));\r\n    values[2] = Math.round(orientedPoint3D.getZ() / spacing.get(2));\r\n\r\n    // return index\r\n    return new Index(values);\r\n  }\r\n\r\n  /**\r\n   * Convert world coordinates into an point.\r\n   *\r\n   * @param {Point} point The world point to convert.\r\n   * @returns {Point3D} The corresponding point.\r\n   */\r\n  worldToPoint(point) {\r\n    // compensate for origin\r\n    // (origin is not oriented, compensate before orientation)\r\n    const origin = this.getOrigin();\r\n    const point3D = new Point3D(\r\n      point.get(0) - origin.getX(),\r\n      point.get(1) - origin.getY(),\r\n      point.get(2) - origin.getZ()\r\n    );\r\n    // orient\r\n    const orientedPoint3D =\r\n      this.getOrientation().getInverse().multiplyPoint3D(point3D);\r\n    // keep >3d values\r\n    const values = point.getValues();\r\n    // apply spacing and round\r\n    const spacing = this.getSpacing();\r\n    values[0] = orientedPoint3D.getX() / spacing.get(0);\r\n    values[1] = orientedPoint3D.getY() / spacing.get(1);\r\n    values[2] = orientedPoint3D.getZ() / spacing.get(2);\r\n\r\n    // return index\r\n    return new Point3D(values[0], values[1], values[2]);\r\n  }\r\n\r\n} // class Geometry\r\n\r\n/**\r\n * Get the oriented values of an input 3D array.\r\n *\r\n * @param {Array} array3D The 3D array.\r\n * @param {Matrix33} orientation The orientation 3D matrix.\r\n * @returns {Array} The values reordered according to the orientation.\r\n */\r\nexport function getOrientedArray3D(array3D, orientation) {\r\n  // values = orientation * orientedValues\r\n  // -> inv(orientation) * values = orientedValues\r\n  return orientation.getInverse().multiplyArray3D(array3D);\r\n}\r\n\r\n/**\r\n * Get the raw values of an oriented input 3D array.\r\n *\r\n * @param {Array} array3D The 3D array.\r\n * @param {Matrix33} orientation The orientation 3D matrix.\r\n * @returns {Array} The values reordered to compensate the orientation.\r\n */\r\nexport function getDeOrientedArray3D(array3D, orientation) {\r\n  // values = orientation * orientedValues\r\n  return orientation.multiplyArray3D(array3D);\r\n}\r\n\r\n/**\r\n * Get the slice spacing from the difference in the Z directions\r\n * of input origins.\r\n *\r\n * @param {Point3D[]} origins An array of Point3D.\r\n * @param {Matrix33} orientation The oritentation matrix.\r\n * @param {boolean} [withCheck] Flag to activate spacing variation check,\r\n *   default to true.\r\n * @returns {number|undefined} The spacing.\r\n */\r\nexport function getSliceGeometrySpacing(origins, orientation, withCheck) {\r\n  if (typeof withCheck === 'undefined') {\r\n    withCheck = true;\r\n  }\r\n  // check origins\r\n  if (origins.length <= 1) {\r\n    return;\r\n  }\r\n  // (x, y, z) = orientationMatrix * (i, j, k)\r\n  // -> inv(orientationMatrix) * (x, y, z) = (i, j, k)\r\n  // applied on the patient position, reorders indices\r\n  // so that Z is the slice direction\r\n  const invOrientation = orientation.getInverse();\r\n  let origin1 = invOrientation.multiplyPoint3D(origins[0]);\r\n  let origin2 = invOrientation.multiplyPoint3D(origins[1]);\r\n  let sliceSpacing = Math.abs(origin1.getZ() - origin2.getZ());\r\n  const deltas = [];\r\n  for (let i = 0; i < origins.length - 1; ++i) {\r\n    origin1 = invOrientation.multiplyPoint3D(origins[i]);\r\n    origin2 = invOrientation.multiplyPoint3D(origins[i + 1]);\r\n    const diff = Math.abs(origin1.getZ() - origin2.getZ());\r\n    if (diff === 0) {\r\n      throw new Error('Zero slice spacing.' +\r\n        origin1.toString() + ' ' + origin2.toString());\r\n    }\r\n    // keep smallest\r\n    if (diff < sliceSpacing) {\r\n      sliceSpacing = diff;\r\n    }\r\n    if (withCheck) {\r\n      if (!isSimilar(sliceSpacing, diff, BIG_EPSILON)) {\r\n        deltas.push(Math.abs(sliceSpacing - diff));\r\n      }\r\n    }\r\n  }\r\n  // warn if non constant\r\n  if (withCheck && deltas.length !== 0) {\r\n    const sumReducer = function (sum, value) {\r\n      return sum + value;\r\n    };\r\n    const mean = deltas.reduce(sumReducer) / deltas.length;\r\n    if (mean > 1e-4) {\r\n      logger.warn('Varying slice spacing, mean delta: ' +\r\n        mean.toFixed(3) + ' (' + deltas.length + ' case(s))');\r\n    }\r\n  }\r\n\r\n  return sliceSpacing;\r\n}\r\n","import {\r\n  DicomParser,\r\n  getTransferSyntaxName\r\n} from './dicomParser';\r\nimport {\r\n  isPixelDataTag,\r\n  isItemDelimitationItemTag,\r\n  isSequenceDelimitationItemTag,\r\n  getItemTag,\r\n  getItemDelimitationItemTag,\r\n  getSequenceDelimitationItemTag,\r\n  getPixelDataTag,\r\n  getTagFromKey\r\n} from './dicomTag';\r\nimport {isNativeLittleEndian} from './dataReader';\r\nimport {Spacing} from '../image/spacing';\r\nimport {logger} from '../utils/logger';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Tag} from './dicomTag';\r\nimport {DataElement} from './dataElement';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Dump the DICOM tags to a string in the same way as the\r\n * DCMTK `dcmdump` command (https://support.dcmtk.org/docs-dcmrt/dcmdump.html).\r\n *\r\n * @param {Object<string, DataElement>} dicomElements The dicom elements.\r\n * @returns {string} The dumped file.\r\n */\r\nexport function dcmdump(dicomElements) {\r\n  const keys = Object.keys(dicomElements);\r\n  let result = '\\n';\r\n  result += '# Dicom-File-Format\\n';\r\n  result += '\\n';\r\n  result += '# Dicom-Meta-Information-Header\\n';\r\n  result += '# Used TransferSyntax: ';\r\n  if (isNativeLittleEndian()) {\r\n    result += 'Little Endian Explicit\\n';\r\n  } else {\r\n    result += 'NOT Little Endian Explicit\\n';\r\n  }\r\n  let dicomElement = null;\r\n  let tag = null;\r\n  let checkHeader = true;\r\n  for (let i = 0, leni = keys.length; i < leni; ++i) {\r\n    dicomElement = dicomElements[keys[i]];\r\n    tag = getTagFromKey(keys[i]);\r\n    if (checkHeader && tag.getGroup() !== '0002') {\r\n      result += '\\n';\r\n      result += '# Dicom-Data-Set\\n';\r\n      result += '# Used TransferSyntax: ';\r\n      const syntax = dicomElements['00020010'].value[0];\r\n      result += getTransferSyntaxName(syntax);\r\n      result += '\\n';\r\n      checkHeader = false;\r\n    }\r\n    result += getElementAsString(tag, dicomElement) + '\\n';\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * Get a data element value as a string.\r\n *\r\n * @param {Tag} tag The DICOM tag.\r\n * @param {object} dicomElement The DICOM element.\r\n * @param {boolean} [pretty] When set to true, returns a 'pretified' content.\r\n * @returns {string} A string representation of the DICOM element.\r\n */\r\nfunction getElementValueAsString(tag, dicomElement, pretty) {\r\n  let str = '';\r\n  const strLenLimit = 65;\r\n\r\n  // dafault to pretty output\r\n  if (typeof pretty === 'undefined') {\r\n    pretty = true;\r\n  }\r\n  // check dicom element input\r\n  if (typeof dicomElement === 'undefined' || dicomElement === null) {\r\n    return str;\r\n  }\r\n\r\n  // Polyfill for Number.isInteger.\r\n  const isInteger = Number.isInteger || function (value) {\r\n    return typeof value === 'number' &&\r\n      isFinite(value) &&\r\n      Math.floor(value) === value;\r\n  };\r\n\r\n  // TODO Support sequences.\r\n\r\n  if (dicomElement.vr !== 'SQ' &&\r\n    dicomElement.value.length === 1 && dicomElement.value[0] === '') {\r\n    str += '(no value available)';\r\n  } else if (isPixelDataTag(tag) &&\r\n    dicomElement.undefinedLength) {\r\n    str = '(PixelSequence)';\r\n  } else if (dicomElement.vr === 'DA' && pretty) {\r\n    const daObj = getDate(dicomElement);\r\n    const da = new Date(daObj.year, daObj.monthIndex, daObj.day);\r\n    str = da.toLocaleDateString();\r\n  } else if (dicomElement.vr === 'TM' && pretty) {\r\n    const tmObj = getTime(dicomElement);\r\n    str = tmObj.hours + ':' + tmObj.minutes + ':' + tmObj.seconds;\r\n  } else {\r\n    let isOtherVR = false;\r\n    if (dicomElement.vr.length !== 0) {\r\n      isOtherVR = (dicomElement.vr[0].toUpperCase() === 'O');\r\n    }\r\n    const isFloatNumberVR = (dicomElement.vr === 'FL' ||\r\n      dicomElement.vr === 'FD' ||\r\n      dicomElement.vr === 'DS');\r\n    let valueStr = '';\r\n    for (let k = 0, lenk = dicomElement.value.length; k < lenk; ++k) {\r\n      valueStr = '';\r\n      if (k !== 0) {\r\n        valueStr += '\\\\';\r\n      }\r\n      if (isFloatNumberVR) {\r\n        const num = Number(dicomElement.value[k]);\r\n        if (!isInteger(num) && pretty) {\r\n          valueStr += num.toPrecision(4);\r\n        } else {\r\n          valueStr += num.toString();\r\n        }\r\n      } else if (isOtherVR) {\r\n        let tmp = dicomElement.value[k].toString(16);\r\n        if (dicomElement.vr === 'OB') {\r\n          tmp = '00'.substring(0, 2 - tmp.length) + tmp;\r\n        } else {\r\n          tmp = '0000'.substring(0, 4 - tmp.length) + tmp;\r\n        }\r\n        valueStr += tmp;\r\n      } else {\r\n        valueStr += dicomElement.value[k];\r\n      }\r\n      // check length\r\n      if (str.length + valueStr.length <= strLenLimit) {\r\n        str += valueStr;\r\n      } else {\r\n        str += '...';\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  return str;\r\n}\r\n\r\n/**\r\n * Get a data element as a string.\r\n *\r\n * @param {Tag} tag The DICOM tag.\r\n * @param {object} dicomElement The DICOM element.\r\n * @param {string} [prefix] A string to prepend this one.\r\n * @returns {string} The element as a string.\r\n */\r\nfunction getElementAsString(tag, dicomElement, prefix) {\r\n  // default prefix\r\n  prefix = prefix || '';\r\n\r\n  // get tag anme from dictionary\r\n  const tagName = tag.getNameFromDictionary();\r\n\r\n  let deSize = dicomElement.value.length;\r\n  let isOtherVR = false;\r\n  if (dicomElement.vr.length !== 0) {\r\n    isOtherVR = (dicomElement.vr[0].toUpperCase() === 'O');\r\n  }\r\n\r\n  // no size for delimitations\r\n  if (isItemDelimitationItemTag(tag) ||\r\n    isSequenceDelimitationItemTag(tag)) {\r\n    deSize = 0;\r\n  } else if (isOtherVR) {\r\n    deSize = 1;\r\n  }\r\n\r\n  const isPixSequence = (isPixelDataTag(tag) &&\r\n    dicomElement.undefinedLength);\r\n\r\n  let line = null;\r\n\r\n  // (group,element)\r\n  line = '(';\r\n  line += tag.getGroup().toLowerCase();\r\n  line += ',';\r\n  line += tag.getElement().toLowerCase();\r\n  line += ') ';\r\n  // value representation\r\n  line += dicomElement.vr;\r\n  // value\r\n  if (dicomElement.vr !== 'SQ' &&\r\n    dicomElement.value.length === 1 &&\r\n    dicomElement.value[0] === '') {\r\n    line += ' (no value available)';\r\n    deSize = 0;\r\n  } else {\r\n    // simple number display\r\n    if (dicomElement.vr === 'na') {\r\n      line += ' ';\r\n      line += dicomElement.value[0];\r\n    } else if (isPixSequence) {\r\n      // pixel sequence\r\n      line += ' (PixelSequence #=' + deSize + ')';\r\n    } else if (dicomElement.vr === 'SQ') {\r\n      line += ' (Sequence with';\r\n      if (dicomElement.undefinedLength) {\r\n        line += ' undefined';\r\n      } else {\r\n        line += ' explicit';\r\n      }\r\n      line += ' length #=';\r\n      line += dicomElement.value.length;\r\n      line += ')';\r\n    } else if (isOtherVR ||\r\n        dicomElement.vr === 'pi' ||\r\n        dicomElement.vr === 'UL' ||\r\n        dicomElement.vr === 'US' ||\r\n        dicomElement.vr === 'SL' ||\r\n        dicomElement.vr === 'SS' ||\r\n        dicomElement.vr === 'FL' ||\r\n        dicomElement.vr === 'FD' ||\r\n        dicomElement.vr === 'AT') {\r\n      // 'O'ther array, limited display length\r\n      line += ' ';\r\n      line += getElementValueAsString(tag, dicomElement, false);\r\n    } else {\r\n      // default\r\n      line += ' [';\r\n      line += getElementValueAsString(tag, dicomElement, false);\r\n      line += ']';\r\n    }\r\n  }\r\n\r\n  // align #\r\n  const nSpaces = 55 - line.length;\r\n  if (nSpaces > 0) {\r\n    for (let s = 0; s < nSpaces; ++s) {\r\n      line += ' ';\r\n    }\r\n  }\r\n  line += ' # ';\r\n  if (dicomElement.vl < 100) {\r\n    line += ' ';\r\n  }\r\n  if (dicomElement.vl < 10) {\r\n    line += ' ';\r\n  }\r\n  line += dicomElement.vl;\r\n  line += ', ';\r\n  line += deSize; //dictElement[1];\r\n  line += ' ';\r\n  if (tagName !== null) {\r\n    line += tagName;\r\n  } else {\r\n    line += 'Unknown Tag & Data';\r\n  }\r\n\r\n  let message = null;\r\n\r\n  // continue for sequence\r\n  if (dicomElement.vr === 'SQ') {\r\n    let item = null;\r\n    for (let l = 0, lenl = dicomElement.value.length; l < lenl; ++l) {\r\n      item = dicomElement.value[l];\r\n      const itemKeys = Object.keys(item);\r\n      if (itemKeys.length === 0) {\r\n        continue;\r\n      }\r\n\r\n      // get the item element\r\n      const itemTag = getItemTag();\r\n      const itemElement = item['FFFEE000'];\r\n      message = '(Item with';\r\n      if (itemElement.undefinedLength) {\r\n        message += ' undefined';\r\n      } else {\r\n        message += ' explicit';\r\n      }\r\n      message += ' length #=' + (itemKeys.length - 1) + ')';\r\n      itemElement.value = [message];\r\n      itemElement.vr = 'na';\r\n\r\n      line += '\\n';\r\n      line += getElementAsString(itemTag, itemElement, prefix + '  ');\r\n\r\n      for (let m = 0, lenm = itemKeys.length; m < lenm; ++m) {\r\n        const itemTag = getTagFromKey(itemKeys[m]);\r\n        if (itemKeys[m] !== 'xFFFEE000') {\r\n          line += '\\n';\r\n          line += getElementAsString(itemTag, item[itemKeys[m]],\r\n            prefix + '    ');\r\n        }\r\n      }\r\n\r\n      message = '(ItemDelimitationItem';\r\n      if (!itemElement.undefinedLength) {\r\n        message += ' for re-encoding';\r\n      }\r\n      message += ')';\r\n      const itemDelimTag = getItemDelimitationItemTag();\r\n      const itemDelimElement = {\r\n        vr: 'na',\r\n        vl: '0',\r\n        value: [message]\r\n      };\r\n      line += '\\n';\r\n      line += getElementAsString(\r\n        itemDelimTag, itemDelimElement, prefix + '  ');\r\n\r\n    }\r\n\r\n    message = '(SequenceDelimitationItem';\r\n    if (!dicomElement.undefinedLength) {\r\n      message += ' for re-encod.';\r\n    }\r\n    message += ')';\r\n    const sqDelimTag = getSequenceDelimitationItemTag();\r\n    const sqDelimElement = {\r\n      vr: 'na',\r\n      vl: '0',\r\n      value: [message]\r\n    };\r\n    line += '\\n';\r\n    line += getElementAsString(sqDelimTag, sqDelimElement, prefix);\r\n  } else if (isPixSequence) {\r\n    // pixel sequence\r\n    let pixItem = null;\r\n    for (let n = 0, lenn = dicomElement.value.length; n < lenn; ++n) {\r\n      pixItem = dicomElement.value[n];\r\n      line += '\\n';\r\n      pixItem.vr = 'pi';\r\n      line += getElementAsString(\r\n        getPixelDataTag(), pixItem, prefix + '  ');\r\n    }\r\n\r\n    const pixDelimTag = getSequenceDelimitationItemTag();\r\n    const pixDelimElement = {\r\n      vr: 'na',\r\n      vl: '0',\r\n      value: ['(SequenceDelimitationItem)']\r\n    };\r\n    line += '\\n';\r\n    line += getElementAsString(pixDelimTag, pixDelimElement, prefix);\r\n  }\r\n\r\n  return prefix + line;\r\n}\r\n\r\n/**\r\n * Extract the 2D size from dicom elements.\r\n *\r\n * @param {object} elements The DICOM elements.\r\n * @returns {object} The size.\r\n */\r\nexport function getImage2DSize(elements) {\r\n  // rows\r\n  const rows = elements['00280010'];\r\n  if (typeof rows === 'undefined') {\r\n    throw new Error('Missing DICOM image number of rows');\r\n  }\r\n  if (rows.value.length === 0) {\r\n    throw new Error('Empty DICOM image number of rows');\r\n  }\r\n  // columns\r\n  const columns = elements['00280011'];\r\n  if (typeof columns === 'undefined') {\r\n    throw new Error('Missing DICOM image number of columns');\r\n  }\r\n  if (columns.value.length === 0) {\r\n    throw new Error('Empty DICOM image number of columns');\r\n  }\r\n  return [columns.value[0], rows.value[0]];\r\n}\r\n\r\n/**\r\n * Get the pixel spacing from the different spacing tags.\r\n *\r\n * @param {object} elements The DICOM elements.\r\n * @returns {object} The read spacing or the default [1,1].\r\n */\r\nexport function getPixelSpacing(elements) {\r\n  // default\r\n  let rowSpacing = 1;\r\n  let columnSpacing = 1;\r\n\r\n  // 1. PixelSpacing\r\n  // 2. ImagerPixelSpacing\r\n  // 3. NominalScannedPixelSpacing\r\n  // 4. PixelAspectRatio\r\n  const keys = ['00280030', '00181164', '00182010', '00280034'];\r\n  for (let k = 0; k < keys.length; ++k) {\r\n    const spacing = elements[keys[k]];\r\n    if (spacing && spacing.value.length === 2) {\r\n      rowSpacing = parseFloat(spacing.value[0]);\r\n      columnSpacing = parseFloat(spacing.value[1]);\r\n      break;\r\n    }\r\n  }\r\n\r\n  // check\r\n  if (columnSpacing === 0) {\r\n    logger.warn('Zero column spacing.');\r\n    columnSpacing = 1;\r\n  }\r\n  if (rowSpacing === 0) {\r\n    logger.warn('Zero row spacing.');\r\n    rowSpacing = 1;\r\n  }\r\n\r\n  // return\r\n  // (slice spacing will be calculated using the image position patient)\r\n  return new Spacing([columnSpacing, rowSpacing, 1]);\r\n}\r\n\r\n/**\r\n * Get the pixel data unit.\r\n *\r\n * @param {object} elements The DICOM elements.\r\n * @returns {string|null} The unit value if available.\r\n */\r\nexport function getPixelUnit(elements) {\r\n  let unit;\r\n  // 1. RescaleType\r\n  // 2. Units (for PET)\r\n  const keys = ['00281054', '00541001'];\r\n  for (let i = 0; i < keys.length; ++i) {\r\n    const element = elements[keys[i]];\r\n    if (typeof element !== 'undefined') {\r\n      unit = element.value[0];\r\n      break;\r\n    }\r\n  }\r\n  // default rescale type for CT\r\n  if (typeof unit === 'undefined') {\r\n    const element = elements['00080060'];\r\n    if (typeof element !== 'undefined') {\r\n      const modality = element.value[0];\r\n      if (modality === 'CT') {\r\n        unit = 'HU';\r\n      }\r\n    }\r\n  }\r\n  return unit;\r\n}\r\n\r\n/**\r\n * Get a 'date' object with {year, monthIndex, day} ready for the\r\n *   Date constructor from a DICOM element with vr=DA.\r\n *\r\n * @param {object} element The DICOM element with date information.\r\n * @returns {{year, monthIndex, day}|undefined} The 'date' object.\r\n */\r\nexport function getDate(element) {\r\n  if (typeof element === 'undefined') {\r\n    return undefined;\r\n  }\r\n  if (element.value.length !== 1) {\r\n    return undefined;\r\n  }\r\n  const daValue = element.value[0];\r\n  // Two possible formats:\r\n  // - standard 'YYYYMMDD'\r\n  // - non-standard 'YYYY.MM.DD' (previous ACR-NEMA)\r\n  let monthBeginIndex = 4;\r\n  let dayBeginIndex = 6;\r\n  if (daValue.length === 10) {\r\n    monthBeginIndex = 5;\r\n    dayBeginIndex = 8;\r\n  }\r\n  const daYears = parseInt(daValue.substring(0, 4), 10);\r\n  // 0-11 range\r\n  const daMonthIndex = daValue.length >= monthBeginIndex + 2\r\n    ? parseInt(daValue.substring(\r\n      monthBeginIndex, monthBeginIndex + 2), 10) - 1 : 0;\r\n  const daDay = daValue.length === dayBeginIndex + 2\r\n    ? parseInt(daValue.substring(\r\n      dayBeginIndex, dayBeginIndex + 2), 10) : 0;\r\n  return {\r\n    year: daYears,\r\n    monthIndex: daMonthIndex,\r\n    day: daDay\r\n  };\r\n}\r\n\r\n/**\r\n * Get a time object with {hours, minutes, seconds} ready for the\r\n *   Date constructor from a DICOM element with vr=TM.\r\n *\r\n * @param {object} element The DICOM element with date information.\r\n * @returns {{hours, minutes, seconds, milliseconds}|undefined} The time object.\r\n */\r\nexport function getTime(element) {\r\n  if (typeof element === 'undefined') {\r\n    return undefined;\r\n  }\r\n  if (element.value.length !== 1) {\r\n    return undefined;\r\n  }\r\n  // format: HH[MMSS.FFFFFF]\r\n  const tmValue = element.value[0];\r\n  const tmHours = parseInt(tmValue.substring(0, 2), 10);\r\n  const tmMinutes = tmValue.length >= 4\r\n    ? parseInt(tmValue.substring(2, 4), 10) : 0;\r\n  const tmSeconds = tmValue.length >= 6\r\n    ? parseInt(tmValue.substring(4, 6), 10) : 0;\r\n  const tmFracSecondsStr = tmValue.length >= 8\r\n    ? tmValue.substring(7, 10) : 0;\r\n  const tmMilliSeconds = tmFracSecondsStr === 0 ? 0\r\n    : parseInt(tmFracSecondsStr, 10) *\r\n      Math.pow(10, 3 - tmFracSecondsStr.length);\r\n  return {\r\n    hours: tmHours,\r\n    minutes: tmMinutes,\r\n    seconds: tmSeconds,\r\n    milliseconds: tmMilliSeconds\r\n  };\r\n}\r\n\r\n/**\r\n * Get a 'dateTime' object with {date, time} ready for the\r\n *   Date constructor from a DICOM element with vr=DT.\r\n *\r\n * @param {object} element The DICOM element with date-time information.\r\n * @returns {{date, time}|undefined} The time object.\r\n */\r\nexport function getDateTime(element) {\r\n  if (typeof element === 'undefined') {\r\n    return undefined;\r\n  }\r\n  if (element.value.length !== 1) {\r\n    return undefined;\r\n  }\r\n  // format: YYYYMMDDHHMMSS.FFFFFF&ZZXX\r\n  const dtFullValue = element.value[0];\r\n  // remove offset (&ZZXX)\r\n  const dtValue = dtFullValue.split('&')[0];\r\n  const dtDate = getDate({value: [dtValue.substring(0, 8)]});\r\n  const dtTime = dtValue.length >= 9\r\n    ? getTime({value: [dtValue.substring(8)]}) : undefined;\r\n  return {\r\n    date: dtDate,\r\n    time: dtTime\r\n  };\r\n}\r\n\r\n/**\r\n * Check an input tag.\r\n *\r\n * @param {object} element The element to check.\r\n * @param {string} name The element name.\r\n * @param {Array} [values] The expected values.\r\n * @returns {string} A warning if the element is not as expected.\r\n */\r\nfunction checkTag(element, name, values) {\r\n  let warning = '';\r\n  if (typeof element === 'undefined') {\r\n    warning += ' ' + name + ' is undefined,';\r\n  } else if (element.value.length === 0) {\r\n    warning += ' ' + name + ' is empty,';\r\n  } else {\r\n    if (typeof values !== 'undefined') {\r\n      for (let i = 0; i < values.length; ++i) {\r\n        if (!element.value.includes(values[i])) {\r\n          warning += ' ' + name + ' does not contain ' + values[i] +\r\n            ' (value: ' + element.value + '),';\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return warning;\r\n}\r\n\r\n/**\r\n * Do the input elements allow for PET SUV calculation.\r\n *\r\n * @param {object} elements The DICOM elements to check.\r\n * @returns {string} A warning if the elements are not as expected.\r\n */\r\nexport function canGetSuvFactor(elements) {\r\n  let warning = '';\r\n\r\n  // RadiopharmaceuticalInformationSequence (type2)\r\n  const radioInfoSqStr = 'RadiopharmaceuticalInformationSequence (00540016)';\r\n  const radioInfoSq = elements['00540016'];\r\n  warning += checkTag(radioInfoSq, radioInfoSqStr);\r\n  if (typeof radioInfoSq !== 'undefined') {\r\n    // RadionuclideTotalDose (type3, Bq)\r\n    const totalDoseStr = 'RadionuclideTotalDose (00181074)';\r\n    const totalDoseEl = radioInfoSq.value[0]['00181074'];\r\n    warning += checkTag(totalDoseEl, totalDoseStr);\r\n    // RadionuclideHalfLife (type3, seconds)\r\n    const halfLifeStr = 'RadionuclideHalfLife (00181075)';\r\n    const halfLifeEl = radioInfoSq.value[0]['00181075'];\r\n    warning += checkTag(halfLifeEl, halfLifeStr);\r\n  }\r\n  // PatientWeight (type3, kilograms)\r\n  const patientWeightStr = ' PatientWeight (00101030)';\r\n  const patWeightEl = elements['00101030'];\r\n  warning += checkTag(patWeightEl, patientWeightStr);\r\n\r\n  // CorrectedImage (type2): must contain ATTN and DECY\r\n  const corrImageTagStr = 'Corrected Image (00280051)';\r\n  const corrImageEl = elements['00280051'];\r\n  warning += checkTag(corrImageEl, corrImageTagStr, ['ATTN', 'DECY']);\r\n  // DecayCorrection (type1): must be START\r\n  const decayCorrTagStr = 'Decay Correction (00541102)';\r\n  const decayCorrEl = elements['00541102'];\r\n  warning += checkTag(decayCorrEl, decayCorrTagStr, ['START']);\r\n  // Units (type1): must be BQML\r\n  const unitTagStr = 'Units (00541001)';\r\n  const unitEl = elements['00541001'];\r\n  warning += checkTag(unitEl, unitTagStr, ['BQML']);\r\n\r\n  // series date/time must be before acquisition date/time\r\n\r\n  // AcquisitionDate (type3)\r\n  const acqDateEl = elements['00080022'];\r\n  // AcquisitionTime (type3)\r\n  const acqTimeEl = elements['00080032'];\r\n\r\n  if (typeof acqDateEl !== 'undefined' &&\r\n    typeof acqTimeEl !== 'undefined') {\r\n    const acqDateObj = getDate(acqDateEl);\r\n    const acqTimeObj = getTime(acqTimeEl);\r\n    const acqDate = new Date(\r\n      acqDateObj.year, acqDateObj.monthIndex, acqDateObj.day,\r\n      acqTimeObj.hours, acqTimeObj.minutes,\r\n      acqTimeObj.seconds, acqTimeObj.milliseconds\r\n    );\r\n\r\n    // SeriesDate (type1 for PET)\r\n    const seriesDateEl = elements['00080021'];\r\n    // SeriesTime (type1 for PET)\r\n    const seriesTimeEl = elements['00080031'];\r\n    const seriesDateObj = getDate(seriesDateEl);\r\n    const seriesTimeObj = getTime(seriesTimeEl);\r\n    const seriesDate = new Date(\r\n      seriesDateObj.year, seriesDateObj.monthIndex, seriesDateObj.day,\r\n      seriesTimeObj.hours, seriesTimeObj.minutes,\r\n      seriesTimeObj.seconds, seriesTimeObj.milliseconds\r\n    );\r\n\r\n    if (seriesDate > acqDate) {\r\n      warning += ' Series date/time is after Aquisition date/time';\r\n    }\r\n  }\r\n\r\n  if (warning.length !== 0) {\r\n    warning = 'Cannot calculate PET SUV:' + warning;\r\n  }\r\n  return warning;\r\n}\r\n\r\n/**\r\n * Get the PET SUV factor.\r\n *\r\n * @see https://qibawiki.rsna.org/images/6/62/SUV_vendorneutral_pseudocode_happypathonly_20180626_DAC.pdf\r\n * (from https://qibawiki.rsna.org/index.php/Standardized_Uptake_Value_(SUV)#SUV_Calculation )\r\n * @param {object} elements The DICOM elements.\r\n * @returns {number} The factor.\r\n */\r\nexport function getSuvFactor(elements) {\r\n\r\n  // SeriesDate (type1 for PET)\r\n  const seriesDateEl = elements['00080021'];\r\n  const seriesDateObj = getDate(seriesDateEl);\r\n  // SeriesTime (type1 for PET)\r\n  const seriesTimeEl = elements['00080031'];\r\n  const seriesTimeObj = getTime(seriesTimeEl);\r\n\r\n  // RadiopharmaceuticalInformationSequence (type2)\r\n  const radioInfoSq = elements['00540016'];\r\n  if (radioInfoSq.value.length !== 1) {\r\n    console.warn(\r\n      'Found more than 1 istopes in RadiopharmaceuticalInformation Sequence.');\r\n  }\r\n  // RadiopharmaceuticalStartDateTime (type3)\r\n  const radioStartDateTimeEl = radioInfoSq.value[0]['00181078'];\r\n  let radioStartDateObj;\r\n  let radioStartTimeObj;\r\n  if (typeof radioStartDateTimeEl === 'undefined') {\r\n    radioStartDateObj = seriesDateObj;\r\n    // RadiopharmaceuticalStartTime (type3)\r\n    const radioStartTimeEl = radioInfoSq.value[0]['00181072'];\r\n    radioStartTimeObj = getTime(radioStartTimeEl);\r\n  } else {\r\n    const radioStartDateTime = getDateTime(radioStartDateTimeEl);\r\n    radioStartDateObj = radioStartDateTime.date;\r\n    radioStartTimeObj = radioStartDateTime.time;\r\n  }\r\n  if (typeof radioStartTimeObj === 'undefined') {\r\n    radioStartTimeObj = {\r\n      hours: 0, minutes: 0, seconds: 0, milliseconds: 0\r\n    };\r\n  }\r\n  const radioStart = new Date(\r\n    radioStartDateObj.year,\r\n    radioStartDateObj.monthIndex,\r\n    radioStartDateObj.day,\r\n    radioStartTimeObj.hours,\r\n    radioStartTimeObj.minutes,\r\n    radioStartTimeObj.seconds,\r\n    radioStartTimeObj.milliseconds\r\n  );\r\n\r\n  // RadionuclideTotalDose (type3, Bq)\r\n  const totalDoseEl = radioInfoSq.value[0]['00181074'];\r\n  // RadionuclideHalfLife (type3, seconds)\r\n  const halfLifeEl = radioInfoSq.value[0]['00181075'];\r\n  // PatientWeight (type3, kilograms)\r\n  const patWeightEl = elements['00101030'];\r\n\r\n  // Series date/time\r\n  const scanStart = new Date(\r\n    seriesDateObj.year,\r\n    seriesDateObj.monthIndex,\r\n    seriesDateObj.day,\r\n    seriesTimeObj.hours,\r\n    seriesTimeObj.minutes,\r\n    seriesTimeObj.seconds,\r\n    seriesTimeObj.milliseconds\r\n  );\r\n  // Date diff is in milliseconds\r\n  const decaySeconds = (scanStart.getTime() - radioStart.getTime()) / 1000;\r\n  const decay = Math.pow(2,\r\n    (-decaySeconds / parseFloat(halfLifeEl.value[0]))\r\n  );\r\n  const decayedDose = totalDoseEl.value[0] * decay;\r\n  // factor is grams / Bq\r\n  const suvFactor = (patWeightEl.value[0] * 1000) / decayedDose;\r\n\r\n  return suvFactor;\r\n}\r\n\r\n/**\r\n * Get the file list from a DICOMDIR\r\n *\r\n * @param {object} data The buffer data of the DICOMDIR\r\n * @returns {Array|undefined} The file list as an array ordered by\r\n *   STUDY > SERIES > IMAGES.\r\n */\r\nexport function getFileListFromDicomDir(data) {\r\n  // parse file\r\n  const parser = new DicomParser();\r\n  parser.parse(data);\r\n  const elements = parser.getDicomElements();\r\n\r\n  // Directory Record Sequence\r\n  if (typeof elements['00041220'] === 'undefined' ||\r\n    typeof elements['00041220'].value === 'undefined') {\r\n    logger.warn('No Directory Record Sequence found in DICOMDIR.');\r\n    return undefined;\r\n  }\r\n  const dirSeq = elements['00041220'].value;\r\n\r\n  if (dirSeq.length === 0) {\r\n    logger.warn('The Directory Record Sequence of the DICOMDIR is empty.');\r\n    return undefined;\r\n  }\r\n\r\n  const records = [];\r\n  let series = null;\r\n  let study = null;\r\n  for (let i = 0; i < dirSeq.length; ++i) {\r\n    // Directory Record Type\r\n    if (typeof dirSeq[i]['00041430'] === 'undefined' ||\r\n      typeof dirSeq[i]['00041430'].value === 'undefined') {\r\n      continue;\r\n    }\r\n    const recType = dirSeq[i]['00041430'].value[0];\r\n\r\n    // supposed to come in order...\r\n    if (recType === 'STUDY') {\r\n      study = [];\r\n      records.push(study);\r\n    } else if (recType === 'SERIES') {\r\n      series = [];\r\n      study.push(series);\r\n    } else if (recType === 'IMAGE') {\r\n      // Referenced File ID\r\n      if (typeof dirSeq[i]['00041500'] === 'undefined' ||\r\n        typeof dirSeq[i]['00041500'].value === 'undefined') {\r\n        continue;\r\n      }\r\n      const refFileIds = dirSeq[i]['00041500'].value;\r\n      // join ids\r\n      series.push(refFileIds.join('/'));\r\n    }\r\n  }\r\n  return records;\r\n}\r\n\r\n/**\r\n * Methods used to extract values from DICOM elements.\r\n *\r\n * Implemented as class and method to allow for override via its prototype.\r\n */\r\nexport class TagValueExtractor {\r\n  /**\r\n   * Get the time.\r\n   *\r\n   * @param {Object<string, DataElement>} _elements The DICOM elements.\r\n   * @returns {number|undefined} The time value if available.\r\n   */\r\n  getTime(_elements) {\r\n    // default returns undefined\r\n    return undefined;\r\n  }\r\n}\r\n","import {Size} from './size';\r\nimport {Geometry} from './geometry';\r\nimport {RescaleSlopeAndIntercept} from './rsi';\r\nimport {WindowLevel} from './windowLevel';\r\nimport {Image} from './image';\r\nimport {luts} from './luts';\r\nimport {\r\n  isJpeg2000TransferSyntax,\r\n  isJpegBaselineTransferSyntax,\r\n  isJpegLosslessTransferSyntax\r\n} from '../dicom/dicomParser';\r\nimport {\r\n  getImage2DSize,\r\n  getPixelSpacing,\r\n  getPixelUnit,\r\n  TagValueExtractor,\r\n  getSuvFactor,\r\n  canGetSuvFactor\r\n} from '../dicom/dicomElementsWrapper';\r\nimport {Vector3D} from '../math/vector';\r\nimport {Matrix33} from '../math/matrix';\r\nimport {Point3D} from '../math/point';\r\nimport {logger} from '../utils/logger';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {DataElement} from '../dicom/dataElement';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * @typedef {Object<string, DataElement>} DataElements\r\n */\r\n\r\n/**\r\n * {@link Image} factory.\r\n */\r\nexport class ImageFactory {\r\n\r\n  /**\r\n   * Check dicom elements. Throws an error if not suitable.\r\n   *\r\n   * @param {DataElements} dataElements The DICOM data elements.\r\n   * @returns {object|undefined} A possible warning.\r\n   */\r\n  checkElements(dataElements) {\r\n    // will throw if columns or rows is not defined\r\n    getImage2DSize(dataElements);\r\n  }\r\n\r\n  /**\r\n   * Get an {@link Image} object from the read DICOM file.\r\n   *\r\n   * @param {DataElements} dataElements The DICOM tags.\r\n   * @param {Uint8Array | Int8Array |\r\n   *   Uint16Array | Int16Array |\r\n   *   Uint32Array | Int32Array} pixelBuffer The pixel buffer.\r\n   * @param {number} numberOfFiles The input number of files.\r\n   * @returns {Image} A new Image.\r\n   */\r\n  create(dataElements, pixelBuffer, numberOfFiles) {\r\n    const size2D = getImage2DSize(dataElements);\r\n    const sizeValues = [size2D[0], size2D[1], 1];\r\n\r\n    // frames\r\n    const frames = dataElements['00280008'];\r\n    if (frames) {\r\n      sizeValues.push(frames.value[0]);\r\n    }\r\n\r\n    // image size\r\n    const size = new Size(sizeValues);\r\n\r\n    // image spacing\r\n    const spacing = getPixelSpacing(dataElements);\r\n\r\n    // TransferSyntaxUID\r\n    const syntax = dataElements['00020010'].value[0];\r\n    const jpeg2000 = isJpeg2000TransferSyntax(syntax);\r\n    const jpegBase = isJpegBaselineTransferSyntax(syntax);\r\n    const jpegLoss = isJpegLosslessTransferSyntax(syntax);\r\n\r\n    // ImagePositionPatient\r\n    const imagePositionPatient = dataElements['00200032'];\r\n    // slice position\r\n    let slicePosition = new Array(0, 0, 0);\r\n    if (typeof imagePositionPatient !== 'undefined') {\r\n      slicePosition = [\r\n        parseFloat(imagePositionPatient.value[0]),\r\n        parseFloat(imagePositionPatient.value[1]),\r\n        parseFloat(imagePositionPatient.value[2])\r\n      ];\r\n    }\r\n\r\n    // slice orientation (cosines are matrices' columns)\r\n    // http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.2.html#sect_C.7.6.2.1.1\r\n    const imageOrientationPatient = dataElements['00200037'];\r\n    let orientationMatrix;\r\n    if (typeof imageOrientationPatient !== 'undefined') {\r\n      const rowCosines = new Vector3D(\r\n        parseFloat(imageOrientationPatient.value[0]),\r\n        parseFloat(imageOrientationPatient.value[1]),\r\n        parseFloat(imageOrientationPatient.value[2]));\r\n      const colCosines = new Vector3D(\r\n        parseFloat(imageOrientationPatient.value[3]),\r\n        parseFloat(imageOrientationPatient.value[4]),\r\n        parseFloat(imageOrientationPatient.value[5]));\r\n      const normal = rowCosines.crossProduct(colCosines);\r\n      /* eslint-disable array-element-newline */\r\n      orientationMatrix = new Matrix33([\r\n        rowCosines.getX(), colCosines.getX(), normal.getX(),\r\n        rowCosines.getY(), colCosines.getY(), normal.getY(),\r\n        rowCosines.getZ(), colCosines.getZ(), normal.getZ()\r\n      ]);\r\n      /* eslint-enable array-element-newline */\r\n    }\r\n\r\n    // geometry\r\n    const origin = new Point3D(\r\n      slicePosition[0], slicePosition[1], slicePosition[2]);\r\n    const extractor = new TagValueExtractor();\r\n    const time = extractor.getTime(dataElements);\r\n    const geometry = new Geometry(\r\n      origin, size, spacing, orientationMatrix, time);\r\n\r\n    // SOP Instance UID\r\n    let sopInstanceUid;\r\n    const siu = dataElements['00080018'];\r\n    if (typeof siu !== 'undefined') {\r\n      sopInstanceUid = siu.value[0];\r\n    }\r\n\r\n    // Sample per pixels\r\n    let samplesPerPixel = 1;\r\n    const spp = dataElements['00280002'];\r\n    if (typeof spp !== 'undefined') {\r\n      samplesPerPixel = spp.value[0];\r\n    }\r\n\r\n    // check buffer size\r\n    const bufferSize = size.getTotalSize() * samplesPerPixel;\r\n    if (bufferSize !== pixelBuffer.length) {\r\n      logger.warn('Badly sized pixel buffer: ' +\r\n        pixelBuffer.length + ' != ' + bufferSize);\r\n      if (bufferSize < pixelBuffer.length) {\r\n        pixelBuffer = pixelBuffer.slice(0, size.getTotalSize());\r\n      } else {\r\n        throw new Error('Underestimated buffer size, can\\'t fix it...');\r\n      }\r\n    }\r\n\r\n    // image\r\n    const image = new Image(geometry, pixelBuffer, [sopInstanceUid]);\r\n    // PhotometricInterpretation\r\n    const photometricInterpretation = dataElements['00280004'];\r\n    if (typeof photometricInterpretation !== 'undefined') {\r\n      let photo = photometricInterpretation.value[0].toUpperCase();\r\n      // jpeg decoders output RGB data\r\n      if ((jpeg2000 || jpegBase || jpegLoss) &&\r\n        (photo !== 'MONOCHROME1' && photo !== 'MONOCHROME2')) {\r\n        photo = 'RGB';\r\n      }\r\n      // check samples per pixels\r\n      if (photo === 'RGB' && samplesPerPixel === 1) {\r\n        photo = 'PALETTE COLOR';\r\n      }\r\n      image.setPhotometricInterpretation(photo);\r\n    }\r\n    // PlanarConfiguration\r\n    const planarConfiguration = dataElements['00280006'];\r\n    if (typeof planarConfiguration !== 'undefined') {\r\n      image.setPlanarConfiguration(planarConfiguration.value[0]);\r\n    }\r\n\r\n    // rescale slope and intercept\r\n    let slope = 1;\r\n    // RescaleSlope\r\n    const rescaleSlope = dataElements['00281053'];\r\n    if (typeof rescaleSlope !== 'undefined') {\r\n      const value = parseFloat(rescaleSlope.value[0]);\r\n      if (!isNaN(value)) {\r\n        slope = value;\r\n      }\r\n    }\r\n    let intercept = 0;\r\n    // RescaleIntercept\r\n    const rescaleIntercept = dataElements['00281052'];\r\n    if (typeof rescaleIntercept !== 'undefined') {\r\n      const value = parseFloat(rescaleIntercept.value[0]);\r\n      if (!isNaN(value)) {\r\n        intercept = value;\r\n      }\r\n    }\r\n\r\n    // meta information\r\n    const meta = {\r\n      numberOfFiles: numberOfFiles\r\n    };\r\n\r\n    // Modality\r\n    const modality = dataElements['00080060'];\r\n    if (typeof modality !== 'undefined') {\r\n      meta.Modality = modality.value[0];\r\n    }\r\n\r\n    // PET SUV\r\n    let isPetWithSuv = false;\r\n    if (typeof meta.Modality !== 'undefined' &&\r\n      meta.Modality === 'PT') {\r\n      const warn = canGetSuvFactor(dataElements);\r\n      if (warn.length === 0) {\r\n        isPetWithSuv = true;\r\n      } else {\r\n        logger.warn(warn);\r\n      }\r\n    }\r\n    let intensityFactor = 1;\r\n    if (isPetWithSuv) {\r\n      intensityFactor = getSuvFactor(dataElements);\r\n      logger.info('Applying PET SUV calibration: ' + intensityFactor);\r\n      slope *= intensityFactor;\r\n      intercept *= intensityFactor;\r\n    }\r\n    const rsi = new RescaleSlopeAndIntercept(slope, intercept);\r\n    image.setRescaleSlopeAndIntercept(rsi);\r\n\r\n    const sopClassUID = dataElements['00080016'];\r\n    if (typeof sopClassUID !== 'undefined') {\r\n      meta.SOPClassUID = sopClassUID.value[0];\r\n    }\r\n    const studyUID = dataElements['0020000D'];\r\n    if (typeof studyUID !== 'undefined') {\r\n      meta.StudyInstanceUID = studyUID.value[0];\r\n    }\r\n    const seriesUID = dataElements['0020000E'];\r\n    if (typeof seriesUID !== 'undefined') {\r\n      meta.SeriesInstanceUID = seriesUID.value[0];\r\n    }\r\n    const bits = dataElements['00280101'];\r\n    if (typeof bits !== 'undefined') {\r\n      meta.BitsStored = bits.value[0];\r\n    }\r\n    const pixelRep = dataElements['00280103'];\r\n    if (typeof pixelRep !== 'undefined') {\r\n      meta.PixelRepresentation = pixelRep.value[0];\r\n    }\r\n    // PixelRepresentation -> is signed\r\n    meta.IsSigned = meta.PixelRepresentation === 1;\r\n    // local pixel unit\r\n    if (isPetWithSuv) {\r\n      meta.pixelUnit = 'SUV';\r\n    } else {\r\n      const pixelUnit = getPixelUnit(dataElements);\r\n      if (typeof pixelUnit !== 'undefined') {\r\n        meta.pixelUnit = pixelUnit;\r\n      }\r\n    }\r\n    // FrameOfReferenceUID (optional)\r\n    const frameOfReferenceUID = dataElements['00200052'];\r\n    if (typeof frameOfReferenceUID !== 'undefined') {\r\n      meta.FrameOfReferenceUID = frameOfReferenceUID.value[0];\r\n    }\r\n    // window level presets\r\n    const windowPresets = {};\r\n    const windowCenter = dataElements['00281050'];\r\n    const windowWidth = dataElements['00281051'];\r\n    const windowCWExplanation = dataElements['00281055'];\r\n    if (typeof windowCenter !== 'undefined' &&\r\n      typeof windowWidth !== 'undefined') {\r\n      let name;\r\n      for (let j = 0; j < windowCenter.value.length; ++j) {\r\n        const center = parseFloat(windowCenter.value[j]);\r\n        let width = parseFloat(windowWidth.value[j]);\r\n        if (center && width && width !== 0) {\r\n          name = '';\r\n          if (typeof windowCWExplanation !== 'undefined') {\r\n            name = windowCWExplanation.value[j];\r\n          }\r\n          if (name === '') {\r\n            name = 'Default' + j;\r\n          }\r\n          width *= intensityFactor;\r\n          if (width < 1) {\r\n            width = 1;\r\n          }\r\n          windowPresets[name] = {\r\n            wl: [new WindowLevel(\r\n              center * intensityFactor,\r\n              width\r\n            )],\r\n            name: name\r\n          };\r\n        }\r\n        if (width === 0) {\r\n          logger.warn('Zero window width found in DICOM.');\r\n        }\r\n      }\r\n    }\r\n    meta.windowPresets = windowPresets;\r\n\r\n    // PALETTE COLOR luts\r\n    if (image.getPhotometricInterpretation() === 'PALETTE COLOR') {\r\n      // Red Palette Color Lookup Table Data\r\n      const redLutElement = dataElements['00281201'];\r\n      // Green Palette Color Lookup Table Data\r\n      const greenLutElement = dataElements['00281202'];\r\n      // Blue Palette Color Lookup Table Data\r\n      const blueLutElement = dataElements['00281203'];\r\n      let redLut;\r\n      let greenLut;\r\n      let blueLut;\r\n      // check red palette descriptor (should all be equal)\r\n      // Red Palette Color Lookup Table Descriptor\r\n      // 0: number of entries in the lookup table\r\n      // 1: first input value mapped\r\n      // 2: number of bits for each entry in the Lookup Table Data (8 or 16)\r\n      const descriptor = dataElements['00281101'];\r\n      if (typeof descriptor !== 'undefined' &&\r\n        descriptor.value.length === 3) {\r\n        if (descriptor.value[2] === 16) {\r\n          let doScale = false;\r\n          // (C.7.6.3.1.5 Palette Color Lookup Table Descriptor)\r\n          // Some implementations have encoded 8 bit entries with 16 bits\r\n          // allocated, padding the high bits;\r\n          let descSize = descriptor.value[0];\r\n          // (C.7.6.3.1.5 Palette Color Lookup Table Descriptor)\r\n          // The first Palette Color Lookup Table Descriptor value is the\r\n          // number of entries in the lookup table. When the number of table\r\n          // entries is equal to 216 then this value shall be 0.\r\n          if (descSize === 0) {\r\n            descSize = 65536;\r\n          }\r\n          // red palette VL\r\n          // TODO vl is undefined, find info elsewhere...\r\n          const vlSize = redLutElement.vl;\r\n          // check double size\r\n          if (vlSize !== 2 * descSize) {\r\n            doScale = true;\r\n            logger.info('16bits lut but size is not double. desc: ' +\r\n              descSize + ' vl: ' + vlSize);\r\n          }\r\n          // (C.7.6.3.1.6 Palette Color Lookup Table Data)\r\n          // Palette color values must always be scaled across the full\r\n          // range of available intensities\r\n          const bitsAllocated = parseInt(\r\n            dataElements['00280100'].value[0], 10);\r\n          if (bitsAllocated === 8) {\r\n            doScale = true;\r\n            logger.info(\r\n              'Scaling 16bits color lut since bits allocated is 8.');\r\n          }\r\n\r\n          if (doScale) {\r\n            const scaleTo8 = function (value) {\r\n              return value >> 8;\r\n            };\r\n\r\n            redLut = redLutElement.value.map(scaleTo8);\r\n            greenLut = greenLutElement.value.map(scaleTo8);\r\n            blueLut = blueLutElement.value.map(scaleTo8);\r\n          }\r\n        } else if (descriptor.value[2] === 8) {\r\n          // lut with vr=OW was read as Uint16, convert it to Uint8\r\n          logger.info(\r\n            'Scaling 16bits color lut since the lut descriptor is 8.');\r\n          let clone = redLutElement.value.slice(0);\r\n          // @ts-expect-error\r\n          redLut = Array.from(new Uint8Array(clone.buffer));\r\n          clone = greenLutElement.value.slice(0);\r\n          // @ts-expect-error\r\n          greenLut = Array.from(new Uint8Array(clone.buffer));\r\n          clone = blueLutElement.value.slice(0);\r\n          // @ts-expect-error\r\n          blueLut = Array.from(new Uint8Array(clone.buffer));\r\n        }\r\n      }\r\n      // set the palette\r\n      luts['palette'] = {\r\n        red: redLut,\r\n        green: greenLut,\r\n        blue: blueLut\r\n      };\r\n    }\r\n\r\n    // RecommendedDisplayFrameRate\r\n    const recommendedDisplayFrameRate = dataElements['00082144'];\r\n    if (typeof recommendedDisplayFrameRate !== 'undefined') {\r\n      meta.RecommendedDisplayFrameRate = parseInt(\r\n        recommendedDisplayFrameRate.value[0], 10);\r\n    }\r\n\r\n    // store the meta data\r\n    image.setMeta(meta);\r\n\r\n    return image;\r\n  }\r\n\r\n}","import {getImage2DSize} from '../dicom/dicomElementsWrapper';\r\nimport {Spacing} from '../image/spacing';\r\nimport {Image} from '../image/image';\r\nimport {Geometry, getSliceGeometrySpacing} from '../image/geometry';\r\nimport {Point3D} from '../math/point';\r\nimport {Vector3D} from '../math/vector';\r\nimport {Index} from '../math/index';\r\nimport {Matrix33, REAL_WORLD_EPSILON} from '../math/matrix';\r\nimport {logger} from '../utils/logger';\r\nimport {arraySortEquals} from '../utils/array';\r\nimport {\r\n  isEqualRgb,\r\n  cielabToSrgb,\r\n  uintLabToLab\r\n} from '../utils/colour';\r\nimport {Size} from './size';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {DataElement} from '../dicom/dataElement';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * @typedef {Object<string, DataElement>} DataElements\r\n */\r\n\r\n/**\r\n * Check two position patients for equality.\r\n *\r\n * @param {*} pos1 The first position patient.\r\n * @param {*} pos2 The second position patient.\r\n * @returns {boolean} True is equal.\r\n */\r\nfunction equalPosPat(pos1, pos2) {\r\n  return JSON.stringify(pos1) === JSON.stringify(pos2);\r\n}\r\n\r\n/**\r\n * @callback compareFn\r\n * @param {object} a The first object.\r\n * @param {object} b The first object.\r\n * @returns {number} >0 to sort a after b, <0 to sort a before b,\r\n *   0 to not change order.\r\n */\r\n\r\n/**\r\n * Get a position patient compare function accroding to an\r\n * input orientation.\r\n *\r\n * @param {Matrix33} orientation The orientation matrix.\r\n * @returns {compareFn} The position compare function.\r\n */\r\nfunction getComparePosPat(orientation) {\r\n  const invOrientation = orientation.getInverse();\r\n  return function (pos1, pos2) {\r\n    const p1 = invOrientation.multiplyArray3D(pos1);\r\n    const p2 = invOrientation.multiplyArray3D(pos2);\r\n    return p1[2] - p2[2];\r\n  };\r\n}\r\n\r\n/**\r\n * Check that a DICOM tag definition is present in a parsed element.\r\n *\r\n * @param {DataElements} dataElements The root dicom element.\r\n * @param {object} tagDefinition The tag definition as {name, tag, type, enum}.\r\n */\r\nfunction checkTag(dataElements, tagDefinition) {\r\n  const element = dataElements[tagDefinition.tag];\r\n  // check null and undefined\r\n  if (tagDefinition.type === 1 || tagDefinition.type === 2) {\r\n    if (typeof element === 'undefined') {\r\n      throw new Error('Missing or empty ' + tagDefinition.name);\r\n    }\r\n  } else {\r\n    if (typeof element === 'undefined') {\r\n      // non mandatory value, exit\r\n      return;\r\n    }\r\n  }\r\n  let includes = false;\r\n  let tagValue;\r\n  if (element.value.length === 1) {\r\n    tagValue = element.value[0];\r\n  } else {\r\n    tagValue = element.value;\r\n  }\r\n  if (Array.isArray(tagValue)) {\r\n    for (let i = 0; i < tagDefinition.enum.length; ++i) {\r\n      if (!Array.isArray(tagDefinition.enum[i])) {\r\n        throw new Error('Cannot compare array and non array tag value.');\r\n      }\r\n      if (arraySortEquals(tagDefinition.enum[i], tagValue)) {\r\n        includes = true;\r\n        break;\r\n      }\r\n    }\r\n  } else {\r\n    includes = tagDefinition.enum.includes(tagValue);\r\n  }\r\n  if (!includes) {\r\n    throw new Error(\r\n      'Unsupported ' + tagDefinition.name + ' value: ' + tagValue);\r\n  }\r\n}\r\n\r\n/**\r\n * List of DICOM Seg required tags.\r\n */\r\nconst RequiredDicomSegTags = [\r\n  {\r\n    name: 'TransferSyntaxUID',\r\n    tag: '00020010',\r\n    type: '1',\r\n    enum: ['1.2.840.10008.1.2.1']\r\n  },\r\n  {\r\n    name: 'MediaStorageSOPClassUID',\r\n    tag: '00020002',\r\n    type: '1',\r\n    enum: ['1.2.840.10008.5.1.4.1.1.66.4']\r\n  },\r\n  {\r\n    name: 'SOPClassUID',\r\n    tag: '00020002',\r\n    type: '1',\r\n    enum: ['1.2.840.10008.5.1.4.1.1.66.4']\r\n  },\r\n  {\r\n    name: 'Modality',\r\n    tag: '00080060',\r\n    type: '1',\r\n    enum: ['SEG']\r\n  },\r\n  {\r\n    name: 'SegmentationType',\r\n    tag: '00620001',\r\n    type: '1',\r\n    enum: ['BINARY']\r\n  },\r\n  {\r\n    name: 'DimensionOrganizationType',\r\n    tag: '00209311',\r\n    type: '3',\r\n    enum: ['3D']\r\n  },\r\n  {\r\n    name: 'ImageType',\r\n    tag: '00080008',\r\n    type: '1',\r\n    enum: [['DERIVED', 'PRIMARY']]\r\n  },\r\n  {\r\n    name: 'SamplesPerPixel',\r\n    tag: '00280002',\r\n    type: '1',\r\n    enum: [1]\r\n  },\r\n  {\r\n    name: 'PhotometricInterpretation',\r\n    tag: '00280004',\r\n    type: '1',\r\n    enum: ['MONOCHROME2']\r\n  },\r\n  {\r\n    name: 'PixelRepresentation',\r\n    tag: '00280103',\r\n    type: '1',\r\n    enum: [0]\r\n  },\r\n  {\r\n    name: 'BitsAllocated',\r\n    tag: '00280100',\r\n    type: '1',\r\n    enum: [1]\r\n  },\r\n  {\r\n    name: 'BitsStored',\r\n    tag: '00280101',\r\n    type: '1',\r\n    enum: [1]\r\n  },\r\n  {\r\n    name: 'HighBit',\r\n    tag: '00280102',\r\n    type: '1',\r\n    enum: [0]\r\n  },\r\n];\r\n\r\n/**\r\n * Get the default DICOM seg tags as an object.\r\n *\r\n * @returns {object} The default tags.\r\n */\r\nexport function getDefaultDicomSegJson() {\r\n  const tags = {};\r\n  for (let i = 0; i < RequiredDicomSegTags.length; ++i) {\r\n    const reqTag = RequiredDicomSegTags[i];\r\n    tags[reqTag.name] = reqTag.enum[0];\r\n  }\r\n  return tags;\r\n}\r\n\r\n/**\r\n * Check the dimension organization from a dicom element.\r\n *\r\n * @param {DataElements} dataElements The root dicom element.\r\n * @returns {object} The dimension organizations and indices.\r\n */\r\nfunction getDimensionOrganization(dataElements) {\r\n  // Dimension Organization Sequence (required)\r\n  const orgSq = dataElements['00209221'];\r\n  if (typeof orgSq === 'undefined' || orgSq.value.length !== 1) {\r\n    throw new Error('Unsupported dimension organization sequence length');\r\n  }\r\n  // Dimension Organization UID\r\n  const orgUID = orgSq.value[0]['00209164'].value[0];\r\n\r\n  // Dimension Index Sequence (conditionally required)\r\n  const indices = [];\r\n  const indexSqElem = dataElements['00209222'];\r\n  if (typeof indexSqElem !== 'undefined') {\r\n    const indexSq = indexSqElem.value;\r\n    // expecting 2D index\r\n    if (indexSq.length !== 2) {\r\n      throw new Error('Unsupported dimension index sequence length');\r\n    }\r\n    let indexPointer;\r\n    for (let i = 0; i < indexSq.length; ++i) {\r\n      // Dimension Organization UID (required)\r\n      const indexOrg = indexSq[i]['00209164'].value[0];\r\n      if (indexOrg !== orgUID) {\r\n        throw new Error(\r\n          'Dimension Index Sequence contains a unknown Dimension Organization');\r\n      }\r\n      // Dimension Index Pointer (required)\r\n      indexPointer = indexSq[i]['00209165'].value[0];\r\n\r\n      const index = {\r\n        DimensionOrganizationUID: indexOrg,\r\n        DimensionIndexPointer: indexPointer\r\n      };\r\n      // Dimension Description Label (optional)\r\n      if (typeof indexSq[i]['00209421'] !== 'undefined') {\r\n        index.DimensionDescriptionLabel = indexSq[i]['00209421'].value[0];\r\n      }\r\n      // store\r\n      indices.push(index);\r\n    }\r\n    // expecting Image Position at last position\r\n    if (indexPointer !== '(0020,0032)') {\r\n      throw new Error('Unsupported non image position as last index');\r\n    }\r\n  }\r\n\r\n  return {\r\n    organizations: {\r\n      value: [\r\n        {\r\n          DimensionOrganizationUID: orgUID\r\n        }\r\n      ]\r\n    },\r\n    indices: {\r\n      value: indices\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * DICOM code.\r\n */\r\nexport class DicomCode {\r\n  /**\r\n   * Code meaning (0008,0104).\r\n   *\r\n   * @type {string}\r\n   */\r\n  meaning;\r\n  /**\r\n   * Code value (0008,0100).\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  value;\r\n  /**\r\n   * Long code value (0008,0119).\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  longValue;\r\n  /**\r\n   * URN code value (0008,0120).\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  urnValue;\r\n  /**\r\n   * Coding scheme designator (0008,0102).\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  schemeDesignator;\r\n\r\n  /**\r\n   * @param {string} meaning The code meaning.\r\n   */\r\n  constructor(meaning) {\r\n    this.meaning = meaning;\r\n  }\r\n}\r\n\r\n/**\r\n * Get a code object from a dicom element.\r\n *\r\n * @param {DataElements} dataElements The dicom element.\r\n * @returns {DicomCode} A code object.\r\n */\r\nfunction getCode(dataElements) {\r\n  // meaning -> CodeMeaning (type1)\r\n  const code = new DicomCode(dataElements['00080104'].value[0]);\r\n  // value -> CodeValue (type1C)\r\n  // longValue -> LongCodeValue (type1C)\r\n  // urnValue -> URNCodeValue (type1C)\r\n  if (dataElements['00080100']) {\r\n    code.value = dataElements['00080100'].value[0];\r\n  } else if (dataElements['00080119']) {\r\n    code.longValue = dataElements['00080119'].value[0];\r\n  } else if (dataElements['00080120']) {\r\n    code.urnValue = dataElements['00080120'].value[0];\r\n  } else {\r\n    throw Error('Invalid code with no value, no long value and no urn value.');\r\n  }\r\n  // schemeDesignator -> CodingSchemeDesignator (type1C)\r\n  if (typeof code.value !== 'undefined' ||\r\n    typeof code.longValue !== 'undefined') {\r\n    if (dataElements['00080102']) {\r\n      code.schemeDesignator = dataElements['00080102'].value[0];\r\n    } else {\r\n      throw Error(\r\n        'No coding sheme designator when code value or long value is present');\r\n    }\r\n  }\r\n  return code;\r\n}\r\n\r\n/**\r\n * DICOM (mask) segment.\r\n */\r\nexport class MaskSegment {\r\n  /**\r\n   * Segment number (0062,0004).\r\n   *\r\n   * @type {number}\r\n   */\r\n  number;\r\n  /**\r\n   * Segment label (0062,0005).\r\n   *\r\n   * @type {string}\r\n   */\r\n  label;\r\n  /**\r\n   * Segment algorithm type (0062,0008).\r\n   *\r\n   * @type {string}\r\n   */\r\n  algorithmType;\r\n  /**\r\n   * Segment algorithm name (0062,0009).\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  algorithmName;\r\n  /**\r\n   * Segment display value as {r,g,b}.\r\n   *\r\n   * @type {object|undefined}\r\n   */\r\n  displayValue;\r\n  /**\r\n   * Segment property code: specific property\r\n   * the segment represents (0062,000F).\r\n   *\r\n   * @type {DicomCode|undefined}\r\n   */\r\n  propertyTypeCode;\r\n  /**\r\n   * Segment property category code: general category\r\n   * of the property the segment represents (0062,0003).\r\n   *\r\n   * @type {DicomCode|undefined}\r\n   */\r\n  propertyCategoryCode;\r\n  /**\r\n   * Segment tracking UID (0062,0021).\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  trackingUid;\r\n  /**\r\n   * Segment tracking id: text label for the UID (0062,0020).\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  trackingId;\r\n\r\n  /**\r\n   * @param {number} number The segment number.\r\n   * @param {string} label The segment label.\r\n   * @param {string} algorithmType The segment number.\r\n   */\r\n  constructor(number, label, algorithmType) {\r\n    this.number = number;\r\n    this.label = label;\r\n    this.algorithmType = algorithmType;\r\n  }\r\n}\r\n\r\n/**\r\n * Get a segment object from a dicom element.\r\n *\r\n * @param {DataElements} dataElements The dicom element.\r\n * @returns {MaskSegment} A segment object.\r\n */\r\nfunction getSegment(dataElements) {\r\n  // number -> SegmentNumber (type1)\r\n  // label -> SegmentLabel (type1)\r\n  // algorithmType -> SegmentAlgorithmType (type1)\r\n  const segment = new MaskSegment(\r\n    dataElements['00620004'].value[0],\r\n    dataElements['00620005'] ? dataElements['00620005'].value[0] : 'n/a',\r\n    dataElements['00620008'].value[0]\r\n  );\r\n  // algorithmName -> SegmentAlgorithmName (type1C)\r\n  if (dataElements['00620009']) {\r\n    segment.algorithmName = dataElements['00620009'].value[0];\r\n  }\r\n  // // required if type is not MANUAL\r\n  // if (segment.algorithmType !== 'MANUAL' &&\r\n  //   (typeof segment.algorithmName === 'undefined' ||\r\n  //   segment.algorithmName.length === 0)) {\r\n  //   throw new Error('Empty algorithm name for non MANUAL algorithm type.');\r\n  // }\r\n  // displayValue ->\r\n  // - RecommendedDisplayGrayscaleValue\r\n  // - RecommendedDisplayCIELabValue converted to RGB\r\n  if (typeof dataElements['0062000C'] !== 'undefined') {\r\n    segment.displayValue = dataElements['006200C'].value;\r\n  } else if (typeof dataElements['0062000D'] !== 'undefined') {\r\n    const cielabElement = dataElements['0062000D'].value;\r\n    const rgb = cielabToSrgb(uintLabToLab({\r\n      l: cielabElement[0],\r\n      a: cielabElement[1],\r\n      b: cielabElement[2]\r\n    }));\r\n    segment.displayValue = rgb;\r\n  }\r\n  // Segmented Property Category Code Sequence (type1, only one)\r\n  if (typeof dataElements['00620003'] !== 'undefined') {\r\n    segment.propertyCategoryCode =\r\n      getCode(dataElements['00620003'].value[0]);\r\n  } else {\r\n    throw Error('Missing Segmented Property Category Code Sequence.');\r\n  }\r\n  // Segmented Property Type Code Sequence (type1)\r\n  if (typeof dataElements['0062000F'] !== 'undefined') {\r\n    segment.propertyTypeCode =\r\n      getCode(dataElements['0062000F'].value[0]);\r\n  } else {\r\n    throw Error('Missing Segmented Property Type Code Sequence.');\r\n  }\r\n  // tracking Id and UID (type1C)\r\n  if (typeof dataElements['00620020'] !== 'undefined') {\r\n    segment.trackingId = dataElements['00620020'].value[0];\r\n    segment.trackingUid = dataElements['00620021'].value[0];\r\n  }\r\n\r\n  return segment;\r\n}\r\n\r\n/**\r\n * Check if two segment objects are equal.\r\n *\r\n * @param {object} seg1 The first segment.\r\n * @param {object} seg2 The second segment.\r\n * @returns {boolean} True if both segment are equal.\r\n */\r\nexport function isEqualSegment(seg1, seg2) {\r\n  // basics\r\n  if (typeof seg1 === 'undefined' ||\r\n    typeof seg2 === 'undefined' ||\r\n    seg1 === null ||\r\n    seg2 === null) {\r\n    return false;\r\n  }\r\n  let isEqual = seg1.number === seg2.number &&\r\n    seg1.label === seg2.label &&\r\n    seg1.algorithmType === seg2.algorithmType;\r\n  // rgb\r\n  if (typeof seg1.displayValue.r !== 'undefined') {\r\n    if (typeof seg2.displayValue.r === 'undefined') {\r\n      isEqual = false;\r\n    } else {\r\n      isEqual = isEqual &&\r\n        isEqualRgb(seg1.displayValue, seg2.displayValue);\r\n    }\r\n  } else {\r\n    isEqual = isEqual &&\r\n      seg1.displayValue === seg2.displayValue;\r\n  }\r\n  // algorithmName\r\n  if (typeof seg1.algorithmName !== 'undefined') {\r\n    if (typeof seg2.algorithmName === 'undefined') {\r\n      isEqual = false;\r\n    } else {\r\n      isEqual = isEqual &&\r\n        seg1.algorithmName === seg2.algorithmName;\r\n    }\r\n  }\r\n\r\n  return isEqual;\r\n}\r\n\r\n/**\r\n * Check if two segment objects are similar: either the\r\n * number or the displayValue are equal.\r\n *\r\n * @param {object} seg1 The first segment.\r\n * @param {object} seg2 The second segment.\r\n * @returns {boolean} True if both segment are similar.\r\n */\r\nexport function isSimilarSegment(seg1, seg2) {\r\n  // basics\r\n  if (typeof seg1 === 'undefined' ||\r\n    typeof seg2 === 'undefined' ||\r\n    seg1 === null ||\r\n    seg2 === null) {\r\n    return false;\r\n  }\r\n  let isSimilar = seg1.number === seg2.number;\r\n  // rgb\r\n  if (typeof seg1.displayValue.r !== 'undefined') {\r\n    if (typeof seg2.displayValue.r === 'undefined') {\r\n      isSimilar = false;\r\n    } else {\r\n      isSimilar = isSimilar ||\r\n        isEqualRgb(seg1.displayValue, seg2.displayValue);\r\n    }\r\n  } else {\r\n    isSimilar = isSimilar ||\r\n      seg1.displayValue === seg2.displayValue;\r\n  }\r\n\r\n  return isSimilar;\r\n}\r\n\r\n/**\r\n * Get a spacing object from a dicom measure element.\r\n *\r\n * @param {DataElements} dataElements The dicom element.\r\n * @returns {Spacing} A spacing object.\r\n */\r\nfunction getSpacingFromMeasure(dataElements) {\r\n  // Pixel Spacing\r\n  if (typeof dataElements['00280030'] === 'undefined') {\r\n    return null;\r\n  }\r\n  const pixelSpacing = dataElements['00280030'];\r\n  const spacingValues = [\r\n    parseFloat(pixelSpacing.value[0]),\r\n    parseFloat(pixelSpacing.value[1])\r\n  ];\r\n  // Slice Thickness\r\n  if (typeof dataElements['00180050'] !== 'undefined') {\r\n    spacingValues.push(parseFloat(dataElements['00180050'].value[0]));\r\n  } else if (typeof dataElements['00180088'] !== 'undefined') {\r\n    // Spacing Between Slices\r\n    spacingValues.push(parseFloat(dataElements['00180088'].value[0]));\r\n  }\r\n  return new Spacing(spacingValues);\r\n}\r\n\r\n/**\r\n * Get a frame information object from a dicom element.\r\n *\r\n * @param {DataElements} dataElements The dicom element.\r\n * @returns {object} A frame information object.\r\n */\r\nfunction getSegmentFrameInfo(dataElements) {\r\n  // Derivation Image Sequence\r\n  const derivationImages = [];\r\n  if (typeof dataElements['00089124'] !== 'undefined') {\r\n    const derivationImageSq = dataElements['00089124'].value;\r\n    // Source Image Sequence\r\n    for (let i = 0; i < derivationImageSq.length; ++i) {\r\n      const sourceImages = [];\r\n      if (typeof derivationImageSq[i]['00082112'] !== 'undefined') {\r\n        const sourceImageSq = derivationImageSq[i]['00082112'].value;\r\n        for (let j = 0; j < sourceImageSq.length; ++j) {\r\n          const sourceImage = {};\r\n          // Referenced SOP Class UID\r\n          if (typeof sourceImageSq[j]['00081150'] !== 'undefined') {\r\n            sourceImage.referencedSOPClassUID =\r\n              sourceImageSq[j]['00081150'].value[0];\r\n          }\r\n          // Referenced SOP Instance UID\r\n          if (typeof sourceImageSq[j]['00081155'] !== 'undefined') {\r\n            sourceImage.referencedSOPInstanceUID =\r\n              sourceImageSq[j]['00081155'].value[0];\r\n          }\r\n          sourceImages.push(sourceImage);\r\n        }\r\n      }\r\n      derivationImages.push({\r\n        sourceImages: sourceImages\r\n      });\r\n    }\r\n  }\r\n  // Frame Content Sequence (required, only one)\r\n  const frameContentSq = dataElements['00209111'].value;\r\n  // Dimension Index Value\r\n  const dimIndex = frameContentSq[0]['00209157'].value;\r\n  // Segment Identification Sequence (required, only one)\r\n  const segmentIdSq = dataElements['0062000A'].value;\r\n  // Referenced Segment Number\r\n  const refSegmentNumber = segmentIdSq[0]['0062000B'].value[0];\r\n  // Plane Position Sequence (required, only one)\r\n  const planePosSq = dataElements['00209113'].value;\r\n  // Image Position (Patient) (conditionally required)\r\n  const imagePosPat = planePosSq[0]['00200032'].value;\r\n  for (let p = 0; p < imagePosPat.length; ++p) {\r\n    imagePosPat[p] = parseFloat(imagePosPat[p]);\r\n  }\r\n  const frameInfo = {\r\n    dimIndex: dimIndex,\r\n    imagePosPat: imagePosPat,\r\n    derivationImages: derivationImages,\r\n    refSegmentNumber: refSegmentNumber\r\n  };\r\n  // Plane Orientation Sequence\r\n  if (typeof dataElements['00209116'] !== 'undefined') {\r\n    const framePlaneOrientationSeq = dataElements['00209116'];\r\n    if (framePlaneOrientationSeq.value.length !== 0) {\r\n      // should only be one Image Orientation (Patient)\r\n      const frameImageOrientation =\r\n        framePlaneOrientationSeq.value[0]['00200037'].value;\r\n      if (typeof frameImageOrientation !== 'undefined') {\r\n        frameInfo.imageOrientationPatient = frameImageOrientation;\r\n      }\r\n    }\r\n  }\r\n  // Pixel Measures Sequence\r\n  if (typeof dataElements['00289110'] !== 'undefined') {\r\n    const framePixelMeasuresSeq = dataElements['00289110'];\r\n    if (framePixelMeasuresSeq.value.length !== 0) {\r\n      // should only be one\r\n      const frameSpacing =\r\n        getSpacingFromMeasure(framePixelMeasuresSeq.value[0]);\r\n      if (typeof frameSpacing !== 'undefined') {\r\n        frameInfo.spacing = frameSpacing;\r\n      }\r\n    } else {\r\n      logger.warn(\r\n        'No shared functional group pixel measure sequence items.');\r\n    }\r\n  }\r\n\r\n  return frameInfo;\r\n}\r\n\r\n/**\r\n * Mask {@link Image} factory.\r\n */\r\nexport class MaskFactory {\r\n\r\n  /*\r\n   * Check dicom elements. Throws an error if not suitable.\r\n   *\r\n   * @param {object} _dicomElements The DICOM tags.\r\n   * @returns {object|undefined} A possible warning.\r\n   */\r\n  checkElements(_dicomElements) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Get an {@link Image} object from the read DICOM file.\r\n   *\r\n   * @param {Object<string, DataElement>} dataElements The DICOM tags.\r\n   * @param {Uint8Array | Int8Array |\r\n   *   Uint16Array | Int16Array |\r\n   *   Uint32Array | Int32Array} pixelBuffer The pixel buffer.\r\n   * @returns {Image} A new Image.\r\n   */\r\n  create(dataElements, pixelBuffer) {\r\n    // check required and supported tags\r\n    for (let d = 0; d < RequiredDicomSegTags.length; ++d) {\r\n      checkTag(dataElements, RequiredDicomSegTags[d]);\r\n    }\r\n\r\n    // image size\r\n    const size2D = getImage2DSize(dataElements);\r\n    const size = new Size([size2D[0], size2D[1], 1]);\r\n\r\n    const sliceSize = size.getTotalSize();\r\n\r\n    // frames\r\n    let frames = 1;\r\n    const framesElem = dataElements['00280008'];\r\n    if (typeof framesElem !== 'undefined') {\r\n      frames = parseInt(framesElem.value[0], 10);\r\n    }\r\n\r\n    if (frames !== pixelBuffer.length / sliceSize) {\r\n      throw new Error(\r\n        'Buffer and numberOfFrames meta are not equal.' +\r\n        frames + ' ' + pixelBuffer.length / sliceSize);\r\n    }\r\n\r\n    // Dimension Organization and Index\r\n    const dimension = getDimensionOrganization(dataElements);\r\n\r\n    // Segment Sequence\r\n    const segSequence = dataElements['00620002'];\r\n    if (typeof segSequence === 'undefined') {\r\n      throw new Error('Missing or empty segmentation sequence');\r\n    }\r\n    const segments = [];\r\n    let storeAsRGB = false;\r\n    for (let i = 0; i < segSequence.value.length; ++i) {\r\n      const segment = getSegment(segSequence.value[i]);\r\n      if (typeof segment.displayValue.r !== 'undefined' &&\r\n        typeof segment.displayValue.g !== 'undefined' &&\r\n        typeof segment.displayValue.b !== 'undefined') {\r\n        // create rgb image\r\n        storeAsRGB = true;\r\n      }\r\n      // store\r\n      segments.push(segment);\r\n    }\r\n\r\n\r\n    // Shared Functional Groups Sequence\r\n    let spacing;\r\n    let imageOrientationPatient;\r\n    const sharedFunctionalGroupsSeq = dataElements['52009229'];\r\n    if (typeof sharedFunctionalGroupsSeq !== 'undefined') {\r\n      // should be only one\r\n      const funcGroup0 = sharedFunctionalGroupsSeq.value[0];\r\n      // Plane Orientation Sequence\r\n      if (typeof funcGroup0['00209116'] !== 'undefined') {\r\n        const planeOrientationSeq = funcGroup0['00209116'];\r\n        if (planeOrientationSeq.value.length !== 0) {\r\n          // should be only one\r\n          imageOrientationPatient =\r\n            planeOrientationSeq.value[0]['00200037'].value;\r\n        } else {\r\n          logger.warn(\r\n            'No shared functional group plane orientation sequence items.');\r\n        }\r\n      }\r\n      // Pixel Measures Sequence\r\n      if (typeof funcGroup0['00289110'] !== 'undefined') {\r\n        const pixelMeasuresSeq = funcGroup0['00289110'];\r\n        if (pixelMeasuresSeq.value.length !== 0) {\r\n          // should be only one\r\n          spacing = getSpacingFromMeasure(pixelMeasuresSeq.value[0]);\r\n        } else {\r\n          logger.warn(\r\n            'No shared functional group pixel measure sequence items.');\r\n        }\r\n      }\r\n    }\r\n\r\n    const includesPosPat = function (arr, val) {\r\n      return arr.some(function (arrVal) {\r\n        return equalPosPat(val, arrVal);\r\n      });\r\n    };\r\n\r\n    const findIndexPosPat = function (arr, val) {\r\n      return arr.findIndex(function (arrVal) {\r\n        return equalPosPat(val, arrVal);\r\n      });\r\n    };\r\n\r\n    // Per-frame Functional Groups Sequence\r\n    const perFrameFuncGroupSequence = dataElements['52009230'];\r\n    if (typeof perFrameFuncGroupSequence === 'undefined') {\r\n      throw new Error('Missing or empty per frame functional sequence');\r\n    }\r\n    if (frames !== perFrameFuncGroupSequence.value.length) {\r\n      throw new Error(\r\n        'perFrameFuncGroupSequence meta and numberOfFrames are not equal.');\r\n    }\r\n    // create frame info object from per frame func\r\n    const frameInfos = [];\r\n    for (let j = 0; j < perFrameFuncGroupSequence.value.length; ++j) {\r\n      frameInfos.push(\r\n        getSegmentFrameInfo(perFrameFuncGroupSequence.value[j]));\r\n    }\r\n\r\n    // check frame infos\r\n    const framePosPats = [];\r\n    for (let ii = 0; ii < frameInfos.length; ++ii) {\r\n      if (!includesPosPat(framePosPats, frameInfos[ii].imagePosPat)) {\r\n        framePosPats.push(frameInfos[ii].imagePosPat);\r\n      }\r\n      // store orientation if needed, avoid multi\r\n      if (typeof frameInfos[ii].imageOrientationPatient !== 'undefined') {\r\n        if (typeof imageOrientationPatient === 'undefined') {\r\n          imageOrientationPatient = frameInfos[ii].imageOrientationPatient;\r\n        } else {\r\n          if (!arraySortEquals(\r\n            imageOrientationPatient, frameInfos[ii].imageOrientationPatient)) {\r\n            throw new Error('Unsupported multi orientation dicom seg.');\r\n          }\r\n        }\r\n      }\r\n      // store spacing if needed, avoid multi\r\n      if (typeof frameInfos[ii].spacing !== 'undefined') {\r\n        if (typeof spacing === 'undefined') {\r\n          spacing = frameInfos[ii].spacing;\r\n        } else {\r\n          if (!spacing.equals(frameInfos[ii].spacing)) {\r\n            throw new Error('Unsupported multi resolution dicom seg.');\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // check spacing and orientation\r\n    if (typeof spacing === 'undefined') {\r\n      throw new Error('No spacing found for DICOM SEG');\r\n    }\r\n    if (typeof imageOrientationPatient === 'undefined') {\r\n      throw new Error('No imageOrientationPatient found for DICOM SEG');\r\n    }\r\n\r\n    // orientation\r\n    const rowCosines = new Vector3D(\r\n      parseFloat(imageOrientationPatient[0]),\r\n      parseFloat(imageOrientationPatient[1]),\r\n      parseFloat(imageOrientationPatient[2]));\r\n    const colCosines = new Vector3D(\r\n      parseFloat(imageOrientationPatient[3]),\r\n      parseFloat(imageOrientationPatient[4]),\r\n      parseFloat(imageOrientationPatient[5]));\r\n    const normal = rowCosines.crossProduct(colCosines);\r\n    /* eslint-disable array-element-newline */\r\n    const orientationMatrix = new Matrix33([\r\n      rowCosines.getX(), colCosines.getX(), normal.getX(),\r\n      rowCosines.getY(), colCosines.getY(), normal.getY(),\r\n      rowCosines.getZ(), colCosines.getZ(), normal.getZ()\r\n    ]);\r\n\r\n    // sort positions patient\r\n    framePosPats.sort(getComparePosPat(orientationMatrix));\r\n\r\n    const point3DFromArray = function (arr) {\r\n      return new Point3D(arr[0], arr[1], arr[2]);\r\n    };\r\n\r\n    // frame origins\r\n    const frameOrigins = [];\r\n    for (let n = 0; n < framePosPats.length; ++n) {\r\n      frameOrigins.push(point3DFromArray(framePosPats[n]));\r\n    }\r\n\r\n    // use calculated spacing\r\n    let newSpacing = spacing;\r\n    const geoSliceSpacing = getSliceGeometrySpacing(\r\n      frameOrigins, orientationMatrix, false);\r\n    const spacingValues = spacing.getValues();\r\n    if (typeof geoSliceSpacing !== 'undefined' &&\r\n      geoSliceSpacing !== spacingValues[2]) {\r\n      spacingValues[2] = geoSliceSpacing;\r\n      newSpacing = new Spacing(spacingValues);\r\n    }\r\n\r\n    // tmp geometry with correct spacing but only one slice\r\n    const tmpGeometry = new Geometry(\r\n      frameOrigins[0], size, newSpacing, orientationMatrix);\r\n\r\n    // origin distance test\r\n    // TODO: maybe use sliceSpacing / 10\r\n    const isNotSmall = function (value) {\r\n      let res = value > REAL_WORLD_EPSILON;\r\n      if (res) {\r\n        // try larger epsilon\r\n        res = value > REAL_WORLD_EPSILON * 10;\r\n        if (!res) {\r\n          // warn if epsilon < value < epsilon * 10\r\n          logger.warn(\r\n            'Using larger real world epsilon in SEG pos pat adding'\r\n          );\r\n        } else {\r\n          res = value > REAL_WORLD_EPSILON * 100;\r\n          if (!res) {\r\n            // warn if epsilon < value < epsilon * 100\r\n            logger.warn(\r\n              'Using larger+ real world epsilon in SEG pos pat adding'\r\n            );\r\n          }\r\n        }\r\n      }\r\n      return res;\r\n    };\r\n\r\n    // add possibly missing posPats\r\n    const posPats = [];\r\n    posPats.push(framePosPats[0]);\r\n    let sliceIndex = 0;\r\n    for (let g = 1; g < framePosPats.length; ++g) {\r\n      ++sliceIndex;\r\n      let index = new Index([0, 0, sliceIndex]);\r\n      let point = tmpGeometry.indexToWorld(index).get3D();\r\n      const frameOrigin = frameOrigins[g];\r\n      // check if more pos pats are needed\r\n      let dist = frameOrigin.getDistance(point);\r\n      const distPrevious = dist;\r\n      // TODO: good threshold?\r\n      while (isNotSmall(dist)) {\r\n        logger.debug('Adding intermediate pos pats for DICOM seg at ' +\r\n          point.toString());\r\n        posPats.push([point.getX(), point.getY(), point.getZ()]);\r\n        ++sliceIndex;\r\n        index = new Index([0, 0, sliceIndex]);\r\n        point = tmpGeometry.indexToWorld(index).get3D();\r\n        dist = frameOrigin.getDistance(point);\r\n        if (dist > distPrevious) {\r\n          throw new Error(\r\n            'Test distance is increasing when adding intermediate pos pats');\r\n        }\r\n      }\r\n      // add frame pos pat\r\n      posPats.push(framePosPats[g]);\r\n    }\r\n\r\n    // as many slices as posPats\r\n    const numberOfSlices = posPats.length;\r\n\r\n    // final geometry\r\n    const geometry = new Geometry(\r\n      frameOrigins[0], size, newSpacing, orientationMatrix);\r\n    const uids = [0];\r\n    for (let m = 1; m < numberOfSlices; ++m) {\r\n      geometry.appendOrigin(point3DFromArray(posPats[m]), m);\r\n      uids.push(m);\r\n    }\r\n\r\n    const getFindSegmentFunc = function (number) {\r\n      return function (item) {\r\n        return item.number === number;\r\n      };\r\n    };\r\n\r\n    // create output buffer\r\n    const mul = storeAsRGB ? 3 : 1;\r\n    const buffer =\r\n      // @ts-ignore\r\n      new pixelBuffer.constructor(mul * sliceSize * numberOfSlices);\r\n    buffer.fill(0);\r\n    // merge frame buffers\r\n    let sliceOffset = null;\r\n    let frameOffset = null;\r\n    for (let f = 0; f < frameInfos.length; ++f) {\r\n      // get the slice index from the position in the posPat array\r\n      sliceIndex = findIndexPosPat(posPats, frameInfos[f].imagePosPat);\r\n      frameOffset = sliceSize * f;\r\n      sliceOffset = sliceSize * sliceIndex;\r\n      // get the frame display value\r\n      const frameSegment = segments.find(\r\n        getFindSegmentFunc(frameInfos[f].refSegmentNumber)\r\n      );\r\n      const pixelValue = frameSegment.displayValue;\r\n      for (let l = 0; l < sliceSize; ++l) {\r\n        if (pixelBuffer[frameOffset + l] !== 0) {\r\n          const offset = mul * (sliceOffset + l);\r\n          if (storeAsRGB) {\r\n            buffer[offset] = pixelValue.r;\r\n            buffer[offset + 1] = pixelValue.g;\r\n            buffer[offset + 2] = pixelValue.b;\r\n          } else {\r\n            buffer[offset] = pixelValue;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // create image\r\n    const image = new Image(geometry, buffer, uids);\r\n    if (storeAsRGB) {\r\n      image.setPhotometricInterpretation('RGB');\r\n    }\r\n    // meta information\r\n    const meta = getDefaultDicomSegJson();\r\n    const safeGet = function (key) {\r\n      let res;\r\n      const element = dataElements[key];\r\n      if (typeof element !== 'undefined') {\r\n        res = element.value[0];\r\n      }\r\n      return res;\r\n    };\r\n    // Study\r\n    meta.StudyDate = safeGet('00080020');\r\n    meta.StudyTime = safeGet('00080030');\r\n    meta.StudyInstanceUID = safeGet('0020000D');\r\n    meta.StudyID = safeGet('00200010');\r\n    // Series\r\n    meta.SeriesInstanceUID = dataElements['0020000E'].value[0];\r\n    meta.SeriesNumber = safeGet('00200011');\r\n    // ReferringPhysicianName\r\n    meta.ReferringPhysicianName = safeGet('00080090');\r\n    // patient info\r\n    meta.PatientName = safeGet('00100010');\r\n    meta.PatientID = safeGet('00100020');\r\n    meta.PatientBirthDate = safeGet('00100030');\r\n    meta.PatientSex = safeGet('00100040');\r\n    // Enhanced General Equipment Module\r\n    meta.Manufacturer = safeGet('00080070');\r\n    meta.ManufacturerModelName = safeGet('00081090');\r\n    meta.DeviceSerialNumber = safeGet('00181000');\r\n    meta.SoftwareVersions = safeGet('00181020');\r\n    // dicom seg dimension\r\n    meta.DimensionOrganizationSequence = dimension.organizations;\r\n    meta.DimensionIndexSequence = dimension.indices;\r\n    // custom\r\n    meta.custom = {\r\n      segments: segments,\r\n      frameInfos: frameInfos,\r\n      SOPInstanceUID: dataElements['00080018'].value[0]\r\n    };\r\n\r\n    // number of files: in this case equal to number slices,\r\n    //   used to calculate buffer size\r\n    meta.numberOfFiles = numberOfSlices;\r\n    // FrameOfReferenceUID (optional)\r\n    const frameOfReferenceUID = dataElements['00200052'];\r\n    if (frameOfReferenceUID) {\r\n      meta.FrameOfReferenceUID = frameOfReferenceUID.value[0];\r\n    }\r\n    // LossyImageCompression (optional)\r\n    const lossyImageCompression = dataElements['00282110'];\r\n    if (lossyImageCompression) {\r\n      meta.LossyImageCompression = lossyImageCompression.value[0];\r\n    }\r\n\r\n    image.setMeta(meta);\r\n\r\n    return image;\r\n  }\r\n\r\n} // class MaskFactory\r\n","import {Index} from '../math/index';\r\nimport {Point3D} from '../math/point';\r\nimport {logger} from '../utils/logger';\r\nimport {arrayContains} from '../utils/array';\r\nimport {getTypedArray} from '../dicom/dicomParser';\r\nimport {ListenerHandler} from '../utils/listen';\r\nimport {colourRange} from './iterator';\r\nimport {RescaleSlopeAndIntercept} from './rsi';\r\nimport {ImageFactory} from './imageFactory';\r\nimport {MaskFactory} from './maskFactory';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Geometry} from './geometry';\r\nimport {Matrix33} from '../math/matrix';\r\nimport {DataElement} from '../dicom/dataElement';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Get the slice index of an input slice into a volume geometry.\r\n *\r\n * @param {Geometry} volumeGeometry The volume geometry.\r\n * @param {Geometry} sliceGeometry The slice geometry.\r\n * @returns {Index} The index of the slice in the volume geomtry.\r\n */\r\nfunction getSliceIndex(volumeGeometry, sliceGeometry) {\r\n  // possible time\r\n  const timeId = sliceGeometry.getInitialTime();\r\n  // index values\r\n  const values = [];\r\n  // x, y\r\n  values.push(0);\r\n  values.push(0);\r\n  // z\r\n  values.push(volumeGeometry.getSliceIndex(sliceGeometry.getOrigin(), timeId));\r\n  // time\r\n  if (typeof timeId !== 'undefined') {\r\n    values.push(timeId);\r\n  }\r\n  // return index\r\n  return new Index(values);\r\n}\r\n\r\n/**\r\n * Create an Image from DICOM elements.\r\n *\r\n * @param {Object<string, DataElement>} elements The DICOM elements.\r\n * @returns {Image} The Image object.\r\n */\r\nexport function createImage(elements) {\r\n  const factory = new ImageFactory();\r\n  return factory.create(\r\n    elements,\r\n    elements['7FE00010'].value[0],\r\n    1\r\n  );\r\n}\r\n\r\n/**\r\n * Create a mask Image from DICOM elements.\r\n *\r\n * @param {Object<string, DataElement>} elements The DICOM elements.\r\n * @returns {Image} The mask Image object.\r\n */\r\nexport function createMaskImage(elements) {\r\n  const factory = new MaskFactory();\r\n  return factory.create(\r\n    elements,\r\n    elements['7FE00010'].value[0]\r\n  );\r\n}\r\n\r\n/**\r\n * Image class.\r\n * Usable once created, optional are:\r\n * - rescale slope and intercept (default 1:0),\r\n * - photometric interpretation (default MONOCHROME2),\r\n * - planar configuration (default RGBRGB...).\r\n *\r\n * @example\r\n * // XMLHttpRequest onload callback\r\n * const onload = function (event) {\r\n *   // parse the dicom buffer\r\n *   const dicomParser = new dwv.DicomParser();\r\n *   dicomParser.parse(event.target.response);\r\n *   // create the image object\r\n *   const image = dwv.createImage(dicomParser.getDicomElements());\r\n *   // result div\r\n *   const div = document.getElementById('dwv');\r\n *   // display the image size\r\n *   const size = image.getGeometry().getSize();\r\n *   div.appendChild(document.createTextNode(\r\n *     'Size: ' + size.toString() +\r\n *     ' (should be 256,256,1)'));\r\n *   // break line\r\n *   div.appendChild(document.createElement('br'));\r\n *   // display a pixel value\r\n *   div.appendChild(document.createTextNode(\r\n *     'Pixel @ [128,40,0]: ' +\r\n *     image.getRescaledValue(128,40,0) +\r\n *     ' (should be 101)'));\r\n * };\r\n * // DICOM file request\r\n * const request = new XMLHttpRequest();\r\n * const url = 'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm';\r\n * request.open('GET', url);\r\n * request.responseType = 'arraybuffer';\r\n * request.onload = onload;\r\n * request.send();\r\n */\r\nexport class Image {\r\n\r\n  /**\r\n   * Data geometry.\r\n   *\r\n   * @type {Geometry}\r\n   */\r\n  #geometry;\r\n\r\n  /**\r\n   * List of compatible typed arrays.\r\n   *\r\n   * @typedef {(\r\n   *   Uint8Array | Int8Array |\r\n   *   Uint16Array | Int16Array |\r\n   *   Uint32Array | Int32Array\r\n   * )} TypedArray\r\n   */\r\n\r\n  /**\r\n   * Data buffer.\r\n   *\r\n   * @type {TypedArray}\r\n   */\r\n  #buffer;\r\n\r\n  /**\r\n   * Image UIDs.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #imageUids;\r\n\r\n  /**\r\n   * Constant rescale slope and intercept (default).\r\n   *\r\n   * @type {RescaleSlopeAndIntercept}\r\n   */\r\n  #rsi = new RescaleSlopeAndIntercept(1, 0);\r\n\r\n  /**\r\n   * Varying rescale slope and intercept.\r\n   *\r\n   * @type {RescaleSlopeAndIntercept[]}\r\n   */\r\n  #rsis = null;\r\n\r\n  /**\r\n   * Flag to know if the RSIs are all identity (1,0).\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isIdentityRSI = true;\r\n\r\n  /**\r\n   * Flag to know if the RSIs are all equals.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isConstantRSI = true;\r\n\r\n  /**\r\n   * Photometric interpretation (MONOCHROME, RGB...).\r\n   *\r\n   * @type {string}\r\n   */\r\n  #photometricInterpretation = 'MONOCHROME2';\r\n\r\n  /**\r\n   * Planar configuration for RGB data (0:RGBRGBRGBRGB... or\r\n   *   1:RRR...GGG...BBB...).\r\n   *\r\n   * @type {number}\r\n   */\r\n  #planarConfiguration = 0;\r\n\r\n  /**\r\n   * Number of components.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #numberOfComponents;\r\n\r\n  /**\r\n   * Meta information.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #meta = {};\r\n\r\n  /**\r\n   * Data range.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #dataRange = null;\r\n\r\n  /**\r\n   * Rescaled data range.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #rescaledDataRange = null;\r\n\r\n  /**\r\n   * Histogram.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #histogram = null;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * @param {Geometry} geometry The geometry of the image.\r\n   * @param {TypedArray} buffer The image data as a one dimensional buffer.\r\n   * @param {Array} [imageUids] An array of Uids indexed to slice number.\r\n   */\r\n  constructor(geometry, buffer, imageUids) {\r\n    this.#geometry = geometry;\r\n    this.#buffer = buffer;\r\n    this.#imageUids = imageUids;\r\n\r\n    this.#numberOfComponents = this.#buffer.length / (\r\n      this.#geometry.getSize().getTotalSize());\r\n  }\r\n\r\n  /**\r\n   * Get the image UID at a given index.\r\n   *\r\n   * @param {Index} [index] The index at which to get the id.\r\n   * @returns {string} The UID.\r\n   */\r\n  getImageUid(index) {\r\n    let uid = this.#imageUids[0];\r\n    if (this.#imageUids.length !== 1 && typeof index !== 'undefined') {\r\n      uid = this.#imageUids[this.getSecondaryOffset(index)];\r\n    }\r\n    return uid;\r\n  }\r\n\r\n  /**\r\n   * Check if this image includes the input uids.\r\n   *\r\n   * @param {string[]} uids UIDs to test for presence.\r\n   * @returns {boolean} True if all uids are in this image uids.\r\n   */\r\n  containsImageUids(uids) {\r\n    return arrayContains(this.#imageUids, uids);\r\n  }\r\n\r\n  /**\r\n   * Get the geometry of the image.\r\n   *\r\n   * @returns {Geometry} The geometry.\r\n   */\r\n  getGeometry() {\r\n    return this.#geometry;\r\n  }\r\n\r\n  /**\r\n   * Get the data buffer of the image.\r\n   *\r\n   * @todo dangerous...\r\n   * @returns {TypedArray} The data buffer of the image.\r\n   */\r\n  getBuffer() {\r\n    return this.#buffer;\r\n  }\r\n\r\n  /**\r\n   * Can the image values be quantified?\r\n   *\r\n   * @returns {boolean} True if only one component.\r\n   */\r\n  canQuantify() {\r\n    return this.getNumberOfComponents() === 1;\r\n  }\r\n\r\n  /**\r\n   * Can window and level be applied to the data?\r\n   *\r\n   * @returns {boolean} True if the data is monochrome.\r\n   */\r\n  canWindowLevel() {\r\n    return this.getPhotometricInterpretation()\r\n      .match(/MONOCHROME/) !== null;\r\n  }\r\n\r\n  /**\r\n   * Can the data be scrolled?\r\n   *\r\n   * @param {Matrix33} viewOrientation The view orientation.\r\n   * @returns {boolean} True if the data has a third dimension greater than one\r\n   *   after applying the view orientation.\r\n   */\r\n  canScroll(viewOrientation) {\r\n    const size = this.getGeometry().getSize();\r\n    // also check the numberOfFiles in case we are in the middle of a load\r\n    let nFiles = 1;\r\n    if (typeof this.#meta.numberOfFiles !== 'undefined') {\r\n      nFiles = this.#meta.numberOfFiles;\r\n    }\r\n    return size.canScroll(viewOrientation) || nFiles !== 1;\r\n  }\r\n\r\n  /**\r\n   * Get the secondary offset max.\r\n   *\r\n   * @returns {number} The maximum offset.\r\n   */\r\n  #getSecondaryOffsetMax() {\r\n    return this.#geometry.getSize().getTotalSize(2);\r\n  }\r\n\r\n  /**\r\n   * Get the secondary offset: an offset that takes into account\r\n   *   the slice and above dimension numbers.\r\n   *\r\n   * @param {Index} index The index.\r\n   * @returns {number} The offset.\r\n   */\r\n  getSecondaryOffset(index) {\r\n    return this.#geometry.getSize().indexToOffset(index, 2);\r\n  }\r\n\r\n  /**\r\n   * Get the rescale slope and intercept.\r\n   *\r\n   * @param {Index} [index] The index (only needed for non constant rsi).\r\n   * @returns {RescaleSlopeAndIntercept} The rescale slope and intercept.\r\n   */\r\n  getRescaleSlopeAndIntercept(index) {\r\n    let res = this.#rsi;\r\n    if (!this.isConstantRSI()) {\r\n      if (typeof index === 'undefined') {\r\n        throw new Error('Cannot get non constant RSI with empty slice index.');\r\n      }\r\n      const offset = this.getSecondaryOffset(index);\r\n      if (typeof this.#rsis[offset] !== 'undefined') {\r\n        res = this.#rsis[offset];\r\n      } else {\r\n        logger.warn('undefined non constant rsi at ' + offset);\r\n      }\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Get the rsi at a specified (secondary) offset.\r\n   *\r\n   * @param {number} offset The desired (secondary) offset.\r\n   * @returns {RescaleSlopeAndIntercept} The coresponding rsi.\r\n   */\r\n  #getRescaleSlopeAndInterceptAtOffset(offset) {\r\n    return this.#rsis[offset];\r\n  }\r\n\r\n  /**\r\n   * Set the rescale slope and intercept.\r\n   *\r\n   * @param {RescaleSlopeAndIntercept} inRsi The input rescale\r\n   *   slope and intercept.\r\n   * @param {number} [offset] The rsi offset (only needed for non constant rsi).\r\n   */\r\n  setRescaleSlopeAndIntercept(inRsi, offset) {\r\n    // update identity flag\r\n    this.#isIdentityRSI = this.#isIdentityRSI && inRsi.isID();\r\n    // update constant flag\r\n    if (!this.#isConstantRSI) {\r\n      if (typeof offset === 'undefined') {\r\n        throw new Error(\r\n          'Cannot store non constant RSI with empty slice index.');\r\n      }\r\n      this.#rsis.splice(offset, 0, inRsi);\r\n    } else {\r\n      if (!this.#rsi.equals(inRsi)) {\r\n        if (typeof offset === 'undefined') {\r\n          // no slice index, replace existing\r\n          this.#rsi = inRsi;\r\n        } else {\r\n          // first non constant rsi\r\n          this.#isConstantRSI = false;\r\n          // switch to non constant mode\r\n          this.#rsis = [];\r\n          // initialise RSIs\r\n          for (let i = 0, leni = this.#getSecondaryOffsetMax(); i < leni; ++i) {\r\n            this.#rsis.push(this.#rsi);\r\n          }\r\n          // store\r\n          this.#rsi = null;\r\n          this.#rsis.splice(offset, 0, inRsi);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Are all the RSIs identity (1,0).\r\n   *\r\n   * @returns {boolean} True if they are.\r\n   */\r\n  isIdentityRSI() {\r\n    return this.#isIdentityRSI;\r\n  }\r\n\r\n  /**\r\n   * Are all the RSIs equal.\r\n   *\r\n   * @returns {boolean} True if they are.\r\n   */\r\n  isConstantRSI() {\r\n    return this.#isConstantRSI;\r\n  }\r\n\r\n  /**\r\n   * Get the photometricInterpretation of the image.\r\n   *\r\n   * @returns {string} The photometricInterpretation of the image.\r\n   */\r\n  getPhotometricInterpretation() {\r\n    return this.#photometricInterpretation;\r\n  }\r\n\r\n  /**\r\n   * Set the photometricInterpretation of the image.\r\n   *\r\n   * @param {string} interp The photometricInterpretation of the image.\r\n   */\r\n  setPhotometricInterpretation(interp) {\r\n    this.#photometricInterpretation = interp;\r\n  }\r\n\r\n  /**\r\n   * Get the planarConfiguration of the image.\r\n   *\r\n   * @returns {number} The planarConfiguration of the image.\r\n   */\r\n  getPlanarConfiguration() {\r\n    return this.#planarConfiguration;\r\n  }\r\n\r\n  /**\r\n   * Set the planarConfiguration of the image.\r\n   *\r\n   * @param {number} config The planarConfiguration of the image.\r\n   */\r\n  setPlanarConfiguration(config) {\r\n    this.#planarConfiguration = config;\r\n  }\r\n\r\n  /**\r\n   * Get the numberOfComponents of the image.\r\n   *\r\n   * @returns {number} The numberOfComponents of the image.\r\n   */\r\n  getNumberOfComponents() {\r\n    return this.#numberOfComponents;\r\n  }\r\n\r\n  /**\r\n   * Get the meta information of the image.\r\n   *\r\n   * @returns {object} The meta information of the image.\r\n   */\r\n  getMeta() {\r\n    return this.#meta;\r\n  }\r\n\r\n  /**\r\n   * Set the meta information of the image.\r\n   *\r\n   * @param {object} rhs The meta information of the image.\r\n   */\r\n  setMeta(rhs) {\r\n    this.#meta = rhs;\r\n  }\r\n\r\n  /**\r\n   * Get value at offset. Warning: No size check...\r\n   *\r\n   * @param {number} offset The desired offset.\r\n   * @returns {number} The value at offset.\r\n   */\r\n  getValueAtOffset(offset) {\r\n    return this.#buffer[offset];\r\n  }\r\n\r\n  /**\r\n   * Get the offsets where the buffer equals the input value.\r\n   * Loops through the whole volume, can get long for big data...\r\n   *\r\n   * @param {number|object} value The value to check.\r\n   * @returns {Array} The list of offsets.\r\n   */\r\n  getOffsets(value) {\r\n    // value to array\r\n    if (this.#numberOfComponents === 1) {\r\n      value = [value];\r\n    } else if (this.#numberOfComponents === 3 &&\r\n      typeof value.r !== 'undefined') {\r\n      value = [value.r, value.g, value.b];\r\n    }\r\n    // main loop\r\n    const offsets = [];\r\n    let equal;\r\n    for (let i = 0; i < this.#buffer.length; i = i + this.#numberOfComponents) {\r\n      equal = true;\r\n      for (let j = 0; j < this.#numberOfComponents; ++j) {\r\n        if (this.#buffer[i + j] !== value[j]) {\r\n          equal = false;\r\n          break;\r\n        }\r\n      }\r\n      if (equal) {\r\n        offsets.push(i);\r\n      }\r\n    }\r\n    return offsets;\r\n  }\r\n\r\n  /**\r\n   * Check if the input values are in the buffer.\r\n   * Could loop through the whole volume, can get long for big data...\r\n   *\r\n   * @param {Array} values The values to check.\r\n   * @returns {Array} A list of booleans for each input value,\r\n   *   set to true if the value is present in the buffer.\r\n   */\r\n  hasValues(values) {\r\n    // check input\r\n    if (typeof values === 'undefined' ||\r\n      values.length === 0) {\r\n      return [];\r\n    }\r\n    // final array value\r\n    const finalValues = [];\r\n    for (let v1 = 0; v1 < values.length; ++v1) {\r\n      if (this.#numberOfComponents === 1) {\r\n        finalValues.push([values[v1]]);\r\n      } else if (this.#numberOfComponents === 3) {\r\n        finalValues.push([\r\n          values[v1].r,\r\n          values[v1].g,\r\n          values[v1].b\r\n        ]);\r\n      }\r\n    }\r\n    // find callback\r\n    let equalFunc;\r\n    if (this.#numberOfComponents === 1) {\r\n      equalFunc = function (a, b) {\r\n        return a[0] === b[0];\r\n      };\r\n    } else if (this.#numberOfComponents === 3) {\r\n      equalFunc = function (a, b) {\r\n        return a[0] === b[0] &&\r\n          a[1] === b[1] &&\r\n          a[2] === b[2];\r\n      };\r\n    }\r\n    const getEqualCallback = function (value) {\r\n      return function (item) {\r\n        return equalFunc(item, value);\r\n      };\r\n    };\r\n    // main loop\r\n    const res = new Array(values.length);\r\n    res.fill(false);\r\n    const valuesToFind = finalValues.slice();\r\n    let equal;\r\n    let indicesToRemove;\r\n    for (let i = 0, leni = this.#buffer.length;\r\n      i < leni; i = i + this.#numberOfComponents) {\r\n      indicesToRemove = [];\r\n      for (let v = 0; v < valuesToFind.length; ++v) {\r\n        equal = true;\r\n        // check value(s)\r\n        for (let j = 0; j < this.#numberOfComponents; ++j) {\r\n          if (this.#buffer[i + j] !== valuesToFind[v][j]) {\r\n            equal = false;\r\n            break;\r\n          }\r\n        }\r\n        // if found, store answer and add to indices to remove\r\n        if (equal) {\r\n          const valIndex = finalValues.findIndex(\r\n            getEqualCallback(valuesToFind[v]));\r\n          res[valIndex] = true;\r\n          indicesToRemove.push(v);\r\n        }\r\n      }\r\n      // remove found values\r\n      for (let r = 0; r < indicesToRemove.length; ++r) {\r\n        valuesToFind.splice(indicesToRemove[r], 1);\r\n      }\r\n      // exit if no values to find\r\n      if (valuesToFind.length === 0) {\r\n        break;\r\n      }\r\n    }\r\n    // return\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Clone the image.\r\n   *\r\n   * @returns {Image} A clone of this image.\r\n   */\r\n  clone() {\r\n    // clone the image buffer\r\n    const clonedBuffer = this.#buffer.slice(0);\r\n    // create the image copy\r\n    const copy = new Image(this.getGeometry(), clonedBuffer, this.#imageUids);\r\n    // copy the RSI(s)\r\n    if (this.isConstantRSI()) {\r\n      copy.setRescaleSlopeAndIntercept(this.getRescaleSlopeAndIntercept());\r\n    } else {\r\n      for (let i = 0; i < this.#getSecondaryOffsetMax(); ++i) {\r\n        copy.setRescaleSlopeAndIntercept(\r\n          this.#getRescaleSlopeAndInterceptAtOffset(i), i);\r\n      }\r\n    }\r\n    // copy extras\r\n    copy.setPhotometricInterpretation(this.getPhotometricInterpretation());\r\n    copy.setPlanarConfiguration(this.getPlanarConfiguration());\r\n    copy.setMeta(this.getMeta());\r\n    // return\r\n    return copy;\r\n  }\r\n\r\n  /**\r\n   * Re-allocate buffer memory to an input size.\r\n   *\r\n   * @param {number} size The new size.\r\n   */\r\n  #realloc(size) {\r\n    // save buffer\r\n    let tmpBuffer = this.#buffer;\r\n    // create new\r\n    this.#buffer = getTypedArray(\r\n      this.#buffer.BYTES_PER_ELEMENT * 8,\r\n      this.#meta.IsSigned ? 1 : 0,\r\n      size);\r\n    if (this.#buffer === null) {\r\n      throw new Error('Cannot reallocate data for image.');\r\n    }\r\n    // put old in new\r\n    this.#buffer.set(tmpBuffer);\r\n    // clean\r\n    tmpBuffer = null;\r\n  }\r\n\r\n  /**\r\n   * Append a slice to the image.\r\n   *\r\n   * @param {Image} rhs The slice to append.\r\n   */\r\n  appendSlice(rhs) {\r\n    // check input\r\n    if (rhs === null) {\r\n      throw new Error('Cannot append null slice');\r\n    }\r\n    const rhsSize = rhs.getGeometry().getSize();\r\n    let size = this.#geometry.getSize();\r\n    if (rhsSize.get(2) !== 1) {\r\n      throw new Error('Cannot append more than one slice');\r\n    }\r\n    if (size.get(0) !== rhsSize.get(0)) {\r\n      throw new Error('Cannot append a slice with different number of columns');\r\n    }\r\n    if (size.get(1) !== rhsSize.get(1)) {\r\n      throw new Error('Cannot append a slice with different number of rows');\r\n    }\r\n    if (!this.#geometry.getOrientation().equals(\r\n      rhs.getGeometry().getOrientation(), 0.0001)) {\r\n      throw new Error('Cannot append a slice with different orientation');\r\n    }\r\n    if (this.#photometricInterpretation !==\r\n      rhs.getPhotometricInterpretation()) {\r\n      throw new Error(\r\n        'Cannot append a slice with different photometric interpretation');\r\n    }\r\n    // all meta should be equal\r\n    for (const key in this.#meta) {\r\n      if (key === 'windowPresets' || key === 'numberOfFiles' ||\r\n        key === 'custom') {\r\n        continue;\r\n      }\r\n      if (this.#meta[key] !== rhs.getMeta()[key]) {\r\n        throw new Error('Cannot append a slice with different ' + key);\r\n      }\r\n    }\r\n\r\n    // update ranges\r\n    const rhsRange = rhs.getDataRange();\r\n    const range = this.getDataRange();\r\n    this.#dataRange = {\r\n      min: Math.min(rhsRange.min, range.min),\r\n      max: Math.max(rhsRange.max, range.max),\r\n    };\r\n    const rhsResRange = rhs.getRescaledDataRange();\r\n    const resRange = this.getRescaledDataRange();\r\n    this.#rescaledDataRange = {\r\n      min: Math.min(rhsResRange.min, resRange.min),\r\n      max: Math.max(rhsResRange.max, resRange.max),\r\n    };\r\n\r\n    // possible time\r\n    const timeId = rhs.getGeometry().getInitialTime();\r\n\r\n    // append frame if needed\r\n    let isNewFrame = false;\r\n    if (typeof timeId !== 'undefined' &&\r\n      !this.#geometry.hasSlicesAtTime(timeId)) {\r\n      // update grometry\r\n      this.appendFrame(timeId, rhs.getGeometry().getOrigin());\r\n      // update size\r\n      size = this.#geometry.getSize();\r\n      // update flag\r\n      isNewFrame = true;\r\n    }\r\n\r\n    // get slice index\r\n    const index = getSliceIndex(this.#geometry, rhs.getGeometry());\r\n\r\n    // calculate slice size\r\n    const sliceSize = this.#numberOfComponents * size.getDimSize(2);\r\n\r\n    // create full buffer if not done yet\r\n    if (typeof this.#meta.numberOfFiles === 'undefined') {\r\n      throw new Error('Missing number of files for buffer manipulation.');\r\n    }\r\n    const fullBufferSize = sliceSize * this.#meta.numberOfFiles;\r\n    if (this.#buffer.length !== fullBufferSize) {\r\n      this.#realloc(fullBufferSize);\r\n    }\r\n\r\n    // slice index\r\n    const sliceIndex = index.get(2);\r\n\r\n    // slice index including possible 4D\r\n    let fullSliceIndex = sliceIndex;\r\n    if (typeof timeId !== 'undefined') {\r\n      fullSliceIndex +=\r\n        this.#geometry.getCurrentNumberOfSlicesBeforeTime(timeId);\r\n    }\r\n    // offset of the input slice\r\n    const indexOffset = fullSliceIndex * sliceSize;\r\n    const maxOffset =\r\n      this.#geometry.getCurrentTotalNumberOfSlices() * sliceSize;\r\n    // move content if needed\r\n    if (indexOffset < maxOffset) {\r\n      this.#buffer.set(\r\n        this.#buffer.subarray(indexOffset, maxOffset),\r\n        indexOffset + sliceSize\r\n      );\r\n    }\r\n    // add new slice content\r\n    this.#buffer.set(rhs.getBuffer(), indexOffset);\r\n\r\n    // update geometry\r\n    if (!isNewFrame) {\r\n      this.#geometry.appendOrigin(\r\n        rhs.getGeometry().getOrigin(), sliceIndex, timeId);\r\n    }\r\n    // update rsi\r\n    // (rhs should just have one rsi)\r\n    this.setRescaleSlopeAndIntercept(\r\n      rhs.getRescaleSlopeAndIntercept(), fullSliceIndex);\r\n\r\n    // current number of images\r\n    const numberOfImages = this.#imageUids.length;\r\n\r\n    // insert sop instance UIDs\r\n    this.#imageUids.splice(fullSliceIndex, 0, rhs.getImageUid());\r\n\r\n    // update window presets\r\n    if (typeof this.#meta.windowPresets !== 'undefined') {\r\n      const windowPresets = this.#meta.windowPresets;\r\n      const rhsPresets = rhs.getMeta().windowPresets;\r\n      const keys = Object.keys(rhsPresets);\r\n      let pkey = null;\r\n      for (let i = 0; i < keys.length; ++i) {\r\n        pkey = keys[i];\r\n        const rhsPreset = rhsPresets[pkey];\r\n        const windowPreset = windowPresets[pkey];\r\n        if (typeof windowPreset !== 'undefined') {\r\n          // if not set or false, check perslice\r\n          if (typeof windowPreset.perslice === 'undefined' ||\r\n            windowPreset.perslice === false) {\r\n            // if different preset.wl, mark it as perslice\r\n            if (!windowPreset.wl[0].equals(rhsPreset.wl[0])) {\r\n              windowPreset.perslice = true;\r\n              // fill wl array with copy of wl[0]\r\n              // (loop on number of images minus the existing one)\r\n              for (let j = 0; j < numberOfImages - 1; ++j) {\r\n                windowPreset.wl.push(windowPreset.wl[0]);\r\n              }\r\n            }\r\n          }\r\n          // store (first) rhs preset.wl if needed\r\n          if (typeof windowPreset.perslice !== 'undefined' &&\r\n            windowPreset.perslice === true) {\r\n            windowPresets[pkey].wl.splice(\r\n              fullSliceIndex, 0, rhsPreset.wl[0]);\r\n          }\r\n        } else {\r\n          // if not defined (it should be), store all\r\n          windowPresets[pkey] = rhsPresets[pkey];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Append a frame buffer to the image.\r\n   *\r\n   * @param {object} frameBuffer The frame buffer to append.\r\n   * @param {number} frameIndex The frame index.\r\n   */\r\n  appendFrameBuffer(frameBuffer, frameIndex) {\r\n    // create full buffer if not done yet\r\n    const size = this.#geometry.getSize();\r\n    const frameSize = this.#numberOfComponents * size.getDimSize(2);\r\n    if (typeof this.#meta.numberOfFiles === 'undefined') {\r\n      throw new Error('Missing number of files for frame buffer manipulation.');\r\n    }\r\n    const fullBufferSize = frameSize * this.#meta.numberOfFiles;\r\n    if (this.#buffer.length !== fullBufferSize) {\r\n      this.#realloc(fullBufferSize);\r\n    }\r\n    // check index\r\n    if (frameIndex >= this.#meta.numberOfFiles) {\r\n      logger.warn('Ignoring frame at index ' + frameIndex +\r\n        ' (size: ' + this.#meta.numberOfFiles + ')');\r\n      return;\r\n    }\r\n    // append\r\n    this.#buffer.set(frameBuffer, frameSize * frameIndex);\r\n    // update geometry\r\n    this.appendFrame(frameIndex, new Point3D(0, 0, 0));\r\n  }\r\n\r\n  /**\r\n   * Append a frame to the image.\r\n   *\r\n   * @param {number} time The frame time value.\r\n   * @param {Point3D} origin The origin of the frame.\r\n   */\r\n  appendFrame(time, origin) {\r\n    this.#geometry.appendFrame(origin, time);\r\n    this.#fireEvent({type: 'appendframe'});\r\n    // memory will be updated at the first appendSlice or appendFrameBuffer\r\n  }\r\n\r\n  /**\r\n   * Get the data range.\r\n   *\r\n   * @returns {object} The data range.\r\n   */\r\n  getDataRange() {\r\n    if (!this.#dataRange) {\r\n      this.#dataRange = this.calculateDataRange();\r\n    }\r\n    return this.#dataRange;\r\n  }\r\n\r\n  /**\r\n   * Get the rescaled data range.\r\n   *\r\n   * @returns {object} The rescaled data range.\r\n   */\r\n  getRescaledDataRange() {\r\n    if (!this.#rescaledDataRange) {\r\n      this.#rescaledDataRange = this.calculateRescaledDataRange();\r\n    }\r\n    return this.#rescaledDataRange;\r\n  }\r\n\r\n  /**\r\n   * Get the histogram.\r\n   *\r\n   * @returns {Array} The histogram.\r\n   */\r\n  getHistogram() {\r\n    if (!this.#histogram) {\r\n      const res = this.calculateHistogram();\r\n      this.#dataRange = res.dataRange;\r\n      this.#rescaledDataRange = res.rescaledDataRange;\r\n      this.#histogram = res.histogram;\r\n    }\r\n    return this.#histogram;\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n  // ****************************************\r\n  // image data modifiers... carefull...\r\n  // ****************************************\r\n\r\n  /**\r\n   * Set the inner buffer values at given offsets.\r\n   *\r\n   * @param {Array} offsets List of offsets where to set the data.\r\n   * @param {object} value The value to set at the given offsets.\r\n   * @fires Image#imagechange\r\n   */\r\n  setAtOffsets(offsets, value) {\r\n    let offset;\r\n    for (let i = 0, leni = offsets.length; i < leni; ++i) {\r\n      offset = offsets[i];\r\n      this.#buffer[offset] = value.r;\r\n      this.#buffer[offset + 1] = value.g;\r\n      this.#buffer[offset + 2] = value.b;\r\n    }\r\n    // fire imagechange\r\n    this.#fireEvent({type: 'imagechange'});\r\n  }\r\n\r\n  /**\r\n   * Set the inner buffer values at given offsets.\r\n   *\r\n   * @param {Array} offsetsLists List of offset lists where to set the data.\r\n   * @param {object} value The value to set at the given offsets.\r\n   * @returns {Array} A list of objects representing the original values before\r\n   *  replacing them.\r\n   * @fires Image#imagechange\r\n   */\r\n  setAtOffsetsAndGetOriginals(offsetsLists, value) {\r\n    const originalColoursLists = [];\r\n\r\n    // update and store\r\n    for (let j = 0; j < offsetsLists.length; ++j) {\r\n      const offsets = offsetsLists[j];\r\n      // first colour\r\n      let offset = offsets[0] * 3;\r\n      let previousColour = {\r\n        r: this.#buffer[offset],\r\n        g: this.#buffer[offset + 1],\r\n        b: this.#buffer[offset + 2]\r\n      };\r\n      // original value storage\r\n      const originalColours = [];\r\n      originalColours.push({\r\n        index: 0,\r\n        colour: previousColour\r\n      });\r\n      for (let i = 0; i < offsets.length; ++i) {\r\n        offset = offsets[i] * 3;\r\n        const currentColour = {\r\n          r: this.#buffer[offset],\r\n          g: this.#buffer[offset + 1],\r\n          b: this.#buffer[offset + 2]\r\n        };\r\n        // check if new colour\r\n        if (previousColour.r !== currentColour.r ||\r\n          previousColour.g !== currentColour.g ||\r\n          previousColour.b !== currentColour.b) {\r\n          // store new colour\r\n          originalColours.push({\r\n            index: i,\r\n            colour: currentColour\r\n          });\r\n          previousColour = currentColour;\r\n        }\r\n        // write update colour\r\n        this.#buffer[offset] = value.r;\r\n        this.#buffer[offset + 1] = value.g;\r\n        this.#buffer[offset + 2] = value.b;\r\n      }\r\n      originalColoursLists.push(originalColours);\r\n    }\r\n    // fire imagechange\r\n    this.#fireEvent({type: 'imagechange'});\r\n    return originalColoursLists;\r\n  }\r\n\r\n  /**\r\n   * Set the inner buffer values at given offsets.\r\n   *\r\n   * @param {Array} offsetsLists List of offset lists where to set the data.\r\n   * @param {object|Array} value The value to set at the given offsets.\r\n   * @fires Image#imagechange\r\n   */\r\n  setAtOffsetsWithIterator(offsetsLists, value) {\r\n    for (let j = 0; j < offsetsLists.length; ++j) {\r\n      const offsets = offsetsLists[j];\r\n      let iterator;\r\n      if (typeof value !== 'undefined' &&\r\n        typeof value.r !== 'undefined') {\r\n        // input value is a simple color\r\n        iterator = colourRange(\r\n          [{index: 0, colour: value}], offsets.length);\r\n      } else {\r\n        // input value is a list of iterators\r\n        // created by setAtOffsetsAndGetOriginals\r\n        iterator = colourRange(\r\n          value[j], offsets.length);\r\n      }\r\n\r\n      // set values\r\n      let ival = iterator.next();\r\n      while (!ival.done) {\r\n        const offset = offsets[ival.index] * 3;\r\n        this.#buffer[offset] = ival.value.r;\r\n        this.#buffer[offset + 1] = ival.value.g;\r\n        this.#buffer[offset + 2] = ival.value.b;\r\n        ival = iterator.next();\r\n      }\r\n    }\r\n    /**\r\n     * Image change event.\r\n     *\r\n     * @event Image#imagechange\r\n     * @type {object}\r\n     */\r\n    this.#fireEvent({type: 'imagechange'});\r\n  }\r\n\r\n  /**\r\n   * Get the value of the image at a specific coordinate.\r\n   *\r\n   * @param {number} i The X index.\r\n   * @param {number} j The Y index.\r\n   * @param {number} k The Z index.\r\n   * @param {number} f The frame number.\r\n   * @returns {number} The value at the desired position.\r\n   * Warning: No size check...\r\n   */\r\n  getValue(i, j, k, f) {\r\n    const frame = (f || 0);\r\n    const index = new Index([i, j, k, frame]);\r\n    return this.getValueAtOffset(\r\n      this.getGeometry().getSize().indexToOffset(index));\r\n  }\r\n\r\n  /**\r\n   * Get the value of the image at a specific index.\r\n   *\r\n   * @param {Index} index The index.\r\n   * @returns {number} The value at the desired position.\r\n   * Warning: No size check...\r\n   */\r\n  getValueAtIndex(index) {\r\n    return this.getValueAtOffset(\r\n      this.getGeometry().getSize().indexToOffset(index));\r\n  }\r\n\r\n  /**\r\n   * Get the rescaled value of the image at a specific position.\r\n   *\r\n   * @param {number} i The X index.\r\n   * @param {number} j The Y index.\r\n   * @param {number} k The Z index.\r\n   * @param {number} f The frame number.\r\n   * @returns {number} The rescaled value at the desired position.\r\n   * Warning: No size check...\r\n   */\r\n  getRescaledValue(i, j, k, f) {\r\n    if (typeof f === 'undefined') {\r\n      f = 0;\r\n    }\r\n    let val = this.getValue(i, j, k, f);\r\n    if (!this.isIdentityRSI()) {\r\n      if (this.isConstantRSI()) {\r\n        val = this.getRescaleSlopeAndIntercept().apply(val);\r\n      } else {\r\n        const values = [i, j, k, f];\r\n        const index = new Index(values);\r\n        val = this.getRescaleSlopeAndIntercept(index).apply(val);\r\n      }\r\n    }\r\n    return val;\r\n  }\r\n\r\n  /**\r\n   * Get the rescaled value of the image at a specific index.\r\n   *\r\n   * @param {Index} index The index.\r\n   * @returns {number} The rescaled value at the desired position.\r\n   * Warning: No size check...\r\n   */\r\n  getRescaledValueAtIndex(index) {\r\n    return this.getRescaledValueAtOffset(\r\n      this.getGeometry().getSize().indexToOffset(index)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the rescaled value of the image at a specific offset.\r\n   *\r\n   * @param {number} offset The desired offset.\r\n   * @returns {number} The rescaled value at the desired offset.\r\n   * Warning: No size check...\r\n   */\r\n  getRescaledValueAtOffset(offset) {\r\n    let val = this.getValueAtOffset(offset);\r\n    if (!this.isIdentityRSI()) {\r\n      if (this.isConstantRSI()) {\r\n        val = this.getRescaleSlopeAndIntercept().apply(val);\r\n      } else {\r\n        const index = this.getGeometry().getSize().offsetToIndex(offset);\r\n        val = this.getRescaleSlopeAndIntercept(index).apply(val);\r\n      }\r\n    }\r\n    return val;\r\n  }\r\n\r\n  /**\r\n   * Calculate the data range of the image.\r\n   * WARNING: for speed reasons, only calculated on the first frame...\r\n   *\r\n   * @returns {object} The range {min, max}.\r\n   */\r\n  calculateDataRange() {\r\n    let min = this.getValueAtOffset(0);\r\n    let max = min;\r\n    let value = 0;\r\n    const size = this.getGeometry().getSize();\r\n    let leni = size.getTotalSize();\r\n    // max to 3D\r\n    if (size.length() >= 3) {\r\n      leni = size.getDimSize(3);\r\n    }\r\n    for (let i = 0; i < leni; ++i) {\r\n      value = this.getValueAtOffset(i);\r\n      if (value > max) {\r\n        max = value;\r\n      }\r\n      if (value < min) {\r\n        min = value;\r\n      }\r\n    }\r\n    // return\r\n    return {min: min, max: max};\r\n  }\r\n\r\n  /**\r\n   * Calculate the rescaled data range of the image.\r\n   * WARNING: for speed reasons, only calculated on the first frame...\r\n   *\r\n   * @returns {object} The range {min, max}.\r\n   */\r\n  calculateRescaledDataRange() {\r\n    if (this.isIdentityRSI()) {\r\n      return this.getDataRange();\r\n    } else if (this.isConstantRSI()) {\r\n      const range = this.getDataRange();\r\n      const resmin = this.getRescaleSlopeAndIntercept().apply(range.min);\r\n      const resmax = this.getRescaleSlopeAndIntercept().apply(range.max);\r\n      return {\r\n        min: ((resmin < resmax) ? resmin : resmax),\r\n        max: ((resmin > resmax) ? resmin : resmax)\r\n      };\r\n    } else {\r\n      let rmin = this.getRescaledValueAtOffset(0);\r\n      let rmax = rmin;\r\n      let rvalue = 0;\r\n      const size = this.getGeometry().getSize();\r\n      let leni = size.getTotalSize();\r\n      // max to 3D\r\n      if (size.length() === 3) {\r\n        leni = size.getDimSize(3);\r\n      }\r\n      for (let i = 0; i < leni; ++i) {\r\n        rvalue = this.getRescaledValueAtOffset(i);\r\n        if (rvalue > rmax) {\r\n          rmax = rvalue;\r\n        }\r\n        if (rvalue < rmin) {\r\n          rmin = rvalue;\r\n        }\r\n      }\r\n      // return\r\n      return {min: rmin, max: rmax};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate the histogram of the image.\r\n   *\r\n   * @returns {object} The histogram, data range and rescaled data range.\r\n   */\r\n  calculateHistogram() {\r\n    const size = this.getGeometry().getSize();\r\n    const histo = [];\r\n    let min = this.getValueAtOffset(0);\r\n    let max = min;\r\n    let value = 0;\r\n    let rmin = this.getRescaledValueAtOffset(0);\r\n    let rmax = rmin;\r\n    let rvalue = 0;\r\n    for (let i = 0, leni = size.getTotalSize(); i < leni; ++i) {\r\n      value = this.getValueAtOffset(i);\r\n      if (value > max) {\r\n        max = value;\r\n      }\r\n      if (value < min) {\r\n        min = value;\r\n      }\r\n      rvalue = this.getRescaledValueAtOffset(i);\r\n      if (rvalue > rmax) {\r\n        rmax = rvalue;\r\n      }\r\n      if (rvalue < rmin) {\r\n        rmin = rvalue;\r\n      }\r\n      histo[rvalue] = (histo[rvalue] || 0) + 1;\r\n    }\r\n    // set data range\r\n    const dataRange = {min: min, max: max};\r\n    const rescaledDataRange = {min: rmin, max: rmax};\r\n    // generate data for plotting\r\n    const histogram = [];\r\n    for (let b = rmin; b <= rmax; ++b) {\r\n      histogram.push([b, (histo[b] || 0)]);\r\n    }\r\n    // return\r\n    return {\r\n      dataRange: dataRange,\r\n      rescaledDataRange: rescaledDataRange,\r\n      histogram: histogram\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Convolute the image with a given 2D kernel.\r\n   *\r\n   * Note: Uses raw buffer values.\r\n   *\r\n   * @param {Array} weights The weights of the 2D kernel as a 3x3 matrix.\r\n   * @returns {Image} The convoluted image.\r\n   */\r\n  convolute2D(weights) {\r\n    if (weights.length !== 9) {\r\n      throw new Error(\r\n        'The convolution matrix does not have a length of 9; it has ' +\r\n        weights.length);\r\n    }\r\n\r\n    const newImage = this.clone();\r\n    const newBuffer = newImage.getBuffer();\r\n\r\n    const imgSize = this.getGeometry().getSize();\r\n    const dimOffset = imgSize.getDimSize(2) * this.getNumberOfComponents();\r\n    for (let k = 0; k < imgSize.get(2); ++k) {\r\n      this.convoluteBuffer(weights, newBuffer, k * dimOffset);\r\n    }\r\n\r\n    return newImage;\r\n  }\r\n\r\n  /**\r\n   * Convolute an image buffer with a given 2D kernel.\r\n   *\r\n   * Note: Uses raw buffer values.\r\n   *\r\n   * @param {Array} weights The weights of the 2D kernel as a 3x3 matrix.\r\n   * @param {TypedArray} buffer The buffer to convolute.\r\n   * @param {number} startOffset The index to start at.\r\n   */\r\n  convoluteBuffer(\r\n    weights, buffer, startOffset) {\r\n    const imgSize = this.getGeometry().getSize();\r\n    const ncols = imgSize.get(0);\r\n    const nrows = imgSize.get(1);\r\n    const ncomp = this.getNumberOfComponents();\r\n\r\n    // number of component and planar configuration vars\r\n    let factor = 1;\r\n    let componentOffset = 1;\r\n    if (ncomp === 3) {\r\n      if (this.getPlanarConfiguration() === 0) {\r\n        factor = 3;\r\n      } else {\r\n        componentOffset = imgSize.getDimSize(2);\r\n      }\r\n    }\r\n\r\n    // allow special indent for matrices\r\n    /*jshint indent:false */\r\n\r\n    // default weight offset matrix\r\n    const wOff = [];\r\n    wOff[0] = (-ncols - 1) * factor;\r\n    wOff[1] = (-ncols) * factor;\r\n    wOff[2] = (-ncols + 1) * factor;\r\n    wOff[3] = -factor;\r\n    wOff[4] = 0;\r\n    wOff[5] = 1 * factor;\r\n    wOff[6] = (ncols - 1) * factor;\r\n    wOff[7] = (ncols) * factor;\r\n    wOff[8] = (ncols + 1) * factor;\r\n\r\n    // border weight offset matrices\r\n    // borders are extended (see http://en.wikipedia.org/wiki/Kernel_%28image_processing%29)\r\n\r\n    // i=0, j=0\r\n    const wOff00 = [];\r\n    wOff00[0] = wOff[4]; wOff00[1] = wOff[4]; wOff00[2] = wOff[5];\r\n    wOff00[3] = wOff[4]; wOff00[4] = wOff[4]; wOff00[5] = wOff[5];\r\n    wOff00[6] = wOff[7]; wOff00[7] = wOff[7]; wOff00[8] = wOff[8];\r\n    // i=0, j=*\r\n    const wOff0x = [];\r\n    wOff0x[0] = wOff[1]; wOff0x[1] = wOff[1]; wOff0x[2] = wOff[2];\r\n    wOff0x[3] = wOff[4]; wOff0x[4] = wOff[4]; wOff0x[5] = wOff[5];\r\n    wOff0x[6] = wOff[7]; wOff0x[7] = wOff[7]; wOff0x[8] = wOff[8];\r\n    // i=0, j=nrows\r\n    const wOff0n = [];\r\n    wOff0n[0] = wOff[1]; wOff0n[1] = wOff[1]; wOff0n[2] = wOff[2];\r\n    wOff0n[3] = wOff[4]; wOff0n[4] = wOff[4]; wOff0n[5] = wOff[5];\r\n    wOff0n[6] = wOff[4]; wOff0n[7] = wOff[4]; wOff0n[8] = wOff[5];\r\n\r\n    // i=*, j=0\r\n    const wOffx0 = [];\r\n    wOffx0[0] = wOff[3]; wOffx0[1] = wOff[4]; wOffx0[2] = wOff[5];\r\n    wOffx0[3] = wOff[3]; wOffx0[4] = wOff[4]; wOffx0[5] = wOff[5];\r\n    wOffx0[6] = wOff[6]; wOffx0[7] = wOff[7]; wOffx0[8] = wOff[8];\r\n    // i=*, j=* -> wOff\r\n    // i=*, j=nrows\r\n    const wOffxn = [];\r\n    wOffxn[0] = wOff[0]; wOffxn[1] = wOff[1]; wOffxn[2] = wOff[2];\r\n    wOffxn[3] = wOff[3]; wOffxn[4] = wOff[4]; wOffxn[5] = wOff[5];\r\n    wOffxn[6] = wOff[3]; wOffxn[7] = wOff[4]; wOffxn[8] = wOff[5];\r\n\r\n    // i=ncols, j=0\r\n    const wOffn0 = [];\r\n    wOffn0[0] = wOff[3]; wOffn0[1] = wOff[4]; wOffn0[2] = wOff[4];\r\n    wOffn0[3] = wOff[3]; wOffn0[4] = wOff[4]; wOffn0[5] = wOff[4];\r\n    wOffn0[6] = wOff[6]; wOffn0[7] = wOff[7]; wOffn0[8] = wOff[7];\r\n    // i=ncols, j=*\r\n    const wOffnx = [];\r\n    wOffnx[0] = wOff[0]; wOffnx[1] = wOff[1]; wOffnx[2] = wOff[1];\r\n    wOffnx[3] = wOff[3]; wOffnx[4] = wOff[4]; wOffnx[5] = wOff[4];\r\n    wOffnx[6] = wOff[6]; wOffnx[7] = wOff[7]; wOffnx[8] = wOff[7];\r\n    // i=ncols, j=nrows\r\n    const wOffnn = [];\r\n    wOffnn[0] = wOff[0]; wOffnn[1] = wOff[1]; wOffnn[2] = wOff[1];\r\n    wOffnn[3] = wOff[3]; wOffnn[4] = wOff[4]; wOffnn[5] = wOff[4];\r\n    wOffnn[6] = wOff[3]; wOffnn[7] = wOff[4]; wOffnn[8] = wOff[4];\r\n\r\n    // restore indent for rest of method\r\n    /*jshint indent:4 */\r\n\r\n    // loop vars\r\n    let pixelOffset = startOffset;\r\n    let newValue = 0;\r\n    let wOffFinal = [];\r\n    for (let c = 0; c < ncomp; ++c) {\r\n      // component offset\r\n      pixelOffset += c * componentOffset;\r\n      for (let j = 0; j < nrows; ++j) {\r\n        for (let i = 0; i < ncols; ++i) {\r\n          wOffFinal = wOff;\r\n          // special border cases\r\n          if (i === 0 && j === 0) {\r\n            wOffFinal = wOff00;\r\n          } else if (i === 0 && j === (nrows - 1)) {\r\n            wOffFinal = wOff0n;\r\n          } else if (i === (ncols - 1) && j === 0) {\r\n            wOffFinal = wOffn0;\r\n          } else if (i === (ncols - 1) && j === (nrows - 1)) {\r\n            wOffFinal = wOffnn;\r\n          } else if (i === 0 && j !== (nrows - 1) && j !== 0) {\r\n            wOffFinal = wOff0x;\r\n          } else if (i === (ncols - 1) && j !== (nrows - 1) && j !== 0) {\r\n            wOffFinal = wOffnx;\r\n          } else if (i !== 0 && i !== (ncols - 1) && j === 0) {\r\n            wOffFinal = wOffx0;\r\n          } else if (i !== 0 && i !== (ncols - 1) && j === (nrows - 1)) {\r\n            wOffFinal = wOffxn;\r\n          }\r\n          // calculate the weighed sum of the source image pixels that\r\n          // fall under the convolution matrix\r\n          newValue = 0;\r\n          for (let wi = 0; wi < 9; ++wi) {\r\n            newValue += this.getValueAtOffset(\r\n              pixelOffset + wOffFinal[wi]) * weights[wi];\r\n          }\r\n          buffer[pixelOffset] = newValue;\r\n          // increment pixel offset\r\n          pixelOffset += factor;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transform an image using a specific operator.\r\n   * WARNING: no size check!\r\n   *\r\n   * @param {Function} operator The operator to use when transforming.\r\n   * @returns {Image} The transformed image.\r\n   * Note: Uses the raw buffer values.\r\n   */\r\n  transform(operator) {\r\n    const newImage = this.clone();\r\n    const newBuffer = newImage.getBuffer();\r\n    for (let i = 0, leni = newBuffer.length; i < leni; ++i) {\r\n      newBuffer[i] = operator(newImage.getValueAtOffset(i));\r\n    }\r\n    return newImage;\r\n  }\r\n\r\n  /**\r\n   * Compose this image with another one and using a specific operator.\r\n   * WARNING: no size check!\r\n   *\r\n   * @param {Image} rhs The image to compose with.\r\n   * @param {Function} operator The operator to use when composing.\r\n   * @returns {Image} The composed image.\r\n   * Note: Uses the raw buffer values.\r\n   */\r\n  compose(rhs, operator) {\r\n    const newImage = this.clone();\r\n    const newBuffer = newImage.getBuffer();\r\n    for (let i = 0, leni = newBuffer.length; i < leni; ++i) {\r\n      // using the operator on the local buffer, i.e. the\r\n      // latest (not original) data\r\n      newBuffer[i] = Math.floor(\r\n        operator(this.getValueAtOffset(i), rhs.getValueAtOffset(i))\r\n      );\r\n    }\r\n    return newImage;\r\n  }\r\n\r\n} // class Image\r\n","import {View} from './view';\r\nimport {luts} from './luts';\r\nimport {\r\n  WindowLevel,\r\n  defaultPresets\r\n} from './windowLevel';\r\nimport {logger} from '../utils/logger';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Image} from './image';\r\nimport {DataElement} from '../dicom/dataElement';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * {@link View} factory.\r\n */\r\nexport class ViewFactory {\r\n\r\n  /**\r\n   * Get an View object from the read DICOM file.\r\n   *\r\n   * @param {Object<string, DataElement>} dataElements The DICOM tags.\r\n   * @param {Image} image The associated image.\r\n   * @returns {View} The new View.\r\n   */\r\n  create(dataElements, image) {\r\n    // view\r\n    const view = new View(image);\r\n\r\n    // default color map\r\n    if (image.getPhotometricInterpretation() === 'MONOCHROME1') {\r\n      view.setColourMap('invPlain');\r\n    } else if (image.getPhotometricInterpretation() === 'PALETTE COLOR') {\r\n      if (typeof luts['palette'] !== 'undefined') {\r\n        view.setColourMap('palette');\r\n      } else {\r\n        logger.warn('Cannot find Palette lut');\r\n      }\r\n    }\r\n\r\n    // window level presets\r\n    let windowPresets = {};\r\n    // image presets\r\n    if (typeof image.getMeta().windowPresets !== 'undefined') {\r\n      windowPresets = image.getMeta().windowPresets;\r\n    }\r\n    // min/max\r\n    // Not filled yet since it is stil too costly to calculate min/max\r\n    // for each slice... It will be filled at first use\r\n    // (see view.setWindowLevelPreset).\r\n    // Order is important, if no wl from DICOM, this will be the default.\r\n    windowPresets.minmax = {name: 'minmax'};\r\n    // optional modality presets\r\n    if (typeof defaultPresets !== 'undefined') {\r\n      const modality = image.getMeta().Modality;\r\n      for (const key in defaultPresets[modality]) {\r\n        const preset = defaultPresets[modality][key];\r\n        windowPresets[key] = {\r\n          wl: [new WindowLevel(preset.center, preset.width)],\r\n          name: key\r\n        };\r\n      }\r\n    }\r\n\r\n    // store\r\n    view.setWindowPresets(windowPresets);\r\n\r\n    // initialise the view\r\n    view.init();\r\n\r\n    return view;\r\n  }\r\n\r\n} // class ViewFactory\r\n","import {Index} from '../math/index';\r\nimport {ModalityLut} from './modalityLut';\r\nimport {WindowLut} from './windowLut';\r\nimport {luts} from './luts';\r\nimport {VoiLut} from './voiLut';\r\nimport {WindowLevel} from './windowLevel';\r\nimport {generateImageDataMonochrome} from './viewMonochrome';\r\nimport {generateImageDataPaletteColor} from './viewPaletteColor';\r\nimport {generateImageDataRgb} from './viewRgb';\r\nimport {generateImageDataYbrFull} from './viewYbrFull';\r\nimport {ViewFactory} from './viewFactory';\r\nimport {getSliceIterator} from '../image/iterator';\r\nimport {ListenerHandler} from '../utils/listen';\r\nimport {logger} from '../utils/logger';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Image} from './image';\r\nimport {RescaleSlopeAndIntercept} from './rsi';\r\nimport {ColourMap} from './luts';\r\nimport {Matrix33} from '../math/matrix';\r\nimport {\r\n  Point,\r\n  Point3D\r\n} from '../math/point';\r\nimport {DataElement} from '../dicom/dataElement';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * List of view event names.\r\n *\r\n * @type {string[]}\r\n */\r\nexport const viewEventNames = [\r\n  'wlchange',\r\n  'wlpresetadd',\r\n  'colourmapchange',\r\n  'positionchange',\r\n  'opacitychange',\r\n  'alphafuncchange'\r\n];\r\n\r\n/**\r\n * Create a View from DICOM elements and image.\r\n *\r\n * @param {Object<string, DataElement>} elements The DICOM elements.\r\n * @param {Image} image The associated image.\r\n * @returns {View} The View object.\r\n */\r\nexport function createView(elements, image) {\r\n  const factory = new ViewFactory();\r\n  return factory.create(elements, image);\r\n}\r\n\r\n/**\r\n * View class.\r\n *\r\n * Need to set the window lookup table once created\r\n * (either directly or with helper methods).\r\n *\r\n * @example\r\n * // XMLHttpRequest onload callback\r\n * const onload = function (event) {\r\n *   // parse the dicom buffer\r\n *   const dicomParser = new dwv.DicomParser();\r\n *   dicomParser.parse(event.target.response);\r\n *   // create the image object\r\n *   const image = dwv.createImage(dicomParser.getDicomElements());\r\n *   // create the view\r\n *   const view = dwv.createView(dicomParser.getDicomElements(), image);\r\n *   // setup canvas\r\n *   const canvas = document.createElement('canvas');\r\n *   canvas.width = 256;\r\n *   canvas.height = 256;\r\n *   const ctx = canvas.getContext(\"2d\");\r\n *   // update the image data\r\n *   const imageData = ctx.createImageData(256, 256);\r\n *   view.generateImageData(imageData);\r\n *   ctx.putImageData(imageData, 0, 0);\r\n *   // update html\r\n *   const div = document.getElementById('dwv');\r\n *   div.appendChild(canvas);;\r\n * };\r\n * // DICOM file request\r\n * const request = new XMLHttpRequest();\r\n * const url = 'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm';\r\n * request.open('GET', url);\r\n * request.responseType = 'arraybuffer';\r\n * request.onload = onload;\r\n * request.send();\r\n */\r\nexport class View {\r\n\r\n  /**\r\n   * The associated image.\r\n   *\r\n   * @type {Image}\r\n   */\r\n  #image;\r\n\r\n  /**\r\n   * Window lookup tables, indexed per Rescale Slope and Intercept (RSI).\r\n   *\r\n   * @type {WindowLut}\r\n   */\r\n  #windowLut;\r\n\r\n  /**\r\n   * Flag for image constant RSI.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isConstantRSI;\r\n\r\n  /**\r\n   * Window presets.\r\n   * Minmax will be filled at first use (see view.setWindowLevelPreset).\r\n   *\r\n   * @type {object}\r\n   */\r\n  #windowPresets = {minmax: {name: 'minmax'}};\r\n\r\n  /**\r\n   * Current window preset name.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #currentPresetName = null;\r\n\r\n  /**\r\n   * Current window level.\r\n   *\r\n   * @type {WindowLevel}\r\n   */\r\n  #currentWl;\r\n\r\n  /**\r\n   * Colour map name.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #colourMapName = 'plain';\r\n\r\n  /**\r\n   * Current position as a Point.\r\n   * Store position and not index to stay geometry independent.\r\n   *\r\n   * @type {Point}\r\n   */\r\n  #currentPosition = null;\r\n\r\n  /**\r\n   * View orientation. Undefined will use the original slice ordering.\r\n   *\r\n   * @type {Matrix33}\r\n   */\r\n  #orientation;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * @param {Image} image The associated image.\r\n   */\r\n  constructor(image) {\r\n    this.#image = image;\r\n\r\n    // listen to appendframe event to update the current position\r\n    //   to add the extra dimension\r\n    this.#image.addEventListener('appendframe', () => {\r\n      // update current position if first appendFrame\r\n      const index = this.getCurrentIndex();\r\n      if (index.length() === 3) {\r\n        // add dimension\r\n        const values = index.getValues();\r\n        values.push(0);\r\n        this.setCurrentIndex(new Index(values));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the associated image.\r\n   *\r\n   * @returns {Image} The associated image.\r\n   */\r\n  getImage() {\r\n    return this.#image;\r\n  }\r\n\r\n  /**\r\n   * Set the associated image.\r\n   *\r\n   * @param {Image} inImage The associated image.\r\n   */\r\n  setImage(inImage) {\r\n    this.#image = inImage;\r\n  }\r\n\r\n  /**\r\n   * Get the view orientation.\r\n   *\r\n   * @returns {Matrix33} The orientation matrix.\r\n   */\r\n  getOrientation() {\r\n    return this.#orientation;\r\n  }\r\n\r\n  /**\r\n   * Set the view orientation.\r\n   *\r\n   * @param {Matrix33} mat33 The orientation matrix.\r\n   */\r\n  setOrientation(mat33) {\r\n    this.#orientation = mat33;\r\n  }\r\n\r\n  /**\r\n   * Initialise the view: set initial index.\r\n   */\r\n  init() {\r\n    this.setInitialIndex();\r\n  }\r\n\r\n  /**\r\n   * Set the initial index to 0.\r\n   */\r\n  setInitialIndex() {\r\n    const geometry = this.#image.getGeometry();\r\n    const size = geometry.getSize();\r\n    const values = new Array(size.length());\r\n    values.fill(0);\r\n    // middle\r\n    values[0] = Math.floor(size.get(0) / 2);\r\n    values[1] = Math.floor(size.get(1) / 2);\r\n    values[2] = Math.floor(size.get(2) / 2);\r\n    this.setCurrentIndex(new Index(values), true);\r\n  }\r\n\r\n  /**\r\n   * Get the milliseconds per frame from frame rate.\r\n   *\r\n   * @param {number} recommendedDisplayFrameRate Recommended Display Frame Rate.\r\n   * @returns {number} The milliseconds per frame.\r\n   */\r\n  getPlaybackMilliseconds(recommendedDisplayFrameRate) {\r\n    if (!recommendedDisplayFrameRate) {\r\n      // Default to 10 FPS if none is found in the meta\r\n      recommendedDisplayFrameRate = 10;\r\n    }\r\n    // round milliseconds per frame to nearest whole number\r\n    return Math.round(1000 / recommendedDisplayFrameRate);\r\n  }\r\n\r\n  /**\r\n   * Per value alpha function.\r\n   *\r\n   * @param {*} _value The pixel value. Can be a number for monochrome\r\n   *  data or an array for RGB data.\r\n   * @param {number} _index The index of the value.\r\n   * @returns {number} The coresponding alpha [0,255].\r\n   */\r\n  #alphaFunction = function (_value, _index) {\r\n    // default always returns fully visible\r\n    return 0xff;\r\n  };\r\n\r\n  /**\r\n   * @callback alphaFn\r\n   * @param {object} value The pixel value.\r\n   * @param {object} index The values' index.\r\n   * @returns {number} The value to display.\r\n   */\r\n\r\n  /**\r\n   * Get the alpha function.\r\n   *\r\n   * @returns {alphaFn} The function.\r\n   */\r\n  getAlphaFunction() {\r\n    return this.#alphaFunction;\r\n  }\r\n\r\n  /**\r\n   * Set alpha function.\r\n   *\r\n   * @param {alphaFn} func The function.\r\n   * @fires View#alphafuncchange\r\n   */\r\n  setAlphaFunction(func) {\r\n    this.#alphaFunction = func;\r\n    /**\r\n     * Alpha func change event.\r\n     *\r\n     * @event View#alphafuncchange\r\n     * @type {object}\r\n     */\r\n    this.#fireEvent({\r\n      type: 'alphafuncchange'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the window LUT of the image.\r\n   * Warning: can be undefined in no window/level was set.\r\n   *\r\n   * @returns {WindowLut} The window LUT of the image.\r\n   * @fires View#wlchange\r\n   */\r\n  #getCurrentWindowLut() {\r\n    // get the current window level\r\n    let wl;\r\n    // special case for 'perslice' presets\r\n    if (this.#currentPresetName &&\r\n      typeof this.#windowPresets[this.#currentPresetName] !== 'undefined' &&\r\n      typeof this.#windowPresets[this.#currentPresetName].perslice !==\r\n        'undefined' &&\r\n      this.#windowPresets[this.#currentPresetName].perslice === true) {\r\n      // check position\r\n      if (!this.getCurrentIndex()) {\r\n        this.setInitialIndex();\r\n      }\r\n      const currentIndex = this.getCurrentIndex();\r\n      // get the preset for this slice\r\n      const offset = this.#image.getSecondaryOffset(currentIndex);\r\n      wl = this.#windowPresets[this.#currentPresetName].wl[offset];\r\n    }\r\n    // regular case\r\n    if (typeof wl === 'undefined') {\r\n      // if no current, use first id\r\n      if (typeof this.#currentWl === 'undefined') {\r\n        this.setWindowLevelPresetById(0, true);\r\n      }\r\n      wl = this.#currentWl;\r\n    }\r\n\r\n    // get the window lut\r\n    if (typeof this.#isConstantRSI === 'undefined' ||\r\n      this.#image.isConstantRSI() !== this.#isConstantRSI) {\r\n      this.#isConstantRSI = this.#image.isConstantRSI();\r\n      // set or update windowLut if isConstantRSI has changed\r\n      // (can be different at first slice and after having loaded\r\n      //  the full volume...)\r\n      let rsi;\r\n      let isDiscrete;\r\n      if (this.#isConstantRSI) {\r\n        rsi = this.#image.getRescaleSlopeAndIntercept();\r\n        isDiscrete = true;\r\n      } else {\r\n        rsi = new RescaleSlopeAndIntercept(1, 0);\r\n        isDiscrete = false;\r\n      }\r\n      // create the rescale lookup table\r\n      const modalityLut = new ModalityLut(\r\n        rsi,\r\n        this.#image.getMeta().BitsStored);\r\n      // create the window lookup table\r\n      this.#windowLut = new WindowLut(\r\n        modalityLut,\r\n        this.#image.getMeta().IsSigned,\r\n        isDiscrete);\r\n    }\r\n\r\n    // update VOI lut if not present or different from previous\r\n    const voiLut = this.#windowLut.getVoiLut();\r\n    let voiLutWl;\r\n    if (typeof voiLut !== 'undefined') {\r\n      voiLutWl = voiLut.getWindowLevel();\r\n    }\r\n    if (typeof voiLut === 'undefined' ||\r\n      !wl.equals(voiLutWl)) {\r\n      // set lut window level\r\n      const voiLut = new VoiLut(wl);\r\n      this.#windowLut.setVoiLut(voiLut);\r\n      // fire change event\r\n      this.#fireEvent({\r\n        type: 'wlchange',\r\n        value: [wl.center, wl.width],\r\n        wc: wl.center,\r\n        ww: wl.width,\r\n        skipGenerate: true\r\n      });\r\n    }\r\n\r\n    // return\r\n    return this.#windowLut;\r\n  }\r\n\r\n  /**\r\n   * Get the window presets.\r\n   *\r\n   * @returns {object} The window presets.\r\n   */\r\n  getWindowPresets() {\r\n    return this.#windowPresets;\r\n  }\r\n\r\n  /**\r\n   * Get the window presets names.\r\n   *\r\n   * @returns {string[]} The list of window presets names.\r\n   */\r\n  getWindowPresetsNames() {\r\n    return Object.keys(this.#windowPresets);\r\n  }\r\n\r\n  /**\r\n   * Set the window presets.\r\n   *\r\n   * @param {object} presets The window presets.\r\n   */\r\n  setWindowPresets(presets) {\r\n    this.#windowPresets = presets;\r\n  }\r\n\r\n  /**\r\n   * Add window presets to the existing ones.\r\n   *\r\n   * @param {object} presets The window presets.\r\n   */\r\n  addWindowPresets(presets) {\r\n    const keys = Object.keys(presets);\r\n    let key = null;\r\n    for (let i = 0; i < keys.length; ++i) {\r\n      key = keys[i];\r\n      if (typeof this.#windowPresets[key] !== 'undefined') {\r\n        if (typeof this.#windowPresets[key].perslice !== 'undefined' &&\r\n          this.#windowPresets[key].perslice === true) {\r\n          throw new Error('Cannot add perslice preset');\r\n        } else {\r\n          // update existing\r\n          this.#windowPresets[key] = presets[key];\r\n        }\r\n      } else {\r\n        // add new\r\n        this.#windowPresets[key] = presets[key];\r\n        // fire event\r\n        /**\r\n         * Window/level add preset event.\r\n         *\r\n         * @event View#wlpresetadd\r\n         * @type {object}\r\n         * @property {string} name The name of the preset.\r\n         */\r\n        this.#fireEvent({\r\n          type: 'wlpresetadd',\r\n          name: key\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the current window level preset name.\r\n   *\r\n   * @returns {string} The preset name.\r\n   */\r\n  getCurrentWindowPresetName() {\r\n    return this.#currentPresetName;\r\n  }\r\n\r\n  /**\r\n   * Get the colour map of the image.\r\n   *\r\n   * @returns {string} The colour map name.\r\n   */\r\n  getColourMap() {\r\n    return this.#colourMapName;\r\n  }\r\n\r\n  /**\r\n   * Get the colour map object.\r\n   *\r\n   * @returns {ColourMap} The colour map.\r\n   */\r\n  #getColourMapLut() {\r\n    return luts[this.#colourMapName];\r\n  }\r\n\r\n  /**\r\n   * Set the colour map of the image.\r\n   *\r\n   * @param {string} name The colour map name.\r\n   * @fires View#colourmapchange\r\n   */\r\n  setColourMap(name) {\r\n    // check if we have it\r\n    if (!luts[name]) {\r\n      throw new Error('Unknown colour map: \\'' + name + '\\'');\r\n    }\r\n\r\n    this.#colourMapName = name;\r\n\r\n    /**\r\n     * Color change event.\r\n     *\r\n     * @event View#colourmapchange\r\n     * @type {object}\r\n     * @property {Array} value The changed value.\r\n     */\r\n    this.#fireEvent({\r\n      type: 'colourmapchange',\r\n      value: [name]\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the current position.\r\n   *\r\n   * @returns {Point} The current position.\r\n   */\r\n  getCurrentPosition() {\r\n    return this.#currentPosition;\r\n  }\r\n\r\n  /**\r\n   * Get the current index.\r\n   *\r\n   * @returns {Index} The current index.\r\n   */\r\n  getCurrentIndex() {\r\n    const position = this.getCurrentPosition();\r\n    if (!position) {\r\n      return null;\r\n    }\r\n    const geometry = this.getImage().getGeometry();\r\n    return geometry.worldToIndex(position);\r\n  }\r\n\r\n  /**\r\n   * Check is the provided position can be set.\r\n   *\r\n   * @param {Point} position The position.\r\n   * @returns {boolean} True is the position is in bounds.\r\n   */\r\n  canSetPosition(position) {\r\n    const geometry = this.#image.getGeometry();\r\n    const index = geometry.worldToIndex(position);\r\n    const dirs = [this.getScrollIndex()];\r\n    if (index.length() === 4) {\r\n      dirs.push(3);\r\n    }\r\n    return geometry.isIndexInBounds(index, dirs);\r\n  }\r\n\r\n  /**\r\n   * Get the first origin or at a given position.\r\n   *\r\n   * @param {Point} [position] Optional position.\r\n   * @returns {Point3D} The origin.\r\n   */\r\n  getOrigin(position) {\r\n    const geometry = this.#image.getGeometry();\r\n    let originIndex = 0;\r\n    if (typeof position !== 'undefined') {\r\n      const index = geometry.worldToIndex(position);\r\n      // index is reoriented, 2 is scroll index\r\n      originIndex = index.get(2);\r\n    }\r\n    return geometry.getOrigins()[originIndex];\r\n  }\r\n\r\n  /**\r\n   * Set the current position.\r\n   *\r\n   * @param {Point} position The new position.\r\n   * @param {boolean} silent Flag to fire event or not.\r\n   * @returns {boolean} False if not in bounds\r\n   * @fires View#positionchange\r\n   */\r\n  setCurrentPosition(position, silent) {\r\n    // send invalid event if not in bounds\r\n    const geometry = this.#image.getGeometry();\r\n    const index = geometry.worldToIndex(position);\r\n    const dirs = [this.getScrollIndex()];\r\n    if (index.length() === 4) {\r\n      dirs.push(3);\r\n    }\r\n    if (!geometry.isIndexInBounds(index, dirs)) {\r\n      if (!silent) {\r\n        // fire event with valid: false\r\n        this.#fireEvent({\r\n          type: 'positionchange',\r\n          value: [\r\n            index.getValues(),\r\n            position.getValues(),\r\n          ],\r\n          valid: false\r\n        });\r\n      }\r\n      return false;\r\n    }\r\n    return this.setCurrentIndex(index, silent);\r\n  }\r\n\r\n  /**\r\n   * Set the current index.\r\n   *\r\n   * @param {Index} index The new index.\r\n   * @param {boolean} [silent] Flag to fire event or not.\r\n   * @returns {boolean} False if not in bounds.\r\n   * @fires View#positionchange\r\n   */\r\n  setCurrentIndex(index, silent) {\r\n    // check input\r\n    if (typeof silent === 'undefined') {\r\n      silent = false;\r\n    }\r\n\r\n    const geometry = this.#image.getGeometry();\r\n    const position = geometry.indexToWorld(index);\r\n\r\n    // check if possible\r\n    const dirs = [this.getScrollIndex()];\r\n    if (index.length() === 4) {\r\n      dirs.push(3);\r\n    }\r\n    if (!geometry.isIndexInBounds(index, dirs)) {\r\n      // do no send invalid positionchange event: avoid empty repaint\r\n      return false;\r\n    }\r\n\r\n    // calculate diff dims before updating internal\r\n    let diffDims = null;\r\n    let currentIndex = null;\r\n    if (this.getCurrentPosition()) {\r\n      currentIndex = this.getCurrentIndex();\r\n    }\r\n    if (currentIndex) {\r\n      if (currentIndex.canCompare(index)) {\r\n        diffDims = currentIndex.compare(index);\r\n      } else {\r\n        diffDims = [];\r\n        const minLen = Math.min(currentIndex.length(), index.length());\r\n        for (let i = 0; i < minLen; ++i) {\r\n          if (currentIndex.get(i) !== index.get(i)) {\r\n            diffDims.push(i);\r\n          }\r\n        }\r\n        const maxLen = Math.max(currentIndex.length(), index.length());\r\n        for (let j = minLen; j < maxLen; ++j) {\r\n          diffDims.push(j);\r\n        }\r\n      }\r\n    } else {\r\n      diffDims = [];\r\n      for (let k = 0; k < index.length(); ++k) {\r\n        diffDims.push(k);\r\n      }\r\n    }\r\n\r\n    // assign\r\n    this.#currentPosition = position;\r\n\r\n    if (!silent) {\r\n      /**\r\n       * Position change event.\r\n       *\r\n       * @event View#positionchange\r\n       * @type {object}\r\n       * @property {Array} value The changed value as [index, pixelValue].\r\n       * @property {Array} diffDims An array of modified indices.\r\n       */\r\n      const posEvent = {\r\n        type: 'positionchange',\r\n        value: [\r\n          index.getValues(),\r\n          position.getValues(),\r\n        ],\r\n        diffDims: diffDims,\r\n        data: {\r\n          imageUid: this.#image.getImageUid(index)\r\n        }\r\n      };\r\n\r\n      // add value if possible\r\n      if (this.#image.canQuantify()) {\r\n        const pixValue = this.#image.getRescaledValueAtIndex(index);\r\n        posEvent.value.push(pixValue);\r\n      }\r\n\r\n      // fire\r\n      this.#fireEvent(posEvent);\r\n    }\r\n\r\n    // all good\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Set the view window/level.\r\n   *\r\n   * @param {WindowLevel} wl The window and level.\r\n   * @param {string} [name] Associated preset name, defaults to 'manual'.\r\n   * Warning: uses the latest set rescale LUT or the default linear one.\r\n   * @param {boolean} [silent] Flag to launch events with skipGenerate.\r\n   * @fires View#wlchange\r\n   */\r\n  setWindowLevel(wl, name, silent) {\r\n    // check input\r\n    if (typeof name === 'undefined') {\r\n      name = 'manual';\r\n    }\r\n    if (typeof silent === 'undefined') {\r\n      silent = false;\r\n    }\r\n\r\n    // check if new\r\n    const isNew = !wl.equals(this.#currentWl);\r\n\r\n    // compare to previous if present\r\n    if (isNew) {\r\n      const isNewWidth = this.#currentWl\r\n        ? this.#currentWl.width !== wl.width : true;\r\n      const isNewCenter = this.#currentWl\r\n        ? this.#currentWl.center !== wl.center : true;\r\n      // assign\r\n      this.#currentWl = wl;\r\n      this.#currentPresetName = name;\r\n\r\n      // update manual\r\n      if (name === 'manual') {\r\n        if (typeof this.#windowPresets[name] !== 'undefined') {\r\n          this.#windowPresets[name].wl[0] = wl;\r\n        } else {\r\n          // add if not present\r\n          this.addWindowPresets({\r\n            manual: {\r\n              wl: [wl],\r\n              name: 'manual'\r\n            }\r\n          });\r\n        }\r\n      }\r\n\r\n      if (isNewWidth || isNewCenter) {\r\n        /**\r\n         * Window/level change event.\r\n         *\r\n         * @event View#wlchange\r\n         * @type {object}\r\n         * @property {Array} value The changed value.\r\n         * @property {number} wc The new window center value.\r\n         * @property {number} ww The new window wdth value.\r\n         * @property {boolean} skipGenerate Flag to skip view generation.\r\n         */\r\n        this.#fireEvent({\r\n          type: 'wlchange',\r\n          value: [wl.center, wl.width],\r\n          wc: wl.center,\r\n          ww: wl.width,\r\n          skipGenerate: silent\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the window/level.\r\n   *\r\n   * @returns {WindowLevel} The window and level.\r\n   */\r\n  getWindowLevel() {\r\n    // same as #currentWl...\r\n    const windowLut = this.#getCurrentWindowLut();\r\n    return windowLut.getVoiLut().getWindowLevel();\r\n  }\r\n\r\n  /**\r\n   * Set the window level to the preset with the input name.\r\n   *\r\n   * @param {string} name The name of the preset to activate.\r\n   * @param {boolean} [silent] Flag to launch events with skipGenerate.\r\n   */\r\n  setWindowLevelPreset(name, silent) {\r\n    const preset = this.getWindowPresets()[name];\r\n    if (typeof preset === 'undefined') {\r\n      throw new Error('Unknown window level preset: \\'' + name + '\\'');\r\n    }\r\n    // special min/max\r\n    if (name === 'minmax' && typeof preset.wl === 'undefined') {\r\n      preset.wl = [this.getWindowLevelMinMax()];\r\n    }\r\n    // default to first\r\n    let wl = preset.wl[0];\r\n    // check if 'perslice' case\r\n    if (typeof preset.perslice !== 'undefined' &&\r\n      preset.perslice === true) {\r\n      const offset = this.#image.getSecondaryOffset(this.getCurrentIndex());\r\n      wl = preset.wl[offset];\r\n    }\r\n    // set w/l\r\n    this.setWindowLevel(wl, name, silent);\r\n  }\r\n\r\n  /**\r\n   * Set the window level to the preset with the input id.\r\n   *\r\n   * @param {number} id The id of the preset to activate.\r\n   * @param {boolean} [silent] Flag to launch events with skipGenerate.\r\n   */\r\n  setWindowLevelPresetById(id, silent) {\r\n    const keys = Object.keys(this.getWindowPresets());\r\n    this.setWindowLevelPreset(keys[id], silent);\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Get the image window/level that covers the full data range.\r\n   * Warning: uses the latest set rescale LUT or the default linear one.\r\n   *\r\n   * @returns {WindowLevel} A min/max window level.\r\n   */\r\n  getWindowLevelMinMax() {\r\n    const range = this.getImage().getRescaledDataRange();\r\n    const min = range.min;\r\n    const max = range.max;\r\n    let width = max - min;\r\n    // full black / white images, defaults to 1.\r\n    if (width < 1) {\r\n      logger.warn('Zero or negative window width, defaulting to one.');\r\n      width = 1;\r\n    }\r\n    const center = min + width / 2;\r\n    return new WindowLevel(center, width);\r\n  }\r\n\r\n  /**\r\n   * Set the image window/level to cover the full data range.\r\n   * Warning: uses the latest set rescale LUT or the default linear one.\r\n   */\r\n  setWindowLevelMinMax() {\r\n    // calculate center and width\r\n    const wl = this.getWindowLevelMinMax();\r\n    // set window level\r\n    this.setWindowLevel(wl, 'minmax');\r\n  }\r\n\r\n  /**\r\n   * Generate display image data to be given to a canvas.\r\n   *\r\n   * @param {ImageData} data The iamge data to fill in.\r\n   * @param {Index} index Optional index at which to generate,\r\n   *   otherwise generates at current index.\r\n   */\r\n  generateImageData(data, index) {\r\n    // check index\r\n    if (typeof index === 'undefined') {\r\n      if (!this.getCurrentIndex()) {\r\n        this.setInitialIndex();\r\n      }\r\n      index = this.getCurrentIndex();\r\n    }\r\n\r\n    const image = this.getImage();\r\n    const isRescaled = !image.isConstantRSI();\r\n    const iterator = getSliceIterator(\r\n      image, index, isRescaled, this.getOrientation());\r\n\r\n    const photoInterpretation = image.getPhotometricInterpretation();\r\n    switch (photoInterpretation) {\r\n    case 'MONOCHROME1':\r\n    case 'MONOCHROME2':\r\n      generateImageDataMonochrome(\r\n        data,\r\n        iterator,\r\n        this.getAlphaFunction(),\r\n        this.#getCurrentWindowLut(),\r\n        this.#getColourMapLut()\r\n      );\r\n      break;\r\n\r\n    case 'PALETTE COLOR':\r\n      generateImageDataPaletteColor(\r\n        data,\r\n        iterator,\r\n        this.getAlphaFunction(),\r\n        this.#getColourMapLut(),\r\n        image.getMeta().BitsStored === 16\r\n      );\r\n      break;\r\n\r\n    case 'RGB':\r\n      generateImageDataRgb(\r\n        data,\r\n        iterator,\r\n        this.getAlphaFunction()\r\n      );\r\n      break;\r\n\r\n    case 'YBR_FULL':\r\n      generateImageDataYbrFull(\r\n        data,\r\n        iterator,\r\n        this.getAlphaFunction()\r\n      );\r\n      break;\r\n\r\n    default:\r\n      throw new Error(\r\n        'Unsupported photometric interpretation: ' + photoInterpretation);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Increment the provided dimension.\r\n   *\r\n   * @param {number} dim The dimension to increment.\r\n   * @param {boolean} silent Do not send event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  incrementIndex(dim, silent) {\r\n    const index = this.getCurrentIndex();\r\n    const values = new Array(index.length());\r\n    values.fill(0);\r\n    if (dim < values.length) {\r\n      values[dim] = 1;\r\n    } else {\r\n      console.warn('Cannot increment given index: ', dim, values.length);\r\n    }\r\n    const incr = new Index(values);\r\n    const newIndex = index.add(incr);\r\n    return this.setCurrentIndex(newIndex, silent);\r\n  }\r\n\r\n  /**\r\n   * Decrement the provided dimension.\r\n   *\r\n   * @param {number} dim The dimension to increment.\r\n   * @param {boolean} silent Do not send event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  decrementIndex(dim, silent) {\r\n    const index = this.getCurrentIndex();\r\n    const values = new Array(index.length());\r\n    values.fill(0);\r\n    if (dim < values.length) {\r\n      values[dim] = -1;\r\n    } else {\r\n      console.warn('Cannot decrement given index: ', dim, values.length);\r\n    }\r\n    const incr = new Index(values);\r\n    const newIndex = index.add(incr);\r\n    return this.setCurrentIndex(newIndex, silent);\r\n  }\r\n\r\n  /**\r\n   * Get the scroll dimension index.\r\n   *\r\n   * @returns {number} The index.\r\n   */\r\n  getScrollIndex() {\r\n    let index = null;\r\n    const orientation = this.getOrientation();\r\n    if (typeof orientation !== 'undefined') {\r\n      index = orientation.getThirdColMajorDirection();\r\n    } else {\r\n      index = 2;\r\n    }\r\n    return index;\r\n  }\r\n\r\n  /**\r\n   * Decrement the scroll dimension index.\r\n   *\r\n   * @param {boolean} silent Do not send event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  decrementScrollIndex(silent) {\r\n    return this.decrementIndex(this.getScrollIndex(), silent);\r\n  }\r\n\r\n  /**\r\n   * Increment the scroll dimension index.\r\n   *\r\n   * @param {boolean} silent Do not send event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  incrementScrollIndex(silent) {\r\n    return this.incrementIndex(this.getScrollIndex(), silent);\r\n  }\r\n\r\n} // class View\r\n","// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {WindowLut} from './windowLut';\r\nimport {ColourMap} from './luts';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Generate image data for 'MONOCHROME*' photometric interpretation.\r\n *\r\n * @param {ImageData} array The array to store the outut data\r\n * @param {object} iterator Position iterator.\r\n * @param {Function} alphaFunc The alpha function.\r\n * @param {WindowLut} windowLut The window/level LUT.\r\n * @param {ColourMap} colourMap The colour map.\r\n */\r\nexport function generateImageDataMonochrome(\r\n  array,\r\n  iterator,\r\n  alphaFunc,\r\n  windowLut,\r\n  colourMap) {\r\n  let index = 0;\r\n  let pxValue = 0;\r\n  let ival = iterator.next();\r\n  while (!ival.done) {\r\n    // pixel value\r\n    pxValue = windowLut.getValue(ival.value);\r\n    // store data\r\n    array.data[index] = colourMap.red[pxValue];\r\n    array.data[index + 1] = colourMap.green[pxValue];\r\n    array.data[index + 2] = colourMap.blue[pxValue];\r\n    array.data[index + 3] = alphaFunc(ival.value, ival.index);\r\n    // increment\r\n    index += 4;\r\n    ival = iterator.next();\r\n  }\r\n}\r\n","import {logger} from '../utils/logger';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ColourMap} from './luts';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Generate image data for 'PALETTE COLOR' photometric interpretation.\r\n *\r\n * @param {ImageData} array The array to store the outut data\r\n * @param {object} iterator Position iterator.\r\n * @param {Function} alphaFunc The alpha function.\r\n * @param {ColourMap} colourMap The colour map.\r\n * @param {boolean} is16BitsStored Flag to know if the data is 16bits.\r\n */\r\nexport function generateImageDataPaletteColor(\r\n  array,\r\n  iterator,\r\n  alphaFunc,\r\n  colourMap,\r\n  is16BitsStored) {\r\n  // right shift 8\r\n  const to8 = function (value) {\r\n    return value >> 8;\r\n  };\r\n\r\n  if (is16BitsStored) {\r\n    logger.info('Scaling 16bits data to 8bits.');\r\n  }\r\n\r\n  let index = 0;\r\n  let pxValue = 0;\r\n  let ival = iterator.next();\r\n  while (!ival.done) {\r\n    // pixel value\r\n    pxValue = ival.value;\r\n    // store data\r\n    // TODO check pxValue fits in lut\r\n    if (is16BitsStored) {\r\n      array.data[index] = to8(colourMap.red[pxValue]);\r\n      array.data[index + 1] = to8(colourMap.green[pxValue]);\r\n      array.data[index + 2] = to8(colourMap.blue[pxValue]);\r\n    } else {\r\n      array.data[index] = colourMap.red[pxValue];\r\n      array.data[index + 1] = colourMap.green[pxValue];\r\n      array.data[index + 2] = colourMap.blue[pxValue];\r\n    }\r\n    array.data[index + 3] = alphaFunc(pxValue, ival.index);\r\n    // increment\r\n    index += 4;\r\n    ival = iterator.next();\r\n  }\r\n}\r\n","/**\r\n * Generate image data for 'RGB' photometric interpretation.\r\n *\r\n * @param {ImageData} array The array to store the outut data\r\n * @param {object} iterator Position iterator.\r\n * @param {Function} alphaFunc The alpha function.\r\n */\r\nexport function generateImageDataRgb(\r\n  array,\r\n  iterator,\r\n  alphaFunc) {\r\n  let index = 0;\r\n  let ival = iterator.next();\r\n  while (!ival.done) {\r\n    // store data\r\n    array.data[index] = ival.value[0];\r\n    array.data[index + 1] = ival.value[1];\r\n    array.data[index + 2] = ival.value[2];\r\n    array.data[index + 3] = alphaFunc(ival.value, ival.index);\r\n    // increment\r\n    index += 4;\r\n    ival = iterator.next();\r\n  }\r\n}\r\n","import {ybrToRgb} from '../utils/colour';\r\n\r\n/**\r\n * Generate image data for 'YBR_FULL' photometric interpretation.\r\n *\r\n * @param {ImageData} array The array to store the outut data\r\n * @param {object} iterator Position iterator.\r\n * @param {Function} alphaFunc The alpha function.\r\n */\r\nexport function generateImageDataYbrFull(\r\n  array,\r\n  iterator,\r\n  alphaFunc) {\r\n  let index = 0;\r\n  let rgb = null;\r\n  let ival = iterator.next();\r\n  while (!ival.done) {\r\n    // convert ybr to rgb\r\n    rgb = ybrToRgb(ival.value[0], ival.value[1], ival.value[2]);\r\n    // store data\r\n    array.data[index] = rgb.r;\r\n    array.data[index + 1] = rgb.g;\r\n    array.data[index + 2] = rgb.b;\r\n    array.data[index + 3] = alphaFunc(ival.value, ival.index);\r\n    // increment\r\n    index += 4;\r\n    ival = iterator.next();\r\n  }\r\n}\r\n","import {Vector3D} from '../math/vector';\r\nimport {Point3D} from '../math/point';\r\nimport {getTargetOrientation} from '../gui/layerGroup';\r\nimport {getOrientedArray3D, getDeOrientedArray3D} from './geometry';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Matrix33} from '../math/matrix';\r\nimport {Spacing} from './spacing';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Plane geometry helper.\r\n */\r\nexport class PlaneHelper {\r\n\r\n  /**\r\n   * The associated spacing.\r\n   *\r\n   * @type {Spacing}\r\n   */\r\n  #spacing;\r\n\r\n  /**\r\n   * The image orientation.\r\n   *\r\n   * @type {Matrix33}\r\n   */\r\n  #imageOrientation;\r\n\r\n  /**\r\n   * The viewe orientation.\r\n   *\r\n   * @type {Matrix33}\r\n   */\r\n  #viewOrientation;\r\n\r\n  /**\r\n   * The target orientation.\r\n   *\r\n   * @type {Matrix33}\r\n   */\r\n  #targetOrientation;\r\n\r\n  /**\r\n   * @param {Spacing} spacing The spacing.\r\n   * @param {Matrix33} imageOrientation The image oientation.\r\n   * @param {Matrix33} viewOrientation The view orientation.\r\n   */\r\n  constructor(spacing, imageOrientation, viewOrientation) {\r\n    this.#spacing = spacing;\r\n    this.#imageOrientation = imageOrientation;\r\n    this.#viewOrientation = viewOrientation;\r\n\r\n    this.#targetOrientation = getTargetOrientation(\r\n      imageOrientation, viewOrientation);\r\n  }\r\n\r\n  /**\r\n   * Get a 3D offset from a plane one.\r\n   *\r\n   * @param {object} offset2D The plane offset as {x,y}.\r\n   * @returns {Vector3D} The 3D world offset.\r\n   */\r\n  getOffset3DFromPlaneOffset(offset2D) {\r\n    // make 3D\r\n    const planeOffset = new Vector3D(\r\n      offset2D.x, offset2D.y, 0);\r\n    // de-orient\r\n    const pixelOffset = this.getTargetDeOrientedVector3D(planeOffset);\r\n    // ~indexToWorld\r\n    return new Vector3D(\r\n      pixelOffset.getX() * this.#spacing.get(0),\r\n      pixelOffset.getY() * this.#spacing.get(1),\r\n      pixelOffset.getZ() * this.#spacing.get(2));\r\n  }\r\n\r\n  /**\r\n   * Get a plane offset from a 3D one.\r\n   *\r\n   * @param {object} offset3D The 3D offset as {x,y,z}.\r\n   * @returns {object} The plane offset as {x,y}.\r\n   */\r\n  getPlaneOffsetFromOffset3D(offset3D) {\r\n    // ~worldToIndex\r\n    const pixelOffset = new Vector3D(\r\n      offset3D.x / this.#spacing.get(0),\r\n      offset3D.y / this.#spacing.get(1),\r\n      offset3D.z / this.#spacing.get(2));\r\n    // orient\r\n    const planeOffset = this.getTargetOrientedVector3D(pixelOffset);\r\n    // make 2D\r\n    return {\r\n      x: planeOffset.getX(),\r\n      y: planeOffset.getY()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Orient an input vector from real to target space.\r\n   *\r\n   * @param {Vector3D} vector The input vector.\r\n   * @returns {Vector3D} The oriented vector.\r\n   */\r\n  getTargetOrientedVector3D(vector) {\r\n    let planeVector = vector;\r\n    if (typeof this.#targetOrientation !== 'undefined') {\r\n      planeVector =\r\n        this.#targetOrientation.getInverse().multiplyVector3D(vector);\r\n    }\r\n    return planeVector;\r\n  }\r\n\r\n  /**\r\n   * De-orient an input vector from target to real space.\r\n   *\r\n   * @param {Vector3D} planeVector The input vector.\r\n   * @returns {Vector3D} The de-orienteded vector.\r\n   */\r\n  getTargetDeOrientedVector3D(planeVector) {\r\n    let vector = planeVector;\r\n    if (typeof this.#targetOrientation !== 'undefined') {\r\n      vector = this.#targetOrientation.multiplyVector3D(planeVector);\r\n    }\r\n    return vector;\r\n  }\r\n\r\n  /**\r\n   * De-orient an input point from target to real space.\r\n   *\r\n   * @param {Point3D} planePoint The input point.\r\n   * @returns {Point3D} The de-orienteded point.\r\n   */\r\n  getTargetDeOrientedPoint3D(planePoint) {\r\n    let point = planePoint;\r\n    if (typeof this.#targetOrientation !== 'undefined') {\r\n      point = this.#targetOrientation.multiplyPoint3D(planePoint);\r\n    }\r\n    return point;\r\n  }\r\n\r\n  /**\r\n   * Orient an input vector from target to image space.\r\n   *\r\n   * @param {Vector3D} planeVector The input vector.\r\n   * @returns {Vector3D} The orienteded vector.\r\n   */\r\n  getImageOrientedVector3D(planeVector) {\r\n    let vector = planeVector;\r\n    if (typeof this.#viewOrientation !== 'undefined') {\r\n      // image oriented => view de-oriented\r\n      const values = getDeOrientedArray3D(\r\n        [\r\n          planeVector.getX(),\r\n          planeVector.getY(),\r\n          planeVector.getZ()\r\n        ],\r\n        this.#viewOrientation);\r\n      vector = new Vector3D(\r\n        values[0],\r\n        values[1],\r\n        values[2]\r\n      );\r\n    }\r\n    return vector;\r\n  }\r\n\r\n  /**\r\n   * Orient an input point from target to image space.\r\n   *\r\n   * @param {Point3D} planePoint The input vector.\r\n   * @returns {Point3D} The orienteded vector.\r\n   */\r\n  getImageOrientedPoint3D(planePoint) {\r\n    let point = planePoint;\r\n    if (typeof this.#viewOrientation !== 'undefined') {\r\n      // image oriented => view de-oriented\r\n      const values = getDeOrientedArray3D(\r\n        [\r\n          planePoint.getX(),\r\n          planePoint.getY(),\r\n          planePoint.getZ()\r\n        ],\r\n        this.#viewOrientation);\r\n      point = new Point3D(\r\n        values[0],\r\n        values[1],\r\n        values[2]\r\n      );\r\n    }\r\n    return point;\r\n  }\r\n\r\n  /**\r\n   * De-orient an input vector from image to target space.\r\n   *\r\n   * @param {Vector3D} vector The input vector.\r\n   * @returns {Vector3D} The de-orienteded vector.\r\n   */\r\n  getImageDeOrientedVector3D(vector) {\r\n    let planeVector = vector;\r\n    if (typeof this.#viewOrientation !== 'undefined') {\r\n      // image de-oriented => view oriented\r\n      const orientedValues = getOrientedArray3D(\r\n        [\r\n          vector.getX(),\r\n          vector.getY(),\r\n          vector.getZ()\r\n        ],\r\n        this.#viewOrientation);\r\n      planeVector = new Vector3D(\r\n        orientedValues[0],\r\n        orientedValues[1],\r\n        orientedValues[2]\r\n      );\r\n    }\r\n    return planeVector;\r\n  }\r\n\r\n  /**\r\n   * De-orient an input point from image to target space.\r\n   *\r\n   * @param {Point3D} point The input point.\r\n   * @returns {Point3D} The de-orienteded point.\r\n   */\r\n  getImageDeOrientedPoint3D(point) {\r\n    let planePoint = point;\r\n    if (typeof this.#viewOrientation !== 'undefined') {\r\n      // image de-oriented => view oriented\r\n      const orientedValues = getOrientedArray3D(\r\n        [\r\n          point.getX(),\r\n          point.getY(),\r\n          point.getZ()\r\n        ],\r\n        this.#viewOrientation);\r\n      planePoint = new Point3D(\r\n        orientedValues[0],\r\n        orientedValues[1],\r\n        orientedValues[2]\r\n      );\r\n    }\r\n    return planePoint;\r\n  }\r\n\r\n  /**\r\n   * Reorder values to follow target orientation.\r\n   *\r\n   * @param {object} values Values as {x,y,z}.\r\n   * @returns {object} Reoriented values as {x,y,z}.\r\n   */\r\n  getTargetOrientedPositiveXYZ(values) {\r\n    const orientedValues = getOrientedArray3D(\r\n      [\r\n        values.x,\r\n        values.y,\r\n        values.z\r\n      ],\r\n      this.#targetOrientation);\r\n    return {\r\n      x: orientedValues[0],\r\n      y: orientedValues[1],\r\n      z: orientedValues[2]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the (view) scroll dimension index.\r\n   *\r\n   * @returns {number} The index.\r\n   */\r\n  getScrollIndex() {\r\n    let index = null;\r\n    if (typeof this.#viewOrientation !== 'undefined') {\r\n      index = this.#viewOrientation.getThirdColMajorDirection();\r\n    } else {\r\n      index = 2;\r\n    }\r\n    return index;\r\n  }\r\n\r\n  /**\r\n   * Get the native (image) scroll dimension index.\r\n   *\r\n   * @returns {number} The index.\r\n   */\r\n  getNativeScrollIndex() {\r\n    let index = null;\r\n    if (typeof this.#imageOrientation !== 'undefined') {\r\n      index = this.#imageOrientation.getThirdColMajorDirection();\r\n    } else {\r\n      index = 2;\r\n    }\r\n    return index;\r\n  }\r\n\r\n} // class PlaneHelper\r\n","import {getIdentityMat33, getCoronalMat33} from '../math/matrix';\r\nimport {Index} from '../math/index';\r\nimport {Point} from '../math/point';\r\nimport {Vector3D} from '../math/vector';\r\nimport {viewEventNames} from '../image/view';\r\nimport {ListenerHandler} from '../utils/listen';\r\nimport {logger} from '../utils/logger';\r\nimport {ViewLayer} from './viewLayer';\r\nimport {DrawLayer} from './drawLayer';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Matrix33} from '../math/matrix';\r\nimport {Point3D} from '../math/point';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Get the layer div id.\r\n *\r\n * @param {string} groupDivId The layer group div id.\r\n * @param {number} layerId The lyaer id.\r\n * @returns {string} A string id.\r\n */\r\nexport function getLayerDivId(groupDivId, layerId) {\r\n  return groupDivId + '-layer-' + layerId;\r\n}\r\n\r\n/**\r\n * Get the layer details from a div id.\r\n *\r\n * @param {string} idString The layer div id.\r\n * @returns {object} The layer details as {groupDivId, layerId}.\r\n */\r\nexport function getLayerDetailsFromLayerDivId(idString) {\r\n  const split = idString.split('-layer-');\r\n  if (split.length !== 2) {\r\n    logger.warn('Not the expected layer div id format...');\r\n  }\r\n  return {\r\n    groupDivId: split[0],\r\n    layerId: split[1]\r\n  };\r\n}\r\n\r\n/**\r\n * Get the layer details from a mouse event.\r\n *\r\n * @param {object} event The event to get the layer div id from. Expecting\r\n * an event origininating from a canvas inside a layer HTML div\r\n * with the 'layer' class and id generated with `getLayerDivId`.\r\n * @returns {object} The layer details as {groupDivId, layerId}.\r\n */\r\nexport function getLayerDetailsFromEvent(event) {\r\n  let res = null;\r\n  // get the closest element from the event target and with the 'layer' class\r\n  const layerDiv = event.target.closest('.layer');\r\n  if (layerDiv && typeof layerDiv.id !== 'undefined') {\r\n    res = getLayerDetailsFromLayerDivId(layerDiv.id);\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Get the view orientation according to an image and target orientation.\r\n * The view orientation is used to go from target to image space.\r\n *\r\n * @param {Matrix33} imageOrientation The image geometry.\r\n * @param {Matrix33} targetOrientation The target orientation.\r\n * @returns {Matrix33} The view orientation.\r\n */\r\nexport function getViewOrientation(imageOrientation, targetOrientation) {\r\n  let viewOrientation = getIdentityMat33();\r\n  if (typeof targetOrientation !== 'undefined') {\r\n    // i: image, v: view, t: target, O: orientation, P: point\r\n    // [Img] -- Oi --> [Real] <-- Ot -- [Target]\r\n    // Pi = (Oi)-1 * Ot * Pt = Ov * Pt\r\n    // -> Ov = (Oi)-1 * Ot\r\n    // TODO: asOneAndZeros simplifies but not nice...\r\n    viewOrientation =\r\n      imageOrientation.asOneAndZeros().getInverse().multiply(targetOrientation);\r\n  }\r\n  // TODO: why abs???\r\n  return viewOrientation.getAbs();\r\n}\r\n\r\n/**\r\n * Get the target orientation according to an image and view orientation.\r\n * The target orientation is used to go from target to real space.\r\n *\r\n * @param {Matrix33} imageOrientation The image geometry.\r\n * @param {Matrix33} viewOrientation The view orientation.\r\n * @returns {Matrix33} The target orientation.\r\n */\r\nexport function getTargetOrientation(imageOrientation, viewOrientation) {\r\n  // i: image, v: view, t: target, O: orientation, P: point\r\n  // [Img] -- Oi --> [Real] <-- Ot -- [Target]\r\n  // Pi = (Oi)-1 * Ot * Pt = Ov * Pt\r\n  // -> Ot = Oi * Ov\r\n  // note: asOneAndZeros as in getViewOrientation...\r\n  let targetOrientation =\r\n    imageOrientation.asOneAndZeros().multiply(viewOrientation);\r\n\r\n  // TODO: why abs???\r\n  const simpleImageOrientation = imageOrientation.asOneAndZeros().getAbs();\r\n  if (simpleImageOrientation.equals(getCoronalMat33().getAbs())) {\r\n    targetOrientation = targetOrientation.getAbs();\r\n  }\r\n\r\n  return targetOrientation;\r\n}\r\n\r\n/**\r\n * Get a scaled offset to adapt to new scale and such as the input center\r\n * stays at the same position.\r\n *\r\n * @param {object} offset The previous offset as {x,y}.\r\n * @param {object} scale The previous scale as {x,y}.\r\n * @param {object} newScale The new scale as {x,y}.\r\n * @param {object} center The scale center as {x,y}.\r\n * @returns {object} The scaled offset as {x,y}.\r\n */\r\nexport function getScaledOffset(offset, scale, newScale, center) {\r\n  // worldPoint = indexPoint / scale + offset\r\n  //=> indexPoint = (worldPoint - offset ) * scale\r\n\r\n  // plane center should stay the same:\r\n  // indexCenter / newScale + newOffset =\r\n  //   indexCenter / oldScale + oldOffset\r\n  //=> newOffset = indexCenter / oldScale + oldOffset -\r\n  //     indexCenter / newScale\r\n  //=> newOffset = worldCenter - indexCenter / newScale\r\n  const indexCenter = {\r\n    x: (center.x - offset.x) * scale.x,\r\n    y: (center.y - offset.y) * scale.y\r\n  };\r\n  return {\r\n    x: center.x - (indexCenter.x / newScale.x),\r\n    y: center.y - (indexCenter.y / newScale.y)\r\n  };\r\n}\r\n\r\n/**\r\n * Layer group.\r\n *\r\n * Display position: {x,y}\r\n * Plane position: Index (access: get(i))\r\n * (world) Position: Point3D (access: getX, getY, getZ)\r\n *\r\n * Display -> World:\r\n * planePos = viewLayer.displayToPlanePos(displayPos)\r\n * -> compensate for layer scale and offset\r\n * pos = viewController.getPositionFromPlanePoint(planePos)\r\n *\r\n * World -> display\r\n * planePos = viewController.getOffset3DFromPlaneOffset(pos)\r\n * no need yet for a planePos to displayPos...\r\n */\r\nexport class LayerGroup {\r\n\r\n  /**\r\n   * The container div.\r\n   *\r\n   * @type {HTMLElement}\r\n   */\r\n  #containerDiv;\r\n\r\n  // jsdoc does not like\r\n  // @type {(ViewLayer|DrawLayer)[]}\r\n\r\n  /**\r\n   * List of layers.\r\n   *\r\n   * @type {Array<ViewLayer|DrawLayer>}\r\n   */\r\n  #layers = [];\r\n\r\n  /**\r\n   * The layer scale as {x,y}.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #scale = {x: 1, y: 1, z: 1};\r\n\r\n  /**\r\n   * The base scale as {x,y}: all posterior scale will be on top of this one.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #baseScale = {x: 1, y: 1, z: 1};\r\n\r\n  /**\r\n   * The layer offset as {x,y}.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #offset = {x: 0, y: 0, z: 0};\r\n\r\n  /**\r\n   * Active view layer index.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #activeViewLayerIndex = undefined;\r\n\r\n  /**\r\n   * Active draw layer index.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #activeDrawLayerIndex = undefined;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Flag to activate crosshair or not.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #showCrosshair = false;\r\n\r\n  /**\r\n   * The current position used for the crosshair.\r\n   *\r\n   * @type {Point}\r\n   */\r\n  #currentPosition;\r\n\r\n  /**\r\n   * Image smoothing flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #imageSmoothing = false;\r\n\r\n  /**\r\n   * @param {HTMLElement} containerDiv The associated HTML div.\r\n   */\r\n  constructor(containerDiv) {\r\n    this.#containerDiv = containerDiv;\r\n  }\r\n\r\n  /**\r\n   * Get the showCrosshair flag.\r\n   *\r\n   * @returns {boolean} True to display the crosshair.\r\n   */\r\n  getShowCrosshair() {\r\n    return this.#showCrosshair;\r\n  }\r\n\r\n  /**\r\n   * Set the showCrosshair flag.\r\n   *\r\n   * @param {boolean} flag True to display the crosshair.\r\n   */\r\n  setShowCrosshair(flag) {\r\n    this.#showCrosshair = flag;\r\n    if (flag) {\r\n      // listen to offset and zoom change\r\n      this.addEventListener('offsetchange', this.#updateCrosshairOnChange);\r\n      this.addEventListener('zoomchange', this.#updateCrosshairOnChange);\r\n      // show crosshair div\r\n      this.#showCrosshairDiv();\r\n    } else {\r\n      // listen to offset and zoom change\r\n      this.removeEventListener('offsetchange', this.#updateCrosshairOnChange);\r\n      this.removeEventListener('zoomchange', this.#updateCrosshairOnChange);\r\n      // remove crosshair div\r\n      this.#removeCrosshairDiv();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the imageSmoothing flag value.\r\n   *\r\n   * @param {boolean} flag True to enable smoothing.\r\n   */\r\n  setImageSmoothing(flag) {\r\n    this.#imageSmoothing = flag;\r\n    // set for existing layers\r\n    for (const layer of this.#layers) {\r\n      if (layer instanceof ViewLayer) {\r\n        layer.setImageSmoothing(flag);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update crosshair on offset or zoom change.\r\n   *\r\n   * @param {object} _event The change event.\r\n   */\r\n  #updateCrosshairOnChange = (_event) => {\r\n    this.#showCrosshairDiv();\r\n  };\r\n\r\n  /**\r\n   * Get the Id of the container div.\r\n   *\r\n   * @returns {string} The id of the div.\r\n   */\r\n  getDivId() {\r\n    return this.#containerDiv.id;\r\n  }\r\n\r\n  /**\r\n   * Get the layer scale.\r\n   *\r\n   * @returns {object} The scale as {x,y,z}.\r\n   */\r\n  getScale() {\r\n    return this.#scale;\r\n  }\r\n\r\n  /**\r\n   * Get the base scale.\r\n   *\r\n   * @returns {object} The scale as {x,y,z}.\r\n   */\r\n  getBaseScale() {\r\n    return this.#baseScale;\r\n  }\r\n\r\n  /**\r\n   * Get the added scale: the scale added to the base scale\r\n   *\r\n   * @returns {object} The scale as {x,y,z}.\r\n   */\r\n  getAddedScale() {\r\n    return {\r\n      x: this.#scale.x / this.#baseScale.x,\r\n      y: this.#scale.y / this.#baseScale.y,\r\n      z: this.#scale.z / this.#baseScale.z\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the layer offset.\r\n   *\r\n   * @returns {object} The offset as {x,y,z}.\r\n   */\r\n  getOffset() {\r\n    return this.#offset;\r\n  }\r\n\r\n  /**\r\n   * Get the number of layers handled by this class.\r\n   *\r\n   * @returns {number} The number of layers.\r\n   */\r\n  getNumberOfLayers() {\r\n    let count = 0;\r\n    this.#layers.forEach(item => {\r\n      if (typeof item !== 'undefined') {\r\n        count++;\r\n      }\r\n    });\r\n    return count;\r\n  }\r\n\r\n  /**\r\n   * Get the number of view layers handled by this class.\r\n   *\r\n   * @returns {number} The number of layers.\r\n   */\r\n  getNumberOfViewLayers() {\r\n    let count = 0;\r\n    this.#layers.forEach(item => {\r\n      if (typeof item !== 'undefined' &&\r\n        item instanceof ViewLayer) {\r\n        count++;\r\n      }\r\n    });\r\n    return count;\r\n  }\r\n\r\n  /**\r\n   * Get the active image layer.\r\n   *\r\n   * @returns {ViewLayer|undefined} The layer.\r\n   */\r\n  getActiveViewLayer() {\r\n    let layer;\r\n    if (typeof this.#activeViewLayerIndex !== 'undefined') {\r\n      const tmpLayer = this.#layers[this.#activeViewLayerIndex];\r\n      if (tmpLayer instanceof ViewLayer) {\r\n        layer = tmpLayer;\r\n      }\r\n    } else {\r\n      logger.info('No active view layer to return');\r\n    }\r\n    return layer;\r\n  }\r\n\r\n  /**\r\n   * Get the view layers associated to a data id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {ViewLayer[]} The layers.\r\n   */\r\n  getViewLayersByDataId(dataId) {\r\n    const res = [];\r\n    for (const layer of this.#layers) {\r\n      if (layer instanceof ViewLayer &&\r\n        layer.getDataId() === dataId) {\r\n        res.push(layer);\r\n      }\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Search view layers for equal imae meta data.\r\n   *\r\n   * @param {object} meta The meta data to find.\r\n   * @returns {ViewLayer[]} The list of view layers that contain matched data.\r\n   */\r\n  searchViewLayers(meta) {\r\n    const res = [];\r\n    for (const layer of this.#layers) {\r\n      if (layer instanceof ViewLayer) {\r\n        if (layer.getViewController().equalImageMeta(meta)) {\r\n          res.push(layer);\r\n        }\r\n      }\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Get the view layers data indices.\r\n   *\r\n   * @returns {Array} The list of indices.\r\n   */\r\n  getViewDataIndices() {\r\n    const res = [];\r\n    for (const layer of this.#layers) {\r\n      if (layer instanceof ViewLayer) {\r\n        res.push(layer.getDataId());\r\n      }\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Get the active draw layer.\r\n   *\r\n   * @returns {DrawLayer|undefined} The layer.\r\n   */\r\n  getActiveDrawLayer() {\r\n    let layer;\r\n    if (typeof this.#activeDrawLayerIndex !== 'undefined') {\r\n      const tmpLayer = this.#layers[this.#activeDrawLayerIndex];\r\n      if (tmpLayer instanceof DrawLayer) {\r\n        layer = tmpLayer;\r\n      }\r\n    } else {\r\n      logger.info('No active draw layer to return');\r\n    }\r\n    return layer;\r\n  }\r\n\r\n  /**\r\n   * Get the draw layers associated to a data id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {DrawLayer[]} The layers.\r\n   */\r\n  getDrawLayersByDataId(dataId) {\r\n    const res = [];\r\n    for (const layer of this.#layers) {\r\n      if (layer instanceof DrawLayer &&\r\n        layer.getDataId() === dataId) {\r\n        res.push(layer);\r\n      }\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Set the active view layer.\r\n   *\r\n   * @param {number} index The index of the layer to set as active.\r\n   */\r\n  setActiveViewLayer(index) {\r\n    if (this.#layers[index] instanceof ViewLayer) {\r\n      this.#activeViewLayerIndex = index;\r\n      /**\r\n       * Active view layer change event.\r\n       *\r\n       * @event LayerGroup#activeviewlayerchange\r\n       * @type {object}\r\n       * @property {Array} value The changed value.\r\n       */\r\n      this.#fireEvent({\r\n        type: 'activelayerchange',\r\n        value: [this.#layers[index]]\r\n      });\r\n    } else {\r\n      logger.warn('No view layer to set as active with index: ' +\r\n        index);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the active view layer with a data id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   */\r\n  setActiveViewLayerByDataId(dataId) {\r\n    let index;\r\n    for (let i = 0; i < this.#layers.length; ++i) {\r\n      if (this.#layers[i] instanceof ViewLayer &&\r\n        this.#layers[i].getDataId() === dataId) {\r\n        // stop at first one\r\n        index = i;\r\n        break;\r\n      }\r\n    }\r\n    if (typeof index !== 'undefined') {\r\n      this.setActiveViewLayer(index);\r\n    } else {\r\n      logger.warn('No view layer to set as active with dataId: ' +\r\n        dataId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the active draw layer.\r\n   *\r\n   * @param {number} index The index of the layer to set as active.\r\n   */\r\n  setActiveDrawLayer(index) {\r\n    if (this.#layers[index] instanceof DrawLayer) {\r\n      this.#activeDrawLayerIndex = index;\r\n      this.#fireEvent({\r\n        type: 'activelayerchange',\r\n        value: [this.#layers[index]]\r\n      });\r\n    } else {\r\n      logger.warn('No draw layer to set as active with index: ' +\r\n        index);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the active draw layer with a data id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   */\r\n  setActiveDrawLayerByDataId(dataId) {\r\n    let index;\r\n    for (let i = 0; i < this.#layers.length; ++i) {\r\n      if (this.#layers[i] instanceof DrawLayer &&\r\n        this.#layers[i].getDataId() === dataId) {\r\n        // stop at first one\r\n        index = i;\r\n        break;\r\n      }\r\n    }\r\n    if (typeof index !== 'undefined') {\r\n      this.setActiveDrawLayer(index);\r\n    } else {\r\n      logger.warn('No draw layer to set as active with dataId: ' +\r\n        dataId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a view layer.\r\n   *\r\n   * @returns {ViewLayer} The created layer.\r\n   */\r\n  addViewLayer() {\r\n    // layer index\r\n    const viewLayerIndex = this.#layers.length;\r\n    // create div\r\n    const div = this.#getNextLayerDiv();\r\n    // prepend to container\r\n    this.#containerDiv.append(div);\r\n    // view layer\r\n    const layer = new ViewLayer(div);\r\n    layer.setImageSmoothing(this.#imageSmoothing);\r\n    // add layer\r\n    this.#layers.push(layer);\r\n    // mark it as active\r\n    this.setActiveViewLayer(viewLayerIndex);\r\n    // bind view layer events\r\n    this.#bindViewLayer(layer);\r\n    // return\r\n    return layer;\r\n  }\r\n\r\n  /**\r\n   * Add a draw layer.\r\n   *\r\n   * @returns {DrawLayer} The created layer.\r\n   */\r\n  addDrawLayer() {\r\n    // store active index\r\n    this.#activeDrawLayerIndex = this.#layers.length;\r\n    // create div\r\n    const div = this.#getNextLayerDiv();\r\n    // prepend to container\r\n    this.#containerDiv.append(div);\r\n    // draw layer\r\n    const layer = new DrawLayer(div);\r\n    // add layer\r\n    this.#layers.push(layer);\r\n    // bind draw layer events\r\n    this.#bindDrawLayer(layer);\r\n    // return\r\n    return layer;\r\n  }\r\n\r\n  /**\r\n   * Bind view layer events to this.\r\n   *\r\n   * @param {ViewLayer} viewLayer The view layer to bind.\r\n   */\r\n  #bindViewLayer(viewLayer) {\r\n    // listen to position change to update other group layers\r\n    viewLayer.addEventListener(\r\n      'positionchange', this.updateLayersToPositionChange);\r\n    // propagate view viewLayer-layer events\r\n    for (const eventName of viewEventNames) {\r\n      viewLayer.addEventListener(eventName, this.#fireEvent);\r\n    }\r\n    // propagate viewLayer events\r\n    viewLayer.addEventListener('renderstart', this.#fireEvent);\r\n    viewLayer.addEventListener('renderend', this.#fireEvent);\r\n  }\r\n\r\n  /**\r\n   * Un-bind a view layer events to this.\r\n   *\r\n   * @param {ViewLayer} viewLayer The view layer to unbind.\r\n   */\r\n  #unbindViewLayer(viewLayer) {\r\n    // listen to position change to update other group layers\r\n    viewLayer.removeEventListener(\r\n      'positionchange', this.updateLayersToPositionChange);\r\n    // propagate view viewLayer-layer events\r\n    for (const eventName of viewEventNames) {\r\n      viewLayer.removeEventListener(eventName, this.#fireEvent);\r\n    }\r\n    // propagate viewLayer events\r\n    viewLayer.removeEventListener('renderstart', this.#fireEvent);\r\n    viewLayer.removeEventListener('renderend', this.#fireEvent);\r\n  }\r\n\r\n  /**\r\n   * Bind draw layer events to this.\r\n   *\r\n   * @param {DrawLayer} drawLayer The draw layer to bind.\r\n   */\r\n  #bindDrawLayer(drawLayer) {\r\n    // propagate drawLayer events\r\n    drawLayer.addEventListener('drawcreate', this.#fireEvent);\r\n    drawLayer.addEventListener('drawdelete', this.#fireEvent);\r\n  }\r\n\r\n  /**\r\n   * Un-bind a draw layer events to this.\r\n   *\r\n   * @param {DrawLayer} drawLayer The draw layer to unbind.\r\n   */\r\n  #unbindDrawLayer(drawLayer) {\r\n    // propagate drawLayer events\r\n    drawLayer.removeEventListener('drawcreate', this.#fireEvent);\r\n    drawLayer.removeEventListener('drawdelete', this.#fireEvent);\r\n  }\r\n\r\n  /**\r\n   * Get the next layer DOM div.\r\n   *\r\n   * @returns {HTMLDivElement} A DOM div.\r\n   */\r\n  #getNextLayerDiv() {\r\n    const div = document.createElement('div');\r\n    div.id = getLayerDivId(this.getDivId(), this.#layers.length);\r\n    div.className = 'layer';\r\n    div.style.pointerEvents = 'none';\r\n    return div;\r\n  }\r\n\r\n  /**\r\n   * Empty the layer list.\r\n   */\r\n  empty() {\r\n    this.#layers = [];\r\n    // reset active indices\r\n    this.#activeViewLayerIndex = undefined;\r\n    this.#activeDrawLayerIndex = undefined;\r\n    // remove possible crosshair\r\n    this.#removeCrosshairDiv();\r\n    // clean container div\r\n    const previous = this.#containerDiv.getElementsByClassName('layer');\r\n    if (previous) {\r\n      while (previous.length > 0) {\r\n        previous[0].remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a layer from this layer group.\r\n   * Warning: if current active layer, the index will\r\n   *   be set to `undefined`. Call one of the setActive\r\n   *   methods to define the active index.\r\n   *\r\n   * @param {ViewLayer | DrawLayer} layer The layer to remove.\r\n   */\r\n  removeLayer(layer) {\r\n    // find layer\r\n    const index = this.#layers.findIndex((item) => item === layer);\r\n    if (index === -1) {\r\n      throw new Error('Cannot find layer to remove');\r\n    }\r\n    // unbind and update active index\r\n    if (layer instanceof ViewLayer) {\r\n      this.#unbindViewLayer(layer);\r\n      if (this.#activeViewLayerIndex === index) {\r\n        this.#activeViewLayerIndex = undefined;\r\n      }\r\n    } else {\r\n      // delete layer draws\r\n      const numberOfDraws = layer.getNumberOfDraws();\r\n      if (typeof numberOfDraws !== 'undefined') {\r\n        let count = 0;\r\n        layer.addEventListener('drawdelete', (_event) => {\r\n          ++count;\r\n          // unbind when all draw are deleted\r\n          if (count === numberOfDraws) {\r\n            this.#unbindDrawLayer(layer);\r\n          }\r\n        });\r\n      }\r\n      layer.deleteDraws();\r\n      if (typeof numberOfDraws === 'undefined') {\r\n        this.#unbindDrawLayer(layer);\r\n      }\r\n      // reset active index\r\n      if (this.#activeDrawLayerIndex === index) {\r\n        this.#activeDrawLayerIndex = undefined;\r\n      }\r\n    }\r\n    // reset in storage\r\n    this.#layers[index] = undefined;\r\n    // update html\r\n    const layerDiv = document.getElementById(layer.getId());\r\n    if (layerDiv) {\r\n      layerDiv.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show a crosshair at a given position.\r\n   *\r\n   * @param {Point} [position] The position where to show the crosshair,\r\n   *   defaults to current position.\r\n   */\r\n  #showCrosshairDiv(position) {\r\n    if (typeof position === 'undefined') {\r\n      position = this.#currentPosition;\r\n    }\r\n\r\n    // remove previous\r\n    this.#removeCrosshairDiv();\r\n\r\n    // use first layer as base for calculating position and\r\n    // line sizes\r\n    let baseLayer;\r\n    for (const layer of this.#layers) {\r\n      if (layer instanceof ViewLayer) {\r\n        baseLayer = layer;\r\n        break;\r\n      }\r\n    }\r\n    if (typeof baseLayer === 'undefined') {\r\n      logger.warn('No layer to show crosshair');\r\n      return;\r\n    }\r\n\r\n    const vc = baseLayer.getViewController();\r\n    const p2D = vc.getPlanePositionFromPosition(position);\r\n    const displayPos = baseLayer.planePosToDisplay(p2D.x, p2D.y);\r\n\r\n    if (typeof displayPos.y !== 'undefined') {\r\n      const lineH = document.createElement('hr');\r\n      lineH.id = this.getDivId() + '-scroll-crosshair-horizontal';\r\n      lineH.className = 'horizontal';\r\n      lineH.style.width = this.#containerDiv.offsetWidth + 'px';\r\n      lineH.style.left = '0px';\r\n      lineH.style.top = displayPos.y + 'px';\r\n      this.#containerDiv.appendChild(lineH);\r\n    }\r\n\r\n    if (typeof displayPos.x !== 'undefined') {\r\n      const lineV = document.createElement('hr');\r\n      lineV.id = this.getDivId() + '-scroll-crosshair-vertical';\r\n      lineV.className = 'vertical';\r\n      lineV.style.width = this.#containerDiv.offsetHeight + 'px';\r\n      lineV.style.left = (displayPos.x) + 'px';\r\n      lineV.style.top = '0px';\r\n      this.#containerDiv.appendChild(lineV);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove crosshair divs.\r\n   */\r\n  #removeCrosshairDiv() {\r\n    let div = document.getElementById(\r\n      this.getDivId() + '-scroll-crosshair-horizontal');\r\n    if (div) {\r\n      div.remove();\r\n    }\r\n    div = document.getElementById(\r\n      this.getDivId() + '-scroll-crosshair-vertical');\r\n    if (div) {\r\n      div.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update layers (but not the active view layer) to a position change.\r\n   *\r\n   * @param {object} event The position change event.\r\n   * @function\r\n   */\r\n  updateLayersToPositionChange = (event) => {\r\n    // pause positionchange listeners\r\n    for (const layer of this.#layers) {\r\n      if (layer instanceof ViewLayer) {\r\n        layer.removeEventListener(\r\n          'positionchange', this.updateLayersToPositionChange);\r\n        layer.removeEventListener('positionchange', this.#fireEvent);\r\n      }\r\n    }\r\n\r\n    const index = new Index(event.value[0]);\r\n    const position = new Point(event.value[1]);\r\n\r\n    // store current position\r\n    this.#currentPosition = position;\r\n\r\n    if (this.#showCrosshair) {\r\n      this.#showCrosshairDiv(position);\r\n    }\r\n\r\n    // origin of the first view layer\r\n    let baseViewLayerOrigin0;\r\n    let baseViewLayerOrigin;\r\n    let scrollOffset;\r\n    let planeOffset;\r\n    // update position for all layers except the source one\r\n    for (const layer of this.#layers) {\r\n      if (typeof layer === 'undefined') {\r\n        continue;\r\n      }\r\n\r\n      // update base offset (does not trigger redraw)\r\n      let hasSetOffset = false;\r\n      if (layer instanceof ViewLayer) {\r\n        const vc = layer.getViewController();\r\n        // origin0 should always be there\r\n        const origin0 = vc.getOrigin();\r\n        // depending on position, origin could be undefined\r\n        const origin = vc.getOrigin(position);\r\n\r\n        if (typeof baseViewLayerOrigin === 'undefined') {\r\n          baseViewLayerOrigin0 = origin0;\r\n          baseViewLayerOrigin = origin;\r\n          const zeroOffset = new Vector3D(0, 0, 0);\r\n          hasSetOffset =\r\n            layer.setBaseOffset(zeroOffset, zeroOffset);\r\n        } else {\r\n          if (vc.canSetPosition(position) &&\r\n            typeof origin !== 'undefined') {\r\n            // TODO: compensate for possible different orientation between views\r\n            const scrollDiff = baseViewLayerOrigin0.minus(origin0);\r\n            scrollOffset = new Vector3D(\r\n              scrollDiff.getX(), scrollDiff.getY(), scrollDiff.getZ());\r\n            const planeDiff = baseViewLayerOrigin.minus(origin);\r\n            planeOffset = new Vector3D(\r\n              planeDiff.getX(), planeDiff.getY(), planeDiff.getZ());\r\n          }\r\n        }\r\n      }\r\n      // also set for draw layers\r\n      // (should be next after a view layer)\r\n      if (typeof scrollOffset !== 'undefined' &&\r\n        typeof planeOffset !== 'undefined') {\r\n        hasSetOffset =\r\n          layer.setBaseOffset(scrollOffset, planeOffset);\r\n      }\r\n\r\n      // update position (triggers redraw)\r\n      let hasSetPos = false;\r\n      if (layer.getId() !== event.srclayerid) {\r\n        hasSetPos = layer.setCurrentPosition(position, index);\r\n      }\r\n\r\n      // force redraw if needed\r\n      if (!hasSetPos && hasSetOffset) {\r\n        layer.draw();\r\n      }\r\n    }\r\n\r\n    // re-start positionchange listeners\r\n    for (const layer of this.#layers) {\r\n      if (layer instanceof ViewLayer) {\r\n        layer.addEventListener(\r\n          'positionchange', this.updateLayersToPositionChange);\r\n        layer.addEventListener('positionchange', this.#fireEvent);\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Calculate the fit scale: the scale that fits the largest data.\r\n   *\r\n   * @returns {number|undefined} The fit scale.\r\n   */\r\n  calculateFitScale() {\r\n    // check container\r\n    if (this.#containerDiv.offsetWidth === 0 &&\r\n      this.#containerDiv.offsetHeight === 0) {\r\n      throw new Error('Cannot fit to zero sized container.');\r\n    }\r\n    // get max size\r\n    const maxSize = this.getMaxSize();\r\n    if (typeof maxSize === 'undefined') {\r\n      return undefined;\r\n    }\r\n    // return best fit\r\n    return Math.min(\r\n      this.#containerDiv.offsetWidth / maxSize.x,\r\n      this.#containerDiv.offsetHeight / maxSize.y\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set the layer group fit scale.\r\n   *\r\n   * @param {number} scaleIn The fit scale.\r\n   */\r\n  setFitScale(scaleIn) {\r\n    // get maximum size\r\n    const maxSize = this.getMaxSize();\r\n    // exit if none\r\n    if (typeof maxSize === 'undefined') {\r\n      return;\r\n    }\r\n\r\n    const containerSize = {\r\n      x: this.#containerDiv.offsetWidth,\r\n      y: this.#containerDiv.offsetHeight\r\n    };\r\n    // offset to keep data centered\r\n    const fitOffset = {\r\n      x: -0.5 * (containerSize.x - Math.floor(maxSize.x * scaleIn)),\r\n      y: -0.5 * (containerSize.y - Math.floor(maxSize.y * scaleIn))\r\n    };\r\n\r\n    // apply to layers\r\n    for (const layer of this.#layers) {\r\n      if (typeof layer !== 'undefined') {\r\n        layer.fitToContainer(scaleIn, containerSize, fitOffset);\r\n      }\r\n    }\r\n\r\n    // update crosshair\r\n    if (this.#showCrosshair) {\r\n      this.#showCrosshairDiv();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the largest data size.\r\n   *\r\n   * @returns {object|undefined} The largest size as {x,y}.\r\n   */\r\n  getMaxSize() {\r\n    let maxSize = {x: 0, y: 0};\r\n    for (const layer of this.#layers) {\r\n      if (layer instanceof ViewLayer) {\r\n        const size = layer.getImageWorldSize();\r\n        if (size.x > maxSize.x) {\r\n          maxSize.x = size.x;\r\n        }\r\n        if (size.y > maxSize.y) {\r\n          maxSize.y = size.y;\r\n        }\r\n      }\r\n    }\r\n    if (maxSize.x === 0 && maxSize.y === 0) {\r\n      maxSize = undefined;\r\n    }\r\n    return maxSize;\r\n  }\r\n\r\n  /**\r\n   * Flip all layers along the Z axis without offset compensation.\r\n   */\r\n  flipScaleZ() {\r\n    this.#baseScale.z *= -1;\r\n    this.setScale(this.#baseScale);\r\n  }\r\n\r\n  /**\r\n   * Add scale to the layers. Scale cannot go lower than 0.1.\r\n   *\r\n   * @param {number} scaleStep The scale to add.\r\n   * @param {Point3D} center The scale center Point3D.\r\n   */\r\n  addScale(scaleStep, center) {\r\n    const newScale = {\r\n      x: this.#scale.x * (1 + scaleStep),\r\n      y: this.#scale.y * (1 + scaleStep),\r\n      z: this.#scale.z * (1 + scaleStep)\r\n    };\r\n    this.setScale(newScale, center);\r\n  }\r\n\r\n  /**\r\n   * Set the layers' scale.\r\n   *\r\n   * @param {object} newScale The scale to apply as {x,y,z}.\r\n   * @param {Point3D} [center] The scale center Point3D.\r\n   * @fires LayerGroup#zoomchange\r\n   */\r\n  setScale(newScale, center) {\r\n    this.#scale = newScale;\r\n    // apply to layers\r\n    for (const layer of this.#layers) {\r\n      if (typeof layer !== 'undefined') {\r\n        layer.setScale(this.#scale, center);\r\n      }\r\n    }\r\n\r\n    // event value\r\n    const value = [\r\n      newScale.x,\r\n      newScale.y,\r\n      newScale.z\r\n    ];\r\n    if (typeof center !== 'undefined') {\r\n      value.push(center.getX());\r\n      value.push(center.getY());\r\n      value.push(center.getZ());\r\n    }\r\n\r\n    /**\r\n     * Zoom change event.\r\n     *\r\n     * @event LayerGroup#zoomchange\r\n     * @type {object}\r\n     * @property {Array} value The changed value.\r\n     */\r\n    this.#fireEvent({\r\n      type: 'zoomchange',\r\n      value: value\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add translation to the layers.\r\n   *\r\n   * @param {object} translation The translation as {x,y,z}.\r\n   */\r\n  addTranslation(translation) {\r\n    this.setOffset({\r\n      x: this.#offset.x - translation.x,\r\n      y: this.#offset.y - translation.y,\r\n      z: this.#offset.z - translation.z\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the layers' offset.\r\n   *\r\n   * @param {object} newOffset The offset as {x,y,z}.\r\n   * @fires LayerGroup#offsetchange\r\n   */\r\n  setOffset(newOffset) {\r\n    // store\r\n    this.#offset = newOffset;\r\n    // apply to layers\r\n    for (const layer of this.#layers) {\r\n      if (typeof layer !== 'undefined') {\r\n        layer.setOffset(this.#offset);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Offset change event.\r\n     *\r\n     * @event LayerGroup#offsetchange\r\n     * @type {object}\r\n     * @property {Array} value The changed value.\r\n     */\r\n    this.#fireEvent({\r\n      type: 'offsetchange',\r\n      value: [\r\n        this.#offset.x,\r\n        this.#offset.y,\r\n        this.#offset.z\r\n      ]\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Reset the stage to its initial scale and no offset.\r\n   */\r\n  reset() {\r\n    this.setScale(this.#baseScale);\r\n    this.setOffset({x: 0, y: 0, z: 0});\r\n  }\r\n\r\n  /**\r\n   * Draw the layer.\r\n   */\r\n  draw() {\r\n    for (const layer of this.#layers) {\r\n      if (typeof layer !== 'undefined') {\r\n        layer.draw();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Display the layer.\r\n   *\r\n   * @param {boolean} flag Whether to display the layer or not.\r\n   */\r\n  display(flag) {\r\n    for (const layer of this.#layers) {\r\n      if (typeof layer !== 'undefined') {\r\n        layer.display(flag);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n} // LayerGroup class\r\n","import {logger} from '../utils/logger';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Image} from './image';\r\nimport {MaskSegment} from './maskFactory';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Mask segment helper.\r\n */\r\nexport class MaskSegmentHelper {\r\n\r\n  /**\r\n   * The associated mask.\r\n   *\r\n   * @type {Image}\r\n   */\r\n  #mask;\r\n\r\n  /**\r\n   * The segments: array of segment description.\r\n   *\r\n   * @type {MaskSegment[]}\r\n   */\r\n  #segments;\r\n\r\n  /**\r\n   * List of ids of hidden segments.\r\n   *\r\n   * @type {number[]}\r\n   */\r\n  #hiddenSegments = [];\r\n\r\n  /**\r\n   * @param {Image} mask The associated mask image.\r\n   */\r\n  constructor(mask) {\r\n    this.#mask = mask;\r\n    this.#segments = mask.getMeta().custom.segments;\r\n  }\r\n\r\n  /**\r\n   * Check if a segment is part of the inner segment list.\r\n   *\r\n   * @param {number} segmentNumber The segment number.\r\n   * @returns {boolean} True if the segment is included.\r\n   */\r\n  hasSegment(segmentNumber) {\r\n    return typeof this.getSegment(segmentNumber) !== 'undefined';\r\n  }\r\n\r\n  /**\r\n   * Check if a segment is present in a mask image.\r\n   *\r\n   * @param {number[]} numbers Array of segment numbers.\r\n   * @returns {boolean[]} Array of boolean set to true\r\n   *   if the segment is present in the mask.\r\n   */\r\n  maskHasSegments(numbers) {\r\n    // create values using displayValue\r\n    const values = [];\r\n    const unknowns = [];\r\n    for (let i = 0; i < numbers.length; ++i) {\r\n      const segment = this.getSegment(numbers[i]);\r\n      if (typeof segment !== 'undefined') {\r\n        values.push(segment.displayValue);\r\n      } else {\r\n        logger.warn('Unknown segment in maskHasSegments: ' + numbers[i]);\r\n        unknowns.push(i);\r\n      }\r\n    }\r\n    const res = this.#mask.hasValues(values);\r\n    // insert unknowns as false in result\r\n    for (let j = 0; j < unknowns.length; ++j) {\r\n      res.splice(unknowns[j], 0, false);\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Get a segment from the inner segment list.\r\n   *\r\n   * @param {number} segmentNumber The segment number.\r\n   * @returns {MaskSegment|undefined} The segment.\r\n   */\r\n  getSegment(segmentNumber) {\r\n    return this.#segments.find(function (item) {\r\n      return item.number === segmentNumber;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the inner segment list.\r\n   *\r\n   * @returns {MaskSegment[]} The list of segments.\r\n   */\r\n  getSegments() {\r\n    return this.#segments;\r\n  }\r\n\r\n  /**\r\n   * Set the inner segment list.\r\n   *\r\n   * @param {MaskSegment[]} list The segment list.\r\n   */\r\n  setSegments(list) {\r\n    this.#segments = list;\r\n  }\r\n\r\n  /**\r\n   * Set the hidden segment list.\r\n   * TODO: not sure if needed...\r\n   *\r\n   * @param {number[]} list The list of hidden segment numbers.\r\n   */\r\n  setHiddenSegments(list) {\r\n    this.#hiddenSegments = list;\r\n  }\r\n\r\n  /**\r\n   * Get the index of a segment in the hidden list.\r\n   *\r\n   * @param {number} segmentNumber The segment number.\r\n   * @returns {number|undefined} The index in the array.\r\n   */\r\n  #getHiddenIndex(segmentNumber) {\r\n    return this.#hiddenSegments.findIndex(function (item) {\r\n      return item === segmentNumber;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Check if a segment is in the hidden list.\r\n   *\r\n   * @param {number} segmentNumber The segment number.\r\n   * @returns {boolean} True if the segment is in the list.\r\n   */\r\n  isHidden(segmentNumber) {\r\n    return this.#getHiddenIndex(segmentNumber) !== -1;\r\n  }\r\n\r\n  /**\r\n   * Add a segment to the hidden list.\r\n   *\r\n   * @param {number} segmentNumber The segment number.\r\n   */\r\n  addToHidden(segmentNumber) {\r\n    if (!this.isHidden(segmentNumber)) {\r\n      this.#hiddenSegments.push(segmentNumber);\r\n    } else {\r\n      logger.warn(\r\n        'Segment is allready in the hidden list: ' + segmentNumber);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a segment from the hidden list.\r\n   *\r\n   * @param {number} segmentNumber The segment number.\r\n   */\r\n  removeFromHidden(segmentNumber) {\r\n    const index = this.#getHiddenIndex(segmentNumber);\r\n    if (index !== -1) {\r\n      this.#hiddenSegments.splice(index, 1);\r\n    } else {\r\n      logger.warn('Segment is not in the hidden list: ' + segmentNumber);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @callback alphaFn\r\n   * @param {object} value The pixel value.\r\n   * @param {object} index The values' index.\r\n   * @returns {number} The value to display.\r\n   */\r\n\r\n  /**\r\n   * Get the alpha function to apply hidden colors.\r\n   *\r\n   * @returns {alphaFn} The corresponding alpha function.\r\n   */\r\n  getAlphaFunc() {\r\n    // get colours\r\n    const hiddenColours = [{r: 0, g: 0, b: 0}];\r\n    for (let i = 0; i < this.#hiddenSegments.length; ++i) {\r\n      const segment = this.getSegment(this.#hiddenSegments[i]);\r\n      if (typeof segment !== 'undefined') {\r\n        hiddenColours.push(segment.displayValue);\r\n      }\r\n    }\r\n\r\n    // create alpha function\r\n    return function (value/*, index*/) {\r\n      for (let i = 0; i < hiddenColours.length; ++i) {\r\n        if (value[0] === hiddenColours[i].r &&\r\n          value[1] === hiddenColours[i].g &&\r\n          value[2] === hiddenColours[i].b) {\r\n          return 0;\r\n        }\r\n      }\r\n      // default\r\n      return 255;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @callback eventFn\r\n   * @param {object} event The event.\r\n   */\r\n\r\n  /**\r\n   * Delete a segment.\r\n   *\r\n   * @param {number} segmentNumber The segment number.\r\n   * @param {eventFn} cmdCallback The command event callback.\r\n   * @param {Function} exeCallback The post execution callback.\r\n   */\r\n  deleteSegment(segmentNumber, cmdCallback, exeCallback) {\r\n    const delcmd = new DeleteSegmentCommand(\r\n      this.#mask, this.getSegment(segmentNumber));\r\n    delcmd.onExecute = cmdCallback;\r\n    delcmd.onUndo = cmdCallback;\r\n    if (delcmd.isValid()) {\r\n      delcmd.execute();\r\n      // callback\r\n      exeCallback(delcmd);\r\n      // possibly hidden\r\n      if (this.isHidden(segmentNumber)) {\r\n        this.removeFromHidden(segmentNumber);\r\n      }\r\n    }\r\n  }\r\n\r\n} // class MaskSegmentHelper\r\n\r\n/**\r\n * Delete segment command.\r\n */\r\nexport class DeleteSegmentCommand {\r\n\r\n  /**\r\n   * The associated mask.\r\n   *\r\n   * @type {Image}\r\n   */\r\n  #mask;\r\n\r\n  /**\r\n   * The segment to remove.\r\n   *\r\n   * @type {MaskSegment}\r\n   */\r\n  #segment;\r\n\r\n  /**\r\n   * Flag to send creation events.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isSilent;\r\n\r\n  /**\r\n   * List of offsets.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #offsets;\r\n\r\n  /**\r\n   * @param {Image} mask The mask image.\r\n   * @param {MaskSegment} segment The segment to remove.\r\n   * @param {boolean} [silent] Whether to send a creation event or not.\r\n   */\r\n  constructor(mask, segment, silent) {\r\n    this.#mask = mask;\r\n    this.#segment = segment;\r\n\r\n    this.#isSilent = (typeof silent === 'undefined') ? false : silent;\r\n    // list of offsets with the colour to delete\r\n    this.#offsets = mask.getOffsets(segment.displayValue);\r\n  }\r\n\r\n  /**\r\n   * Get the command name.\r\n   *\r\n   * @returns {string} The command name.\r\n   */\r\n  getName() {\r\n    return 'Delete-segment';\r\n  }\r\n\r\n  /**\r\n   * Check if a command is valid and can be executed.\r\n   *\r\n   * @returns {boolean} True if the command is valid.\r\n   */\r\n  isValid() {\r\n    return this.#offsets.length !== 0;\r\n  }\r\n\r\n  /**\r\n   * Execute the command.\r\n   *\r\n   * @fires DeleteSegmentCommand#masksegmentdelete\r\n   */\r\n  execute() {\r\n    // remove\r\n    this.#mask.setAtOffsets(this.#offsets, {r: 0, g: 0, b: 0});\r\n\r\n    // callback\r\n    if (!this.#isSilent) {\r\n      /**\r\n       * Segment delete event.\r\n       *\r\n       * @event DeleteSegmentCommand#masksegmentdelete\r\n       * @type {object}\r\n       * @property {number} segmentnumber The segment number.\r\n       */\r\n      this.onExecute({\r\n        type: 'masksegmentdelete',\r\n        segmentnumber: this.#segment.number\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Undo the command.\r\n   *\r\n   * @fires DeleteSegmentCommand#masksegmentredraw\r\n   */\r\n  undo() {\r\n    // re-draw\r\n    this.#mask.setAtOffsets(this.#offsets, this.#segment.displayValue);\r\n\r\n    // callback\r\n    /**\r\n     * Segment redraw event.\r\n     *\r\n     * @event DeleteSegmentCommand#masksegmentredraw\r\n     * @type {object}\r\n     * @property {number} segmentnumber The segment number.\r\n     */\r\n    this.onUndo({\r\n      type: 'masksegmentredraw',\r\n      segmentnumber: this.#segment.number\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle an execute event.\r\n   *\r\n   * @param {object} _event The execute event with type and id.\r\n   */\r\n  onExecute(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n  /**\r\n   * Handle an undo event.\r\n   *\r\n   * @param {object} _event The undo event with type and id.\r\n   */\r\n  onUndo(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n} // DeleteSegmentCommand class\r\n","import {Index} from '../math/index';\r\nimport {Vector3D} from '../math/vector';\r\nimport {Point3D} from '../math/point';\r\nimport {isIdentityMat33} from '../math/matrix';\r\nimport {Size} from '../image/size';\r\nimport {Spacing} from '../image/spacing';\r\nimport {Image} from '../image/image';\r\nimport {Geometry} from '../image/geometry';\r\nimport {PlaneHelper} from '../image/planeHelper';\r\nimport {MaskSegmentHelper} from '../image/maskSegmentHelper';\r\nimport {\r\n  getSliceIterator,\r\n  getIteratorValues,\r\n  getRegionSliceIterator,\r\n  getVariableRegionSliceIterator\r\n} from '../image/iterator';\r\nimport {ListenerHandler} from '../utils/listen';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {View} from '../image/view';\r\nimport {WindowLevel} from '../image/windowLevel';\r\nimport {Point, Point2D} from '../math/point';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * View controller.\r\n */\r\nexport class ViewController {\r\n\r\n  /**\r\n   * Associated View.\r\n   *\r\n   * @type {View}\r\n   */\r\n  #view;\r\n\r\n  /**\r\n   * Associated data id.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #dataId;\r\n\r\n  /**\r\n   * Plane helper.\r\n   *\r\n   * @type {PlaneHelper}\r\n   */\r\n  #planeHelper;\r\n\r\n  /**\r\n   * Mask segment helper.\r\n   *\r\n   * @type {MaskSegmentHelper}\r\n   */\r\n  #maskSegmentHelper;\r\n\r\n  /**\r\n   * Colour map name.\r\n   * Defaults to 'plain' as defined in Views' default.\r\n   *\r\n   * #type {string}\r\n   */\r\n  #colourMapName = 'plain';\r\n\r\n  /**\r\n   * Third dimension player ID (created by setInterval).\r\n   *\r\n   * @type {number|undefined}\r\n   */\r\n  #playerID;\r\n\r\n  /**\r\n   * @param {View} view The associated view.\r\n   * @param {string} dataId The associated data id.\r\n   */\r\n  constructor(view, dataId) {\r\n    // check view\r\n    if (typeof view.getImage() === 'undefined') {\r\n      throw new Error('View does not have an image, cannot setup controller');\r\n    }\r\n\r\n    this.#view = view;\r\n    this.#dataId = dataId;\r\n\r\n    // setup the plane helper\r\n    this.#planeHelper = new PlaneHelper(\r\n      view.getImage().getGeometry().getRealSpacing(),\r\n      view.getImage().getGeometry().getOrientation(),\r\n      view.getOrientation()\r\n    );\r\n\r\n    // mask segment helper\r\n    if (view.getImage().getMeta().Modality === 'SEG') {\r\n      this.#maskSegmentHelper =\r\n        new MaskSegmentHelper(view.getImage());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Get the plane helper.\r\n   *\r\n   * @returns {PlaneHelper} The helper.\r\n   */\r\n  getPlaneHelper() {\r\n    return this.#planeHelper;\r\n  }\r\n\r\n  /**\r\n   * Check is the associated image is a mask.\r\n   *\r\n   * @returns {boolean} True if the associated image is a mask.\r\n   */\r\n  isMask() {\r\n    return typeof this.#maskSegmentHelper !== 'undefined';\r\n  }\r\n\r\n  /**\r\n   * Get the mask segment helper.\r\n   *\r\n   * @returns {MaskSegmentHelper} The helper.\r\n   */\r\n  getMaskSegmentHelper() {\r\n    return this.#maskSegmentHelper;\r\n  }\r\n\r\n  /**\r\n   * Apply the hidden segments list by setting\r\n   * the corresponding alpha function.\r\n   */\r\n  applyHiddenSegments() {\r\n    if (this.isMask) {\r\n      this.setViewAlphaFunction(this.#maskSegmentHelper.getAlphaFunc());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a segment.\r\n   *\r\n   * @param {number} segmentNumber The segment number.\r\n   * @param {Function} exeCallback The post execution callback.\r\n   */\r\n  deleteSegment(segmentNumber, exeCallback) {\r\n    if (this.isMask) {\r\n      this.#maskSegmentHelper.deleteSegment(\r\n        segmentNumber, this.#fireEvent, exeCallback);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialise the controller.\r\n   */\r\n  initialise() {\r\n    // set window/level to first preset\r\n    this.setWindowLevelPresetById(0);\r\n    // default position\r\n    this.setCurrentPosition(this.getPositionFromPlanePoint(0, 0));\r\n  }\r\n\r\n  /**\r\n   * Get the image modality.\r\n   *\r\n   * @returns {string} The modality.\r\n   */\r\n  getModality() {\r\n    return this.#view.getImage().getMeta().Modality;\r\n  }\r\n\r\n  /**\r\n   * Get the window/level presets names.\r\n   *\r\n   * @returns {string[]} The presets names.\r\n   */\r\n  getWindowLevelPresetsNames() {\r\n    return this.#view.getWindowPresetsNames();\r\n  }\r\n\r\n  /**\r\n   * Add window/level presets to the view.\r\n   *\r\n   * @param {object} presets A preset object.\r\n   * @returns {object} The list of presets.\r\n   */\r\n  addWindowLevelPresets(presets) {\r\n    return this.#view.addWindowPresets(presets);\r\n  }\r\n\r\n  /**\r\n   * Set the window level to the preset with the input name.\r\n   *\r\n   * @param {string} name The name of the preset to activate.\r\n   */\r\n  setWindowLevelPreset(name) {\r\n    this.#view.setWindowLevelPreset(name);\r\n  }\r\n\r\n  /**\r\n   * Set the window level to the preset with the input id.\r\n   *\r\n   * @param {number} id The id of the preset to activate.\r\n   */\r\n  setWindowLevelPresetById(id) {\r\n    this.#view.setWindowLevelPresetById(id);\r\n  }\r\n\r\n  /**\r\n   * Check if the controller is playing.\r\n   *\r\n   * @returns {boolean} True if the controler is playing.\r\n   */\r\n  isPlaying() {\r\n    return (typeof this.#playerID !== 'undefined');\r\n  }\r\n\r\n  /**\r\n   * Get the current position.\r\n   *\r\n   * @returns {Point} The position.\r\n   */\r\n  getCurrentPosition() {\r\n    return this.#view.getCurrentPosition();\r\n  }\r\n\r\n  /**\r\n   * Get the current index.\r\n   *\r\n   * @returns {Index} The current index.\r\n   */\r\n  getCurrentIndex() {\r\n    return this.#view.getCurrentIndex();\r\n  }\r\n\r\n  /**\r\n   * Get the current oriented index.\r\n   *\r\n   * @returns {Index} The index.\r\n   */\r\n  getCurrentOrientedIndex() {\r\n    let res = this.#view.getCurrentIndex();\r\n    if (typeof this.#view.getOrientation() !== 'undefined') {\r\n      // view oriented => image de-oriented\r\n      const vector = this.#planeHelper.getImageDeOrientedVector3D(\r\n        new Vector3D(res.get(0), res.get(1), res.get(2))\r\n      );\r\n      res = new Index([\r\n        vector.getX(), vector.getY(), vector.getZ()\r\n      ]);\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Get the scroll index.\r\n   *\r\n   * @returns {number} The index.\r\n   */\r\n  getScrollIndex() {\r\n    return this.#view.getScrollIndex();\r\n  }\r\n\r\n  /**\r\n   * Get the current scroll index value.\r\n   *\r\n   * @returns {object} The value.\r\n   */\r\n  getCurrentScrollIndexValue() {\r\n    return this.#view.getCurrentIndex().get(this.#view.getScrollIndex());\r\n  }\r\n\r\n  /**\r\n   * Get the first origin or at a given position.\r\n   *\r\n   * @param {Point} [position] Opitonal position.\r\n   * @returns {Point3D} The origin.\r\n   */\r\n  getOrigin(position) {\r\n    return this.#view.getOrigin(position);\r\n  }\r\n\r\n  /**\r\n   * Get the current scroll position value.\r\n   *\r\n   * @returns {object} The value.\r\n   */\r\n  getCurrentScrollPosition() {\r\n    const scrollIndex = this.#view.getScrollIndex();\r\n    return this.#view.getCurrentPosition().get(scrollIndex);\r\n  }\r\n\r\n  /**\r\n   * Generate display image data to be given to a canvas.\r\n   *\r\n   * @param {ImageData} array The array to fill in.\r\n   * @param {Index} [index] Optional index at which to generate,\r\n   *   otherwise generates at current index.\r\n   */\r\n  generateImageData(array, index) {\r\n    this.#view.generateImageData(array, index);\r\n  }\r\n\r\n  /**\r\n   * Set the associated image.\r\n   *\r\n   * @param {Image} img The associated image.\r\n   * @param {string} dataId The data id of the image.\r\n   */\r\n  setImage(img, dataId) {\r\n    this.#view.setImage(img);\r\n    this.#dataId = dataId;\r\n  }\r\n\r\n  /**\r\n   * Get the current view (2D) spacing.\r\n   *\r\n   * @returns {Array} The spacing as a 2D array.\r\n   */\r\n  get2DSpacing() {\r\n    const spacing = this.#view.getImage().getGeometry().getSpacing(\r\n      this.#view.getOrientation());\r\n    return [spacing.get(0), spacing.get(1)];\r\n  }\r\n\r\n  /**\r\n   * Get the image rescaled value at the input position.\r\n   *\r\n   * @param {Point} position the input position.\r\n   * @returns {number|undefined} The image value or undefined if out of bounds\r\n   *   or no quantifiable (for ex RGB).\r\n   */\r\n  getRescaledImageValue(position) {\r\n    const image = this.#view.getImage();\r\n    if (!image.canQuantify()) {\r\n      return;\r\n    }\r\n    const geometry = image.getGeometry();\r\n    const index = geometry.worldToIndex(position);\r\n    let value;\r\n    if (geometry.isIndexInBounds(index)) {\r\n      value = image.getRescaledValueAtIndex(index);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Get the image pixel unit.\r\n   *\r\n   * @returns {string} The unit\r\n   */\r\n  getPixelUnit() {\r\n    return this.#view.getImage().getMeta().pixelUnit;\r\n  }\r\n\r\n  /**\r\n   * Get some values from the associated image in a region.\r\n   *\r\n   * @param {Point2D} min Minimum point.\r\n   * @param {Point2D} max Maximum point.\r\n   * @returns {Array} A list of values.\r\n   */\r\n  getImageRegionValues(min, max) {\r\n    let image = this.#view.getImage();\r\n    const orientation = this.#view.getOrientation();\r\n    let position = this.getCurrentIndex();\r\n    let rescaled = true;\r\n\r\n    // created oriented slice if needed\r\n    if (!isIdentityMat33(orientation)) {\r\n      // generate slice values\r\n      const sliceIter = getSliceIterator(\r\n        image,\r\n        position,\r\n        rescaled,\r\n        orientation\r\n      );\r\n      const sliceValues = getIteratorValues(sliceIter);\r\n      // oriented geometry\r\n      const orientedSize = image.getGeometry().getSize(orientation);\r\n      const sizeValues = orientedSize.getValues();\r\n      sizeValues[2] = 1;\r\n      const sliceSize = new Size(sizeValues);\r\n      const orientedSpacing = image.getGeometry().getSpacing(orientation);\r\n      const spacingValues = orientedSpacing.getValues();\r\n      spacingValues[2] = 1;\r\n      const sliceSpacing = new Spacing(spacingValues);\r\n      const sliceOrigin = new Point3D(0, 0, 0);\r\n      const sliceGeometry =\r\n        new Geometry(sliceOrigin, sliceSize, sliceSpacing);\r\n      // slice image\r\n      // @ts-ignore\r\n      image = new Image(sliceGeometry, sliceValues);\r\n      // update position\r\n      position = new Index([0, 0, 0]);\r\n      rescaled = false;\r\n    }\r\n\r\n    // get region values\r\n    const iter = getRegionSliceIterator(\r\n      image, position, rescaled, min, max);\r\n    let values = [];\r\n    if (iter) {\r\n      values = getIteratorValues(iter);\r\n    }\r\n    return values;\r\n  }\r\n\r\n  /**\r\n   * Get some values from the associated image in variable regions.\r\n   *\r\n   * @param {Array} regions A list of regions.\r\n   * @returns {Array} A list of values.\r\n   */\r\n  getImageVariableRegionValues(regions) {\r\n    const iter = getVariableRegionSliceIterator(\r\n      this.#view.getImage(),\r\n      this.getCurrentIndex(),\r\n      true, regions\r\n    );\r\n    let values = [];\r\n    if (iter) {\r\n      values = getIteratorValues(iter);\r\n    }\r\n    return values;\r\n  }\r\n\r\n  /**\r\n   * Can the image values be quantified?\r\n   *\r\n   * @returns {boolean} True if possible.\r\n   */\r\n  canQuantifyImage() {\r\n    return this.#view.getImage().canQuantify();\r\n  }\r\n\r\n  /**\r\n   * Can window and level be applied to the data?\r\n   *\r\n   * @returns {boolean} True if possible.\r\n   */\r\n  canWindowLevel() {\r\n    return this.#view.getImage().canWindowLevel();\r\n  }\r\n\r\n  /**\r\n   * Can the data be scrolled?\r\n   *\r\n   * @returns {boolean} True if the data has either the third dimension\r\n   * or above greater than one.\r\n   */\r\n  canScroll() {\r\n    return this.#view.getImage().canScroll(this.#view.getOrientation());\r\n  }\r\n\r\n  /**\r\n   * Get the image size.\r\n   *\r\n   * @returns {Size} The size.\r\n   */\r\n  getImageSize() {\r\n    return this.#view.getImage().getGeometry().getSize(\r\n      this.#view.getOrientation());\r\n  }\r\n\r\n  /**\r\n   * Get the image world (mm) 2D size.\r\n   *\r\n   * @returns {object} The 2D size as {x,y}.\r\n   */\r\n  getImageWorldSize() {\r\n    const geometry = this.#view.getImage().getGeometry();\r\n    const size = geometry.getSize(this.#view.getOrientation()).get2D();\r\n    const spacing = geometry.getSpacing(this.#view.getOrientation()).get2D();\r\n    return {\r\n      x: size.x * spacing.x,\r\n      y: size.y * spacing.y\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the image rescaled data range.\r\n   *\r\n   * @returns {object} The range as {min, max}.\r\n   */\r\n  getImageRescaledDataRange() {\r\n    return this.#view.getImage().getRescaledDataRange();\r\n  }\r\n\r\n  /**\r\n   * Compare the input meta data to the associated image one.\r\n   *\r\n   * @param {object} meta The meta data.\r\n   * @returns {boolean} True if the associated image has equal meta data.\r\n   */\r\n  equalImageMeta(meta) {\r\n    const imageMeta = this.#view.getImage().getMeta();\r\n    // loop through input meta keys\r\n    const metaKeys = Object.keys(meta);\r\n    for (let i = 0; i < metaKeys.length; ++i) {\r\n      const metaKey = metaKeys[i];\r\n      if (typeof imageMeta[metaKey] === 'undefined') {\r\n        return false;\r\n      }\r\n      if (imageMeta[metaKey] !== meta[metaKey]) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Check is the provided position can be set.\r\n   *\r\n   * @param {Point} position The position.\r\n   * @returns {boolean} True is the position is in bounds.\r\n   */\r\n  canSetPosition(position) {\r\n    return this.#view.canSetPosition(position);\r\n  }\r\n\r\n  /**\r\n   * Set the current position.\r\n   *\r\n   * @param {Point} pos The position.\r\n   * @param {boolean} [silent] If true, does not fire a\r\n   *   positionchange event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  setCurrentPosition(pos, silent) {\r\n    return this.#view.setCurrentPosition(pos, silent);\r\n  }\r\n\r\n  /**\r\n   * Get a position from a 2D (x,y) position.\r\n   *\r\n   * @param {number} x The column position.\r\n   * @param {number} y The row position.\r\n   * @returns {Point} The associated position.\r\n   */\r\n  getPositionFromPlanePoint(x, y) {\r\n    // keep third direction\r\n    const k = this.getCurrentScrollIndexValue();\r\n    const planePoint = new Point3D(x, y, k);\r\n    // de-orient\r\n    const point = this.#planeHelper.getImageOrientedPoint3D(planePoint);\r\n    // ~indexToWorld to not loose precision\r\n    const geometry = this.#view.getImage().getGeometry();\r\n    const point3D = geometry.pointToWorld(point);\r\n    // merge with current position to keep extra dimensions\r\n    return this.getCurrentPosition().mergeWith3D(point3D);\r\n  }\r\n\r\n  /**\r\n   * Get a 2D (x,y) position from a position.\r\n   *\r\n   * @param {Point} point The 3D position.\r\n   * @returns {object} The 2D position.\r\n   */\r\n  getPlanePositionFromPosition(point) {\r\n    // orient\r\n    const geometry = this.#view.getImage().getGeometry();\r\n    // ~worldToIndex to not loose precision\r\n    const point3D = geometry.worldToPoint(point);\r\n    const planePoint = this.#planeHelper.getImageDeOrientedPoint3D(point3D);\r\n    // return\r\n    return {\r\n      x: planePoint.getX(),\r\n      y: planePoint.getY(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Set the current index.\r\n   *\r\n   * @param {Index} index The index.\r\n   * @param {boolean} [silent] If true, does not fire a positionchange event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  setCurrentIndex(index, silent) {\r\n    return this.#view.setCurrentIndex(index, silent);\r\n  }\r\n\r\n  /**\r\n   * Get a plane 3D position from a plane 2D position: does not compensate\r\n   *   for the image origin. Needed for setting the scale center...\r\n   *\r\n   * @param {object} point2D The 2D position as {x,y}.\r\n   * @returns {Point3D} The 3D point.\r\n   */\r\n  getPlanePositionFromPlanePoint(point2D) {\r\n    // keep third direction\r\n    const k = this.getCurrentScrollIndexValue();\r\n    const planePoint = new Point3D(point2D.x, point2D.y, k);\r\n    // de-orient\r\n    const point = this.#planeHelper.getTargetDeOrientedPoint3D(planePoint);\r\n    // ~indexToWorld to not loose precision\r\n    const geometry = this.#view.getImage().getGeometry();\r\n    const spacing = geometry.getRealSpacing();\r\n    return new Point3D(\r\n      point.getX() * spacing.get(0),\r\n      point.getY() * spacing.get(1),\r\n      point.getZ() * spacing.get(2));\r\n  }\r\n\r\n  /**\r\n   * Get a 3D offset from a plane one.\r\n   *\r\n   * @param {object} offset2D The plane offset as {x,y}.\r\n   * @returns {Vector3D} The 3D world offset.\r\n   */\r\n  getOffset3DFromPlaneOffset(offset2D) {\r\n    return this.#planeHelper.getOffset3DFromPlaneOffset(offset2D);\r\n  }\r\n\r\n  /**\r\n   * Increment the provided dimension.\r\n   *\r\n   * @param {number} dim The dimension to increment.\r\n   * @param {boolean} [silent] Do not send event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  incrementIndex(dim, silent) {\r\n    return this.#view.incrementIndex(dim, silent);\r\n  }\r\n\r\n  /**\r\n   * Decrement the provided dimension.\r\n   *\r\n   * @param {number} dim The dimension to increment.\r\n   * @param {boolean} [silent] Do not send event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  decrementIndex(dim, silent) {\r\n    return this.#view.decrementIndex(dim, silent);\r\n  }\r\n\r\n  /**\r\n   * Decrement the scroll dimension index.\r\n   *\r\n   * @param {boolean} [silent] Do not send event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  decrementScrollIndex(silent) {\r\n    return this.#view.decrementScrollIndex(silent);\r\n  }\r\n\r\n  /**\r\n   * Increment the scroll dimension index.\r\n   *\r\n   * @param {boolean} [silent] Do not send event.\r\n   * @returns {boolean} False if not in bounds.\r\n   */\r\n  incrementScrollIndex(silent) {\r\n    return this.#view.incrementScrollIndex(silent);\r\n  }\r\n\r\n  /**\r\n   * Scroll play: loop through all slices.\r\n   */\r\n  play() {\r\n    // ensure data is scrollable: dim >= 3\r\n    if (!this.canScroll()) {\r\n      return;\r\n    }\r\n    if (this.#playerID === null) {\r\n      const image = this.#view.getImage();\r\n      const recommendedDisplayFrameRate =\r\n        image.getMeta().RecommendedDisplayFrameRate;\r\n      const milliseconds = this.#view.getPlaybackMilliseconds(\r\n        recommendedDisplayFrameRate);\r\n      const size = image.getGeometry().getSize();\r\n      const canScroll3D = size.canScroll3D();\r\n\r\n      this.#playerID = window.setInterval(() => {\r\n        let canDoMore = false;\r\n        if (canScroll3D) {\r\n          canDoMore = this.incrementScrollIndex();\r\n        } else {\r\n          canDoMore = this.incrementIndex(3);\r\n        }\r\n        // end of scroll, loop back\r\n        if (!canDoMore) {\r\n          const pos1 = this.getCurrentIndex();\r\n          const values = pos1.getValues();\r\n          const orientation = this.#view.getOrientation();\r\n          if (canScroll3D) {\r\n            values[orientation.getThirdColMajorDirection()] = 0;\r\n          } else {\r\n            values[3] = 0;\r\n          }\r\n          const index = new Index(values);\r\n          const geometry = this.#view.getImage().getGeometry();\r\n          this.setCurrentPosition(geometry.indexToWorld(index));\r\n        }\r\n      }, milliseconds);\r\n    } else {\r\n      this.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop scroll playing.\r\n   */\r\n  stop() {\r\n    if (typeof this.#playerID !== 'undefined') {\r\n      clearInterval(this.#playerID);\r\n      this.#playerID = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the window/level.\r\n   *\r\n   * @returns {WindowLevel} The window and level.\r\n   */\r\n  getWindowLevel() {\r\n    return this.#view.getWindowLevel();\r\n  }\r\n\r\n  /**\r\n   * Get the current window level preset name.\r\n   *\r\n   * @returns {string} The preset name.\r\n   */\r\n  getCurrentWindowPresetName() {\r\n    return this.#view.getCurrentWindowPresetName();\r\n  }\r\n\r\n  /**\r\n   * Set the window and level.\r\n   *\r\n   * @param {WindowLevel} wl The window and level.\r\n   */\r\n  setWindowLevel(wl) {\r\n    this.#view.setWindowLevel(wl);\r\n  }\r\n\r\n  /**\r\n   * Get the colour map.\r\n   *\r\n   * @returns {string} The colour map name.\r\n   */\r\n  getColourMap() {\r\n    return this.#view.getColourMap();\r\n  }\r\n\r\n  /**\r\n   * Set the colour map.\r\n   *\r\n   * @param {string} name The colour map name.\r\n   */\r\n  setColourMap(name) {\r\n    this.#view.setColourMap(name);\r\n  }\r\n\r\n  /**\r\n   * @callback alphaFn\r\n   * @param {object} value The pixel value.\r\n   * @param {object} index The values' index.\r\n   * @returns {number} The value to display.\r\n   */\r\n\r\n  /**\r\n   * Set the view per value alpha function.\r\n   *\r\n   * @param {alphaFn} func The function.\r\n   */\r\n  setViewAlphaFunction(func) {\r\n    this.#view.setAlphaFunction(func);\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    event.dataid = this.#dataId;\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n} // class ViewController\r\n","import {logger} from '../utils/logger';\r\n\r\n/**\r\n * List of interaction event names.\r\n */\r\nexport const InteractionEventNames = [\r\n  'mousedown',\r\n  'mousemove',\r\n  'mouseup',\r\n  'mouseout',\r\n  'wheel',\r\n  'dblclick',\r\n  'touchstart',\r\n  'touchmove',\r\n  'touchend'\r\n];\r\n\r\n/**\r\n * Get a HTML element associated to a container div.\r\n *\r\n * @param {string} containerDivId The id of the container div.\r\n * @param {string} name The name or id to find.\r\n * @returns {object} The found element or null.\r\n * @deprecated\r\n */\r\nexport function getElement(containerDivId, name) {\r\n  // get by class in the container div\r\n  const parent = document.getElementById(containerDivId);\r\n  if (!parent) {\r\n    return null;\r\n  }\r\n  const elements = parent.getElementsByClassName(name);\r\n  // getting the last element since some libraries (ie jquery-mobile) create\r\n  // span in front of regular tags (such as select)...\r\n  let element = elements[elements.length - 1];\r\n  // if not found get by id with 'containerDivId-className'\r\n  if (typeof element === 'undefined') {\r\n    element = document.getElementById(containerDivId + '-' + name);\r\n  }\r\n  return element;\r\n}\r\n\r\n/**\r\n * Overridalbe custom UI object for client defined UI.\r\n */\r\nexport const customUI = {\r\n  /**\r\n   * Open a dialogue to edit roi data. Defaults to window.prompt.\r\n   *\r\n   * @param {object} data The roi data.\r\n   * @param {Function} callback The callback to launch on dialogue exit.\r\n   */\r\n  openRoiDialog(data, callback) {\r\n    const textExpr = prompt('Label', data.textExpr);\r\n    if (textExpr !== null) {\r\n      data.textExpr = textExpr;\r\n      callback(data);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Get the positions (without the parent offset) of a list of touch events.\r\n *\r\n * @param {Array} touches The list of touch events.\r\n * @returns {Array} The list of positions of the touch events.\r\n */\r\nfunction getTouchesPositions(touches) {\r\n  // get the touch offset from all its parents\r\n  let offsetLeft = 0;\r\n  let offsetTop = 0;\r\n  if (touches.length !== 0 &&\r\n    typeof touches[0].target !== 'undefined') {\r\n    let offsetParent = touches[0].target.offsetParent;\r\n    while (offsetParent) {\r\n      if (!isNaN(offsetParent.offsetLeft)) {\r\n        offsetLeft += offsetParent.offsetLeft;\r\n      }\r\n      if (!isNaN(offsetParent.offsetTop)) {\r\n        offsetTop += offsetParent.offsetTop;\r\n      }\r\n      offsetParent = offsetParent.offsetParent;\r\n    }\r\n  } else {\r\n    logger.debug('No touch target offset parent.');\r\n  }\r\n  // set its position\r\n  const positions = [];\r\n  for (let i = 0; i < touches.length; ++i) {\r\n    positions.push({\r\n      x: touches[i].pageX - offsetLeft,\r\n      y: touches[i].pageY - offsetTop\r\n    });\r\n  }\r\n  return positions;\r\n}\r\n\r\n/**\r\n * Get the offset of an input event.\r\n *\r\n * @param {object} event The event to get the offset from.\r\n * @returns {Array} The array of offsets.\r\n */\r\nexport function getEventOffset(event) {\r\n  let positions = [];\r\n  if (typeof event.targetTouches !== 'undefined' &&\r\n    event.targetTouches.length !== 0) {\r\n    // see https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent/targetTouches\r\n    positions = getTouchesPositions(event.targetTouches);\r\n  } else if (typeof event.changedTouches !== 'undefined' &&\r\n    event.changedTouches.length !== 0) {\r\n    // see https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent/changedTouches\r\n    positions = getTouchesPositions(event.changedTouches);\r\n  } else {\r\n    // offsetX/Y: the offset in the X coordinate of the mouse pointer\r\n    // between that event and the padding edge of the target node\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/offsetX\r\n    // https://caniuse.com/mdn-api_mouseevent_offsetx\r\n    positions.push({\r\n      x: event.offsetX,\r\n      y: event.offsetY\r\n    });\r\n  }\r\n  return positions;\r\n}\r\n\r\n/**\r\n * Test if a canvas with the input size can be created.\r\n *\r\n * @see https://github.com/ivmartel/dwv/issues/902\r\n * @see https://github.com/jhildenbiddle/canvas-size/blob/v1.2.4/src/canvas-test.js\r\n * @param {number} width The canvas width.\r\n * @param {number} height The canvas height.\r\n * @returns {boolean} True is the canvas can be created.\r\n */\r\nexport function canCreateCanvas(width, height) {\r\n  // test canvas with input size\r\n  const testCvs = document.createElement('canvas');\r\n  testCvs.width = width;\r\n  testCvs.height = height;\r\n  // crop canvas to speed up test\r\n  const cropCvs = document.createElement('canvas');\r\n  cropCvs.width = 1;\r\n  cropCvs.height = 1;\r\n  // contexts\r\n  const testCtx = testCvs.getContext('2d');\r\n  const cropCtx = cropCvs.getContext('2d');\r\n  // set data\r\n  if (testCtx) {\r\n    testCtx.fillRect(width - 1, height - 1, 1, 1);\r\n    // Render the test pixel in the bottom-right corner of the\r\n    // test canvas in the top-left of the 1x1 crop canvas. This\r\n    // dramatically reducing the time for getImageData to complete.\r\n    cropCtx.drawImage(testCvs, width - 1, height - 1, 1, 1, 0, 0, 1, 1);\r\n  }\r\n  // Verify image data (alpha component, Pass = 255, Fail = 0)\r\n  return cropCtx && cropCtx.getImageData(0, 0, 1, 1).data[3] !== 0;\r\n}\r\n","import {Index} from '../math/index';\r\nimport {ListenerHandler} from '../utils/listen';\r\nimport {viewEventNames} from '../image/view';\r\nimport {ViewController} from '../app/viewController';\r\nimport {\r\n  canCreateCanvas,\r\n  InteractionEventNames\r\n} from './generic';\r\nimport {getScaledOffset} from './layerGroup';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Vector3D} from '../math/vector';\r\nimport {Point, Point3D} from '../math/point';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * View layer.\r\n */\r\nexport class ViewLayer {\r\n\r\n  /**\r\n   * Container div.\r\n   *\r\n   * @type {HTMLElement}\r\n   */\r\n  #containerDiv;\r\n\r\n  /**\r\n   * The view controller.\r\n   *\r\n   * @type {ViewController}\r\n   */\r\n  #viewController = null;\r\n\r\n  /**\r\n   * The main display canvas.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #canvas = null;\r\n\r\n  /**\r\n   * The offscreen canvas: used to store the raw, unscaled pixel data.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #offscreenCanvas = null;\r\n\r\n  /**\r\n   * The associated CanvasRenderingContext2D.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #context = null;\r\n\r\n  /**\r\n   * Flag to know if the current position is valid.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isValidPosition = true;\r\n\r\n  /**\r\n   * The image data array.\r\n   *\r\n   * @type {ImageData}\r\n   */\r\n  #imageData = null;\r\n\r\n  /**\r\n   * The layer base size as {x,y}.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #baseSize;\r\n\r\n  /**\r\n   * The layer base spacing as {x,y}.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #baseSpacing;\r\n\r\n  /**\r\n   * The layer opacity.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #opacity = 1;\r\n\r\n  /**\r\n   * The layer scale.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #scale = {x: 1, y: 1};\r\n\r\n  /**\r\n   * The layer fit scale.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #fitScale = {x: 1, y: 1};\r\n\r\n  /**\r\n   * The layer flip scale.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #flipScale = {x: 1, y: 1, z: 1};\r\n\r\n  /**\r\n   * The layer offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #offset = {x: 0, y: 0};\r\n\r\n  /**\r\n   * The base layer offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #baseOffset = {x: 0, y: 0};\r\n\r\n  /**\r\n   * The view offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #viewOffset = {x: 0, y: 0};\r\n\r\n  /**\r\n   * The zoom offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #zoomOffset = {x: 0, y: 0};\r\n\r\n  /**\r\n   * The flip offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #flipOffset = {x: 0, y: 0};\r\n\r\n  /**\r\n   * Data update flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #needsDataUpdate = null;\r\n\r\n  /**\r\n   * The associated data id.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #dataId;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Image smoothing flag.\r\n   * see: https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/imageSmoothingEnabled\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #imageSmoothing = false;\r\n\r\n  /**\r\n   * @param {HTMLElement} containerDiv The layer div, its id will be used\r\n   *   as this layer id.\r\n   */\r\n  constructor(containerDiv) {\r\n    this.#containerDiv = containerDiv;\r\n    // specific css class name\r\n    this.#containerDiv.className += ' viewLayer';\r\n  }\r\n\r\n  /**\r\n   * Get the associated data id.\r\n   *\r\n   * @returns {string} The data id.\r\n   */\r\n  getDataId() {\r\n    return this.#dataId;\r\n  }\r\n\r\n  /**\r\n   * Set the imageSmoothing flag value.\r\n   *\r\n   * @param {boolean} flag True to enable smoothing.\r\n   */\r\n  setImageSmoothing(flag) {\r\n    this.#imageSmoothing = flag;\r\n  }\r\n\r\n  /**\r\n   * Set the associated view.\r\n   *\r\n   * @param {object} view The view.\r\n   * @param {string} dataId The associated data id.\r\n   */\r\n  setView(view, dataId) {\r\n    this.#dataId = dataId;\r\n    // local listeners\r\n    view.addEventListener('wlchange', this.#onWLChange);\r\n    view.addEventListener('colourmapchange', this.#onColourMapChange);\r\n    view.addEventListener('positionchange', this.#onPositionChange);\r\n    view.addEventListener('alphafuncchange', this.#onAlphaFuncChange);\r\n    // view events\r\n    for (let j = 0; j < viewEventNames.length; ++j) {\r\n      view.addEventListener(viewEventNames[j], this.#fireEvent);\r\n    }\r\n    // create view controller\r\n    this.#viewController = new ViewController(view, dataId);\r\n  }\r\n\r\n  /**\r\n   * Get the view controller.\r\n   *\r\n   * @returns {ViewController} The controller.\r\n   */\r\n  getViewController() {\r\n    return this.#viewController;\r\n  }\r\n\r\n  /**\r\n   * Get the canvas image data.\r\n   *\r\n   * @returns {object} The image data.\r\n   */\r\n  getImageData() {\r\n    return this.#imageData;\r\n  }\r\n\r\n  /**\r\n   * Handle an image set event.\r\n   *\r\n   * @param {object} event The event.\r\n   * @function\r\n   */\r\n  onimageset = (event) => {\r\n    // event.value = [index, image]\r\n    if (this.#dataId === event.dataid) {\r\n      this.#viewController.setImage(event.value[0], this.#dataId);\r\n      this.#setBaseSize(this.#viewController.getImageSize().get2D());\r\n      this.#needsDataUpdate = true;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle an image change event.\r\n   *\r\n   * @param {object} event The event.\r\n   * @function\r\n   */\r\n  onimagechange = (event) => {\r\n    // event.value = [index]\r\n    if (this.#dataId === event.dataid) {\r\n      this.#needsDataUpdate = true;\r\n    }\r\n  };\r\n\r\n  // common layer methods [start] ---------------\r\n\r\n  /**\r\n   * Get the id of the layer.\r\n   *\r\n   * @returns {string} The string id.\r\n   */\r\n  getId() {\r\n    return this.#containerDiv.id;\r\n  }\r\n\r\n  /**\r\n   * Get the layer base size (without scale).\r\n   *\r\n   * @returns {object} The size as {x,y}.\r\n   */\r\n  getBaseSize() {\r\n    return this.#baseSize;\r\n  }\r\n\r\n  /**\r\n   * Get the image world (mm) 2D size.\r\n   *\r\n   * @returns {object} The 2D size as {x,y}.\r\n   */\r\n  getImageWorldSize() {\r\n    return this.#viewController.getImageWorldSize();\r\n  }\r\n\r\n  /**\r\n   * Get the layer opacity.\r\n   *\r\n   * @returns {number} The opacity ([0:1] range).\r\n   */\r\n  getOpacity() {\r\n    return this.#opacity;\r\n  }\r\n\r\n  /**\r\n   * Set the layer opacity.\r\n   *\r\n   * @param {number} alpha The opacity ([0:1] range).\r\n   */\r\n  setOpacity(alpha) {\r\n    if (alpha === this.#opacity) {\r\n      return;\r\n    }\r\n\r\n    this.#opacity = Math.min(Math.max(alpha, 0), 1);\r\n\r\n    /**\r\n     * Opacity change event.\r\n     *\r\n     * @event App#opacitychange\r\n     * @type {object}\r\n     * @property {string} type The event type.\r\n     */\r\n    const event = {\r\n      type: 'opacitychange',\r\n      value: [this.#opacity]\r\n    };\r\n    this.#fireEvent(event);\r\n  }\r\n\r\n  /**\r\n   * Add a flip offset along the layer X axis.\r\n   */\r\n  addFlipOffsetX() {\r\n    this.#flipOffset.x += this.#canvas.width / this.#scale.x;\r\n    this.#offset.x += this.#flipOffset.x;\r\n  }\r\n\r\n  /**\r\n   * Add a flip offset along the layer Y axis.\r\n   */\r\n  addFlipOffsetY() {\r\n    this.#flipOffset.y += this.#canvas.height / this.#scale.y;\r\n    this.#offset.y += this.#flipOffset.y;\r\n  }\r\n\r\n  /**\r\n   * Flip the scale along the layer X axis.\r\n   */\r\n  flipScaleX() {\r\n    this.#flipScale.x *= -1;\r\n  }\r\n\r\n  /**\r\n   * Flip the scale along the layer Y axis.\r\n   */\r\n  flipScaleY() {\r\n    this.#flipScale.y *= -1;\r\n  }\r\n\r\n  /**\r\n   * Flip the scale along the layer Z axis.\r\n   */\r\n  flipScaleZ() {\r\n    this.#flipScale.z *= -1;\r\n  }\r\n\r\n  /**\r\n   * Set the layer scale.\r\n   *\r\n   * @param {object} newScale The scale as {x,y}.\r\n   * @param {Point3D} [center] The scale center.\r\n   */\r\n  setScale(newScale, center) {\r\n    const helper = this.#viewController.getPlaneHelper();\r\n    const orientedNewScale = helper.getTargetOrientedPositiveXYZ({\r\n      x: newScale.x * this.#flipScale.x,\r\n      y: newScale.y * this.#flipScale.y,\r\n      z: newScale.z * this.#flipScale.z,\r\n    });\r\n    const finalNewScale = {\r\n      x: this.#fitScale.x * orientedNewScale.x,\r\n      y: this.#fitScale.y * orientedNewScale.y\r\n    };\r\n\r\n    if (Math.abs(newScale.x) === 1 &&\r\n      Math.abs(newScale.y) === 1 &&\r\n      Math.abs(newScale.z) === 1) {\r\n      // reset zoom offset for scale=1\r\n      const resetOffset = {\r\n        x: this.#offset.x - this.#zoomOffset.x,\r\n        y: this.#offset.y - this.#zoomOffset.y\r\n      };\r\n      // store new offset\r\n      this.#zoomOffset = {x: 0, y: 0};\r\n      this.#offset = resetOffset;\r\n    } else {\r\n      if (typeof center !== 'undefined') {\r\n        let worldCenter = helper.getPlaneOffsetFromOffset3D({\r\n          x: center.getX(),\r\n          y: center.getY(),\r\n          z: center.getZ()\r\n        });\r\n        // center was obtained with viewLayer.displayToMainPlanePos\r\n        // compensated for baseOffset\r\n        // TODO: justify...\r\n        worldCenter = {\r\n          x: worldCenter.x + this.#baseOffset.x,\r\n          y: worldCenter.y + this.#baseOffset.y\r\n        };\r\n\r\n        const newOffset = getScaledOffset(\r\n          this.#offset, this.#scale, finalNewScale, worldCenter);\r\n\r\n        const newZoomOffset = {\r\n          x: this.#zoomOffset.x + newOffset.x - this.#offset.x,\r\n          y: this.#zoomOffset.y + newOffset.y - this.#offset.y\r\n        };\r\n        // store new offset\r\n        this.#zoomOffset = newZoomOffset;\r\n        this.#offset = newOffset;\r\n      }\r\n    }\r\n\r\n    // store new scale\r\n    this.#scale = finalNewScale;\r\n  }\r\n\r\n  /**\r\n   * Set the base layer offset. Updates the layer offset.\r\n   *\r\n   * @param {Vector3D} scrollOffset The scroll offset vector.\r\n   * @param {Vector3D} planeOffset The plane offset vector.\r\n   * @returns {boolean} True if the offset was updated.\r\n   */\r\n  setBaseOffset(scrollOffset, planeOffset) {\r\n    const helper = this.#viewController.getPlaneHelper();\r\n    const scrollIndex = helper.getNativeScrollIndex();\r\n    const newOffset = helper.getPlaneOffsetFromOffset3D({\r\n      x: scrollIndex === 0 ? scrollOffset.getX() : planeOffset.getX(),\r\n      y: scrollIndex === 1 ? scrollOffset.getY() : planeOffset.getY(),\r\n      z: scrollIndex === 2 ? scrollOffset.getZ() : planeOffset.getZ(),\r\n    });\r\n    const needsUpdate = this.#baseOffset.x !== newOffset.x ||\r\n    this.#baseOffset.y !== newOffset.y;\r\n    // reset offset if needed\r\n    if (needsUpdate) {\r\n      this.#offset = {\r\n        x: this.#offset.x - this.#baseOffset.x + newOffset.x,\r\n        y: this.#offset.y - this.#baseOffset.y + newOffset.y\r\n      };\r\n      this.#baseOffset = newOffset;\r\n    }\r\n    return needsUpdate;\r\n  }\r\n\r\n  /**\r\n   * Set the layer offset.\r\n   *\r\n   * @param {object} newOffset The offset as {x,y}.\r\n   */\r\n  setOffset(newOffset) {\r\n    const helper = this.#viewController.getPlaneHelper();\r\n    const planeNewOffset = helper.getPlaneOffsetFromOffset3D(newOffset);\r\n    this.#offset = {\r\n      x: planeNewOffset.x +\r\n        this.#viewOffset.x +\r\n        this.#baseOffset.x +\r\n        this.#zoomOffset.x +\r\n        this.#flipOffset.x,\r\n      y: planeNewOffset.y +\r\n        this.#viewOffset.y +\r\n        this.#baseOffset.y +\r\n        this.#zoomOffset.y +\r\n        this.#flipOffset.y\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Transform a display position to an index.\r\n   *\r\n   * @param {number} x The X position.\r\n   * @param {number} y The Y position.\r\n   * @returns {Index} The equivalent index.\r\n   */\r\n  displayToPlaneIndex(x, y) {\r\n    const planePos = this.displayToPlanePos(x, y);\r\n    return new Index([\r\n      Math.floor(planePos.x),\r\n      Math.floor(planePos.y)\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Remove scale from a display position.\r\n   *\r\n   * @param {number} x The X position.\r\n   * @param {number} y The Y position.\r\n   * @returns {object} The de-scaled position as {x,y}.\r\n   */\r\n  displayToPlaneScale(x, y) {\r\n    return {\r\n      x: x / this.#scale.x,\r\n      y: y / this.#scale.y\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get a plane position from a display position.\r\n   *\r\n   * @param {number} x The X position.\r\n   * @param {number} y The Y position.\r\n   * @returns {object} The plane position as {x,y}.\r\n   */\r\n  displayToPlanePos(x, y) {\r\n    const deScaled = this.displayToPlaneScale(x, y);\r\n    return {\r\n      x: deScaled.x + this.#offset.x,\r\n      y: deScaled.y + this.#offset.y\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get a display position from a plane position.\r\n   *\r\n   * @param {number} x The X position.\r\n   * @param {number} y The Y position.\r\n   * @returns {object} The display position as {x,y}, can be individually\r\n   *   undefined if out of bounds.\r\n   */\r\n  planePosToDisplay(x, y) {\r\n    let posX = (x - this.#offset.x + this.#baseOffset.x) * this.#scale.x;\r\n    let posY = (y - this.#offset.y + this.#baseOffset.y) * this.#scale.y;\r\n    // check if in bounds\r\n    if (posX < 0 || posX >= this.#canvas.width) {\r\n      posX = undefined;\r\n    }\r\n    if (posY < 0 || posY >= this.#canvas.height) {\r\n      posY = undefined;\r\n    }\r\n    return {x: posX, y: posY};\r\n  }\r\n\r\n  /**\r\n   * Get a main plane position from a display position.\r\n   *\r\n   * @param {number} x The X position.\r\n   * @param {number} y The Y position.\r\n   * @returns {object} The main plane position as {x,y}.\r\n   */\r\n  displayToMainPlanePos(x, y) {\r\n    const planePos = this.displayToPlanePos(x, y);\r\n    return {\r\n      x: planePos.x - this.#baseOffset.x,\r\n      y: planePos.y - this.#baseOffset.y\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Display the layer.\r\n   *\r\n   * @param {boolean} flag Whether to display the layer or not.\r\n   */\r\n  display(flag) {\r\n    this.#containerDiv.style.display = flag ? '' : 'none';\r\n  }\r\n\r\n  /**\r\n   * Check if the layer is visible.\r\n   *\r\n   * @returns {boolean} True if the layer is visible.\r\n   */\r\n  isVisible() {\r\n    return this.#containerDiv.style.display === '';\r\n  }\r\n\r\n  /**\r\n   * Draw the content (imageData) of the layer.\r\n   * The imageData variable needs to be set\r\n   *\r\n   * @fires App#renderstart\r\n   * @fires App#renderend\r\n   */\r\n  draw() {\r\n    // skip for non valid position\r\n    if (!this.#isValidPosition) {\r\n      return;\r\n    }\r\n\r\n    /**\r\n     * Render start event.\r\n     *\r\n     * @event App#renderstart\r\n     * @type {object}\r\n     * @property {string} type The event type.\r\n     */\r\n    let event = {\r\n      type: 'renderstart',\r\n      layerid: this.getId(),\r\n      dataid: this.getDataId()\r\n    };\r\n    this.#fireEvent(event);\r\n\r\n    // update data if needed\r\n    if (this.#needsDataUpdate) {\r\n      this.#updateImageData();\r\n    }\r\n\r\n    // context opacity\r\n    this.#context.globalAlpha = this.#opacity;\r\n\r\n    // clear context\r\n    this.clear();\r\n\r\n    // draw the cached canvas on the context\r\n    // transform takes as input a, b, c, d, e, f to create\r\n    // the transform matrix (column-major order):\r\n    // [ a c e ]\r\n    // [ b d f ]\r\n    // [ 0 0 1 ]\r\n    this.#context.setTransform(\r\n      this.#scale.x,\r\n      0,\r\n      0,\r\n      this.#scale.y,\r\n      -1 * this.#offset.x * this.#scale.x,\r\n      -1 * this.#offset.y * this.#scale.y\r\n    );\r\n\r\n    // disable smoothing (set just before draw, could be reset by resize)\r\n    this.#context.imageSmoothingEnabled = this.#imageSmoothing;\r\n    // draw image\r\n    this.#context.drawImage(this.#offscreenCanvas, 0, 0);\r\n\r\n    /**\r\n     * Render end event.\r\n     *\r\n     * @event App#renderend\r\n     * @type {object}\r\n     * @property {string} type The event type.\r\n     */\r\n    event = {\r\n      type: 'renderend',\r\n      layerid: this.getId(),\r\n      dataid: this.getDataId()\r\n    };\r\n    this.#fireEvent(event);\r\n  }\r\n\r\n  /**\r\n   * Initialise the layer: set the canvas and context\r\n   *\r\n   * @param {object} size The image size as {x,y}.\r\n   * @param {object} spacing The image spacing as {x,y}.\r\n   * @param {number} alpha The initial data opacity.\r\n   */\r\n  initialise(size, spacing, alpha) {\r\n    // set locals\r\n    this.#baseSpacing = spacing;\r\n    this.#opacity = Math.min(Math.max(alpha, 0), 1);\r\n\r\n    // create canvas\r\n    // (canvas size is set in fitToContainer)\r\n    this.#canvas = document.createElement('canvas');\r\n    this.#containerDiv.appendChild(this.#canvas);\r\n\r\n    // check that the getContext method exists\r\n    if (!this.#canvas.getContext) {\r\n      alert('Error: no canvas.getContext method.');\r\n      return;\r\n    }\r\n    // get the 2D context\r\n    this.#context = this.#canvas.getContext('2d');\r\n    if (!this.#context) {\r\n      alert('Error: failed to get the 2D context.');\r\n      return;\r\n    }\r\n\r\n    // off screen canvas\r\n    this.#offscreenCanvas = document.createElement('canvas');\r\n\r\n    // set base size: needs an existing context and off screen canvas\r\n    this.#setBaseSize(size);\r\n\r\n    // update data on first draw\r\n    this.#needsDataUpdate = true;\r\n  }\r\n\r\n  /**\r\n   * Set the base size of the layer.\r\n   *\r\n   * @param {object} size The size as {x,y}.\r\n   */\r\n  #setBaseSize(size) {\r\n    // check canvas creation\r\n    if (!canCreateCanvas(size.x, size.y)) {\r\n      throw new Error('Cannot create canvas with size ' +\r\n        size.x + ', ' + size.y);\r\n    }\r\n\r\n    // set local\r\n    this.#baseSize = size;\r\n\r\n    // off screen canvas\r\n    this.#offscreenCanvas.width = this.#baseSize.x;\r\n    this.#offscreenCanvas.height = this.#baseSize.y;\r\n    // original empty image data array\r\n    this.#context.clearRect(0, 0, this.#baseSize.x, this.#baseSize.y);\r\n    this.#imageData = this.#context.createImageData(\r\n      this.#baseSize.x, this.#baseSize.y);\r\n  }\r\n\r\n  /**\r\n   * Fit the layer to its parent container.\r\n   *\r\n   * @param {number} fitScale1D The 1D fit scale.\r\n   * @param {object} fitSize The fit size as {x,y}.\r\n   * @param {object} fitOffset The fit offset as {x,y}.\r\n   */\r\n  fitToContainer(fitScale1D, fitSize, fitOffset) {\r\n    let needsDraw = false;\r\n\r\n    // set canvas size if different from previous\r\n    if (this.#canvas.width !== fitSize.x ||\r\n      this.#canvas.height !== fitSize.y) {\r\n      if (!canCreateCanvas(fitSize.x, fitSize.y)) {\r\n        throw new Error('Cannot resize canvas ' + fitSize.x + ', ' + fitSize.y);\r\n      }\r\n      // canvas size change triggers canvas reset\r\n      this.#canvas.width = fitSize.x;\r\n      this.#canvas.height = fitSize.y;\r\n      // update draw flag\r\n      needsDraw = true;\r\n    }\r\n\r\n    // fit scale\r\n    const newFitScale = {\r\n      x: fitScale1D * this.#baseSpacing.x,\r\n      y: fitScale1D * this.#baseSpacing.y\r\n    };\r\n    // #scale = inputScale * fitScale * flipScale\r\n    // flipScale does not change here, we can omit it\r\n    // newScale = (#scale / fitScale) * newFitScale\r\n    const newScale = {\r\n      x: this.#scale.x * newFitScale.x / this.#fitScale.x,\r\n      y: this.#scale.y * newFitScale.y / this.#fitScale.y\r\n    };\r\n\r\n    // set scales if different from previous\r\n    if (this.#scale.x !== newScale.x ||\r\n      this.#scale.y !== newScale.y) {\r\n      this.#fitScale = newFitScale;\r\n      this.#scale = newScale;\r\n      // update draw flag\r\n      needsDraw = true;\r\n    }\r\n\r\n    // view offset\r\n    const newViewOffset = {\r\n      x: fitOffset.x / newFitScale.x,\r\n      y: fitOffset.y / newFitScale.y\r\n    };\r\n    // #flipOffset = canvas / #scale\r\n    const newFlipOffset = {\r\n      x: this.#flipOffset.x !== 0 ? fitSize.x / newFitScale.x : 0,\r\n      y: this.#flipOffset.y !== 0 ? fitSize.y / newFitScale.y : 0,\r\n    };\r\n\r\n    // set offsets if different from previous\r\n    if (this.#viewOffset.x !== newViewOffset.x ||\r\n      this.#viewOffset.y !== newViewOffset.y ||\r\n      this.#flipOffset.x !== newFlipOffset.x ||\r\n      this.#flipOffset.y !== newFlipOffset.y) {\r\n      // update global offset\r\n      this.#offset = {\r\n        x: this.#offset.x +\r\n          newViewOffset.x - this.#viewOffset.x +\r\n          newFlipOffset.x - this.#flipOffset.x,\r\n        y: this.#offset.y +\r\n          newViewOffset.y - this.#viewOffset.y +\r\n          newFlipOffset.y - this.#flipOffset.y,\r\n      };\r\n      // update private local offsets\r\n      this.#flipOffset = newFlipOffset;\r\n      this.#viewOffset = newViewOffset;\r\n      // update draw flag\r\n      needsDraw = true;\r\n    }\r\n\r\n    // draw if needed\r\n    if (needsDraw) {\r\n      this.draw();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enable and listen to container interaction events.\r\n   */\r\n  bindInteraction() {\r\n    // allow pointer events\r\n    this.#containerDiv.style.pointerEvents = 'auto';\r\n    // interaction events\r\n    const names = InteractionEventNames;\r\n    for (let i = 0; i < names.length; ++i) {\r\n      this.#containerDiv.addEventListener(\r\n        names[i], this.#fireEvent, {passive: true});\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disable and stop listening to container interaction events.\r\n   */\r\n  unbindInteraction() {\r\n    // disable pointer events\r\n    this.#containerDiv.style.pointerEvents = 'none';\r\n    // interaction events\r\n    const names = InteractionEventNames;\r\n    for (let i = 0; i < names.length; ++i) {\r\n      this.#containerDiv.removeEventListener(names[i], this.#fireEvent);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    event.srclayerid = this.getId();\r\n    event.dataid = this.#dataId;\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n  // common layer methods [end] ---------------\r\n\r\n  /**\r\n   * Update the canvas image data.\r\n   */\r\n  #updateImageData() {\r\n    // generate image data\r\n    this.#viewController.generateImageData(this.#imageData);\r\n    // pass the data to the off screen canvas\r\n    this.#offscreenCanvas.getContext('2d').putImageData(this.#imageData, 0, 0);\r\n    // update data flag\r\n    this.#needsDataUpdate = false;\r\n  }\r\n\r\n  /**\r\n   * Handle window/level change.\r\n   *\r\n   * @param {object} event The event fired when changing the window/level.\r\n   */\r\n  #onWLChange = (event) => {\r\n    // generate and draw if no skip flag\r\n    const skip = typeof event.skipGenerate !== 'undefined' &&\r\n      event.skipGenerate === true;\r\n    if (!skip) {\r\n      this.#needsDataUpdate = true;\r\n      this.draw();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle colour map change.\r\n   *\r\n   * @param {object} event The event fired when changing the colour map.\r\n   */\r\n  #onColourMapChange = (event) => {\r\n    const skip = typeof event.skipGenerate !== 'undefined' &&\r\n      event.skipGenerate === true;\r\n    if (!skip) {\r\n      this.#needsDataUpdate = true;\r\n      this.draw();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle position change.\r\n   *\r\n   * @param {object} event The event fired when changing the position.\r\n   */\r\n  #onPositionChange = (event) => {\r\n    const skip = typeof event.skipGenerate !== 'undefined' &&\r\n      event.skipGenerate === true;\r\n    if (!skip) {\r\n      let valid = true;\r\n      if (typeof event.valid !== 'undefined') {\r\n        valid = event.valid;\r\n      }\r\n      // clear for non valid events\r\n      if (!valid) {\r\n        // clear only once\r\n        if (this.#isValidPosition) {\r\n          this.#isValidPosition = false;\r\n          this.clear();\r\n        }\r\n      } else {\r\n        // 3D dimensions\r\n        const dims3D = [0, 1, 2];\r\n        // remove scroll index\r\n        const indexScrollIndex =\r\n          dims3D.indexOf(this.#viewController.getScrollIndex());\r\n        dims3D.splice(indexScrollIndex, 1);\r\n        // remove non scroll index from diff dims\r\n        const diffDims = event.diffDims.filter(function (item) {\r\n          return dims3D.indexOf(item) === -1;\r\n        });\r\n        // update if we have something left\r\n        if (diffDims.length !== 0 || !this.#isValidPosition) {\r\n          // reset valid flag\r\n          this.#isValidPosition = true;\r\n          // reset update flag\r\n          this.#needsDataUpdate = true;\r\n          this.draw();\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle alpha function change.\r\n   *\r\n   * @param {object} event The event fired when changing the function.\r\n   */\r\n  #onAlphaFuncChange = (event) => {\r\n    const skip = typeof event.skipGenerate !== 'undefined' &&\r\n      event.skipGenerate === true;\r\n    if (!skip) {\r\n      this.#needsDataUpdate = true;\r\n      this.draw();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Set the current position.\r\n   *\r\n   * @param {Point} position The new position.\r\n   * @param {Index} _index The new index.\r\n   * @returns {boolean} True if the position was updated.\r\n   */\r\n  setCurrentPosition(position, _index) {\r\n    return this.#viewController.setCurrentPosition(position);\r\n  }\r\n\r\n  /**\r\n   * Clear the context.\r\n   */\r\n  clear() {\r\n    // clear the context: reset the transform first\r\n    // store the current transformation matrix\r\n    this.#context.save();\r\n    // use the identity matrix while clearing the canvas\r\n    this.#context.setTransform(1, 0, 0, 1, 0, 0);\r\n    this.#context.clearRect(0, 0, this.#canvas.width, this.#canvas.height);\r\n    // restore the transform\r\n    this.#context.restore();\r\n  }\r\n\r\n} // ViewLayer class\r\n","import {getShadowColour} from '../utils/colour';\r\n\r\n/**\r\n * Style class.\r\n */\r\nexport class Style {\r\n  /**\r\n   * Font size.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #fontSize = 10;\r\n\r\n  /**\r\n   * Font family.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #fontFamily = 'Verdana';\r\n\r\n  /**\r\n   * Text colour.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #textColour = '#fff';\r\n\r\n  /**\r\n   * Line colour.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #lineColour = '#ffff80';\r\n\r\n  /**\r\n   * Base scale.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #baseScale = {x: 1, y: 1};\r\n\r\n  /**\r\n   * Zoom scale.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #zoomScale = {x: 1, y: 1};\r\n\r\n  /**\r\n   * Stroke width.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #strokeWidth = 2;\r\n\r\n  /**\r\n   * Shadow offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #shadowOffset = {x: 0.25, y: 0.25};\r\n\r\n  /**\r\n   * Tag opacity.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #tagOpacity = 0.2;\r\n\r\n  /**\r\n   * Text padding.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #textPadding = 3;\r\n\r\n  /**\r\n   * Get the font family.\r\n   *\r\n   * @returns {string} The font family.\r\n   */\r\n  getFontFamily() {\r\n    return this.#fontFamily;\r\n  }\r\n\r\n  /**\r\n   * Get the font size.\r\n   *\r\n   * @returns {number} The font size.\r\n   */\r\n  getFontSize() {\r\n    return this.#fontSize;\r\n  }\r\n\r\n  /**\r\n   * Get the stroke width.\r\n   *\r\n   * @returns {number} The stroke width.\r\n   */\r\n  getStrokeWidth() {\r\n    return this.#strokeWidth;\r\n  }\r\n\r\n  /**\r\n   * Get the text colour.\r\n   *\r\n   * @returns {string} The text colour.\r\n   */\r\n  getTextColour() {\r\n    return this.#textColour;\r\n  }\r\n\r\n  /**\r\n   * Get the line colour.\r\n   *\r\n   * @returns {string} The line colour.\r\n   */\r\n  getLineColour() {\r\n    return this.#lineColour;\r\n  }\r\n\r\n  /**\r\n   * Set the line colour.\r\n   *\r\n   * @param {string} colour The line colour.\r\n   */\r\n  setLineColour(colour) {\r\n    this.#lineColour = colour;\r\n  }\r\n\r\n  /**\r\n   * Set the base scale.\r\n   *\r\n   * @param {number} scale The scale as {x,y}.\r\n   */\r\n  setBaseScale(scale) {\r\n    this.#baseScale = scale;\r\n  }\r\n\r\n  /**\r\n   * Set the zoom scale.\r\n   *\r\n   * @param {object} scale The scale as {x,y}.\r\n   */\r\n  setZoomScale(scale) {\r\n    this.#zoomScale = scale;\r\n  }\r\n\r\n  /**\r\n   * Get the base scale.\r\n   *\r\n   * @returns {number} The scale as {x,y}.\r\n   */\r\n  getBaseScale() {\r\n    return this.#baseScale;\r\n  }\r\n\r\n  /**\r\n   * Get the zoom scale.\r\n   *\r\n   * @returns {object} The scale as {x,y}.\r\n   */\r\n  getZoomScale() {\r\n    return this.#zoomScale;\r\n  }\r\n\r\n  /**\r\n   * Scale an input value using the base scale.\r\n   *\r\n   * @param {number} value The value to scale.\r\n   * @returns {number} The scaled value.\r\n   */\r\n  scale(value) {\r\n    // TODO: 2D?\r\n    return value / this.#baseScale.x;\r\n  }\r\n\r\n  /**\r\n   * Apply zoom scale on an input value.\r\n   *\r\n   * @param {number} value The value to scale.\r\n   * @returns {object} The scaled value as {x,y}.\r\n   */\r\n  applyZoomScale(value) {\r\n    // times 2 so that the font size 10 looks like a 10...\r\n    // (same logic as in the DrawController::updateLabelScale)\r\n    return {\r\n      x: 2 * value / this.#zoomScale.x,\r\n      y: 2 * value / this.#zoomScale.y\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the shadow offset.\r\n   *\r\n   * @returns {object} The offset as {x,y}.\r\n   */\r\n  getShadowOffset() {\r\n    return this.#shadowOffset;\r\n  }\r\n\r\n  /**\r\n   * Get the tag opacity.\r\n   *\r\n   * @returns {number} The opacity.\r\n   */\r\n  getTagOpacity() {\r\n    return this.#tagOpacity;\r\n  }\r\n\r\n  /**\r\n   * Get the text padding.\r\n   *\r\n   * @returns {number} The padding.\r\n   */\r\n  getTextPadding() {\r\n    return this.#textPadding;\r\n  }\r\n\r\n  /**\r\n   * Get the font definition string.\r\n   *\r\n   * @returns {string} The font definition string.\r\n   */\r\n  getFontStr() {\r\n    return ('normal ' + this.getFontSize() + 'px sans-serif');\r\n  }\r\n\r\n  /**\r\n   * Get the line height.\r\n   *\r\n   * @returns {number} The line height.\r\n   */\r\n  getLineHeight() {\r\n    return (this.getFontSize() + this.getFontSize() / 5);\r\n  }\r\n\r\n  /**\r\n   * Get the font size scaled to the display.\r\n   *\r\n   * @returns {number} The scaled font size.\r\n   */\r\n  getScaledFontSize() {\r\n    return this.scale(this.getFontSize());\r\n  }\r\n\r\n  /**\r\n   * Get the stroke width scaled to the display.\r\n   *\r\n   * @returns {number} The scaled stroke width.\r\n   */\r\n  getScaledStrokeWidth() {\r\n    return this.scale(this.getStrokeWidth());\r\n  }\r\n\r\n  /**\r\n   * Get the shadow line colour.\r\n   *\r\n   * @returns {string} The shadow line colour.\r\n   */\r\n  getShadowLineColour() {\r\n    return getShadowColour(this.getLineColour());\r\n  }\r\n\r\n} // class Style\r\n","// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Style} from '../gui/style';\r\nimport {DrawLayer} from '../gui/drawLayer';\r\nimport {ViewController} from '../app/viewController';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Get the display name of the input shape.\r\n *\r\n * @param {Konva.Shape} shape The Konva shape.\r\n * @returns {string} The display name.\r\n */\r\nexport function getShapeDisplayName(shape) {\r\n  let displayName = 'shape';\r\n  if (shape instanceof Konva.Line) {\r\n    if (shape.points().length === 4) {\r\n      displayName = 'line';\r\n    } else if (shape.points().length === 6) {\r\n      displayName = 'protractor';\r\n    } else {\r\n      displayName = 'roi';\r\n    }\r\n  } else if (shape instanceof Konva.Rect) {\r\n    displayName = 'rectangle';\r\n  } else if (shape instanceof Konva.Ellipse) {\r\n    displayName = 'ellipse';\r\n  }\r\n  // return\r\n  return displayName;\r\n}\r\n\r\n/**\r\n * Draw group command.\r\n */\r\nexport class DrawGroupCommand {\r\n\r\n  /**\r\n   * The group to draw.\r\n   *\r\n   * @type {Konva.Group}\r\n   */\r\n  #group;\r\n\r\n  /**\r\n   * The shape display name.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #name;\r\n\r\n  /**\r\n   * The draw layer.\r\n   *\r\n   * @type {DrawLayer}\r\n   */\r\n  #layer;\r\n\r\n  /**\r\n   * Flag to send events.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isSilent;\r\n\r\n  /**\r\n   * The group parent.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #parent;\r\n\r\n  /**\r\n   * @param {Konva.Group} group The group draw.\r\n   * @param {string} name The shape display name.\r\n   * @param {DrawLayer} layer The layer where to draw the group.\r\n   * @param {boolean} [silent] Whether to send a creation event or not.\r\n   */\r\n  constructor(group, name, layer, silent) {\r\n    this.#group = group;\r\n    this.#name = name;\r\n    this.#layer = layer;\r\n    this.#isSilent = (typeof silent === 'undefined') ? false : silent;\r\n    this.#parent = group.getParent();\r\n  }\r\n\r\n  /**\r\n   * Get the command name.\r\n   *\r\n   * @returns {string} The command name.\r\n   */\r\n  getName() {\r\n    return 'Draw-' + this.#name;\r\n  }\r\n\r\n  /**\r\n   * Execute the command.\r\n   *\r\n   * @fires DrawGroupCommand#drawcreate\r\n   */\r\n  execute() {\r\n    // add the group to the parent (in case of undo/redo)\r\n    this.#parent.add(this.#group);\r\n    // draw\r\n    this.#layer.getKonvaLayer().draw();\r\n    // callback\r\n    if (!this.#isSilent) {\r\n      /**\r\n       * Draw create event.\r\n       *\r\n       * @event DrawGroupCommand#drawcreate\r\n       * @type {object}\r\n       * @property {string} id The id of the created draw.\r\n       * @property {string} srclayerid The id of the layer of the draw.\r\n       * @property {string} dataid The associated data id.\r\n       */\r\n      this.onExecute({\r\n        type: 'drawcreate',\r\n        id: this.#group.id(),\r\n        srclayerid: this.#layer.getId(),\r\n        dataid: this.#layer.getDataId()\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Undo the command.\r\n   *\r\n   * @fires DeleteGroupCommand#drawdelete\r\n   */\r\n  undo() {\r\n    // remove the group from the parent layer\r\n    this.#group.remove();\r\n    // draw\r\n    this.#layer.getKonvaLayer().draw();\r\n    // callback\r\n    this.onUndo({\r\n      type: 'drawdelete',\r\n      id: this.#group.id(),\r\n      srclayerid: this.#layer.getId(),\r\n      dataid: this.#layer.getDataId()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle an execute event.\r\n   *\r\n   * @param {object} _event The execute event with type and id.\r\n   */\r\n  onExecute(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n  /**\r\n   * Handle an undo event.\r\n   *\r\n   * @param {object} _event The undo event with type and id.\r\n   */\r\n  onUndo(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n} // DrawGroupCommand class\r\n\r\n\r\n/**\r\n * Move group command.\r\n */\r\nexport class MoveGroupCommand {\r\n\r\n  /**\r\n   * The group to move.\r\n   *\r\n   * @type {Konva.Group}\r\n   */\r\n  #group;\r\n\r\n  /**\r\n   * The shape display name.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #name;\r\n\r\n  /**\r\n   * The 2D translation as {x,y}.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #translation;\r\n\r\n  /**\r\n   * The draw layer.\r\n   *\r\n   * @type {DrawLayer}\r\n   */\r\n  #layer;\r\n\r\n  /**\r\n   * @param {Konva.Group} group The group draw.\r\n   * @param {string} name The shape display name.\r\n   * @param {object} translation A 2D translation to move the group by.\r\n   * @param {DrawLayer} layer The layer where to move the group.\r\n   */\r\n  constructor(group, name, translation, layer) {\r\n    this.#group = group;\r\n    this.#name = name;\r\n    this.#translation = translation;\r\n    this.#layer = layer;\r\n  }\r\n\r\n  /**\r\n   * Get the command name.\r\n   *\r\n   * @returns {string} The command name.\r\n   */\r\n  getName() {\r\n    return 'Move-' + this.#name;\r\n  }\r\n\r\n  /**\r\n   * Execute the command.\r\n   *\r\n   * @fires MoveGroupCommand#drawmove\r\n   */\r\n  execute() {\r\n    // translate group\r\n    this.#group.move(this.#translation);\r\n    // draw\r\n    this.#layer.getKonvaLayer().draw();\r\n    // callback\r\n    /**\r\n     * Draw move event.\r\n     *\r\n     * @event MoveGroupCommand#drawmove\r\n     * @type {object}\r\n     * @property {string} id The id of the create draw.\r\n     * @property {string} srclayerid The id of the layer of the draw.\r\n     * @property {string} dataid The associated data id.\r\n     */\r\n    this.onExecute({\r\n      type: 'drawmove',\r\n      id: this.#group.id(),\r\n      srclayerid: this.#layer.getId(),\r\n      dataid: this.#layer.getDataId()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Undo the command.\r\n   *\r\n   * @fires MoveGroupCommand#drawmove\r\n   */\r\n  undo() {\r\n    // invert translate group\r\n    const minusTrans = {\r\n      x: -this.#translation.x,\r\n      y: -this.#translation.y\r\n    };\r\n    this.#group.move(minusTrans);\r\n    // draw\r\n    this.#layer.getKonvaLayer().draw();\r\n    // callback\r\n    this.onUndo({\r\n      type: 'drawmove',\r\n      id: this.#group.id(),\r\n      srclayerid: this.#layer.getId(),\r\n      dataid: this.#layer.getDataId()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle an execute event.\r\n   *\r\n   * @param {object} _event The execute event with type and id.\r\n   */\r\n  onExecute(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n  /**\r\n   * Handle an undo event.\r\n   *\r\n   * @param {object} _event The undo event with type and id.\r\n   */\r\n  onUndo(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n} // MoveGroupCommand class\r\n\r\n\r\n/**\r\n * Change group command.\r\n */\r\nexport class ChangeGroupCommand {\r\n\r\n  /**\r\n   * The shape display name.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #name;\r\n\r\n  /**\r\n   * The shape factory.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #factory;\r\n\r\n  /**\r\n   * The start anchor.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #startAnchor;\r\n\r\n  /**\r\n   * The end anchor.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #endAnchor;\r\n\r\n  /**\r\n   * The draw layer.\r\n   *\r\n   * @type {DrawLayer}\r\n   */\r\n  #layer;\r\n\r\n  /**\r\n   * The associated view controller.\r\n   *\r\n   * @type {ViewController}\r\n   */\r\n  #viewController;\r\n\r\n  /**\r\n   * The app style.\r\n   *\r\n   * @type {Style}\r\n   */\r\n  #style;\r\n\r\n  /**\r\n   * @param {string} name The shape display name.\r\n   * @param {object} factory The shape factory.\r\n   * @param {object} startAnchor The anchor that starts the change.\r\n   * @param {object} endAnchor The anchor that ends the change.\r\n   * @param {DrawLayer} layer The layer where to change the group.\r\n   * @param {ViewController} viewController The associated viewController.\r\n   * @param {Style} style The app style.\r\n   */\r\n  constructor(\r\n    name, factory, startAnchor, endAnchor, layer, viewController, style) {\r\n    this.#name = name;\r\n    this.#factory = factory;\r\n    this.#startAnchor = startAnchor;\r\n    this.#endAnchor = endAnchor;\r\n    this.#layer = layer;\r\n    this.#viewController = viewController;\r\n    this.#style = style;\r\n  }\r\n\r\n  /**\r\n   * Get the command name.\r\n   *\r\n   * @returns {string} The command name.\r\n   */\r\n  getName() {\r\n    return 'Change-' + this.#name;\r\n  }\r\n\r\n  /**\r\n   * Execute the command.\r\n   *\r\n   * @fires ChangeGroupCommand#drawchange\r\n   */\r\n  execute() {\r\n    // change shape\r\n    this.#factory.update(\r\n      this.#endAnchor,\r\n      this.#style,\r\n      this.#viewController\r\n    );\r\n    // draw\r\n    this.#layer.getKonvaLayer().draw();\r\n    // callback\r\n    /**\r\n     * Draw change event.\r\n     *\r\n     * @event ChangeGroupCommand#drawchange\r\n     * @type {object}\r\n     * @property {string} id The id of the created draw.\r\n     * @property {string} srclayerid The id of the layer of the draw.\r\n     * @property {string} dataid The associated data id.\r\n     */\r\n    this.onExecute({\r\n      type: 'drawchange',\r\n      id: this.#endAnchor.getParent().id(),\r\n      srclayerid: this.#layer.getId(),\r\n      dataid: this.#layer.getDataId()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Undo the command.\r\n   *\r\n   * @fires ChangeGroupCommand#drawchange\r\n   */\r\n  undo() {\r\n    // invert change shape\r\n    this.#factory.update(\r\n      this.#startAnchor,\r\n      this.#style,\r\n      this.#viewController\r\n    );\r\n    // draw\r\n    this.#layer.getKonvaLayer().draw();\r\n    // callback\r\n    this.onUndo({\r\n      type: 'drawchange',\r\n      id: this.#startAnchor.getParent().id(),\r\n      srclayerid: this.#layer.getId(),\r\n      dataid: this.#layer.getDataId()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle an execute event.\r\n   *\r\n   * @param {object} _event The execute event with type and id.\r\n   */\r\n  onExecute(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n  /**\r\n   * Handle an undo event.\r\n   *\r\n   * @param {object} _event The undo event with type and id.\r\n   */\r\n  onUndo(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n} // ChangeGroupCommand class\r\n\r\n/**\r\n * Delete group command.\r\n */\r\nexport class DeleteGroupCommand {\r\n\r\n  /**\r\n   * The group to draw.\r\n   *\r\n   * @type {Konva.Group}\r\n   */\r\n  #group;\r\n\r\n  /**\r\n   * The shape display name.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #name;\r\n\r\n  /**\r\n   * The draw layer.\r\n   *\r\n   * @type {DrawLayer}\r\n   */\r\n  #layer;\r\n\r\n  /**\r\n   * The group parent.\r\n   *\r\n   * @type {Konva.Container}\r\n   */\r\n  #parent;\r\n\r\n  /**\r\n   * @param {Konva.Group} group The group draw.\r\n   * @param {string} name The shape display name.\r\n   * @param {DrawLayer} layer The layer where to delete the group.\r\n   */\r\n  constructor(group, name, layer) {\r\n    this.#group = group;\r\n    this.#name = name;\r\n    this.#layer = layer;\r\n    this.#parent = group.getParent();\r\n  }\r\n\r\n  /**\r\n   * Get the command name.\r\n   *\r\n   * @returns {string} The command name.\r\n   */\r\n  getName() {\r\n    return 'Delete-' + this.#name;\r\n  }\r\n\r\n  /**\r\n   * Execute the command.\r\n   *\r\n   * @fires DeleteGroupCommand#drawdelete\r\n   */\r\n  execute() {\r\n    // remove the group from its parent\r\n    this.#group.remove();\r\n    // draw\r\n    this.#layer.getKonvaLayer().draw();\r\n    // callback\r\n    /**\r\n     * Draw delete event.\r\n     *\r\n     * @event DeleteGroupCommand#drawdelete\r\n     * @type {object}\r\n     * @property {string} id The id of the created draw.\r\n     * @property {string} srclayerid The id of the layer of the draw.\r\n     * @property {string} dataid The associated data id.\r\n     */\r\n    this.onExecute({\r\n      type: 'drawdelete',\r\n      id: this.#group.id(),\r\n      srclayerid: this.#layer.getId(),\r\n      dataid: this.#layer.getDataId()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Undo the command.\r\n   *\r\n   * @fires DrawGroupCommand#drawcreate\r\n   */\r\n  undo() {\r\n    // add the group to its parent\r\n    this.#parent.add(this.#group);\r\n    // draw\r\n    this.#layer.getKonvaLayer().draw();\r\n    // callback\r\n    this.onUndo({\r\n      type: 'drawcreate',\r\n      id: this.#group.id(),\r\n      srclayerid: this.#layer.getId(),\r\n      dataid: this.#layer.getDataId()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle an execute event.\r\n   *\r\n   * @param {object} _event The execute event with type and id.\r\n   */\r\n  onExecute(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n  /**\r\n   * Handle an undo event.\r\n   *\r\n   * @param {object} _event The undo event with type and id.\r\n   */\r\n  onUndo(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n} // DeleteGroupCommand class\r\n","import {getIndexFromStringId} from '../math/index';\r\nimport {logger} from '../utils/logger';\r\nimport {replaceFlags} from '../utils/string';\r\nimport {getShadowColour} from '../utils/colour';\r\nimport {\r\n  getShapeDisplayName,\r\n  DrawGroupCommand,\r\n  DeleteGroupCommand\r\n} from '../tools/drawCommands';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Index} from '../math/index';\r\nimport {DrawLayer} from '../gui/drawLayer';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Konva.\r\n *\r\n * @external Konva\r\n * @see https://konvajs.org/\r\n */\r\nimport Konva from 'konva';\r\n\r\n/**\r\n * Draw meta data.\r\n */\r\nexport class DrawMeta {\r\n  /**\r\n   * Draw quantification.\r\n   *\r\n   * @type {object}\r\n   */\r\n  quantification;\r\n\r\n  /**\r\n   * Draw text expression. Can contain variables surrounded with '{}' that will\r\n   * be extracted from the quantification object.\r\n   *\r\n   * @type {string}\r\n   */\r\n  textExpr;\r\n}\r\n\r\n/**\r\n * Draw details.\r\n */\r\nexport class DrawDetails {\r\n  /**\r\n   * The draw ID.\r\n   *\r\n   * @type {number}\r\n   */\r\n  id;\r\n\r\n  /**\r\n   * The draw position: an Index converted to string.\r\n   *\r\n   * @type {string}\r\n   */\r\n  position;\r\n\r\n  /**\r\n   * The draw type.\r\n   *\r\n   * @type {string}\r\n   */\r\n  type;\r\n\r\n  /**\r\n   * The draw color: for example 'green', '#00ff00' or 'rgb(0,255,0)'.\r\n   *\r\n   * @type {string}\r\n   */\r\n  color;\r\n\r\n  /**\r\n   * The draw meta.\r\n   *\r\n   * @type {DrawMeta}\r\n   */\r\n  meta;\r\n}\r\n\r\n/**\r\n * Is an input node's name 'shape'.\r\n *\r\n * @param {Konva.Node} node A Konva node.\r\n * @returns {boolean} True if the node's name is 'shape'.\r\n */\r\nexport function isNodeNameShape(node) {\r\n  return node.name() === 'shape';\r\n}\r\n\r\n/**\r\n * Is a node an extra shape associated with a main one.\r\n *\r\n * @param {Konva.Node} node A Konva node.\r\n * @returns {boolean} True if the node's name starts with 'shape-'.\r\n */\r\nexport function isNodeNameShapeExtra(node) {\r\n  return node.name().startsWith('shape-');\r\n}\r\n\r\n/**\r\n * Is an input node's name 'label'.\r\n *\r\n * @param {Konva.Node} node A Konva node.\r\n * @returns {boolean} True if the node's name is 'label'.\r\n */\r\nexport function isNodeNameLabel(node) {\r\n  return node.name() === 'label';\r\n}\r\n\r\n/**\r\n * Is an input node a position node.\r\n *\r\n * @param {Konva.Node} node A Konva node.\r\n * @returns {boolean} True if the node's name is 'position-group'.\r\n */\r\nexport function isPositionNode(node) {\r\n  return node.name() === 'position-group';\r\n}\r\n\r\n/**\r\n * @callback testFn\r\n * @param {Konva.Node} node The node.\r\n * @returns {boolean} True if the node passes the test.\r\n */\r\n\r\n/**\r\n * Get a lambda to check a node's id.\r\n *\r\n * @param {string} id The id to check.\r\n * @returns {testFn} A function to check a node's id.\r\n */\r\nexport function isNodeWithId(id) {\r\n  return function (node) {\r\n    return node.id() === id;\r\n  };\r\n}\r\n\r\n/**\r\n * Is the input node a node that has the 'stroke' method.\r\n *\r\n * @param {Konva.Node} node A Konva node.\r\n * @returns {boolean} True if the node's name is 'anchor' and 'label'.\r\n */\r\nexport function canNodeChangeColour(node) {\r\n  return node.name() !== 'anchor' && node.name() !== 'label';\r\n}\r\n\r\n/**\r\n * Debug function to output the layer hierarchy as text.\r\n *\r\n * @param {object} layer The Konva layer.\r\n * @param {string} prefix A display prefix (used in recursion).\r\n * @returns {string} A text representation of the hierarchy.\r\n */\r\nexport function getHierarchyLog(layer, prefix) {\r\n  if (typeof prefix === 'undefined') {\r\n    prefix = '';\r\n  }\r\n  const kids = layer.getChildren();\r\n  let log = prefix + '|__ ' + layer.name() + ': ' + layer.id() + '\\n';\r\n  for (let i = 0; i < kids.length; ++i) {\r\n    log += getHierarchyLog(kids[i], prefix + '    ');\r\n  }\r\n  return log;\r\n}\r\n\r\n/**\r\n * Draw controller.\r\n */\r\nexport class DrawController {\r\n\r\n  /**\r\n   * The draw layer.\r\n   *\r\n   * @type {DrawLayer}\r\n   */\r\n  #drawLayer;\r\n\r\n  /**\r\n   * The Konva layer.\r\n   *\r\n   * @type {Konva.Layer}\r\n   */\r\n  #konvaLayer;\r\n\r\n  /**\r\n   * Current position group id.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #currentPosGroupId = null;\r\n\r\n  /**\r\n   * @param {DrawLayer} drawLayer The draw layer.\r\n   */\r\n  constructor(drawLayer) {\r\n    this.#drawLayer = drawLayer;\r\n    this.#konvaLayer = drawLayer.getKonvaLayer();\r\n  }\r\n\r\n  /**\r\n   * Get the current position group.\r\n   *\r\n   * @returns {Konva.Group|undefined} The Konva.Group.\r\n   */\r\n  getCurrentPosGroup() {\r\n    // get position groups\r\n    const posGroups = this.#konvaLayer.getChildren((node) => {\r\n      return node.id() === this.#currentPosGroupId;\r\n    });\r\n    // if one group, use it\r\n    // if no group, create one\r\n    let posGroup;\r\n    if (posGroups.length === 1) {\r\n      if (posGroups[0] instanceof Konva.Group) {\r\n        posGroup = posGroups[0];\r\n      }\r\n    } else if (posGroups.length === 0) {\r\n      posGroup = new Konva.Group();\r\n      posGroup.name('position-group');\r\n      posGroup.id(this.#currentPosGroupId);\r\n      posGroup.visible(true); // dont inherit\r\n      // add new group to layer\r\n      this.#konvaLayer.add(posGroup);\r\n    } else {\r\n      logger.warn('Unexpected number of draw position groups.');\r\n    }\r\n    // return\r\n    return posGroup;\r\n  }\r\n\r\n  /**\r\n   * Reset: clear the layers array.\r\n   */\r\n  reset() {\r\n    this.#konvaLayer = null;\r\n  }\r\n\r\n  /**\r\n   * Get a Konva group using its id.\r\n   *\r\n   * @param {string} id The group id.\r\n   * @returns {object|undefined} The Konva group.\r\n   */\r\n  getGroup(id) {\r\n    const group = this.#konvaLayer.findOne('#' + id);\r\n    if (typeof group === 'undefined') {\r\n      logger.warn('Cannot find node with id: ' + id\r\n      );\r\n    }\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Activate the current draw layer.\r\n   *\r\n   * @param {Index} index The current position.\r\n   * @param {number} scrollIndex The scroll index.\r\n   */\r\n  activateDrawLayer(index, scrollIndex) {\r\n    // TODO: add layer info\r\n    // get and store the position group id\r\n    const dims = [scrollIndex];\r\n    for (let j = 3; j < index.length(); ++j) {\r\n      dims.push(j);\r\n    }\r\n    this.#currentPosGroupId = index.toStringId(dims);\r\n\r\n    // get all position groups\r\n    const posGroups = this.#konvaLayer.getChildren(isPositionNode);\r\n    // reset or set the visible property\r\n    let visible;\r\n    for (let i = 0, leni = posGroups.length; i < leni; ++i) {\r\n      visible = false;\r\n      if (posGroups[i].id() === this.#currentPosGroupId) {\r\n        visible = true;\r\n      }\r\n      // group members inherit the visible property\r\n      posGroups[i].visible(visible);\r\n    }\r\n\r\n    // show current draw layer\r\n    this.#konvaLayer.draw();\r\n  }\r\n\r\n  /**\r\n   * Get a list of drawing display details.\r\n   *\r\n   * @returns {DrawDetails[]} A list of draw details.\r\n   */\r\n  getDrawDisplayDetails() {\r\n    const list = [];\r\n    const groups = this.#konvaLayer.getChildren();\r\n    for (let j = 0, lenj = groups.length; j < lenj; ++j) {\r\n      const position = getIndexFromStringId(groups[j].id());\r\n      // @ts-ignore\r\n      const collec = groups[j].getChildren();\r\n      for (let i = 0, leni = collec.length; i < leni; ++i) {\r\n        const shape = collec[i].getChildren(isNodeNameShape)[0];\r\n        const label = collec[i].getChildren(isNodeNameLabel)[0];\r\n        const text = label.getChildren()[0];\r\n        let type = shape.className;\r\n        if (type === 'Line') {\r\n          const shapeExtrakids = collec[i].getChildren(\r\n            isNodeNameShapeExtra);\r\n          if (shape.closed()) {\r\n            type = 'Roi';\r\n          } else if (shapeExtrakids.length !== 0) {\r\n            const extraName0 = shapeExtrakids[0].name();\r\n            if (extraName0.indexOf('triangle') !== -1) {\r\n              type = 'Arrow';\r\n            } else if (extraName0.indexOf('arc') !== -1) {\r\n              type = 'Protractor';\r\n            } else {\r\n              type = 'Ruler';\r\n            }\r\n          }\r\n        }\r\n        if (type === 'Rect') {\r\n          type = 'Rectangle';\r\n        }\r\n        list.push({\r\n          id: collec[i].id(),\r\n          position: position.toString(),\r\n          type: type,\r\n          color: shape.stroke(),\r\n          meta: text.meta\r\n        });\r\n      }\r\n    }\r\n    return list;\r\n  }\r\n\r\n  /**\r\n   * Get a list of drawing store details. Used in state.\r\n   *\r\n   * @returns {object} A list of draw details including id, text, quant...\r\n   * TODO Unify with getDrawDisplayDetails?\r\n   */\r\n  getDrawStoreDetails() {\r\n    const drawingsDetails = {};\r\n\r\n    // get all position groups\r\n    const posGroups = this.#konvaLayer.getChildren(isPositionNode);\r\n\r\n    let posKids;\r\n    let group;\r\n    for (let i = 0, leni = posGroups.length; i < leni; ++i) {\r\n      // @ts-ignore\r\n      posKids = posGroups[i].getChildren();\r\n      for (let j = 0, lenj = posKids.length; j < lenj; ++j) {\r\n        group = posKids[j];\r\n        // remove anchors\r\n        const anchors = group.find('.anchor');\r\n        for (let a = 0; a < anchors.length; ++a) {\r\n          anchors[a].remove();\r\n        }\r\n        // get text\r\n        const texts = group.find('.text');\r\n        if (texts.length !== 1) {\r\n          logger.warn('There should not be more than one text per shape.');\r\n        }\r\n        // get meta (non konva vars)\r\n        drawingsDetails[group.id()] = {\r\n          meta: texts[0].meta\r\n        };\r\n      }\r\n    }\r\n    return drawingsDetails;\r\n  }\r\n\r\n  /**\r\n   * Set the drawings on the current stage.\r\n   *\r\n   * @param {Array} drawings An array of drawings.\r\n   * @param {DrawDetails[]} drawingsDetails An array of drawings details.\r\n   * @param {object} cmdCallback The DrawCommand callback.\r\n   * @param {object} exeCallback The callback to call once the\r\n   *   DrawCommand has been executed.\r\n   */\r\n  setDrawings(\r\n    drawings, drawingsDetails, cmdCallback, exeCallback) {\r\n    // regular Konva deserialize\r\n    const stateLayer = Konva.Node.create(drawings);\r\n\r\n    // get all position groups\r\n    const statePosGroups = stateLayer.getChildren(isPositionNode);\r\n\r\n    for (let i = 0, leni = statePosGroups.length; i < leni; ++i) {\r\n      const statePosGroup = statePosGroups[i];\r\n\r\n      // Get or create position-group if it does not exist and\r\n      // append it to konvaLayer\r\n      let posGroup = this.#konvaLayer.getChildren(\r\n        isNodeWithId(statePosGroup.id()))[0];\r\n      if (typeof posGroup === 'undefined') {\r\n        posGroup = new Konva.Group({\r\n          id: statePosGroup.id(),\r\n          name: 'position-group',\r\n          visible: false\r\n        });\r\n        this.#konvaLayer.add(posGroup);\r\n      }\r\n\r\n      const statePosKids = statePosGroup.getChildren();\r\n      for (let j = 0, lenj = statePosKids.length; j < lenj; ++j) {\r\n        // shape group (use first one since it will be removed from\r\n        // the group when we change it)\r\n        const stateGroup = statePosKids[0];\r\n        // add group to posGroup (switches its parent)\r\n        // @ts-ignore\r\n        posGroup.add(stateGroup);\r\n        // shape\r\n        const shape = stateGroup.getChildren(isNodeNameShape)[0];\r\n        // create the draw command\r\n        const cmd = new DrawGroupCommand(\r\n          stateGroup,\r\n          shape.className,\r\n          this.#drawLayer\r\n        );\r\n        // draw command callbacks\r\n        cmd.onExecute = cmdCallback;\r\n        cmd.onUndo = cmdCallback;\r\n        // details\r\n        if (drawingsDetails) {\r\n          const details = drawingsDetails[stateGroup.id()];\r\n          const label = stateGroup.getChildren(isNodeNameLabel)[0];\r\n          const text = label.getText();\r\n          // store details\r\n          text.meta = details.meta;\r\n          // reset text (it was not encoded)\r\n          text.setText(replaceFlags(\r\n            text.meta.textExpr, text.meta.quantification\r\n          ));\r\n        }\r\n        // execute\r\n        cmd.execute();\r\n        exeCallback(cmd);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a drawing from its details.\r\n   *\r\n   * @param {DrawDetails} drawDetails Details of the drawing to update.\r\n   */\r\n  updateDraw(drawDetails) {\r\n    // get the group\r\n    const group = this.#konvaLayer.findOne('#' + drawDetails.id);\r\n    if (typeof group === 'undefined') {\r\n      logger.warn(\r\n        '[updateDraw] Cannot find group with id: ' + drawDetails.id\r\n      );\r\n      return;\r\n    }\r\n    // shape\r\n    // @ts-ignore\r\n    const shapes = group.getChildren(isNodeNameShape);\r\n    for (let i = 0; i < shapes.length; ++i) {\r\n      shapes[i].stroke(drawDetails.color);\r\n    }\r\n    // shape extra\r\n    // @ts-ignore\r\n    const shapesExtra = group.getChildren(isNodeNameShapeExtra);\r\n    for (let j = 0; j < shapesExtra.length; ++j) {\r\n      if (typeof shapesExtra[j].stroke() !== 'undefined') {\r\n        shapesExtra[j].stroke(drawDetails.color);\r\n      } else if (typeof shapesExtra[j].fill() !== 'undefined') {\r\n        // for example text\r\n        shapesExtra[j].fill(drawDetails.color);\r\n      }\r\n    }\r\n    // label\r\n    // @ts-ignore\r\n    const label = group.getChildren(isNodeNameLabel)[0];\r\n    const shadowColor = getShadowColour(drawDetails.color);\r\n    const kids = label.getChildren();\r\n    for (let k = 0; k < kids.length; ++k) {\r\n      const kid = kids[k];\r\n      kid.fill(drawDetails.color);\r\n      if (kids[k].className === 'Text') {\r\n        const text = kids[k];\r\n        text.shadowColor(shadowColor);\r\n        if (typeof drawDetails.meta !== 'undefined') {\r\n          text.meta = drawDetails.meta;\r\n          text.setText(replaceFlags(\r\n            text.meta.textExpr, text.meta.quantification\r\n          ));\r\n          label.setVisible(text.meta.textExpr.length !== 0);\r\n        }\r\n      }\r\n    }\r\n\r\n    // udpate current layer\r\n    this.#konvaLayer.draw();\r\n  }\r\n\r\n  /**\r\n   * Delete a Draw from the stage.\r\n   *\r\n   * @param {Konva.Group} group The group to delete.\r\n   * @param {object} cmdCallback The DeleteCommand callback.\r\n   * @param {object} exeCallback The callback to call once the\r\n   *  DeleteCommand has been executed.\r\n   */\r\n  deleteDrawGroup(group, cmdCallback, exeCallback) {\r\n    const shape = group.getChildren(isNodeNameShape)[0];\r\n    if (!(shape instanceof Konva.Shape)) {\r\n      return;\r\n    }\r\n    const shapeDisplayName = getShapeDisplayName(shape);\r\n    const delcmd = new DeleteGroupCommand(\r\n      group,\r\n      shapeDisplayName,\r\n      this.#drawLayer\r\n    );\r\n    delcmd.onExecute = cmdCallback;\r\n    delcmd.onUndo = cmdCallback;\r\n    delcmd.execute();\r\n    // callback\r\n    if (typeof exeCallback !== 'undefined') {\r\n      exeCallback(delcmd);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a Draw from the stage.\r\n   *\r\n   * @param {string} id The id of the group to delete.\r\n   * @param {Function} cmdCallback The DeleteCommand callback.\r\n   * @param {Function} exeCallback The callback to call once the\r\n   *  DeleteCommand has been executed.\r\n   * @returns {boolean} False if the group cannot be found.\r\n   */\r\n  deleteDraw(id, cmdCallback, exeCallback) {\r\n    // get the group\r\n    const group = this.getGroup(id);\r\n    if (typeof group === 'undefined') {\r\n      return false;\r\n    }\r\n    // delete\r\n    this.deleteDrawGroup(group, cmdCallback, exeCallback);\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Delete all Draws from the stage.\r\n   *\r\n   * @param {Function} cmdCallback The DeleteCommand callback.\r\n   * @param {Function} exeCallback The callback to call once the\r\n   *  DeleteCommand has been executed.\r\n   */\r\n  deleteDraws(cmdCallback, exeCallback) {\r\n    const posGroups = this.#konvaLayer.getChildren();\r\n    for (const posGroup of posGroups) {\r\n      if (posGroup instanceof Konva.Group) {\r\n        const shapeGroups = posGroup.getChildren();\r\n        while (shapeGroups.length) {\r\n          if (shapeGroups[0] instanceof Konva.Group) {\r\n            this.deleteDrawGroup(shapeGroups[0], cmdCallback, exeCallback);\r\n          }\r\n        }\r\n      } else {\r\n        logger.warn('Found non group in layer while deleting');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the total number of draws\r\n   * (at all positions).\r\n   *\r\n   * @returns {number} The total number of draws.\r\n   */\r\n  getNumberOfDraws() {\r\n    const posGroups = this.#konvaLayer.getChildren();\r\n    let count = 0;\r\n    for (const posGroup of posGroups) {\r\n      if (posGroup instanceof Konva.Group) {\r\n        count += posGroup.getChildren().length;\r\n      }\r\n    }\r\n    return count;\r\n  }\r\n\r\n} // class DrawController\r\n","import {ListenerHandler} from '../utils/listen';\r\nimport {DrawController} from '../app/drawController';\r\nimport {getScaledOffset} from './layerGroup';\r\nimport {InteractionEventNames} from './generic';\r\n\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Point, Point3D} from '../math/point';\r\nimport {Index} from '../math/index';\r\nimport {Vector3D} from '../math/vector';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Draw layer.\r\n */\r\nexport class DrawLayer {\r\n\r\n  /**\r\n   * The container div.\r\n   *\r\n   * @type {HTMLDivElement}\r\n   */\r\n  #containerDiv;\r\n\r\n  /**\r\n   * Konva stage.\r\n   *\r\n   * @type {Konva.Stage}\r\n   */\r\n  #konvaStage = null;\r\n\r\n  /**\r\n   * The layer base size as {x,y}.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #baseSize;\r\n\r\n  /**\r\n   * The layer base spacing as {x,y}.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #baseSpacing;\r\n\r\n  /**\r\n   * The layer fit scale.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #fitScale = {x: 1, y: 1};\r\n\r\n  /**\r\n   * The layer flip scale.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #flipScale = {x: 1, y: 1, z: 1};\r\n\r\n  /**\r\n   * The base layer offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #baseOffset = {x: 0, y: 0};\r\n\r\n  /**\r\n   * The view offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #viewOffset = {x: 0, y: 0};\r\n\r\n  /**\r\n   * The zoom offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #zoomOffset = {x: 0, y: 0};\r\n\r\n  /**\r\n   * The flip offset.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #flipOffset = {x: 0, y: 0};\r\n\r\n  /**\r\n   * The draw controller.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #drawController;\r\n\r\n  /**\r\n   * The plane helper.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #planeHelper;\r\n\r\n  /**\r\n   * The associated data id.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #dataId;\r\n\r\n  /**\r\n   * @param {HTMLDivElement} containerDiv The layer div, its id will be used\r\n   *   as this layer id.\r\n   */\r\n  constructor(containerDiv) {\r\n    this.#containerDiv = containerDiv;\r\n    // specific css class name\r\n    this.#containerDiv.className += ' drawLayer';\r\n  }\r\n\r\n  /**\r\n   * Get the associated data id.\r\n   *\r\n   * @returns {string} The id.\r\n   */\r\n  getDataId() {\r\n    return this.#dataId;\r\n  }\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Get the Konva stage.\r\n   *\r\n   * @returns {Konva.Stage} The stage.\r\n   */\r\n  getKonvaStage() {\r\n    return this.#konvaStage;\r\n  }\r\n\r\n  /**\r\n   * Get the Konva layer.\r\n   *\r\n   * @returns {Konva.Layer} The layer.\r\n   */\r\n  getKonvaLayer() {\r\n    // there should only be one layer\r\n    return this.#konvaStage.getLayers()[0];\r\n  }\r\n\r\n  /**\r\n   * Get the draw controller.\r\n   *\r\n   * @returns {object} The controller.\r\n   */\r\n  getDrawController() {\r\n    return this.#drawController;\r\n  }\r\n\r\n  /**\r\n   * Set the plane helper.\r\n   *\r\n   * @param {object} helper The helper.\r\n   */\r\n  setPlaneHelper(helper) {\r\n    this.#planeHelper = helper;\r\n  }\r\n\r\n  // common layer methods [start] ---------------\r\n\r\n  /**\r\n   * Get the id of the layer.\r\n   *\r\n   * @returns {string} The string id.\r\n   */\r\n  getId() {\r\n    return this.#containerDiv.id;\r\n  }\r\n\r\n  /**\r\n   * Get the layer base size (without scale).\r\n   *\r\n   * @returns {object} The size as {x,y}.\r\n   */\r\n  getBaseSize() {\r\n    return this.#baseSize;\r\n  }\r\n\r\n  /**\r\n   * Get the layer opacity.\r\n   *\r\n   * @returns {number} The opacity ([0:1] range).\r\n   */\r\n  getOpacity() {\r\n    return this.#konvaStage.opacity();\r\n  }\r\n\r\n  /**\r\n   * Set the layer opacity.\r\n   *\r\n   * @param {number} alpha The opacity ([0:1] range).\r\n   */\r\n  setOpacity(alpha) {\r\n    this.#konvaStage.opacity(Math.min(Math.max(alpha, 0), 1));\r\n  }\r\n\r\n  /**\r\n   * Add a flip offset along the layer X axis.\r\n   */\r\n  addFlipOffsetX() {\r\n    // flip offset\r\n    const scale = this.#konvaStage.scale();\r\n    const size = this.#konvaStage.size();\r\n    this.#flipOffset.x += size.width / scale.x;\r\n    // apply\r\n    const offset = this.#konvaStage.offset();\r\n    offset.x += this.#flipOffset.x;\r\n    this.#konvaStage.offset(offset);\r\n  }\r\n\r\n  /**\r\n   * Add a flip offset along the layer Y axis.\r\n   */\r\n  addFlipOffsetY() {\r\n    // flip offset\r\n    const scale = this.#konvaStage.scale();\r\n    const size = this.#konvaStage.size();\r\n    this.#flipOffset.y += size.height / scale.y;\r\n    // apply\r\n    const offset = this.#konvaStage.offset();\r\n    offset.y += this.#flipOffset.y;\r\n    this.#konvaStage.offset(offset);\r\n  }\r\n\r\n  /**\r\n   * Flip the scale along the layer X axis.\r\n   */\r\n  flipScaleX() {\r\n    this.#flipScale.x *= -1;\r\n  }\r\n\r\n  /**\r\n   * Flip the scale along the layer Y axis.\r\n   */\r\n  flipScaleY() {\r\n    this.#flipScale.y *= -1;\r\n  }\r\n\r\n  /**\r\n   * Flip the scale along the layer Z axis.\r\n   */\r\n  flipScaleZ() {\r\n    this.#flipScale.z *= -1;\r\n  }\r\n\r\n  /**\r\n   * Set the layer scale.\r\n   *\r\n   * @param {object} newScale The scale as {x,y}.\r\n   * @param {Point3D} [center] The scale center.\r\n   */\r\n  setScale(newScale, center) {\r\n    const orientedNewScale =\r\n      this.#planeHelper.getTargetOrientedPositiveXYZ({\r\n        x: newScale.x * this.#flipScale.x,\r\n        y: newScale.y * this.#flipScale.y,\r\n        z: newScale.z * this.#flipScale.z,\r\n      });\r\n    const finalNewScale = {\r\n      x: this.#fitScale.x * orientedNewScale.x,\r\n      y: this.#fitScale.y * orientedNewScale.y\r\n    };\r\n\r\n    const offset = this.#konvaStage.offset();\r\n\r\n    if (Math.abs(newScale.x) === 1 &&\r\n      Math.abs(newScale.y) === 1 &&\r\n      Math.abs(newScale.z) === 1) {\r\n      // reset zoom offset for scale=1\r\n      const resetOffset = {\r\n        x: offset.x - this.#zoomOffset.x,\r\n        y: offset.y - this.#zoomOffset.y\r\n      };\r\n      // store new offset\r\n      this.#zoomOffset = {x: 0, y: 0};\r\n      this.#konvaStage.offset(resetOffset);\r\n    } else {\r\n      if (typeof center !== 'undefined') {\r\n        let worldCenter = this.#planeHelper.getPlaneOffsetFromOffset3D({\r\n          x: center.getX(),\r\n          y: center.getY(),\r\n          z: center.getZ()\r\n        });\r\n        // center was obtained with viewLayer.displayToMainPlanePos\r\n        // compensated for baseOffset\r\n        // TODO: justify...\r\n        worldCenter = {\r\n          x: worldCenter.x + this.#baseOffset.x,\r\n          y: worldCenter.y + this.#baseOffset.y\r\n        };\r\n\r\n        const newOffset = getScaledOffset(\r\n          offset, this.#konvaStage.scale(), finalNewScale, worldCenter);\r\n\r\n        const newZoomOffset = {\r\n          x: this.#zoomOffset.x + newOffset.x - offset.x,\r\n          y: this.#zoomOffset.y + newOffset.y - offset.y\r\n        };\r\n        // store new offset\r\n        this.#zoomOffset = newZoomOffset;\r\n        this.#konvaStage.offset(newOffset);\r\n      }\r\n    }\r\n\r\n    this.#konvaStage.scale(finalNewScale);\r\n    // update labels\r\n    this.#updateLabelScale(finalNewScale);\r\n  }\r\n\r\n  /**\r\n   * Set the layer offset.\r\n   *\r\n   * @param {object} newOffset The offset as {x,y}.\r\n   */\r\n  setOffset(newOffset) {\r\n    const planeNewOffset =\r\n      this.#planeHelper.getPlaneOffsetFromOffset3D(newOffset);\r\n    this.#konvaStage.offset({\r\n      x: planeNewOffset.x +\r\n        this.#viewOffset.x +\r\n        this.#baseOffset.x +\r\n        this.#zoomOffset.x +\r\n        this.#flipOffset.x,\r\n      y: planeNewOffset.y +\r\n        this.#viewOffset.y +\r\n        this.#baseOffset.y +\r\n        this.#zoomOffset.y +\r\n        this.#flipOffset.y\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the base layer offset. Updates the layer offset.\r\n   *\r\n   * @param {Vector3D} scrollOffset The scroll offset vector.\r\n   * @param {Vector3D} planeOffset The plane offset vector.\r\n   * @returns {boolean} True if the offset was updated.\r\n   */\r\n  setBaseOffset(scrollOffset, planeOffset) {\r\n    const scrollIndex = this.#planeHelper.getNativeScrollIndex();\r\n    const newOffset = this.#planeHelper.getPlaneOffsetFromOffset3D({\r\n      x: scrollIndex === 0 ? scrollOffset.getX() : planeOffset.getX(),\r\n      y: scrollIndex === 1 ? scrollOffset.getY() : planeOffset.getY(),\r\n      z: scrollIndex === 2 ? scrollOffset.getZ() : planeOffset.getZ(),\r\n    });\r\n    const needsUpdate = this.#baseOffset.x !== newOffset.x ||\r\n      this.#baseOffset.y !== newOffset.y;\r\n    // reset offset if needed\r\n    if (needsUpdate) {\r\n      const offset = this.#konvaStage.offset();\r\n      this.#konvaStage.offset({\r\n        x: offset.x - this.#baseOffset.x + newOffset.x,\r\n        y: offset.y - this.#baseOffset.y + newOffset.y\r\n      });\r\n      this.#baseOffset = newOffset;\r\n    }\r\n    return needsUpdate;\r\n  }\r\n\r\n  /**\r\n   * Display the layer.\r\n   *\r\n   * @param {boolean} flag Whether to display the layer or not.\r\n   */\r\n  display(flag) {\r\n    this.#containerDiv.style.display = flag ? '' : 'none';\r\n  }\r\n\r\n  /**\r\n   * Check if the layer is visible.\r\n   *\r\n   * @returns {boolean} True if the layer is visible.\r\n   */\r\n  isVisible() {\r\n    return this.#containerDiv.style.display === '';\r\n  }\r\n\r\n  /**\r\n   * Draw the content (imageData) of the layer.\r\n   * The imageData variable needs to be set\r\n   */\r\n  draw() {\r\n    this.#konvaStage.draw();\r\n  }\r\n\r\n  /**\r\n   * Initialise the layer: set the canvas and context\r\n   *\r\n   * @param {object} size The image size as {x,y}.\r\n   * @param {object} spacing The image spacing as {x,y}.\r\n   * @param {string} dataId The associated data id.\r\n   */\r\n  initialise(size, spacing, dataId) {\r\n    // set locals\r\n    this.#baseSize = size;\r\n    this.#baseSpacing = spacing;\r\n    this.#dataId = dataId;\r\n\r\n    // create stage\r\n    this.#konvaStage = new Konva.Stage({\r\n      container: this.#containerDiv,\r\n      width: this.#baseSize.x,\r\n      height: this.#baseSize.y,\r\n      listening: false\r\n    });\r\n    // reset style\r\n    // (avoids a not needed vertical scrollbar)\r\n    this.#konvaStage.getContent().setAttribute('style', '');\r\n\r\n    // create layer\r\n    const konvaLayer = new Konva.Layer({\r\n      listening: false,\r\n      visible: true\r\n    });\r\n    this.#konvaStage.add(konvaLayer);\r\n\r\n    // create draw controller\r\n    this.#drawController = new DrawController(this);\r\n  }\r\n\r\n  /**\r\n   * Fit the layer to its parent container.\r\n   *\r\n   * @param {number} fitScale1D The 1D fit scale.\r\n   * @param {object} fitSize The fit size as {x,y}.\r\n   * @param {object} fitOffset The fit offset as {x,y}.\r\n   */\r\n  fitToContainer(fitScale1D, fitSize, fitOffset) {\r\n    // update konva\r\n    this.#konvaStage.width(fitSize.x);\r\n    this.#konvaStage.height(fitSize.y);\r\n\r\n    // previous scale without fit\r\n    const previousScale = {\r\n      x: this.#konvaStage.scale().x / this.#fitScale.x,\r\n      y: this.#konvaStage.scale().y / this.#fitScale.y\r\n    };\r\n    // update fit scale\r\n    const previousFitScale = this.#fitScale;\r\n    this.#fitScale = {\r\n      x: fitScale1D * this.#baseSpacing.x,\r\n      y: fitScale1D * this.#baseSpacing.y\r\n    };\r\n    // update scale\r\n    this.#konvaStage.scale({\r\n      x: previousScale.x * this.#fitScale.x,\r\n      y: previousScale.y * this.#fitScale.y\r\n    });\r\n\r\n    // update offsets\r\n    this.#viewOffset = {\r\n      x: fitOffset.x / this.#fitScale.x,\r\n      y: fitOffset.y / this.#fitScale.y\r\n    };\r\n    this.#flipOffset = {\r\n      x: this.#flipOffset.x * previousFitScale.x / this.#fitScale.x,\r\n      y: this.#flipOffset.y * previousFitScale.y / this.#fitScale.y\r\n    };\r\n\r\n    this.#konvaStage.offset({\r\n      x: this.#viewOffset.x +\r\n        this.#baseOffset.x +\r\n        this.#zoomOffset.x +\r\n        this.#flipOffset.x,\r\n      y: this.#viewOffset.y +\r\n        this.#baseOffset.y +\r\n        this.#zoomOffset.y +\r\n        this.#flipOffset.y\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Check the visibility of a given group.\r\n   *\r\n   * @param {string} id The id of the group.\r\n   * @returns {boolean} True if the group is visible.\r\n   */\r\n  isGroupVisible(id) {\r\n    // get the group\r\n    const group = this.#drawController.getGroup(id);\r\n    if (typeof group === 'undefined') {\r\n      return false;\r\n    }\r\n    // get visibility\r\n    return group.isVisible();\r\n  }\r\n\r\n  /**\r\n   * Toggle the visibility of a given group.\r\n   *\r\n   * @param {string} id The id of the group.\r\n   * @returns {boolean} False if the group cannot be found.\r\n   */\r\n  toggleGroupVisibility(id) {\r\n    // get the group\r\n    const group = this.#drawController.getGroup(id);\r\n    if (typeof group === 'undefined') {\r\n      return false;\r\n    }\r\n    // toggle visible\r\n    group.visible(!group.isVisible());\r\n\r\n    // udpate\r\n    this.draw();\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Delete a Draw from the stage.\r\n   *\r\n   * @param {string} id The id of the group to delete.\r\n   * @param {object} exeCallback The callback to call once the\r\n   *  DeleteCommand has been executed.\r\n   */\r\n  deleteDraw(id, exeCallback) {\r\n    if (typeof this.#drawController !== 'undefined') {\r\n      this.#drawController.deleteDraw(id, this.#fireEvent, exeCallback);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete all Draws from the stage.\r\n   *\r\n   * @param {object} exeCallback The callback to call once the\r\n   *  DeleteCommand has been executed.\r\n   */\r\n  deleteDraws(exeCallback) {\r\n    if (typeof this.#drawController !== 'undefined') {\r\n      this.#drawController.deleteDraws(this.#fireEvent, exeCallback);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the total number of draws of this layer\r\n   * (at all positions).\r\n   *\r\n   * @returns {number|undefined} The total number of draws.\r\n   */\r\n  getNumberOfDraws() {\r\n    let res;\r\n    if (typeof this.#drawController !== 'undefined') {\r\n      res = this.#drawController.getNumberOfDraws();\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Enable and listen to container interaction events.\r\n   */\r\n  bindInteraction() {\r\n    this.#konvaStage.listening(true);\r\n    // allow pointer events\r\n    this.#containerDiv.style.pointerEvents = 'auto';\r\n    // interaction events\r\n    const names = InteractionEventNames;\r\n    for (let i = 0; i < names.length; ++i) {\r\n      this.#containerDiv.addEventListener(names[i], this.#fireEvent);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disable and stop listening to container interaction events.\r\n   */\r\n  unbindInteraction() {\r\n    this.#konvaStage.listening(false);\r\n    // disable pointer events\r\n    this.#containerDiv.style.pointerEvents = 'none';\r\n    // interaction events\r\n    const names = InteractionEventNames;\r\n    for (let i = 0; i < names.length; ++i) {\r\n      this.#containerDiv.removeEventListener(names[i], this.#fireEvent);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the current position.\r\n   *\r\n   * @param {Point} position The new position.\r\n   * @param {Index} index The new index.\r\n   * @returns {boolean} True if the position was updated.\r\n   */\r\n  setCurrentPosition(position, index) {\r\n    this.getDrawController().activateDrawLayer(\r\n      index, this.#planeHelper.getScrollIndex());\r\n    // TODO: add check\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    event.srclayerid = this.getId();\r\n    event.dataid = this.#dataId;\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n  // common layer methods [end] ---------------\r\n\r\n  /**\r\n   * Update label scale: compensate for it so\r\n   *   that label size stays visually the same.\r\n   *\r\n   * @param {object} scale The scale to compensate for as {x,y}.\r\n   */\r\n  #updateLabelScale(scale) {\r\n    // same formula as in style::applyZoomScale:\r\n    // compensate for scale and times 2 so that font 10 looks like a 10\r\n    const ratioX = 2 / scale.x;\r\n    const ratioY = 2 / scale.y;\r\n    // compensate scale for labels\r\n    const labels = this.#konvaStage.find('Label');\r\n    for (let i = 0; i < labels.length; ++i) {\r\n      labels[i].scale({x: ratioX, y: ratioY});\r\n    }\r\n  }\r\n\r\n} // DrawLayer class\r\n","import {Point, Point3D} from '../math/point';\r\nimport {WindowLevel} from '../image/windowLevel';\r\nimport {LayerGroup} from './layerGroup';\r\nimport {logger} from '../utils/logger';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ViewLayer} from '../gui/viewLayer';\r\nimport {DrawLayer} from '../gui/drawLayer';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Window/level binder.\r\n */\r\nexport class WindowLevelBinder {\r\n  getEventType = function () {\r\n    return 'wlchange';\r\n  };\r\n  getCallback = function (layerGroup) {\r\n    return function (event) {\r\n      const viewLayers = layerGroup.getViewLayersByDataId(event.dataid);\r\n      if (viewLayers.length !== 0) {\r\n        const vc = viewLayers[0].getViewController();\r\n        const wl = new WindowLevel(event.value[0], event.value[1]);\r\n        vc.setWindowLevel(wl);\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * Colour map binder.\r\n */\r\nexport class ColourMapBinder {\r\n  getEventType = function () {\r\n    return 'colourmapchange';\r\n  };\r\n  getCallback = function (layerGroup) {\r\n    return function (event) {\r\n      const viewLayers = layerGroup.getViewLayersByDataId(event.dataid);\r\n      if (viewLayers.length !== 0) {\r\n        const vc = viewLayers[0].getViewController();\r\n        vc.setColourMap(event.value[0]);\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * Position binder.\r\n */\r\nexport class PositionBinder {\r\n  getEventType = function () {\r\n    return 'positionchange';\r\n  };\r\n  getCallback = function (layerGroup) {\r\n    return function (event) {\r\n      const pointValues = event.value[1];\r\n      const vc = layerGroup.getActiveViewLayer().getViewController();\r\n      // handle different number of dimensions\r\n      const currentPos = vc.getCurrentPosition();\r\n      const currentDims = currentPos.length();\r\n      const inputDims = pointValues.length;\r\n      if (inputDims !== currentDims) {\r\n        if (inputDims === currentDims - 1) {\r\n          // add missing dim, for ex: input 3D -> current 4D\r\n          pointValues.push(currentPos.get(currentDims - 1));\r\n        } else if (inputDims === currentDims + 1) {\r\n          // remove extra dim, for ex: input 4D -> current 3D\r\n          pointValues.pop();\r\n        }\r\n      }\r\n      vc.setCurrentPosition(new Point(pointValues));\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * Zoom binder.\r\n */\r\nexport class ZoomBinder {\r\n  getEventType = function () {\r\n    return 'zoomchange';\r\n  };\r\n  getCallback = function (layerGroup) {\r\n    return function (event) {\r\n      const scale = {\r\n        x: event.value[0],\r\n        y: event.value[1],\r\n        z: event.value[2]\r\n      };\r\n      let center;\r\n      if (event.value.length === 6) {\r\n        center = new Point3D(\r\n          event.value[3],\r\n          event.value[4],\r\n          event.value[5]\r\n        );\r\n      }\r\n      layerGroup.setScale(scale, center);\r\n      layerGroup.draw();\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * Offset binder.\r\n */\r\nexport class OffsetBinder {\r\n  getEventType = function () {\r\n    return 'offsetchange';\r\n  };\r\n  getCallback = function (layerGroup) {\r\n    return function (event) {\r\n      layerGroup.setOffset({\r\n        x: event.value[0],\r\n        y: event.value[1],\r\n        z: event.value[2]\r\n      });\r\n      layerGroup.draw();\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * Opacity binder. Only propagates to view layers of the same data.\r\n */\r\nexport class OpacityBinder {\r\n  getEventType = function () {\r\n    return 'opacitychange';\r\n  };\r\n  getCallback = function (layerGroup) {\r\n    return function (event) {\r\n      // exit if no data id\r\n      if (typeof event.dataid === 'undefined') {\r\n        return;\r\n      }\r\n      // propagate to first view layer\r\n      const viewLayers = layerGroup.getViewLayersByDataId(event.dataid);\r\n      if (viewLayers.length !== 0 &&\r\n        layerGroup.getNumberOfViewLayers() > 1) {\r\n        viewLayers[0].setOpacity(event.value);\r\n        viewLayers[0].draw();\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * List of binders.\r\n */\r\nexport const binderList = {\r\n  WindowLevelBinder,\r\n  PositionBinder,\r\n  ZoomBinder,\r\n  OffsetBinder,\r\n  OpacityBinder,\r\n  ColourMapBinder\r\n};\r\n\r\n/**\r\n * Stage: controls a list of layer groups and their\r\n * synchronisation.\r\n */\r\nexport class Stage {\r\n\r\n  /**\r\n   * Associated layer groups.\r\n   *\r\n   * @type {LayerGroup[]}\r\n   */\r\n  #layerGroups = [];\r\n\r\n  /**\r\n   * Active layer group index.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #activeLayerGroupIndex = null;\r\n\r\n  /**\r\n   * Image smoothing flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #imageSmoothing = false;\r\n\r\n  // layer group binders\r\n  #binders = [];\r\n  // binder callbacks\r\n  #callbackStore = null;\r\n\r\n  /**\r\n   * Get the layer group at the given index.\r\n   *\r\n   * @param {number} index The index.\r\n   * @returns {LayerGroup} The layer group.\r\n   */\r\n  getLayerGroup(index) {\r\n    return this.#layerGroups[index];\r\n  }\r\n\r\n  /**\r\n   * Get the number of layer groups that form the stage.\r\n   *\r\n   * @returns {number} The number of layer groups.\r\n   */\r\n  getNumberOfLayerGroups() {\r\n    return this.#layerGroups.length;\r\n  }\r\n\r\n  /**\r\n   * Get the active layer group.\r\n   *\r\n   * @returns {LayerGroup} The layer group.\r\n   */\r\n  getActiveLayerGroup() {\r\n    return this.getLayerGroup(this.#activeLayerGroupIndex);\r\n  }\r\n\r\n  /**\r\n   * Set the active layer group.\r\n   *\r\n   * @param {number} index The layer group index.\r\n   */\r\n  setActiveLayerGroup(index) {\r\n    if (typeof this.getLayerGroup(index) !== 'undefined') {\r\n      this.#activeLayerGroupIndex = index;\r\n    } else {\r\n      logger.warn('No layer group to set as active with index: ' +\r\n        index);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the view layers associated to a data id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {ViewLayer[]} The layers.\r\n   */\r\n  getViewLayersByDataId(dataId) {\r\n    let res = [];\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      res = res.concat(this.#layerGroups[i].getViewLayersByDataId(dataId));\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Get the draw layers associated to a data id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {DrawLayer[]} The layers.\r\n   */\r\n  getDrawLayersByDataId(dataId) {\r\n    let res = [];\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      res = res.concat(this.#layerGroups[i].getDrawLayersByDataId(dataId));\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Add a layer group to the list.\r\n   *\r\n   * @param {object} htmlElement The HTML element of the layer group.\r\n   * @returns {LayerGroup} The newly created layer group.\r\n   */\r\n  addLayerGroup(htmlElement) {\r\n    this.#activeLayerGroupIndex = this.#layerGroups.length;\r\n    const layerGroup = new LayerGroup(htmlElement);\r\n    layerGroup.setImageSmoothing(this.#imageSmoothing);\r\n    // add to storage\r\n    const isBound = this.#callbackStore && this.#callbackStore.length !== 0;\r\n    if (isBound) {\r\n      this.unbindLayerGroups();\r\n    }\r\n    this.#layerGroups.push(layerGroup);\r\n    if (isBound) {\r\n      this.bindLayerGroups();\r\n    }\r\n    // return created group\r\n    return layerGroup;\r\n  }\r\n\r\n  /**\r\n   * Get a layer group from an HTML element id.\r\n   *\r\n   * @param {string} id The element id to find.\r\n   * @returns {LayerGroup} The layer group.\r\n   */\r\n  getLayerGroupByDivId(id) {\r\n    return this.#layerGroups.find(function (item) {\r\n      return item.getDivId() === id;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the layer groups binders.\r\n   *\r\n   * @param {Array} list The list of binder objects.\r\n   */\r\n  setBinders(list) {\r\n    if (typeof list === 'undefined' || list === null) {\r\n      throw new Error('Cannot set null or undefined binders');\r\n    }\r\n    if (this.#binders.length !== 0) {\r\n      this.unbindLayerGroups();\r\n    }\r\n    this.#binders = list.slice();\r\n    this.bindLayerGroups();\r\n  }\r\n\r\n  /**\r\n   * Empty the layer group list.\r\n   */\r\n  empty() {\r\n    this.unbindLayerGroups();\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      this.#layerGroups[i].empty();\r\n    }\r\n    this.#layerGroups = [];\r\n    this.#activeLayerGroupIndex = null;\r\n  }\r\n\r\n  /**\r\n   * Remove a layer group from this stage.\r\n   *\r\n   * @param {LayerGroup} layerGroup The layer group to remove.\r\n   */\r\n  removeLayerGroup(layerGroup) {\r\n    // find layer\r\n    const index = this.#layerGroups.findIndex((item) => item === layerGroup);\r\n    if (index === -1) {\r\n      throw new Error('Cannot find layerGroup to remove');\r\n    }\r\n    // unbind\r\n    this.unbindLayerGroups();\r\n    // empty layer group\r\n    layerGroup.empty();\r\n    // remove from storage\r\n    this.#layerGroups.splice(index, 1);\r\n    // update active index\r\n    if (this.#activeLayerGroupIndex === index) {\r\n      this.#activeLayerGroupIndex = undefined;\r\n    }\r\n    // bind\r\n    this.bindLayerGroups();\r\n  }\r\n\r\n  /**\r\n   * Reset the stage: calls reset on all layer groups.\r\n   */\r\n  reset() {\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      this.#layerGroups[i].reset();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Draw the stage: calls draw on all layer groups.\r\n   */\r\n  draw() {\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      this.#layerGroups[i].draw();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Synchronise the fit scale of the group layers.\r\n   */\r\n  syncLayerGroupScale() {\r\n    let minScale;\r\n    const hasScale = [];\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      const scale = this.#layerGroups[i].calculateFitScale();\r\n      if (typeof scale !== 'undefined') {\r\n        hasScale.push(i);\r\n        if (typeof minScale === 'undefined' || scale < minScale) {\r\n          minScale = scale;\r\n        }\r\n      }\r\n    }\r\n    // exit if no scale\r\n    if (typeof minScale === 'undefined') {\r\n      return;\r\n    }\r\n    // apply min scale to layers\r\n    for (let j = 0; j < this.#layerGroups.length; ++j) {\r\n      if (hasScale.includes(j)) {\r\n        this.#layerGroups[j].setFitScale(minScale);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Bind the layer groups of the stage.\r\n   */\r\n  bindLayerGroups() {\r\n    if (this.#layerGroups.length === 0 ||\r\n      this.#layerGroups.length === 1 ||\r\n      this.#binders.length === 0) {\r\n      return;\r\n    }\r\n    // create callback store\r\n    this.#callbackStore = new Array(this.#layerGroups.length);\r\n    // add listeners\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      for (let j = 0; j < this.#binders.length; ++j) {\r\n        this.#addEventListeners(i, this.#binders[j]);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind the layer groups of the stage.\r\n   */\r\n  unbindLayerGroups() {\r\n    if (this.#layerGroups.length === 0 ||\r\n      this.#layerGroups.length === 1 ||\r\n      this.#binders.length === 0 ||\r\n      !this.#callbackStore) {\r\n      return;\r\n    }\r\n    // remove listeners\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      for (let j = 0; j < this.#binders.length; ++j) {\r\n        this.#removeEventListeners(i, this.#binders[j]);\r\n      }\r\n    }\r\n    // clear callback store\r\n    this.#callbackStore = null;\r\n  }\r\n\r\n  /**\r\n   * Set the imageSmoothing flag value.\r\n   *\r\n   * @param {boolean} flag True to enable smoothing.\r\n   */\r\n  setImageSmoothing(flag) {\r\n    this.#imageSmoothing = flag;\r\n    // set for existing layer groups\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      this.#layerGroups[i].setImageSmoothing(flag);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the binder callback function for a given layer group index.\r\n   * The function is created if not yet stored.\r\n   *\r\n   * @param {object} binder The layer binder.\r\n   * @param {number} index The index of the associated layer group.\r\n   * @returns {Function} The binder function.\r\n   */\r\n  #getBinderCallback(binder, index) {\r\n    if (typeof this.#callbackStore[index] === 'undefined') {\r\n      this.#callbackStore[index] = [];\r\n    }\r\n    const store = this.#callbackStore[index];\r\n    let binderObj = store.find(function (elem) {\r\n      return elem.binder === binder;\r\n    });\r\n    if (typeof binderObj === 'undefined') {\r\n      // create new callback object\r\n      binderObj = {\r\n        binder: binder,\r\n        callback: (event) => {\r\n          // stop listeners\r\n          this.#removeEventListeners(index, binder);\r\n          // apply binder\r\n          binder.getCallback(this.#layerGroups[index])(event);\r\n          // re-start listeners\r\n          this.#addEventListeners(index, binder);\r\n        }\r\n      };\r\n      this.#callbackStore[index].push(binderObj);\r\n    }\r\n    return binderObj.callback;\r\n  }\r\n\r\n  /**\r\n   * Add event listeners for a given layer group index and binder.\r\n   *\r\n   * @param {number} index The index of the associated layer group.\r\n   * @param {object} binder The layer binder.\r\n   */\r\n  #addEventListeners(index, binder) {\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      if (i !== index) {\r\n        this.#layerGroups[index].addEventListener(\r\n          binder.getEventType(),\r\n          this.#getBinderCallback(binder, i)\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove event listeners for a given layer group index and binder.\r\n   *\r\n   * @param {number} index The index of the associated layer group.\r\n   * @param {object} binder The layer binder.\r\n   */\r\n  #removeEventListeners(index, binder) {\r\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\r\n      if (i !== index) {\r\n        this.#layerGroups[index].removeEventListener(\r\n          binder.getEventType(),\r\n          this.#getBinderCallback(binder, i)\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n} // class Stage\r\n","import {Index} from '../math/index';\r\nimport {colourNameToHex} from '../utils/colour';\r\nimport {WindowLevel} from '../image/windowLevel';\r\n\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * State class.\r\n * Saves: data url/path, display info.\r\n *\r\n * History:\r\n * - v0.5 (dwv 0.30.0, 12/2021)\r\n *   - store position as array\r\n *   - new draw position group key\r\n * - v0.4 (dwv 0.29.0, 06/2021)\r\n *   - move drawing details into meta property\r\n *   - remove scale center and translation, add offset\r\n * - v0.3 (dwv v0.23.0, 03/2018)\r\n *   - new drawing structure, drawings are now the full layer object and\r\n *     using toObject to avoid saving a string representation\r\n *   - new details structure: simple array of objects referenced by draw ids\r\n * - v0.2 (dwv v0.17.0, 12/2016)\r\n *   - adds draw details: array [nslices][nframes] of detail objects\r\n * - v0.1 (dwv v0.15.0, 07/2016)\r\n *   - adds version\r\n *   - drawings: array [nslices][nframes] with all groups\r\n * - initial release (dwv v0.10.0, 05/2015), no version number...\r\n *   - content: window-center, window-width, position, scale,\r\n *       scaleCenter, translation, drawings\r\n *   - drawings: array [nslices] with all groups\r\n */\r\nexport class State {\r\n  /**\r\n   * Save the application state as JSON.\r\n   *\r\n   * @param {App} app The associated application.\r\n   * @returns {string} The state as a JSON string.\r\n   */\r\n  toJSON(app) {\r\n    const layerGroup = app.getActiveLayerGroup();\r\n    const viewController =\r\n      layerGroup.getActiveViewLayer().getViewController();\r\n    const position = viewController.getCurrentIndex();\r\n    const drawLayer = layerGroup.getActiveDrawLayer();\r\n    const drawController = drawLayer.getDrawController();\r\n    const wl = viewController.getWindowLevel();\r\n    // return a JSON string\r\n    return JSON.stringify({\r\n      version: '0.5',\r\n      'window-center': wl.center,\r\n      'window-width': wl.width,\r\n      position: position.getValues(),\r\n      scale: app.getAddedScale(),\r\n      offset: app.getOffset(),\r\n      drawings: drawLayer.getKonvaLayer().toObject(),\r\n      drawingsDetails: drawController.getDrawStoreDetails()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Load an application state from JSON.\r\n   *\r\n   * @param {string} json The state as a JSON string.\r\n   * @returns {object} The state object.\r\n   */\r\n  fromJSON(json) {\r\n    const data = JSON.parse(json);\r\n    let res = null;\r\n    if (data.version === '0.1') {\r\n      res = this.#readV01(data);\r\n    } else if (data.version === '0.2') {\r\n      res = this.#readV02(data);\r\n    } else if (data.version === '0.3') {\r\n      res = this.#readV03(data);\r\n    } else if (data.version === '0.4') {\r\n      res = this.#readV04(data);\r\n    } else if (data.version === '0.5') {\r\n      res = this.#readV05(data);\r\n    } else {\r\n      throw new Error('Unknown state file format version: \\'' +\r\n        data.version + '\\'.');\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Load an application state from JSON.\r\n   *\r\n   * @param {App} app The app to apply the state to.\r\n   * @param {object} data The state data.\r\n   */\r\n  apply(app, data) {\r\n    const layerGroup = app.getActiveLayerGroup();\r\n    const viewController =\r\n      layerGroup.getActiveViewLayer().getViewController();\r\n    // display\r\n    const wl = new WindowLevel(data['window-center'], data['window-width']);\r\n    viewController.setWindowLevel(wl);\r\n    // position is index...\r\n    viewController.setCurrentIndex(new Index(data.position));\r\n    // apply saved scale on top of current base one\r\n    const baseScale = app.getActiveLayerGroup().getBaseScale();\r\n    let scale = null;\r\n    let offset = null;\r\n    if (typeof data.scaleCenter !== 'undefined') {\r\n      scale = {\r\n        x: data.scale * baseScale.x,\r\n        y: data.scale * baseScale.y,\r\n        z: 1\r\n      };\r\n      // ---- transform translation (now) ----\r\n      // Tx = -offset.x * scale.x\r\n      // => offset.x = -Tx / scale.x\r\n      // ---- transform translation (before) ----\r\n      // origin.x = centerX - (centerX - origin.x) * (newZoomX / zoom.x);\r\n      // (zoom.x -> initial zoom = base scale, origin.x = 0)\r\n      // Tx = origin.x + (trans.x * zoom.x)\r\n      const originX = data.scaleCenter.x - data.scaleCenter.x * data.scale;\r\n      const originY = data.scaleCenter.y - data.scaleCenter.y * data.scale;\r\n      const oldTx = originX + data.translation.x * scale.x;\r\n      const oldTy = originY + data.translation.y * scale.y;\r\n      offset = {\r\n        x: -oldTx / scale.x,\r\n        y: -oldTy / scale.y,\r\n        z: 0\r\n      };\r\n    } else {\r\n      scale = {\r\n        x: data.scale.x * baseScale.x,\r\n        y: data.scale.y * baseScale.y,\r\n        z: baseScale.z\r\n      };\r\n      offset = {\r\n        x: data.offset.x,\r\n        y: data.offset.y,\r\n        z: 0\r\n      };\r\n    }\r\n    app.getActiveLayerGroup().setScale(scale);\r\n    app.getActiveLayerGroup().setOffset(offset);\r\n    // render to draw the view layer\r\n    app.render(app.getDataIds()[0]); //todo: fix\r\n    // drawings (will draw the draw layer)\r\n    app.setDrawings(data.drawings, data.drawingsDetails);\r\n  }\r\n\r\n  /**\r\n   * Read an application state from an Object in v0.1 format.\r\n   *\r\n   * @param {object} data The Object representation of the state.\r\n   * @returns {object} The state object.\r\n   */\r\n  #readV01(data) {\r\n    // v0.1 -> v0.2\r\n    const v02DAndD = v01Tov02DrawingsAndDetails(data.drawings);\r\n    // v0.2 -> v0.3, v0.4\r\n    data.drawings = v02Tov03Drawings(v02DAndD.drawings).toObject();\r\n    data.drawingsDetails = v03Tov04DrawingsDetails(\r\n      v02DAndD.drawingsDetails);\r\n    // v0.4 -> v0.5\r\n    data = v04Tov05Data(data);\r\n    data.drawings = v04Tov05Drawings(data.drawings);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read an application state from an Object in v0.2 format.\r\n   *\r\n   * @param {object} data The Object representation of the state.\r\n   * @returns {object} The state object.\r\n   */\r\n  #readV02(data) {\r\n    // v0.2 -> v0.3, v0.4\r\n    data.drawings = v02Tov03Drawings(data.drawings).toObject();\r\n    data.drawingsDetails = v03Tov04DrawingsDetails(\r\n      v02Tov03DrawingsDetails(data.drawingsDetails));\r\n    // v0.4 -> v0.5\r\n    data = v04Tov05Data(data);\r\n    data.drawings = v04Tov05Drawings(data.drawings);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read an application state from an Object in v0.3 format.\r\n   *\r\n   * @param {object} data The Object representation of the state.\r\n   * @returns {object} The state object.\r\n   */\r\n  #readV03(data) {\r\n    // v0.3 -> v0.4\r\n    data.drawingsDetails = v03Tov04DrawingsDetails(data.drawingsDetails);\r\n    // v0.4 -> v0.5\r\n    data = v04Tov05Data(data);\r\n    data.drawings = v04Tov05Drawings(data.drawings);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Read an application state from an Object in v0.4 format.\r\n   *\r\n   * @param {object} data The Object representation of the state.\r\n   * @returns {object} The state object.\r\n   */\r\n  #readV04(data) {\r\n    // v0.4 -> v0.5\r\n    data = v04Tov05Data(data);\r\n    data.drawings = v04Tov05Drawings(data.drawings);\r\n    return data;\r\n  }\r\n  /**\r\n   * Read an application state from an Object in v0.5 format.\r\n   *\r\n   * @param {object} data The Object representation of the state.\r\n   * @returns {object} The state object.\r\n   */\r\n  #readV05(data) {\r\n    return data;\r\n  }\r\n\r\n} // State class\r\n\r\n/**\r\n * Convert drawings from v0.2 to v0.3.\r\n * v0.2: one layer per slice/frame\r\n * v0.3: one layer, one group per slice. setDrawing expects the full stage\r\n *\r\n * @param {Array} drawings An array of drawings.\r\n * @returns {object} The layer with the converted drawings.\r\n */\r\nfunction v02Tov03Drawings(drawings) {\r\n  // Auxiliar variables\r\n  let group, groupShapes, parentGroup;\r\n  // Avoid errors when dropping multiple states\r\n  //drawLayer.getChildren().each(function(node){\r\n  //    node.visible(false);\r\n  //});\r\n\r\n  /**\r\n   * Get the draw group id for a given position.\r\n   *\r\n   * @param {Index} currentPosition The current position.\r\n   * @returns {string} The group id.\r\n   */\r\n  function getDrawPositionGroupId(currentPosition) {\r\n    const sliceNumber = currentPosition.get(2);\r\n    const frameNumber = currentPosition.length() === 4\r\n      ? currentPosition.get(3) : 0;\r\n    return 'slice-' + sliceNumber + '_frame-' + frameNumber;\r\n  }\r\n\r\n  const drawLayer = new Konva.Layer({\r\n    listening: false,\r\n    visible: true\r\n  });\r\n\r\n  // Get the positions-groups data\r\n  const groupDrawings = typeof drawings === 'string'\r\n    ? JSON.parse(drawings) : drawings;\r\n  // Iterate over each position-groups\r\n  for (let k = 0, lenk = groupDrawings.length; k < lenk; ++k) {\r\n    // Iterate over each frame\r\n    for (let f = 0, lenf = groupDrawings[k].length; f < lenf; ++f) {\r\n      groupShapes = groupDrawings[k][f];\r\n      if (groupShapes.length !== 0) {\r\n        // Create position-group set as visible and append it to drawLayer\r\n        parentGroup = new Konva.Group({\r\n          id: getDrawPositionGroupId(new Index([1, 1, k, f])),\r\n          name: 'position-group',\r\n          visible: false\r\n        });\r\n\r\n        // Iterate over shapes-group\r\n        for (let g = 0, leng = groupShapes.length; g < leng; ++g) {\r\n          // create the konva group\r\n          group = Konva.Node.create(groupShapes[g]);\r\n          // enforce draggable: only the shape was draggable in v0.2,\r\n          // now the whole group is.\r\n          group.draggable(true);\r\n          group.getChildren().forEach(function (gnode) {\r\n            gnode.draggable(false);\r\n          });\r\n          // add to position group\r\n          parentGroup.add(group);\r\n        }\r\n        // add to layer\r\n        drawLayer.add(parentGroup);\r\n      }\r\n    }\r\n  }\r\n\r\n  return drawLayer;\r\n}\r\n\r\n/**\r\n * Convert drawings from v0.1 to v0.2.\r\n * v0.1: text on its own\r\n * v0.2: text as part of label\r\n *\r\n * @param {Array} inputDrawings An array of drawings.\r\n * @returns {object} The converted drawings.\r\n */\r\nfunction v01Tov02DrawingsAndDetails(inputDrawings) {\r\n  const newDrawings = [];\r\n  const drawingsDetails = {};\r\n\r\n  let drawGroups;\r\n  let drawGroup;\r\n  // loop over each slice\r\n  for (let k = 0, lenk = inputDrawings.length; k < lenk; ++k) {\r\n    // loop over each frame\r\n    newDrawings[k] = [];\r\n    for (let f = 0, lenf = inputDrawings[k].length; f < lenf; ++f) {\r\n      // draw group\r\n      drawGroups = inputDrawings[k][f];\r\n      const newFrameDrawings = [];\r\n      // Iterate over shapes-group\r\n      for (let g = 0, leng = drawGroups.length; g < leng; ++g) {\r\n        // create konva group from input\r\n        drawGroup = Konva.Node.create(drawGroups[g]);\r\n        // force visible (not set in state)\r\n        drawGroup.visible(true);\r\n        // label position\r\n        let pos = {x: 0, y: 0};\r\n        // update shape colour\r\n        const kshape = drawGroup.getChildren(function (node) {\r\n          return node.name() === 'shape';\r\n        })[0];\r\n        kshape.stroke(colourNameToHex(kshape.stroke()));\r\n        // special line case\r\n        if (drawGroup.name() === 'line-group') {\r\n          // update name\r\n          drawGroup.name('ruler-group');\r\n          // add ticks\r\n          const ktick0 = new Konva.Line({\r\n            points: [kshape.points()[0],\r\n              kshape.points()[1],\r\n              kshape.points()[0],\r\n              kshape.points()[1]],\r\n            name: 'shape-tick0'\r\n          });\r\n          drawGroup.add(ktick0);\r\n          const ktick1 = new Konva.Line({\r\n            points: [kshape.points()[2],\r\n              kshape.points()[3],\r\n              kshape.points()[2],\r\n              kshape.points()[3]],\r\n            name: 'shape-tick1'\r\n          });\r\n          drawGroup.add(ktick1);\r\n        }\r\n        // special protractor case: update arc name\r\n        const karcs = drawGroup.getChildren(function (node) {\r\n          return node.name() === 'arc';\r\n        });\r\n        if (karcs.length === 1) {\r\n          karcs[0].name('shape-arc');\r\n        }\r\n        // get its text\r\n        const ktexts = drawGroup.getChildren(function (node) {\r\n          return node.name() === 'text';\r\n        });\r\n        // update text: move it into a label\r\n        let ktext = new Konva.Text({\r\n          name: 'text',\r\n          text: ''\r\n        });\r\n        if (ktexts.length === 1) {\r\n          pos.x = ktexts[0].x();\r\n          pos.y = ktexts[0].y();\r\n          // remove it from the group\r\n          ktexts[0].remove();\r\n          // use it\r\n          ktext = ktexts[0];\r\n        } else {\r\n          // use shape position if no text\r\n          if (kshape.points().length !== 0) {\r\n            pos = {x: kshape.points()[0],\r\n              y: kshape.points()[1]};\r\n          }\r\n        }\r\n        // create new label with text and tag\r\n        const klabel = new Konva.Label({\r\n          x: pos.x,\r\n          y: pos.y,\r\n          name: 'label'\r\n        });\r\n        klabel.add(ktext);\r\n        klabel.add(new Konva.Tag());\r\n        // add label to group\r\n        drawGroup.add(klabel);\r\n        // add group to list\r\n        newFrameDrawings.push(JSON.stringify(drawGroup.toObject()));\r\n\r\n        // create details (v0.3 format)\r\n        let textExpr = ktext.text();\r\n        const txtLen = textExpr.length;\r\n        let quant = null;\r\n        // adapt to text with flag\r\n        if (drawGroup.name() === 'ruler-group') {\r\n          quant = {\r\n            length: {\r\n              value: parseFloat(textExpr.substring(0, txtLen - 2)),\r\n              unit: textExpr.substring(-2)\r\n            }\r\n          };\r\n          textExpr = '{length}';\r\n        } else if (drawGroup.name() === 'ellipse-group' ||\r\n                    drawGroup.name() === 'rectangle-group') {\r\n          quant = {\r\n            surface: {\r\n              value: parseFloat(textExpr.substring(0, txtLen - 3)),\r\n              unit: textExpr.substring(-3)\r\n            }\r\n          };\r\n          textExpr = '{surface}';\r\n        } else if (drawGroup.name() === 'protractor-group' ||\r\n                    drawGroup.name() === 'rectangle-group') {\r\n          quant = {\r\n            angle: {\r\n              value: parseFloat(textExpr.substring(0, txtLen - 1)),\r\n              unit: textExpr.substring(-1)\r\n            }\r\n          };\r\n          textExpr = '{angle}';\r\n        }\r\n        // set details\r\n        drawingsDetails[drawGroup.id()] = {\r\n          textExpr: textExpr,\r\n          longText: '',\r\n          quant: quant\r\n        };\r\n\r\n      }\r\n      newDrawings[k].push(newFrameDrawings);\r\n    }\r\n  }\r\n\r\n  return {drawings: newDrawings, drawingsDetails: drawingsDetails};\r\n}\r\n\r\n/**\r\n * Convert drawing details from v0.2 to v0.3.\r\n * - v0.2: array [nslices][nframes] with all\r\n * - v0.3: simple array of objects referenced by draw ids\r\n *\r\n * @param {Array} details An array of drawing details.\r\n * @returns {object} The converted drawings.\r\n */\r\nfunction v02Tov03DrawingsDetails(details) {\r\n  const res = {};\r\n  // Get the positions-groups data\r\n  const groupDetails = typeof details === 'string'\r\n    ? JSON.parse(details) : details;\r\n  // Iterate over each position-groups\r\n  for (let k = 0, lenk = groupDetails.length; k < lenk; ++k) {\r\n    // Iterate over each frame\r\n    for (let f = 0, lenf = groupDetails[k].length; f < lenf; ++f) {\r\n      // Iterate over shapes-group\r\n      for (let g = 0, leng = groupDetails[k][f].length; g < leng; ++g) {\r\n        const group = groupDetails[k][f][g];\r\n        res[group.id] = {\r\n          textExpr: group.textExpr,\r\n          longText: group.longText,\r\n          quant: group.quant\r\n        };\r\n      }\r\n    }\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Convert drawing details from v0.3 to v0.4.\r\n * - v0.3: properties at group root\r\n * - v0.4: properties in group meta object\r\n *\r\n * @param {Array} details An array of drawing details.\r\n * @returns {object} The converted drawings.\r\n */\r\nfunction v03Tov04DrawingsDetails(details) {\r\n  const res = {};\r\n  const keys = Object.keys(details);\r\n  // Iterate over each position-groups\r\n  for (let k = 0, lenk = keys.length; k < lenk; ++k) {\r\n    const detail = details[keys[k]];\r\n    res[keys[k]] = {\r\n      meta: {\r\n        textExpr: detail.textExpr,\r\n        longText: detail.longText,\r\n        quantification: detail.quant\r\n      }\r\n    };\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Convert drawing from v0.4 to v0.5.\r\n * - v0.4: position as object\r\n * - v0.5: position as array\r\n *\r\n * @param {object} data An array of drawing.\r\n * @returns {object} The converted drawings.\r\n */\r\nfunction v04Tov05Data(data) {\r\n  const pos = data.position;\r\n  data.position = [pos.i, pos.j, pos.k];\r\n  return data;\r\n}\r\n\r\n/**\r\n * Convert drawing from v0.4 to v0.5.\r\n * - v0.4: draw id as 'slice-0_frame-1'\r\n * - v0.5: draw id as '#2-0_#3-1''\r\n *\r\n * @param {object} inputDrawings An array of drawing.\r\n * @returns {object} The converted drawings.\r\n */\r\nfunction v04Tov05Drawings(inputDrawings) {\r\n  // Iterate over each position-groups\r\n  const posGroups = inputDrawings.children;\r\n  for (let k = 0, lenk = posGroups.length; k < lenk; ++k) {\r\n    const posGroup = posGroups[k];\r\n    const id = posGroup.attrs.id;\r\n    const ids = id.split('_');\r\n    const sliceNumber = parseInt(ids[0].substring(6), 10); // 'slice-0'\r\n    const frameNumber = parseInt(ids[1].substring(6), 10); // 'frame-0'\r\n    let newId = '#2-';\r\n    if (sliceNumber === 0 && frameNumber !== 0) {\r\n      newId += frameNumber;\r\n    } else {\r\n      newId += sliceNumber;\r\n    }\r\n    posGroup.attrs.id = newId;\r\n  }\r\n  return inputDrawings;\r\n}\r\n","import {logger} from './logger';\r\nimport {splitKeyValueString} from './string';\r\n\r\n/**\r\n * Get an full object URL from a string uri.\r\n *\r\n * @param {string} uri A string representing the url.\r\n * @returns {URL} A URL object.\r\n */\r\nexport function getUrlFromUri(uri) {\r\n  // add base to allow for relative urls\r\n  // (base is not used for absolute urls)\r\n  return new URL(uri, window.location.origin);\r\n}\r\n\r\n/**\r\n * Split an input URI:\r\n * 'root?key0=val00&key0=val01&key1=val10' returns\r\n * { base : root, query : [ key0 : [val00, val01], key1 : val1 ] }\r\n * Returns an empty object if the input string is not correct (null, empty...)\r\n * or if it is not a query string (no question mark).\r\n *\r\n * @param {string} uri The string to split.\r\n * @returns {object} The split string.\r\n */\r\nexport function splitUri(uri) {\r\n  // result\r\n  const result = {};\r\n  // check if query string\r\n  let sepIndex = null;\r\n  if (uri && (sepIndex = uri.indexOf('?')) !== -1) {\r\n    // base: before the '?'\r\n    result.base = uri.substring(0, sepIndex);\r\n    // query : after the '?' and until possible '#'\r\n    let hashIndex = uri.indexOf('#');\r\n    if (hashIndex === -1) {\r\n      hashIndex = uri.length;\r\n    }\r\n    const query = uri.substring(sepIndex + 1, hashIndex);\r\n    // split key/value pairs of the query\r\n    result.query = splitKeyValueString(query);\r\n  }\r\n  // return\r\n  return result;\r\n}\r\n\r\n/**\r\n * Get the query part, split into an array, of an input URI.\r\n * The URI scheme is: 'base?query#fragment'\r\n *\r\n * @param {string} uri The input URI.\r\n * @returns {object} The query part, split into an array, of the input URI.\r\n */\r\nexport function getUriQuery(uri) {\r\n  // split\r\n  const parts = splitUri(uri);\r\n  // check not empty\r\n  if (Object.keys(parts).length === 0) {\r\n    return null;\r\n  }\r\n  // return query\r\n  return parts.query;\r\n}\r\n\r\n/**\r\n * Generic URI query decoder.\r\n * Supports manifest:\r\n *   [dwv root]?input=encodeURIComponent('[manifest file]')&type=manifest\r\n * or encoded URI with base and key value/pairs:\r\n *   [dwv root]?input=encodeURIComponent([root]?key0=value0&key1=value1)\r\n *\r\n * @param {object} query The query part to the input URI.\r\n * @param {Function} callback The function to call with the decoded file urls.\r\n * @param {object} options Optional url request options.\r\n */\r\nexport function decodeQuery(query, callback, options) {\r\n  // manifest\r\n  if (query.type && query.type === 'manifest') {\r\n    decodeManifestQuery(query, callback);\r\n  } else {\r\n    // default case: encoded URI with base and key/value pairs\r\n    callback(\r\n      decodeKeyValueUri(query.input, query.dwvReplaceMode),\r\n      options);\r\n  }\r\n}\r\n\r\n/**\r\n * Decode a Key/Value pair URI. If a key is repeated, the result\r\n * be an array of base + each key.\r\n *\r\n * @param {string} uri The URI to decode.\r\n * @param {string} replaceMode The key replace mode.\r\n *   replaceMode can be:\r\n *   - key (default): keep the key\r\n *   - other than key: do not use the key\r\n *   'file' is a special case where the '?' of the query is not kept.\r\n * @returns {Array} The list of input file urls.\r\n */\r\nexport function decodeKeyValueUri(uri, replaceMode) {\r\n  const result = [];\r\n\r\n  // repeat key replace mode (default to keep key)\r\n  let repeatKeyReplaceMode = 'key';\r\n  if (replaceMode) {\r\n    repeatKeyReplaceMode = replaceMode;\r\n  }\r\n\r\n  // decode input URI\r\n  const queryUri = decodeURIComponent(uri);\r\n  // get key/value pairs from input URI\r\n  const inputQueryPairs = splitUri(queryUri);\r\n  if (Object.keys(inputQueryPairs).length === 0) {\r\n    result.push(queryUri);\r\n  } else {\r\n    const keys = Object.keys(inputQueryPairs.query);\r\n    // find repeat key\r\n    let repeatKey = null;\r\n    for (let i = 0; i < keys.length; ++i) {\r\n      if (inputQueryPairs.query[keys[i]] instanceof Array) {\r\n        repeatKey = keys[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!repeatKey) {\r\n      result.push(queryUri);\r\n    } else {\r\n      const repeatList = inputQueryPairs.query[repeatKey];\r\n      // build base uri\r\n      let baseUrl = inputQueryPairs.base;\r\n      // add '?' when:\r\n      // - base is not empty\r\n      // - the repeatKey is not 'file'\r\n      // root/path/to/?file=0.jpg&file=1.jpg\r\n      if (baseUrl !== '' && repeatKey !== 'file') {\r\n        baseUrl += '?';\r\n      }\r\n      let gotOneArg = false;\r\n      for (let j = 0; j < keys.length; ++j) {\r\n        if (keys[j] !== repeatKey) {\r\n          if (gotOneArg) {\r\n            baseUrl += '&';\r\n          }\r\n          baseUrl += keys[j] + '=' + inputQueryPairs.query[keys[j]];\r\n          gotOneArg = true;\r\n        }\r\n      }\r\n      // append built urls to result\r\n      let url;\r\n      for (let k = 0; k < repeatList.length; ++k) {\r\n        url = baseUrl;\r\n        if (gotOneArg) {\r\n          url += '&';\r\n        }\r\n        if (repeatKeyReplaceMode === 'key') {\r\n          url += repeatKey + '=';\r\n        }\r\n        // other than 'key' mode: do nothing\r\n        url += repeatList[k];\r\n        result.push(url);\r\n      }\r\n    }\r\n  }\r\n  // return\r\n  return result;\r\n}\r\n\r\n/**\r\n * Decode a manifest query.\r\n *\r\n * @external XMLHttpRequest\r\n * @param {object} query The manifest query: {input, nslices},\r\n * with input the input URI and nslices the number of slices.\r\n * @param {Function} callback The function to call with the decoded urls.\r\n */\r\nfunction decodeManifestQuery(query, callback) {\r\n  let uri = '';\r\n  if (query.input[0] === '/') {\r\n    uri = window.location.protocol + '//' + window.location.host;\r\n  }\r\n  // TODO: needs to be decoded (decodeURIComponent?\r\n  uri += query.input;\r\n\r\n  /**\r\n   * Handle error.\r\n   *\r\n   * @param {object} event The error event.\r\n   */\r\n  function onError(event) {\r\n    logger.warn('RequestError while receiving manifest: ' +\r\n      event.target.status);\r\n  }\r\n\r\n  /**\r\n   * Handle load.\r\n   *\r\n   * @param {object} event The load event.\r\n   */\r\n  function onLoad(event) {\r\n    callback(decodeManifest(event.target.responseXML, query.nslices));\r\n  }\r\n\r\n  const request = new XMLHttpRequest();\r\n  request.open('GET', decodeURIComponent(uri), true);\r\n  request.responseType = 'document';\r\n  request.onload = onLoad;\r\n  request.onerror = onError;\r\n  request.send(null);\r\n}\r\n\r\n/**\r\n * Decode an XML manifest.\r\n *\r\n * @param {object} manifest The manifest to decode.\r\n * @param {number} nslices The number of slices to load.\r\n * @returns {Array} The decoded manifest.\r\n */\r\nexport function decodeManifest(manifest, nslices) {\r\n  const result = [];\r\n  // wado url\r\n  const wadoElement = manifest.getElementsByTagName('wado_query');\r\n  const wadoURL = wadoElement[0].getAttribute('wadoURL');\r\n  const rootURL = wadoURL + '?requestType=WADO&contentType=application/dicom&';\r\n  // patient list\r\n  const patientList = manifest.getElementsByTagName('Patient');\r\n  if (patientList.length > 1) {\r\n    logger.warn('More than one patient, loading first one.');\r\n  }\r\n  // study list\r\n  const studyList = patientList[0].getElementsByTagName('Study');\r\n  if (studyList.length > 1) {\r\n    logger.warn('More than one study, loading first one.');\r\n  }\r\n  const studyUID = studyList[0].getAttribute('StudyInstanceUID');\r\n  // series list\r\n  const seriesList = studyList[0].getElementsByTagName('Series');\r\n  if (seriesList.length > 1) {\r\n    logger.warn('More than one series, loading first one.');\r\n  }\r\n  const seriesUID = seriesList[0].getAttribute('SeriesInstanceUID');\r\n  // instance list\r\n  const instanceList = seriesList[0].getElementsByTagName('Instance');\r\n  // loop on instances and push links\r\n  let max = instanceList.length;\r\n  if (nslices < max) {\r\n    max = nslices;\r\n  }\r\n  for (let i = 0; i < max; ++i) {\r\n    const sopInstanceUID = instanceList[i].getAttribute('SOPInstanceUID');\r\n    const link = rootURL +\r\n        '&studyUID=' + studyUID +\r\n        '&seriesUID=' + seriesUID +\r\n        '&objectUID=' + sopInstanceUID;\r\n    result.push(link);\r\n  }\r\n  // return\r\n  return result;\r\n}\r\n","import {ListenerHandler} from '../utils/listen';\r\n\r\n/**\r\n * UndoStack class.\r\n */\r\nexport class UndoStack {\r\n  /**\r\n   * Array of commands.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #stack = [];\r\n\r\n  /**\r\n   * Current command index.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #curCmdIndex = 0;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Get the stack size.\r\n   *\r\n   * @returns {number} The size of the stack.\r\n   */\r\n  getStackSize() {\r\n    return this.#stack.length;\r\n  }\r\n\r\n  /**\r\n   * Get the current stack index.\r\n   *\r\n   * @returns {number} The stack index.\r\n   */\r\n  getCurrentStackIndex() {\r\n    return this.#curCmdIndex;\r\n  }\r\n\r\n  /**\r\n   * Add a command to the stack.\r\n   *\r\n   * @param {object} cmd The command to add.\r\n   * @fires UndoStack#undoadd\r\n   */\r\n  add(cmd) {\r\n    // clear commands after current index\r\n    this.#stack = this.#stack.slice(0, this.#curCmdIndex);\r\n    // store command\r\n    this.#stack.push(cmd);\r\n    // increment index\r\n    ++this.#curCmdIndex;\r\n    /**\r\n     * Command add to undo stack event.\r\n     *\r\n     * @event UndoStack#undoadd\r\n     * @type {object}\r\n     * @property {string} command The name of the command added to the\r\n     *   undo stack.\r\n     */\r\n    this.#fireEvent({\r\n      type: 'undoadd',\r\n      command: cmd.getName()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Undo the last command.\r\n   *\r\n   * @fires UndoStack#undo\r\n   */\r\n  undo() {\r\n    // a bit inefficient...\r\n    if (this.#curCmdIndex > 0) {\r\n      // decrement command index\r\n      --this.#curCmdIndex;\r\n      // undo last command\r\n      this.#stack[this.#curCmdIndex].undo();\r\n      /**\r\n       * Command undo event.\r\n       *\r\n       * @event UndoStack#undo\r\n       * @type {object}\r\n       * @property {string} command The name of the undone command.\r\n       */\r\n      this.#fireEvent({\r\n        type: 'undo',\r\n        command: this.#stack[this.#curCmdIndex].getName()\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redo the last command.\r\n   *\r\n   * @fires UndoStack#redo\r\n   */\r\n  redo() {\r\n    if (this.#curCmdIndex < this.#stack.length) {\r\n      // run last command\r\n      this.#stack[this.#curCmdIndex].execute();\r\n      /**\r\n       * Command redo event.\r\n       *\r\n       * @event UndoStack#redo\r\n       * @type {object}\r\n       * @property {string} command The name of the redone command.\r\n       */\r\n      this.#fireEvent({\r\n        type: 'redo',\r\n        command: this.#stack[this.#curCmdIndex].getName()\r\n      });\r\n      // increment command index\r\n      ++this.#curCmdIndex;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *    event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n} // UndoStack class\r\n","import {InteractionEventNames, getEventOffset} from '../gui/generic';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {LayerGroup} from '../gui/layerGroup';\r\nimport {ViewLayer} from '../gui/viewLayer';\r\nimport {DrawLayer} from '../gui/drawLayer';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Toolbox controller.\r\n */\r\nexport class ToolboxController {\r\n\r\n  /**\r\n   * List of tools to control.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #toolList;\r\n\r\n  /**\r\n   * Selected tool.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #selectedTool = null;\r\n\r\n  /**\r\n   * Callback store to allow attach/detach.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #callbackStore = [];\r\n\r\n  /**\r\n   * Current layers bound to tool.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #boundLayers = {};\r\n\r\n  /**\r\n   * @param {object} toolList The list of tool objects.\r\n   */\r\n  constructor(toolList) {\r\n    this.#toolList = toolList;\r\n  }\r\n\r\n  /**\r\n   * Initialise.\r\n   */\r\n  init() {\r\n    for (const key in this.#toolList) {\r\n      this.#toolList[key].init();\r\n    }\r\n    // keydown listener\r\n    window.addEventListener('keydown',\r\n      this.#getOnMouch('window', 'keydown'), true);\r\n  }\r\n\r\n  /**\r\n   * Get the tool list.\r\n   *\r\n   * @returns {Array} The list of tool objects.\r\n   */\r\n  getToolList() {\r\n    return this.#toolList;\r\n  }\r\n\r\n  /**\r\n   * Check if a tool is in the tool list.\r\n   *\r\n   * @param {string} name The name to check.\r\n   * @returns {boolean} The tool list element for the given name.\r\n   */\r\n  hasTool(name) {\r\n    return typeof this.getToolList()[name] !== 'undefined';\r\n  }\r\n\r\n  /**\r\n   * Get the selected tool.\r\n   *\r\n   * @returns {object} The selected tool.\r\n   */\r\n  getSelectedTool() {\r\n    return this.#selectedTool;\r\n  }\r\n\r\n  /**\r\n   * Get the selected tool event handler.\r\n   *\r\n   * @param {string} eventType The event type, for example\r\n   *   mousedown, touchstart...\r\n   * @returns {Function} The event handler.\r\n   */\r\n  getSelectedToolEventHandler(eventType) {\r\n    return this.getSelectedTool()[eventType];\r\n  }\r\n\r\n  /**\r\n   * Set the selected tool.\r\n   *\r\n   * @param {string} name The name of the tool.\r\n   */\r\n  setSelectedTool(name) {\r\n    // check if we have it\r\n    if (!this.hasTool(name)) {\r\n      throw new Error('Unknown tool: \\'' + name + '\\'');\r\n    }\r\n    // de-activate previous\r\n    if (this.#selectedTool) {\r\n      this.#selectedTool.activate(false);\r\n    }\r\n    // set internal var\r\n    this.#selectedTool = this.#toolList[name];\r\n    // activate new tool\r\n    this.#selectedTool.activate(true);\r\n  }\r\n\r\n  /**\r\n   * Set the selected tool live features.\r\n   *\r\n   * @param {object} list The list of features.\r\n   */\r\n  setToolFeatures(list) {\r\n    if (this.getSelectedTool()) {\r\n      this.getSelectedTool().setFeatures(list);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to layer interaction events.\r\n   *\r\n   * @param {LayerGroup} layerGroup The associated layer group.\r\n   * @param {ViewLayer|DrawLayer} layer The layer to listen to.\r\n   */\r\n  bindLayerGroup(layerGroup, layer) {\r\n    const divId = layerGroup.getDivId();\r\n    // listen to active layer changes\r\n    layerGroup.addEventListener(\r\n      'activelayerchange', this.#getActiveLayerChangeHandler(divId));\r\n    // bind the layer\r\n    this.#internalBindLayerGroup(divId, layer);\r\n  }\r\n\r\n  /**\r\n   * Bind a layer group to this controller.\r\n   *\r\n   * @param {string} layerGroupDivId The layer group div id.\r\n   * @param {ViewLayer|DrawLayer} layer The layer.\r\n   */\r\n  #internalBindLayerGroup(layerGroupDivId, layer) {\r\n    // remove from local list if preset\r\n    if (typeof this.#boundLayers[layerGroupDivId] !== 'undefined') {\r\n      this.#unbindLayer(this.#boundLayers[layerGroupDivId]);\r\n    }\r\n    // replace layer in local list\r\n    this.#boundLayers[layerGroupDivId] = layer;\r\n    // bind layer\r\n    this.#bindLayer(layer);\r\n  }\r\n\r\n  /**\r\n   * Get an active layer change handler.\r\n   *\r\n   * @param {string} divId The associated layer group div id.\r\n   * @returns {Function} The event handler.\r\n   */\r\n  #getActiveLayerChangeHandler(divId) {\r\n    return (event) => {\r\n      const layer = event.value[0];\r\n      this.#internalBindLayerGroup(divId, layer);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add canvas mouse and touch listeners to a layer.\r\n   *\r\n   * @param {ViewLayer|DrawLayer} layer The layer to start listening to.\r\n   */\r\n  #bindLayer(layer) {\r\n    layer.bindInteraction();\r\n    // interaction events\r\n    const names = InteractionEventNames;\r\n    for (let i = 0; i < names.length; ++i) {\r\n      layer.addEventListener(names[i],\r\n        this.#getOnMouch(layer.getId(), names[i]));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove canvas mouse and touch listeners to a layer.\r\n   *\r\n   * @param {ViewLayer|DrawLayer} layer The layer to stop listening to.\r\n   */\r\n  #unbindLayer(layer) {\r\n    layer.unbindInteraction();\r\n    // interaction events\r\n    const names = InteractionEventNames;\r\n    for (let i = 0; i < names.length; ++i) {\r\n      layer.removeEventListener(names[i],\r\n        this.#getOnMouch(layer.getId(), names[i]));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mou(se) and (T)ouch event handler. This function just determines\r\n   * the mouse/touch position relative to the canvas element.\r\n   * It then passes it to the current tool.\r\n   *\r\n   * @param {string} layerId The layer id.\r\n   * @param {string} eventType The event type.\r\n   * @returns {object} A callback for the provided layer and event.\r\n   */\r\n  #getOnMouch(layerId, eventType) {\r\n    // augment event with converted offsets\r\n    const augmentEventOffsets = function (event) {\r\n      // event offset(s)\r\n      const offsets = getEventOffset(event);\r\n      // should have at least one offset\r\n      event._x = offsets[0].x;\r\n      event._y = offsets[0].y;\r\n      // possible second\r\n      if (offsets.length === 2) {\r\n        event._x1 = offsets[1].x;\r\n        event._y1 = offsets[1].y;\r\n      }\r\n    };\r\n\r\n    const applySelectedTool = (event) => {\r\n      // make sure we have a tool\r\n      if (this.#selectedTool) {\r\n        const func = this.#selectedTool[event.type];\r\n        if (func) {\r\n          func(event);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (typeof this.#callbackStore[layerId] === 'undefined') {\r\n      this.#callbackStore[layerId] = [];\r\n    }\r\n\r\n    if (typeof this.#callbackStore[layerId][eventType] === 'undefined') {\r\n      let callback = null;\r\n      if (eventType === 'keydown') {\r\n        callback = function (event) {\r\n          applySelectedTool(event);\r\n        };\r\n      } else if (eventType === 'touchend') {\r\n        callback = function (event) {\r\n          applySelectedTool(event);\r\n        };\r\n      } else {\r\n        // mouse or touch events\r\n        callback = function (event) {\r\n          augmentEventOffsets(event);\r\n          applySelectedTool(event);\r\n        };\r\n      }\r\n      // store callback\r\n      this.#callbackStore[layerId][eventType] = callback;\r\n    }\r\n\r\n    return this.#callbackStore[layerId][eventType];\r\n  }\r\n\r\n} // class ToolboxController\r\n","/**\r\n * Multiple progresses handler.\r\n * Stores a multi dimensional list of progresses to allow to\r\n * calculate a global progress.\r\n *\r\n */\r\nexport class MultiProgressHandler {\r\n\r\n  /**\r\n   * List of progresses.\r\n   * First dimension is a list of item for which the progress is recorded,\r\n   *   for example file names.\r\n   * Second dimension is a list of possible progresses, for example\r\n   *   the progress of the download and the progress of the decoding.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #progresses = [];\r\n\r\n  /**\r\n   * Number of dimensions.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #numberOfDimensions = 2;\r\n\r\n  /**\r\n   * Progress callback.\r\n   *\r\n   * @type {Function}\r\n   */\r\n  #callback;\r\n\r\n  /**\r\n   * @param {Function} callback The function to pass the global progress to.\r\n   */\r\n  constructor(callback) {\r\n    this.#callback = callback;\r\n  }\r\n\r\n  /**\r\n   * Set the number of dimensions.\r\n   *\r\n   * @param {number} num The number.\r\n   */\r\n  setNumberOfDimensions(num) {\r\n    this.#numberOfDimensions = num;\r\n  }\r\n\r\n  /**\r\n   * Set the number of data to load.\r\n   *\r\n   * @param {number} n The number of data to load.\r\n   */\r\n  setNToLoad(n) {\r\n    for (let i = 0; i < n; ++i) {\r\n      this.#progresses[i] = [];\r\n      for (let j = 0; j < this.#numberOfDimensions; ++j) {\r\n        this.#progresses[i][j] = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a load progress.\r\n   * Call the member callback with a global event.\r\n   *\r\n   * @param {object} event The progress event.\r\n   */\r\n  onprogress = (event) => {\r\n    // check event\r\n    if (!event.lengthComputable) {\r\n      return;\r\n    }\r\n    if (typeof event.subindex === 'undefined') {\r\n      return;\r\n    }\r\n    if (typeof event.index === 'undefined') {\r\n      return;\r\n    }\r\n    // calculate percent\r\n    const percent = (event.loaded * 100) / event.total;\r\n    // set percent for index\r\n    this.#progresses[event.index][event.subindex] = percent;\r\n\r\n    // item progress\r\n    let item = null;\r\n    if (typeof event.item !== 'undefined') {\r\n      item = event.item;\r\n    } else {\r\n      item = {\r\n        loaded: this.#getItemProgress(event.index),\r\n        total: 100,\r\n        source: event.source\r\n      };\r\n    }\r\n\r\n    // call callback with a global event\r\n    this.#callback({\r\n      lengthComputable: true,\r\n      loaded: this.#getGlobalPercent(),\r\n      total: 100,\r\n      item: item\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Get the item load percent.\r\n   *\r\n   * @param {number} index The index of the item.\r\n   * @returns {number} The load percentage.\r\n   */\r\n  #getItemProgress(index) {\r\n    let sum = 0;\r\n    for (let j = 0; j < this.#numberOfDimensions; ++j) {\r\n      sum += this.#progresses[index][j];\r\n    }\r\n    return sum / this.#numberOfDimensions;\r\n  }\r\n\r\n  /**\r\n   * Get the global load percent including the provided one.\r\n   *\r\n   * @returns {number} The accumulated percentage.\r\n   */\r\n  #getGlobalPercent() {\r\n    let sum = 0;\r\n    const lenprog = this.#progresses.length;\r\n    for (let i = 0; i < lenprog; ++i) {\r\n      sum += this.#getItemProgress(i);\r\n    }\r\n    return Math.round(sum / lenprog);\r\n  }\r\n\r\n\r\n  /**\r\n   * @callback eventFn\r\n   * @param {object} event The event.\r\n   */\r\n\r\n  /**\r\n   * Create a mono progress event handler.\r\n   *\r\n   * @param {number} index The index of the data.\r\n   * @param {number} subindex The sub-index of the data.\r\n   * @returns {eventFn} A progress handler function.\r\n   */\r\n  getMonoProgressHandler(index, subindex) {\r\n    return (event) => {\r\n      event.index = index;\r\n      event.subindex = subindex;\r\n      this.onprogress(event);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a mono progress event handler with an undefined index.\r\n   * Warning: The caller handles the progress index.\r\n   *\r\n   * @param {number} subindex The sub-index of the data.\r\n   * @returns {eventFn} A progress handler function.\r\n   */\r\n  getUndefinedMonoProgressHandler(subindex) {\r\n    return (event) => {\r\n      event.subindex = subindex;\r\n      this.onprogress(event);\r\n    };\r\n  }\r\n}\r\n","import {endsWith, getRootPath} from '../utils/string';\r\nimport {MultiProgressHandler} from '../utils/progress';\r\nimport {getFileListFromDicomDir} from '../dicom/dicomElementsWrapper';\r\nimport {loaderList} from './loaderList';\r\n\r\n// url content types\r\nexport const urlContentTypes = {\r\n  Text: 0,\r\n  ArrayBuffer: 1\r\n};\r\n\r\n/**\r\n * Urls loader.\r\n */\r\nexport class UrlsLoader {\r\n\r\n  /**\r\n   * Input data.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #inputData = null;\r\n\r\n  /**\r\n   * Array of launched requests.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #requests = [];\r\n\r\n  /**\r\n   * Data loader.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #runningLoader = null;\r\n\r\n  /**\r\n   * Number of loaded data.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #nLoad = 0;\r\n\r\n  /**\r\n   * Number of load end events.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #nLoadend = 0;\r\n\r\n  /**\r\n   * Flag to know if the load is aborting.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #aborting;\r\n\r\n  /**\r\n   * The default character set (optional).\r\n   *\r\n   * @type {string}\r\n   */\r\n  #defaultCharacterSet;\r\n\r\n  /**\r\n   * Get the default character set.\r\n   *\r\n   * @returns {string} The default character set.\r\n   */\r\n  getDefaultCharacterSet() {\r\n    return this.#defaultCharacterSet;\r\n  }\r\n\r\n  /**\r\n   * Set the default character set.\r\n   *\r\n   * @param {string} characterSet The character set.\r\n   */\r\n  setDefaultCharacterSet(characterSet) {\r\n    this.#defaultCharacterSet = characterSet;\r\n  }\r\n\r\n  /**\r\n   * Store the current input.\r\n   *\r\n   * @param {object} data The input data.\r\n   */\r\n  #storeInputData(data) {\r\n    this.#inputData = data;\r\n    // reset counters\r\n    this.#nLoad = 0;\r\n    this.#nLoadend = 0;\r\n    // reset flag\r\n    this.#aborting = false;\r\n    // clear storage\r\n    this.#clearStoredRequests();\r\n    this.#clearStoredLoader();\r\n  }\r\n\r\n  /**\r\n   * Store a launched request.\r\n   *\r\n   * @param {object} request The launched request.\r\n   */\r\n  #storeRequest(request) {\r\n    this.#requests.push(request);\r\n  }\r\n\r\n  /**\r\n   * Clear the stored requests.\r\n   *\r\n   */\r\n  #clearStoredRequests() {\r\n    this.#requests = [];\r\n  }\r\n\r\n  /**\r\n   * Store the launched loader.\r\n   *\r\n   * @param {object} loader The launched loader.\r\n   */\r\n  #storeLoader(loader) {\r\n    this.#runningLoader = loader;\r\n  }\r\n\r\n  /**\r\n   * Clear the stored loader.\r\n   *\r\n   */\r\n  #clearStoredLoader() {\r\n    this.#runningLoader = null;\r\n  }\r\n\r\n  /**\r\n   * Increment the number of loaded data\r\n   *   and call onload if loaded all data.\r\n   *\r\n   * @param {object} _event The load data event.\r\n   */\r\n  #addLoad = (_event) => {\r\n    this.#nLoad++;\r\n    // call onload when all is loaded\r\n    // (not using the input event since it is\r\n    //   an individual load)\r\n    if (this.#nLoad === this.#inputData.length) {\r\n      this.onload({\r\n        source: this.#inputData\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Increment the counter of load end events\r\n   *   and run callbacks when all done, erroneus or not.\r\n   *\r\n   * @param {object} _event The load end event.\r\n   */\r\n  #addLoadend = (_event) => {\r\n    this.#nLoadend++;\r\n    // call onloadend when all is run\r\n    // (not using the input event since it is\r\n    //   an individual load end)\r\n    if (this.#nLoadend === this.#inputData.length) {\r\n      this.onloadend({\r\n        source: this.#inputData\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @callback eventFn\r\n   * @param {object} event The event.\r\n   */\r\n\r\n  /**\r\n   * Augment a callback event with a srouce.\r\n   *\r\n   * @param {object} callback The callback to augment its event.\r\n   * @param {object} source The source to add to the event.\r\n   * @returns {eventFn} The augmented callback.\r\n   */\r\n  #augmentCallbackEvent(callback, source) {\r\n    return (event) => {\r\n      event.source = source;\r\n      callback(event);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Load a list of URLs or a DICOMDIR.\r\n   *\r\n   * @param {Array} data The list of urls to load.\r\n   * @param {object} [options] Load options.\r\n   */\r\n  load(data, options) {\r\n    // send start event\r\n    this.onloadstart({\r\n      source: data\r\n    });\r\n\r\n    // check if DICOMDIR case\r\n    if (data.length === 1 &&\r\n      (endsWith(data[0], 'DICOMDIR') ||\r\n      endsWith(data[0], '.dcmdir'))) {\r\n      this.#loadDicomDir(data[0], options);\r\n    } else {\r\n      this.#loadUrls(data, options);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a load handler for a data element.\r\n   *\r\n   * @param {object} loader The associated loader.\r\n   * @param {object} dataElement The data element.\r\n   * @param {number} i The index of the element.\r\n   * @returns {eventFn} A load handler.\r\n   */\r\n  #getLoadHandler(loader, dataElement, i) {\r\n    return (event) => {\r\n      // check response status\r\n      // https://developer.mozilla.org/en-US/docs/Web/HTTP/Response_codes\r\n      // status 200: \"OK\"; status 0: \"debug\"\r\n      const status = event.target.status;\r\n      if (status !== 200 && status !== 0) {\r\n        this.onerror({\r\n          source: dataElement,\r\n          error: 'GET ' + event.target.responseURL +\r\n            ' ' + event.target.status +\r\n            ' (' + event.target.statusText + ')',\r\n          target: event.target\r\n        });\r\n        this.#addLoadend();\r\n      } else {\r\n        loader.load(event.target.response, dataElement, i);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Load a list of urls.\r\n   *\r\n   * @param {Array} data The list of urls to load.\r\n   * @param {object} [options] The options object, can contain:\r\n   *  - requestHeaders: an array of {name, value} to use as request headers\r\n   *  - withCredentials: boolean xhr.withCredentials flag to pass\r\n   *    to the request\r\n   *  - batchSize: the size of the request url batch\r\n   */\r\n  #loadUrls(data, options) {\r\n    // check input\r\n    if (typeof data === 'undefined' || data.length === 0) {\r\n      return;\r\n    }\r\n    this.#storeInputData(data);\r\n\r\n    // create prgress handler\r\n    const mproghandler = new MultiProgressHandler(this.onprogress);\r\n    mproghandler.setNToLoad(data.length);\r\n\r\n    // create loaders\r\n    const loaders = [];\r\n    for (let m = 0; m < loaderList.length; ++m) {\r\n      loaders.push(new loaderList[m]());\r\n    }\r\n\r\n    // find an appropriate loader\r\n    let dataElement = data[0];\r\n    let loader = null;\r\n    let foundLoader = false;\r\n    for (let l = 0; l < loaders.length; ++l) {\r\n      loader = loaders[l];\r\n      if (loader.canLoadUrl(dataElement, options)) {\r\n        foundLoader = true;\r\n        // load options\r\n        loader.setOptions({\r\n          numberOfFiles: data.length,\r\n          defaultCharacterSet: this.getDefaultCharacterSet()\r\n        });\r\n        // set loader callbacks\r\n        // loader.onloadstart: nothing to do\r\n        loader.onprogress = mproghandler.getUndefinedMonoProgressHandler(1);\r\n        loader.onloaditem = this.onloaditem;\r\n        loader.onload = this.#addLoad;\r\n        loader.onloadend = this.#addLoadend;\r\n        loader.onerror = this.onerror;\r\n        loader.onabort = this.onabort;\r\n\r\n        // store loader\r\n        this.#storeLoader(loader);\r\n        // exit\r\n        break;\r\n      }\r\n    }\r\n    if (!foundLoader) {\r\n      throw new Error('No loader found for url: ' + dataElement);\r\n    }\r\n\r\n    // store last run request index\r\n    let lastRunRequestIndex = 0;\r\n    const requestOnLoadEnd = () => {\r\n      // launch next in queue\r\n      if (lastRunRequestIndex < this.#requests.length - 1 && !this.#aborting) {\r\n        ++lastRunRequestIndex;\r\n        this.#requests[lastRunRequestIndex].send(null);\r\n      }\r\n    };\r\n\r\n    // loop on I/O elements\r\n    for (let i = 0; i < data.length; ++i) {\r\n      dataElement = data[i];\r\n\r\n      // check loader\r\n      if (!loader.canLoadUrl(dataElement, options)) {\r\n        throw new Error('Input url of different type: ' + dataElement);\r\n      }\r\n      /**\r\n       * The http request.\r\n       *\r\n       * @external XMLHttpRequest\r\n       * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\r\n       */\r\n      const request = new XMLHttpRequest();\r\n      request.open('GET', dataElement, true);\r\n\r\n      // request options\r\n      if (typeof options !== 'undefined') {\r\n        // optional request headers\r\n        if (typeof options.requestHeaders !== 'undefined') {\r\n          const requestHeaders = options.requestHeaders;\r\n          for (let j = 0; j < requestHeaders.length; ++j) {\r\n            if (typeof requestHeaders[j].name !== 'undefined' &&\r\n              typeof requestHeaders[j].value !== 'undefined') {\r\n              request.setRequestHeader(\r\n                requestHeaders[j].name, requestHeaders[j].value);\r\n            }\r\n          }\r\n        }\r\n        // optional withCredentials\r\n        // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials\r\n        if (typeof options.withCredentials !== 'undefined') {\r\n          request.withCredentials = options.withCredentials;\r\n        }\r\n      }\r\n\r\n      // set request callbacks\r\n      // request.onloadstart: nothing to do\r\n      request.onprogress = this.#augmentCallbackEvent(\r\n        mproghandler.getMonoProgressHandler(i, 0), dataElement);\r\n      request.onload = this.#getLoadHandler(loader, dataElement, i);\r\n      request.onloadend = requestOnLoadEnd;\r\n      const errorCallback =\r\n        this.#augmentCallbackEvent(this.onerror, dataElement);\r\n      request.onerror = (event) => {\r\n        this.#addLoadend();\r\n        errorCallback(event);\r\n      };\r\n      const abortCallback =\r\n        this.#augmentCallbackEvent(this.onabort, dataElement);\r\n      request.onabort = (event) => {\r\n        this.#addLoadend();\r\n        abortCallback(event);\r\n      };\r\n      // response type (default is 'text')\r\n      if (loader.loadUrlAs() === urlContentTypes.ArrayBuffer) {\r\n        request.responseType = 'arraybuffer';\r\n      }\r\n\r\n      // store request\r\n      this.#storeRequest(request);\r\n    }\r\n\r\n    // launch requests in batch\r\n    let batchSize = this.#requests.length;\r\n    if (typeof options !== 'undefined') {\r\n      // optional request batch size\r\n      if (typeof options.batchSize !== 'undefined' && batchSize !== 0) {\r\n        batchSize = Math.min(options.batchSize, this.#requests.length);\r\n      }\r\n    }\r\n    for (let r = 0; r < batchSize; ++r) {\r\n      if (!this.#aborting) {\r\n        lastRunRequestIndex = r;\r\n        this.#requests[lastRunRequestIndex].send(null);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load a DICOMDIR.\r\n   *\r\n   * @param {string} dicomDirUrl The DICOMDIR url.\r\n   * @param {object} [options] Load options.\r\n   */\r\n  #loadDicomDir(dicomDirUrl, options) {\r\n    // read DICOMDIR\r\n    const request = new XMLHttpRequest();\r\n    request.open('GET', dicomDirUrl, true);\r\n    request.responseType = 'arraybuffer';\r\n    // request.onloadstart: nothing to do\r\n    /**\r\n     * @param {object} event The load event.\r\n     */\r\n    request.onload = (event) => {\r\n      // check status\r\n      const status = event.target.status;\r\n      if (status !== 200 && status !== 0) {\r\n        this.onerror({\r\n          source: dicomDirUrl,\r\n          error: 'GET ' + event.target.responseURL +\r\n            ' ' + event.target.status +\r\n            ' (' + event.target.statusText + ')',\r\n          target: event.target\r\n        });\r\n        this.onloadend({});\r\n      } else {\r\n        // get the file list\r\n        const list = getFileListFromDicomDir(event.target.response);\r\n        // use the first list\r\n        const urls = list[0][0];\r\n        // append root url\r\n        const rootUrl = getRootPath(dicomDirUrl);\r\n        const fullUrls = [];\r\n        for (let i = 0; i < urls.length; ++i) {\r\n          fullUrls.push(rootUrl + '/' + urls[i]);\r\n        }\r\n        // load urls\r\n        this.#loadUrls(fullUrls, options);\r\n      }\r\n    };\r\n    request.onerror = (event) => {\r\n      this.#augmentCallbackEvent(this.onerror, dicomDirUrl)(event);\r\n      this.onloadend({});\r\n    };\r\n    request.onabort = (event) => {\r\n      this.#augmentCallbackEvent(this.onabort, dicomDirUrl)(event);\r\n      this.onloadend({});\r\n    };\r\n    // request.onloadend: nothing to do\r\n    // send request\r\n    request.send(null);\r\n  }\r\n\r\n  /**\r\n   * Abort a load.\r\n   */\r\n  abort() {\r\n    this.#aborting = true;\r\n    // abort non finished requests\r\n    for (let i = 0; i < this.#requests.length; ++i) {\r\n      // 0: UNSENT, 1: OPENED, 2: HEADERS_RECEIVED (send()), 3: LOADING, 4: DONE\r\n      if (this.#requests[i].readyState !== 4) {\r\n        this.#requests[i].abort();\r\n      }\r\n    }\r\n    // abort loader\r\n    if (this.#runningLoader && this.#runningLoader.isLoading()) {\r\n      this.#runningLoader.abort();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a load progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event fired\r\n   *   when a file item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle a load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class UrlsLoader\r\n","/**\r\n * Thread Pool.\r\n * Highly inspired from {@link http://www.smartjava.org/content/html5-easily-parallelize-jobs-using-web-workers-and-threadpool}.\r\n */\r\nexport class ThreadPool {\r\n\r\n  /**\r\n   * @param {number} poolSize The size of the pool.\r\n   */\r\n  constructor(poolSize) {\r\n    this.poolSize = poolSize;\r\n    // task queue\r\n    this.taskQueue = [];\r\n    // lsit of available threads\r\n    this.freeThreads = [];\r\n    // create 'poolSize' number of worker threads\r\n    for (let i = 0; i < poolSize; ++i) {\r\n      this.freeThreads.push(new WorkerThread(this));\r\n    }\r\n    // list of running threads (unsed in abort)\r\n    this.runningThreads = [];\r\n  }\r\n\r\n  /**\r\n   * Add a worker task to the queue.\r\n   * Will be run when a thread is made available.\r\n   *\r\n   * @param {object} workerTask The task to add to the queue.\r\n   */\r\n  addWorkerTask(workerTask) {\r\n    // send work start if first task\r\n    if (this.freeThreads.length === this.poolSize) {\r\n      this.onworkstart({type: 'work-start'});\r\n    }\r\n    // launch task or queue\r\n    if (this.freeThreads.length > 0) {\r\n      // get the first free worker thread\r\n      const workerThread = this.freeThreads.shift();\r\n      // add the thread to the runnning list\r\n      this.runningThreads.push(workerThread);\r\n      // run the input task\r\n      workerThread.run(workerTask);\r\n    } else {\r\n      // no free thread, add task to queue\r\n      this.taskQueue.push(workerTask);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Abort all threads.\r\n   */\r\n  abort() {\r\n    // stop all threads\r\n    this.#stop();\r\n    // callback\r\n    this.onabort({type: 'work-abort'});\r\n    this.onworkend({type: 'work-end'});\r\n  }\r\n\r\n  /**\r\n   * Handle a task end.\r\n   *\r\n   * @param {object} workerThread The thread to free.\r\n   */\r\n  onTaskEnd(workerThread) {\r\n    // launch next task in queue or finish\r\n    if (this.taskQueue.length > 0) {\r\n      // get waiting task\r\n      const workerTask = this.taskQueue.shift();\r\n      // use input thread to run the waiting task\r\n      workerThread.run(workerTask);\r\n    } else {\r\n      // stop the worker\r\n      workerThread.stop();\r\n      // no task to run, add to free list\r\n      this.freeThreads.push(workerThread);\r\n      // remove from running list\r\n      for (let i = 0; i < this.runningThreads.length; ++i) {\r\n        if (this.runningThreads[i].getId() === workerThread.getId()) {\r\n          this.runningThreads.splice(i, 1);\r\n        }\r\n      }\r\n      // the work is done when the queue is back to its initial size\r\n      if (this.freeThreads.length === this.poolSize) {\r\n        this.onwork({type: 'work'});\r\n        this.onworkend({type: 'work-end'});\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle an error message from a worker.\r\n   *\r\n   * @param {object} event The error event.\r\n   */\r\n  handleWorkerError = (event) => {\r\n    // stop all threads\r\n    this.#stop();\r\n    // callback\r\n    this.onerror({error: event});\r\n    this.onworkend({type: 'work-end'});\r\n  };\r\n\r\n  // private ----------------------------------------------------------------\r\n\r\n  /**\r\n   * Stop the pool: stop all running threads.\r\n   *\r\n   */\r\n  #stop() {\r\n    // clear tasks\r\n    this.taskQueue = [];\r\n    // cancel running workers\r\n    for (let i = 0; i < this.runningThreads.length; ++i) {\r\n      this.runningThreads[i].stop();\r\n    }\r\n    this.runningThreads = [];\r\n  }\r\n\r\n\r\n  /**\r\n   * Handle a work start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The work start event.\r\n   */\r\n  onworkstart(_event) {}\r\n\r\n  /**\r\n   * Handle a work item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The work item event fired\r\n   *   when a work item ended successfully.\r\n   */\r\n  onworkitem(_event) {}\r\n\r\n  /**\r\n   * Handle a work event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The work event fired\r\n   *   when a work ended successfully.\r\n   */\r\n  onwork(_event) {}\r\n\r\n  /**\r\n   * Handle a work end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The work end event fired\r\n   *  when a work has completed, successfully or not.\r\n   */\r\n  onworkend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // ThreadPool\r\n\r\n/**\r\n * Worker background task.\r\n *\r\n * @external Worker\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Worker\r\n */\r\n\r\n/**\r\n * Worker thread.\r\n */\r\nclass WorkerThread {\r\n\r\n  /**\r\n   * @param {object} parentPool The parent pool.\r\n   */\r\n  constructor(parentPool) {\r\n    this.parentPool = parentPool;\r\n    // thread ID\r\n    this.id = Math.random().toString(36).substring(2, 15);\r\n    // running task\r\n    this.runningTask = null;\r\n    // worker used to run task\r\n    this.worker;\r\n  }\r\n\r\n  /**\r\n   * Get the thread ID.\r\n   *\r\n   * @returns {string} The thread ID (alphanumeric).\r\n   */\r\n  getId() {\r\n    return this.id;\r\n  }\r\n\r\n  /**\r\n   * Run a worker task\r\n   *\r\n   * @param {object} workerTask The task to run.\r\n   */\r\n  run(workerTask) {\r\n    // store task\r\n    this.runningTask = workerTask;\r\n    // create a new web worker if not done yet\r\n    if (typeof this.worker === 'undefined') {\r\n      this.worker = new Worker(this.runningTask.script);\r\n      // set callbacks\r\n      this.worker.onmessage = this.onmessage;\r\n      this.worker.onerror = this.onerror;\r\n    }\r\n    // launch the worker\r\n    this.worker.postMessage(this.runningTask.startMessage);\r\n  }\r\n\r\n  /**\r\n   * Finish a task and tell the parent.\r\n   */\r\n  stop() {\r\n    // stop the worker\r\n    if (typeof this.worker !== 'undefined') {\r\n      this.worker.terminate();\r\n      // force create at next run\r\n      this.worker = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Message event handler.\r\n   * For now assume we only get a single callback from a worker\r\n   * which also indicates the end of this worker.\r\n   *\r\n   * @param {object} event The message event.\r\n   */\r\n  onmessage = (event) => {\r\n    // augment event\r\n    event.itemNumber = this.runningTask.info.itemNumber;\r\n    event.numberOfItems = this.runningTask.info.numberOfItems;\r\n    event.index = this.runningTask.info.index;\r\n    // send event\r\n    this.parentPool.onworkitem(event);\r\n    // tell the parent pool the task is done\r\n    this.parentPool.onTaskEnd(this);\r\n  };\r\n\r\n  /**\r\n   * Error event handler.\r\n   *\r\n   * @param {object} event The error event.\r\n   */\r\n  onerror = (event) => {\r\n    // augment event\r\n    event.itemNumber = this.runningTask.info.itemNumber;\r\n    event.numberOfItems = this.runningTask.info.numberOfItems;\r\n    event.index = this.runningTask.info.index;\r\n    // pass to parent\r\n    this.parentPool.handleWorkerError(event);\r\n    // stop the worker and free the thread\r\n    this.stop();\r\n  };\r\n} // class WorkerThread\r\n\r\n/**\r\n * Worker task.\r\n */\r\nexport class WorkerTask {\r\n  /**\r\n   * @param {string} script The worker script.\r\n   * @param {object} message The data to pass to the worker.\r\n   * @param {object} info Information object about the input data.\r\n   */\r\n  constructor(script, message, info) {\r\n    // worker script\r\n    this.script = script;\r\n    // worker start message\r\n    this.startMessage = message;\r\n    // information about the work data\r\n    this.info = info;\r\n  }\r\n}\r\n","import {ThreadPool, WorkerTask} from '../utils/thread';\r\n\r\n/**\r\n * The JPEG baseline decoder.\r\n *\r\n * @external JpegImage\r\n * @see https://github.com/mozilla/pdf.js/blob/master/src/core/jpg.js\r\n */\r\n/* global JpegImage */\r\n// @ts-ignore\r\nconst hasJpegBaselineDecoder = (typeof JpegImage !== 'undefined');\r\n\r\n/**\r\n * The JPEG decoder namespace.\r\n *\r\n * @external jpeg\r\n * @see https://github.com/rii-mango/JPEGLosslessDecoderJS\r\n */\r\n/* global jpeg */\r\nconst hasJpegLosslessDecoder =\r\n  // @ts-ignore\r\n  (typeof jpeg !== 'undefined') && (typeof jpeg.lossless !== 'undefined');\r\n\r\n/**\r\n * The JPEG 2000 decoder.\r\n *\r\n * @external JpxImage\r\n * @see https://github.com/jpambrun/jpx-medical/blob/master/jpx.js\r\n */\r\n/* global JpxImage */\r\n// @ts-ignore\r\nconst hasJpeg2000Decoder = (typeof JpxImage !== 'undefined');\r\n\r\n/* global dwvdecoder */\r\n\r\n/**\r\n * Decoder scripts to be passed to web workers for image decoding.\r\n */\r\nexport const decoderScripts = {\r\n  jpeg2000: '',\r\n  'jpeg-lossless': '',\r\n  'jpeg-baseline': '',\r\n  rle: ''\r\n};\r\n\r\n/**\r\n * Asynchronous pixel buffer decoder.\r\n */\r\nclass AsynchPixelBufferDecoder {\r\n\r\n  /**\r\n   * The associated worker script.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #script;\r\n\r\n  /**\r\n   * Associated thread pool.\r\n   *\r\n   * @type {ThreadPool}\r\n   */\r\n  #pool = new ThreadPool(10);\r\n\r\n  /**\r\n   * Flag to know if callbacks are set.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #areCallbacksSet = false;\r\n\r\n  /**\r\n   * @param {string} script The path to the decoder script to be used\r\n   *   by the web worker.\r\n   * @param {number} _numberOfData The anticipated number of data to decode.\r\n   */\r\n  constructor(script, _numberOfData) {\r\n    this.#script = script;\r\n  }\r\n\r\n  /**\r\n   * Decode a pixel buffer.\r\n   *\r\n   * @param {Array} pixelBuffer The pixel buffer.\r\n   * @param {object} pixelMeta The input meta data.\r\n   * @param {object} info Information object about the input data.\r\n   */\r\n  decode(pixelBuffer, pixelMeta, info) {\r\n    if (!this.#areCallbacksSet) {\r\n      this.#areCallbacksSet = true;\r\n      // set event handlers\r\n      this.#pool.onworkstart = this.ondecodestart;\r\n      this.#pool.onworkitem = this.ondecodeditem;\r\n      this.#pool.onwork = this.ondecoded;\r\n      this.#pool.onworkend = this.ondecodeend;\r\n      this.#pool.onerror = this.onerror;\r\n      this.#pool.onabort = this.onabort;\r\n    }\r\n    // create worker task\r\n    const workerTask = new WorkerTask(\r\n      this.#script,\r\n      {\r\n        buffer: pixelBuffer,\r\n        meta: pixelMeta\r\n      },\r\n      info\r\n    );\r\n    // add it the queue and run it\r\n    this.#pool.addWorkerTask(workerTask);\r\n  }\r\n\r\n  /**\r\n   * Abort decoding.\r\n   */\r\n  abort() {\r\n    // abort the thread pool, will trigger pool.onabort\r\n    this.#pool.abort();\r\n  }\r\n\r\n  /**\r\n   * Handle a decode start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode start event.\r\n   */\r\n  ondecodestart(_event) {}\r\n\r\n  /**\r\n   * Handle a decode item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode item event fired\r\n   *   when a decode item ended successfully.\r\n   */\r\n  ondecodeditem(_event) {}\r\n\r\n  /**\r\n   * Handle a decode event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode event fired\r\n   *   when a file has been decoded successfully.\r\n   */\r\n  ondecoded(_event) {}\r\n\r\n  /**\r\n   * Handle a decode end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode end event fired\r\n   *  when a file decoding has completed, successfully or not.\r\n   */\r\n  ondecodeend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class AsynchPixelBufferDecoder\r\n\r\n/**\r\n * Synchronous pixel buffer decoder.\r\n */\r\nclass SynchPixelBufferDecoder {\r\n\r\n  /**\r\n   * Name of the compression algorithm.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #algoName;\r\n\r\n  /**\r\n   * Number of data.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #numberOfData;\r\n\r\n  /**\r\n   * @param {string} algoName The decompression algorithm name.\r\n   * @param {number} numberOfData The anticipated number of data to decode.\r\n   */\r\n  constructor(algoName, numberOfData) {\r\n    this.#algoName = algoName;\r\n    this.#numberOfData = numberOfData;\r\n  }\r\n\r\n  // decode count\r\n  #decodeCount = 0;\r\n\r\n  /**\r\n   * Decode a pixel buffer.\r\n   *\r\n   * @param {Array} pixelBuffer The pixel buffer.\r\n   * @param {object} pixelMeta The input meta data.\r\n   * @param {object} info Information object about the input data.\r\n   * @external jpeg\r\n   * @external JpegImage\r\n   * @external JpxImage\r\n   */\r\n  decode(pixelBuffer, pixelMeta, info) {\r\n    ++this.#decodeCount;\r\n\r\n    let decoder = null;\r\n    let decodedBuffer = null;\r\n    if (this.#algoName === 'jpeg-lossless') {\r\n      if (!hasJpegLosslessDecoder) {\r\n        throw new Error('No JPEG Lossless decoder provided');\r\n      }\r\n      // bytes per element\r\n      const bpe = pixelMeta.bitsAllocated / 8;\r\n      const buf = new Uint8Array(pixelBuffer);\r\n      // @ts-ignore\r\n      decoder = new jpeg.lossless.Decoder();\r\n      const decoded = decoder.decode(buf.buffer, 0, buf.buffer.byteLength, bpe);\r\n      if (pixelMeta.bitsAllocated === 8) {\r\n        if (pixelMeta.isSigned) {\r\n          decodedBuffer = new Int8Array(decoded.buffer);\r\n        } else {\r\n          decodedBuffer = new Uint8Array(decoded.buffer);\r\n        }\r\n      } else if (pixelMeta.bitsAllocated === 16) {\r\n        if (pixelMeta.isSigned) {\r\n          decodedBuffer = new Int16Array(decoded.buffer);\r\n        } else {\r\n          decodedBuffer = new Uint16Array(decoded.buffer);\r\n        }\r\n      }\r\n    } else if (this.#algoName === 'jpeg-baseline') {\r\n      if (!hasJpegBaselineDecoder) {\r\n        throw new Error('No JPEG Baseline decoder provided');\r\n      }\r\n      // @ts-ignore\r\n      decoder = new JpegImage();\r\n      decoder.parse(pixelBuffer);\r\n      decodedBuffer = decoder.getData(decoder.width, decoder.height);\r\n    } else if (this.#algoName === 'jpeg2000') {\r\n      if (!hasJpeg2000Decoder) {\r\n        throw new Error('No JPEG 2000 decoder provided');\r\n      }\r\n      // decompress pixel buffer into Int16 image\r\n      // @ts-ignore\r\n      decoder = new JpxImage();\r\n      decoder.parse(pixelBuffer);\r\n      // set the pixel buffer\r\n      decodedBuffer = decoder.tiles[0].items;\r\n    } else if (this.#algoName === 'rle') {\r\n      // decode DICOM buffer\r\n      // @ts-ignore\r\n      decoder = new dwvdecoder.RleDecoder();\r\n      // set the pixel buffer\r\n      decodedBuffer = decoder.decode(\r\n        pixelBuffer,\r\n        pixelMeta.bitsAllocated,\r\n        pixelMeta.isSigned,\r\n        pixelMeta.sliceSize,\r\n        pixelMeta.samplesPerPixel,\r\n        pixelMeta.planarConfiguration);\r\n    }\r\n    // send decode events\r\n    this.ondecodeditem({\r\n      data: [decodedBuffer],\r\n      index: info.index,\r\n      numberOfItems: info.numberOfItems,\r\n      itemNumber: info.itemNumber\r\n    });\r\n    // decode end?\r\n    if (this.#decodeCount === this.#numberOfData) {\r\n      this.ondecoded({});\r\n      this.ondecodeend({});\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Abort decoding.\r\n   */\r\n  abort() {\r\n    // nothing to do in the synchronous case.\r\n    // callback\r\n    this.onabort({});\r\n    this.ondecodeend({});\r\n  }\r\n\r\n  /**\r\n   * Handle a decode start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode start event.\r\n   */\r\n  ondecodestart(_event) {}\r\n\r\n  /**\r\n   * Handle a decode item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode item event fired\r\n   *   when a decode item ended successfully.\r\n   */\r\n  ondecodeditem(_event) {}\r\n\r\n  /**\r\n   * Handle a decode event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode event fired\r\n   *   when a file has been decoded successfully.\r\n   */\r\n  ondecoded(_event) {}\r\n\r\n  /**\r\n   * Handle a decode end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode end event fired\r\n   *  when a file decoding has completed, successfully or not.\r\n   */\r\n  ondecodeend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class SynchPixelBufferDecoder\r\n\r\n/**\r\n * Decode a pixel buffer.\r\n *\r\n * If the 'decoderScripts' variable does not contain the desired,\r\n * algorythm the decoder will switch to the synchronous mode.\r\n */\r\nexport class PixelBufferDecoder {\r\n\r\n  /**\r\n   * Flag to know if callbacks are set.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #areCallbacksSet = false;\r\n\r\n  /**\r\n   * Pixel decoder.\r\n   * Defined only once.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #pixelDecoder = null;\r\n\r\n  /**\r\n   * @param {string} algoName The decompression algorithm name.\r\n   * @param {number} numberOfData The anticipated number of data to decode.\r\n   */\r\n  constructor(algoName, numberOfData) {\r\n    // initialise the asynch decoder (if possible)\r\n    if (typeof decoderScripts !== 'undefined' &&\r\n      typeof decoderScripts[algoName] !== 'undefined') {\r\n      this.#pixelDecoder = new AsynchPixelBufferDecoder(\r\n        decoderScripts[algoName], numberOfData);\r\n    } else {\r\n      this.#pixelDecoder = new SynchPixelBufferDecoder(\r\n        algoName, numberOfData);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get data from an input buffer using a DICOM parser.\r\n   *\r\n   * @param {Array} pixelBuffer The input data buffer.\r\n   * @param {object} pixelMeta The input meta data.\r\n   * @param {object} info Information object about the input data.\r\n   */\r\n  decode(pixelBuffer, pixelMeta, info) {\r\n    if (!this.#areCallbacksSet) {\r\n      this.#areCallbacksSet = true;\r\n      // set callbacks\r\n      this.#pixelDecoder.ondecodestart = this.ondecodestart;\r\n      this.#pixelDecoder.ondecodeditem = this.ondecodeditem;\r\n      this.#pixelDecoder.ondecoded = this.ondecoded;\r\n      this.#pixelDecoder.ondecodeend = this.ondecodeend;\r\n      this.#pixelDecoder.onerror = this.onerror;\r\n      this.#pixelDecoder.onabort = this.onabort;\r\n    }\r\n    // decode and call the callback\r\n    this.#pixelDecoder.decode(pixelBuffer, pixelMeta, info);\r\n  }\r\n\r\n  /**\r\n   * Abort decoding.\r\n   */\r\n  abort() {\r\n    // decoder classes should define an abort\r\n    this.#pixelDecoder.abort();\r\n  }\r\n\r\n  /**\r\n   * Handle a decode start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode start event.\r\n   */\r\n  ondecodestart(_event) {}\r\n\r\n  /**\r\n   * Handle a decode item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode item event fired\r\n   *   when a decode item ended successfully.\r\n   */\r\n  ondecodeditem(_event) {}\r\n\r\n  /**\r\n   * Handle a decode event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode event fired\r\n   *   when a file has been decoded successfully.\r\n   */\r\n  ondecoded(_event) {}\r\n\r\n  /**\r\n   * Handle a decode end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The decode end event fired\r\n   *  when a file decoding has completed, successfully or not.\r\n   */\r\n  ondecodeend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class PixelBufferDecoder\r\n","import {logger} from '../utils/logger';\r\nimport {\r\n  DicomParser,\r\n  getSyntaxDecompressionName\r\n} from '../dicom/dicomParser';\r\nimport {ImageFactory} from './imageFactory';\r\nimport {MaskFactory} from './maskFactory';\r\nimport {PixelBufferDecoder} from './decoder';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {DataElement} from '../dicom/dataElement';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Create a View from a DICOM buffer.\r\n */\r\nexport class DicomBufferToView {\r\n\r\n  /**\r\n   * Converter options.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #options;\r\n\r\n  /**\r\n   * Set the converter options.\r\n   *\r\n   * @param {object} opt The input options.\r\n   */\r\n  setOptions(opt) {\r\n    this.#options = opt;\r\n  }\r\n\r\n  /**\r\n   * Pixel buffer decoder.\r\n   * Define only once to allow optional asynchronous mode.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #pixelDecoder = null;\r\n\r\n  // local tmp storage\r\n  #dicomParserStore = [];\r\n  #finalBufferStore = [];\r\n  #decompressedSizes = [];\r\n  #factoryWarnings = [];\r\n\r\n  /**\r\n   * Get the factory associated to input DICOM elements.\r\n   *\r\n   * @param {Object<string, DataElement>} elements The DICOM elements.\r\n   * @returns {ImageFactory|MaskFactory} The associated factory.\r\n   */\r\n  #getFactory(elements) {\r\n    let factory;\r\n    // mask factory for DICOM SEG\r\n    const element = elements['00080060'];\r\n    if (typeof element !== 'undefined') {\r\n      const modality = element.value[0];\r\n      if (modality === 'SEG') {\r\n        factory = new MaskFactory();\r\n      }\r\n    }\r\n    // default image factory\r\n    if (typeof factory === 'undefined') {\r\n      factory = new ImageFactory();\r\n    }\r\n    return factory;\r\n  }\r\n\r\n  /**\r\n   * Generate the image object.\r\n   *\r\n   * @param {number} index The data index.\r\n   * @param {string} origin The data origin.\r\n   */\r\n  #generateImage(index, origin) {\r\n    const dataElements = this.#dicomParserStore[index].getDicomElements();\r\n    const factory = this.#getFactory(dataElements);\r\n    // create the image\r\n    try {\r\n      const image = factory.create(\r\n        dataElements,\r\n        this.#finalBufferStore[index],\r\n        this.#options.numberOfFiles);\r\n      // call onloaditem\r\n      this.onloaditem({\r\n        data: {\r\n          image: image,\r\n          info: dataElements\r\n        },\r\n        source: origin,\r\n        warn: this.#factoryWarnings[index]\r\n      });\r\n    } catch (error) {\r\n      this.onerror({\r\n        error: error,\r\n        source: origin\r\n      });\r\n      this.onloadend({\r\n        source: origin\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a decoded item event.\r\n   *\r\n   * @param {object} event The decoded item event.\r\n   */\r\n  #onDecodedItem(event) {\r\n    // send progress\r\n    this.onprogress({\r\n      lengthComputable: true,\r\n      loaded: event.itemNumber + 1,\r\n      total: event.numberOfItems,\r\n      index: event.index,\r\n      source: origin\r\n    });\r\n\r\n    const dataIndex = event.index;\r\n\r\n    // store decoded data\r\n    const decodedData = event.data[0];\r\n    if (event.numberOfItems !== 1) {\r\n      // allocate buffer if not done yet\r\n      if (typeof this.#decompressedSizes[dataIndex] === 'undefined') {\r\n        this.#decompressedSizes[dataIndex] = decodedData.length;\r\n        const fullSize = event.numberOfItems *\r\n          this.#decompressedSizes[dataIndex];\r\n        try {\r\n          this.#finalBufferStore[dataIndex] =\r\n            new decodedData.constructor(fullSize);\r\n        } catch (error) {\r\n          if (error instanceof RangeError) {\r\n            const powerOf2 = Math.floor(Math.log(fullSize) / Math.log(2));\r\n            logger.error('Cannot allocate ' +\r\n              decodedData.constructor.name +\r\n              ' of size: ' +\r\n              fullSize + ' (>2^' + powerOf2 + ') for decompressed data.');\r\n          }\r\n          // abort\r\n          this.#pixelDecoder.abort();\r\n          // send events\r\n          this.onerror({\r\n            error: error,\r\n            source: origin\r\n          });\r\n          this.onloadend({\r\n            source: origin\r\n          });\r\n          // exit\r\n          return;\r\n        }\r\n      }\r\n      // hoping for all items to have the same size...\r\n      if (decodedData.length !== this.#decompressedSizes[dataIndex]) {\r\n        logger.warn('Unsupported varying decompressed data size: ' +\r\n          decodedData.length + ' != ' + this.#decompressedSizes[dataIndex]);\r\n      }\r\n      // set buffer item data\r\n      this.#finalBufferStore[dataIndex].set(\r\n        decodedData, this.#decompressedSizes[dataIndex] * event.itemNumber);\r\n    } else {\r\n      this.#finalBufferStore[dataIndex] = decodedData;\r\n    }\r\n\r\n    // create image for the first item\r\n    if (event.itemNumber === 0) {\r\n      this.#generateImage(dataIndex, origin);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get data from an input buffer using a DICOM parser.\r\n   *\r\n   * @param {ArrayBuffer} buffer The input data buffer.\r\n   * @param {string} origin The data origin.\r\n   * @param {number} dataIndex The data index.\r\n   */\r\n  convert(buffer, origin, dataIndex) {\r\n\r\n    this.onloadstart({\r\n      source: origin,\r\n      index: dataIndex\r\n    });\r\n\r\n    // DICOM parser\r\n    const dicomParser = new DicomParser();\r\n\r\n    if (typeof this.#options.defaultCharacterSet !== 'undefined') {\r\n      dicomParser.setDefaultCharacterSet(this.#options.defaultCharacterSet);\r\n    }\r\n    // parse the buffer\r\n    let warning;\r\n    try {\r\n      dicomParser.parse(buffer);\r\n      // check elements\r\n      const factory = this.#getFactory(dicomParser.getDicomElements());\r\n      warning = factory.checkElements(dicomParser.getDicomElements());\r\n    } catch (error) {\r\n      this.onerror({\r\n        error: error,\r\n        source: origin\r\n      });\r\n      this.onloadend({\r\n        source: origin\r\n      });\r\n      return;\r\n    }\r\n\r\n\r\n    const pixelBuffer = dicomParser.getDicomElements()['7FE00010'].value;\r\n    // help GC: discard pixel buffer from elements\r\n    dicomParser.getDicomElements()['7FE00010'].value = [];\r\n    const syntax = dicomParser.getDicomElements()['00020010'].value[0];\r\n    const algoName = getSyntaxDecompressionName(syntax);\r\n    const needDecompression = (algoName !== null);\r\n\r\n    // store\r\n    this.#dicomParserStore[dataIndex] = dicomParser;\r\n    this.#finalBufferStore[dataIndex] = pixelBuffer[0];\r\n    this.#factoryWarnings[dataIndex] = warning;\r\n\r\n    if (needDecompression) {\r\n      // gather pixel buffer meta data\r\n      const bitsAllocated =\r\n        dicomParser.getDicomElements()['00280100'].value[0];\r\n      const pixelRepresentation =\r\n        dicomParser.getDicomElements()['00280103'].value[0];\r\n      const pixelMeta = {\r\n        bitsAllocated: bitsAllocated,\r\n        isSigned: (pixelRepresentation === 1)\r\n      };\r\n      const columnsElement = dicomParser.getDicomElements()['00280011'];\r\n      const rowsElement = dicomParser.getDicomElements()['00280010'];\r\n      if (typeof columnsElement !== 'undefined' &&\r\n        typeof rowsElement !== 'undefined') {\r\n        pixelMeta.sliceSize = columnsElement.value[0] * rowsElement.value[0];\r\n      }\r\n      const samplesPerPixelElement =\r\n        dicomParser.getDicomElements()['00280002'];\r\n      if (typeof samplesPerPixelElement !== 'undefined') {\r\n        pixelMeta.samplesPerPixel = samplesPerPixelElement.value[0];\r\n      }\r\n      const planarConfigurationElement =\r\n        dicomParser.getDicomElements()['00280006'];\r\n      if (typeof planarConfigurationElement !== 'undefined') {\r\n        pixelMeta.planarConfiguration = planarConfigurationElement.value[0];\r\n      }\r\n\r\n      // number of items\r\n      const numberOfItems = pixelBuffer.length;\r\n\r\n      // setup the decoder (one decoder per all converts)\r\n      if (this.#pixelDecoder === null) {\r\n        this.#pixelDecoder = new PixelBufferDecoder(\r\n          algoName, numberOfItems);\r\n        // callbacks\r\n        // pixelDecoder.ondecodestart: nothing to do\r\n        this.#pixelDecoder.ondecodeditem = (event) => {\r\n          this.#onDecodedItem(event);\r\n          // send onload and onloadend when all items have been decoded\r\n          if (event.itemNumber + 1 === event.numberOfItems) {\r\n            this.onload(event);\r\n            this.onloadend(event);\r\n          }\r\n        };\r\n        // pixelDecoder.ondecoded: nothing to do\r\n        // pixelDecoder.ondecodeend: nothing to do\r\n        this.#pixelDecoder.onerror = this.onerror;\r\n        this.#pixelDecoder.onabort = this.onabort;\r\n      }\r\n\r\n      // launch decode\r\n      for (let i = 0; i < numberOfItems; ++i) {\r\n        this.#pixelDecoder.decode(pixelBuffer[i], pixelMeta,\r\n          {\r\n            itemNumber: i,\r\n            numberOfItems: numberOfItems,\r\n            index: dataIndex\r\n          }\r\n        );\r\n      }\r\n    } else {\r\n      // no decompression\r\n      // send progress\r\n      this.onprogress({\r\n        lengthComputable: true,\r\n        loaded: 100,\r\n        total: 100,\r\n        index: dataIndex,\r\n        source: origin\r\n      });\r\n      // generate image\r\n      this.#generateImage(dataIndex, origin);\r\n      // send load events\r\n      this.onload({\r\n        source: origin\r\n      });\r\n      this.onloadend({\r\n        source: origin\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Abort a conversion.\r\n   */\r\n  abort() {\r\n    // abort decoding, will trigger pixelDecoder.onabort\r\n    if (this.#pixelDecoder) {\r\n      this.#pixelDecoder.abort();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n  /**\r\n   * Handle a load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class DicomBufferToView\r\n","import {MultiProgressHandler} from '../utils/progress';\r\nimport {loaderList} from './loaderList';\r\n\r\n/**\r\n * Memory loader.\r\n */\r\nexport class MemoryLoader {\r\n\r\n  /**\r\n   * Input data.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #inputData = null;\r\n\r\n  /**\r\n   * Data loader.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #runningLoader = null;\r\n\r\n  /**\r\n   * Number of loaded data.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #nLoad = 0;\r\n\r\n  /**\r\n   * Number of load end events.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #nLoadend = 0;\r\n\r\n  /**\r\n   * The default character set (optional).\r\n   *\r\n   * @type {string}\r\n   */\r\n  #defaultCharacterSet;\r\n\r\n  /**\r\n   * Get the default character set.\r\n   *\r\n   * @returns {string} The default character set.\r\n   */\r\n  getDefaultCharacterSet() {\r\n    return this.#defaultCharacterSet;\r\n  }\r\n\r\n  /**\r\n   * Set the default character set.\r\n   *\r\n   * @param {string} characterSet The character set.\r\n   */\r\n  setDefaultCharacterSet(characterSet) {\r\n    this.#defaultCharacterSet = characterSet;\r\n  }\r\n\r\n  /**\r\n   * Store the current input.\r\n   *\r\n   * @param {object} data The input data.\r\n   */\r\n  #storeInputData(data) {\r\n    this.#inputData = data;\r\n    // reset counters\r\n    this.#nLoad = 0;\r\n    this.#nLoadend = 0;\r\n    // clear storage\r\n    this.#clearStoredLoader();\r\n  }\r\n\r\n  /**\r\n   * Store the launched loader.\r\n   *\r\n   * @param {object} loader The launched loader.\r\n   */\r\n  #storeLoader(loader) {\r\n    this.#runningLoader = loader;\r\n  }\r\n\r\n  /**\r\n   * Clear the stored loader.\r\n   *\r\n   */\r\n  #clearStoredLoader() {\r\n    this.#runningLoader = null;\r\n  }\r\n\r\n  /**\r\n   * Increment the number of loaded data\r\n   *   and call onload if loaded all data.\r\n   *\r\n   * @param {object} _event The load data event.\r\n   */\r\n  #addLoad = (_event) => {\r\n    this.#nLoad++;\r\n    // call onload when all is loaded\r\n    // (not using the input event since it is not the\r\n    //   general load)\r\n    if (this.#nLoad === this.#inputData.length) {\r\n      this.onload({\r\n        source: this.#inputData\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Increment the counter of load end events\r\n   *   and run callbacks when all done, erroneus or not.\r\n   *\r\n   * @param {object} _event The load end event.\r\n   */\r\n  #addLoadend = (_event) => {\r\n    this.#nLoadend++;\r\n    // call onloadend when all is run\r\n    // (not using the input event since it is not the\r\n    //   general load end)\r\n    if (this.#nLoadend === this.#inputData.length) {\r\n      this.onloadend({\r\n        source: this.#inputData\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Load a list of buffers.\r\n   *\r\n   * @param {Array} data The list of buffers to load.\r\n   */\r\n  load(data) {\r\n    // check input\r\n    if (typeof data === 'undefined' || data.length === 0) {\r\n      return;\r\n    }\r\n    this.#storeInputData(data);\r\n\r\n    // send start event\r\n    this.onloadstart({\r\n      source: data\r\n    });\r\n\r\n    // create prgress handler\r\n    const mproghandler = new MultiProgressHandler(this.onprogress);\r\n    mproghandler.setNToLoad(data.length);\r\n    mproghandler.setNumberOfDimensions(1);\r\n\r\n    // create loaders\r\n    const loaders = [];\r\n    for (let m = 0; m < loaderList.length; ++m) {\r\n      loaders.push(new loaderList[m]());\r\n    }\r\n\r\n    // find an appropriate loader\r\n    let dataElement = data[0];\r\n    let loader = null;\r\n    let foundLoader = false;\r\n    for (let l = 0; l < loaders.length; ++l) {\r\n      loader = loaders[l];\r\n      if (loader.canLoadMemory(dataElement)) {\r\n        foundLoader = true;\r\n        // load options\r\n        loader.setOptions({\r\n          numberOfFiles: data.length,\r\n          defaultCharacterSet: this.getDefaultCharacterSet()\r\n        });\r\n        // set loader callbacks\r\n        // loader.onloadstart: nothing to do\r\n        loader.onprogress = mproghandler.getUndefinedMonoProgressHandler(0);\r\n        loader.onloaditem = this.onloaditem;\r\n        loader.onload = this.#addLoad;\r\n        loader.onloadend = this.#addLoadend;\r\n        loader.onerror = this.onerror;\r\n        loader.onabort = this.onabort;\r\n\r\n        // store loader\r\n        this.#storeLoader(loader);\r\n        // exit\r\n        break;\r\n      }\r\n    }\r\n    if (!foundLoader) {\r\n      throw new Error('No loader found for data: ' + dataElement.filename);\r\n    }\r\n\r\n    // loop on I/O elements\r\n    for (let i = 0; i < data.length; ++i) {\r\n      dataElement = data[i];\r\n      // check loader\r\n      if (!loader.canLoadMemory(dataElement)) {\r\n        throw new Error('Input data of different type: ' +\r\n          dataElement.filename);\r\n      }\r\n      // read\r\n      loader.load(dataElement.data, dataElement.filename, i);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Abort a load.\r\n   */\r\n  abort() {\r\n    // abort loader\r\n    if (this.#runningLoader && this.#runningLoader.isLoading()) {\r\n      this.#runningLoader.abort();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a load progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event fired\r\n   *   when a file item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle a load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class MemoryLoader\r\n","import {Size} from '../image/size';\r\nimport {Spacing} from '../image/spacing';\r\nimport {Geometry} from '../image/geometry';\r\nimport {Image} from '../image/image';\r\nimport {Point3D} from '../math/point';\r\n\r\n/**\r\n * Create a simple array buffer from an ImageData buffer.\r\n *\r\n * @param {object} imageData The ImageData taken from a context.\r\n * @returns {Uint8Array} The image buffer.\r\n */\r\nfunction imageDataToBuffer(imageData) {\r\n  // remove alpha\r\n  // TODO support passing the full image data\r\n  const dataLen = imageData.data.length;\r\n  const buffer = new Uint8Array((dataLen / 4) * 3);\r\n  let j = 0;\r\n  for (let i = 0; i < dataLen; i += 4) {\r\n    buffer[j] = imageData.data[i];\r\n    buffer[j + 1] = imageData.data[i + 1];\r\n    buffer[j + 2] = imageData.data[i + 2];\r\n    j += 3;\r\n  }\r\n  return buffer;\r\n}\r\n\r\n/**\r\n * Get an image from an input context imageData.\r\n *\r\n * @param {number} width The width of the coresponding image.\r\n * @param {number} height The height of the coresponding image.\r\n * @param {number} sliceIndex The slice index of the imageData.\r\n * @param {object} imageBuffer The image buffer.\r\n * @param {number} numberOfFrames The final number of frames.\r\n * @param {string} imageUid The image UID.\r\n * @returns {object} The corresponding view.\r\n */\r\nfunction getDefaultImage(\r\n  width, height, sliceIndex,\r\n  imageBuffer, numberOfFrames,\r\n  imageUid) {\r\n  // image size\r\n  const imageSize = new Size([width, height, 1]);\r\n  // default spacing\r\n  // TODO: misleading...\r\n  const imageSpacing = new Spacing([1, 1, 1]);\r\n  // default origin\r\n  const origin = new Point3D(0, 0, sliceIndex);\r\n  // create image\r\n  const geometry = new Geometry(origin, imageSize, imageSpacing);\r\n  const image = new Image(geometry, imageBuffer, [imageUid]);\r\n  image.setPhotometricInterpretation('RGB');\r\n  // meta information\r\n  const meta = {};\r\n  meta.BitsStored = 8;\r\n  if (typeof numberOfFrames !== 'undefined') {\r\n    meta.numberOfFiles = numberOfFrames;\r\n  }\r\n  image.setMeta(meta);\r\n  // return\r\n  return image;\r\n}\r\n\r\n/**\r\n * Get data from an input image using a canvas.\r\n *\r\n * @param {HTMLImageElement} domImage The DOM Image,\r\n *   an HTMLImageElement with extra info.\r\n * @param {string|File} origin The data origin.\r\n * @param {number} index The data index.\r\n * @returns {object} A load data event.\r\n */\r\nexport function getViewFromDOMImage(domImage, origin, index) {\r\n  // image size\r\n  const width = domImage.width;\r\n  const height = domImage.height;\r\n\r\n  // draw the image in the canvas in order to get its data\r\n  const canvas = document.createElement('canvas');\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n  const ctx = canvas.getContext('2d');\r\n  ctx.drawImage(domImage, 0, 0);\r\n  // get the image data\r\n  const imageData = ctx.getImageData(0, 0, width, height);\r\n\r\n  // image properties\r\n  const info = {};\r\n  if (typeof origin === 'string') {\r\n    info['origin'] = {value: origin};\r\n  } else {\r\n    info['fileName'] = {value: origin.name};\r\n    info['fileType'] = {value: origin.type};\r\n    info['fileLastModifiedDate'] = {value: origin.lastModified};\r\n  }\r\n  info['imageWidth'] = {value: width};\r\n  info['imageHeight'] = {value: height};\r\n\r\n  const sliceIndex = index ? index : 0;\r\n  info['imageUid'] = {value: sliceIndex};\r\n\r\n  // create view\r\n  const imageBuffer = imageDataToBuffer(imageData);\r\n  const image = getDefaultImage(\r\n    width, height, sliceIndex, imageBuffer, 1, sliceIndex.toString());\r\n\r\n  // return\r\n  return {\r\n    data: {\r\n      image: image,\r\n      info: info\r\n    },\r\n    source: origin\r\n  };\r\n}\r\n\r\n/**\r\n * Get data from an input image using a canvas.\r\n *\r\n * @param {object} video The DOM Video, an HTMLVideoElement with extra info.\r\n * @param {Function} onloaditem On load callback.\r\n * @param {object} onload The function to call once the data is loaded.\r\n * @param {object} onprogress The function to call to report progress.\r\n * @param {object} onloadend The function to call to report load end.\r\n * @param {string|File} origin The data origin.\r\n * @param {number} dataIndex The data index.\r\n */\r\nexport function getViewFromDOMVideo(\r\n  video, onloaditem, onload, onprogress, onloadend,\r\n  origin, dataIndex) {\r\n  // video size\r\n  const width = video.videoWidth;\r\n  const height = video.videoHeight;\r\n\r\n  // default frame rate...\r\n  const frameRate = 30;\r\n  // number of frames\r\n  const numberOfFrames = Math.ceil(video.duration * frameRate);\r\n\r\n  // video properties\r\n  const info = {};\r\n  if (typeof origin === 'string') {\r\n    info['origin'] = {value: origin};\r\n  } else {\r\n    info['fileName'] = {value: origin.name};\r\n    info['fileType'] = {value: origin.type};\r\n    info['fileLastModifiedDate'] = {value: origin.lastModified};\r\n  }\r\n  info['imageWidth'] = {value: width};\r\n  info['imageHeight'] = {value: height};\r\n  info['numberOfFrames'] = {value: numberOfFrames};\r\n  info['imageUid'] = {value: 0};\r\n\r\n  // draw the image in the canvas in order to get its data\r\n  const canvas = document.createElement('canvas');\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n  const ctx = canvas.getContext('2d');\r\n\r\n  // using seeked to loop through all video frames\r\n  video.addEventListener('seeked', onseeked, false);\r\n\r\n  // current frame index\r\n  let frameIndex = 0;\r\n  // video image\r\n  let image = null;\r\n\r\n  /**\r\n   * Draw the context and store it as a frame\r\n   */\r\n  function storeFrame() {\r\n    // send progress\r\n    onprogress({\r\n      lengthComputable: true,\r\n      loaded: frameIndex,\r\n      total: numberOfFrames,\r\n      index: dataIndex,\r\n      source: origin\r\n    });\r\n    // draw image\r\n    ctx.drawImage(video, 0, 0);\r\n    // context to image buffer\r\n    const imgBuffer = imageDataToBuffer(\r\n      ctx.getImageData(0, 0, width, height));\r\n    if (frameIndex === 0) {\r\n      // create view\r\n      image = getDefaultImage(\r\n        width, height, 1, imgBuffer, numberOfFrames, dataIndex.toString());\r\n      // call callback\r\n      onloaditem({\r\n        data: {\r\n          image: image,\r\n          info: info\r\n        },\r\n        source: origin\r\n      });\r\n    } else {\r\n      image.appendFrameBuffer(imgBuffer, frameIndex);\r\n    }\r\n    // increment index\r\n    ++frameIndex;\r\n  }\r\n\r\n  let nextTime = 0;\r\n\r\n  /**\r\n   * Handle seeked event\r\n   *\r\n   * @param {object} event The seeked event.\r\n   */\r\n  function onseeked(event) {\r\n    // store\r\n    storeFrame();\r\n    // set the next time\r\n    // (not using currentTime, it seems to get offseted)\r\n    nextTime += 1 / frameRate;\r\n    if (nextTime <= event.target.duration) {\r\n      this.currentTime = nextTime;\r\n    } else {\r\n      onload({\r\n        source: origin\r\n      });\r\n      onloadend({\r\n        source: origin\r\n      });\r\n      // stop listening\r\n      video.removeEventListener('seeked', onseeked);\r\n    }\r\n  }\r\n\r\n  // trigger the first seek\r\n  video.currentTime = nextTime;\r\n}\r\n","import {DicomDataLoader} from './dicomDataLoader';\r\nimport {JSONTextLoader} from './jsonTextLoader';\r\nimport {MultipartLoader} from './multipartLoader';\r\nimport {RawImageLoader} from './rawImageLoader';\r\nimport {RawVideoLoader} from './rawVideoLoader';\r\nimport {ZipLoader} from './zipLoader';\r\n\r\nexport const loaderList = [\r\n  DicomDataLoader,\r\n  JSONTextLoader,\r\n  MultipartLoader,\r\n  RawImageLoader,\r\n  RawVideoLoader,\r\n  ZipLoader\r\n];\r\n","import {startsWith, getFileExtension} from '../utils/string';\r\nimport {getUrlFromUri} from '../utils/uri';\r\nimport {fileContentTypes} from './filesLoader';\r\nimport {urlContentTypes} from './urlsLoader';\r\nimport {DicomBufferToView} from '../image/dicomBufferToView';\r\n\r\n/**\r\n * DICOM data loader.\r\n */\r\nexport class DicomDataLoader {\r\n\r\n  /**\r\n   * Loader options.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #options = {};\r\n\r\n  /**\r\n   * Loading flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isLoading = false;\r\n\r\n  /**\r\n   * Set the loader options.\r\n   *\r\n   * @param {object} opt The input options.\r\n   */\r\n  setOptions(opt) {\r\n    this.#options = opt;\r\n  }\r\n\r\n  /**\r\n   * Is the load ongoing?\r\n   *\r\n   * @returns {boolean} True if loading.\r\n   */\r\n  isLoading() {\r\n    return this.#isLoading;\r\n  }\r\n\r\n  /**\r\n   * DICOM buffer to View (asynchronous)\r\n   *\r\n   */\r\n  #db2v = new DicomBufferToView();\r\n\r\n  /**\r\n   * Load data.\r\n   *\r\n   * @param {object} buffer The DICOM buffer.\r\n   * @param {string} origin The data origin.\r\n   * @param {number} index The data index.\r\n   */\r\n  load(buffer, origin, index) {\r\n    // setup db2v ony once\r\n    if (!this.#isLoading) {\r\n      // pass options\r\n      this.#db2v.setOptions(this.#options);\r\n      // connect handlers\r\n      this.#db2v.onloadstart = this.onloadstart;\r\n      this.#db2v.onprogress = this.onprogress;\r\n      this.#db2v.onloaditem = this.onloaditem;\r\n      this.#db2v.onload = this.onload;\r\n      this.#db2v.onloadend = (event) => {\r\n        // reset loading flag\r\n        this.#isLoading = false;\r\n        // call listeners\r\n        this.onloadend(event);\r\n      };\r\n      this.#db2v.onerror = (event) => {\r\n        event.source = origin;\r\n        this.onerror(event);\r\n      };\r\n      this.#db2v.onabort = this.onabort;\r\n    }\r\n\r\n    // set loading flag\r\n    this.#isLoading = true;\r\n    // convert\r\n    this.#db2v.convert(buffer, origin, index);\r\n  }\r\n\r\n  /**\r\n   * Abort load.\r\n   */\r\n  abort() {\r\n    // reset loading flag\r\n    this.#isLoading = false;\r\n    // abort conversion, will trigger db2v.onabort\r\n    this.#db2v.abort();\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided file.\r\n   *\r\n   * @param {object} file The file to check.\r\n   * @returns {boolean} True if the file can be loaded.\r\n   */\r\n  canLoadFile(file) {\r\n    const ext = getFileExtension(file.name);\r\n    const hasNoExt = (ext === null);\r\n    const hasDcmExt = (ext === 'dcm');\r\n    return hasNoExt || hasDcmExt;\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided url.\r\n   * True if:\r\n   *  - the url has a 'contentType' and it is 'application/dicom'\r\n   *    (as in wado urls)\r\n   *  - the url has no 'contentType' and no extension or the extension is 'dcm'\r\n   *\r\n   * @param {string} url The url to check.\r\n   * @param {object} [options] Optional url request options.\r\n   * @returns {boolean} True if the url can be loaded.\r\n   */\r\n  canLoadUrl(url, options) {\r\n    // if there are options.requestHeaders, just base check on them\r\n    if (typeof options !== 'undefined' &&\r\n      typeof options.requestHeaders !== 'undefined') {\r\n      // starts with 'application/dicom'\r\n      const isDicom = function (element) {\r\n        return element.name === 'Accept' &&\r\n          startsWith(element.value, 'application/dicom') &&\r\n          element.value[18] !== '+';\r\n      };\r\n      return typeof options.requestHeaders.find(isDicom) !== 'undefined';\r\n    }\r\n\r\n    const urlObjext = getUrlFromUri(url);\r\n    // extension\r\n    const ext = getFileExtension(urlObjext.pathname);\r\n    const hasNoExt = (ext === null);\r\n    const hasDcmExt = (ext === 'dcm');\r\n    // content type (for wado url)\r\n    const contentType = urlObjext.searchParams.get('contentType');\r\n    const hasContentType = contentType !== null &&\r\n      typeof contentType !== 'undefined';\r\n    const hasDicomContentType = (contentType === 'application/dicom');\r\n\r\n    return hasContentType ? hasDicomContentType : (hasNoExt || hasDcmExt);\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided memory object.\r\n   *\r\n   * @param {object} mem The memory object.\r\n   * @returns {boolean} True if the object can be loaded.\r\n   */\r\n  canLoadMemory(mem) {\r\n    const contentType = mem['Content-Type'];\r\n    if (typeof contentType !== 'undefined' &&\r\n      contentType.startsWith('application/dicom')) {\r\n      return true;\r\n    }\r\n    if (typeof mem.filename !== 'undefined') {\r\n      return this.canLoadFile({name: mem.filename});\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get the file content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'fileContentTypes'.\r\n   */\r\n  loadFileAs() {\r\n    return fileContentTypes.ArrayBuffer;\r\n  }\r\n\r\n  /**\r\n   * Get the url content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'urlContentTypes'.\r\n   */\r\n  loadUrlAs() {\r\n    return urlContentTypes.ArrayBuffer;\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event fired\r\n   *   when a file item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle an load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class DicomDataLoader\r\n","import {startsWith, getFileExtension} from '../utils/string';\r\nimport {getUrlFromUri} from '../utils/uri';\r\nimport {fileContentTypes} from './filesLoader';\r\nimport {urlContentTypes} from './urlsLoader';\r\n\r\n/**\r\n * JSON text loader.\r\n */\r\nexport class JSONTextLoader {\r\n\r\n  /**\r\n   * Loading flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isLoading = false;\r\n\r\n  /**\r\n   * Set the loader options.\r\n   *\r\n   * @param {object} _opt The input options.\r\n   */\r\n  setOptions(_opt) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Is the load ongoing?\r\n   *\r\n   * @returns {boolean} True if loading.\r\n   */\r\n  isLoading() {\r\n    return this.#isLoading;\r\n  }\r\n\r\n  /**\r\n   * Load data.\r\n   *\r\n   * @param {object} text The input text.\r\n   * @param {string} origin The data origin.\r\n   * @param {number} index The data index.\r\n   */\r\n  load(text, origin, index) {\r\n    // set loading flag\r\n    this.#isLoading = true;\r\n    this.onloadstart({\r\n      source: origin\r\n    });\r\n\r\n    try {\r\n      this.onprogress({\r\n        lengthComputable: true,\r\n        loaded: 100,\r\n        total: 100,\r\n        index: index,\r\n        source: origin\r\n      });\r\n      const data = {\r\n        data: text,\r\n        source: origin\r\n      };\r\n      // only expecting one item\r\n      this.onloaditem(data);\r\n      this.onload(data);\r\n    } catch (error) {\r\n      this.onerror({\r\n        error: error,\r\n        source: origin\r\n      });\r\n    } finally {\r\n      // reset loading flag\r\n      this.#isLoading = false;\r\n      this.onloadend({\r\n        source: origin\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Abort load: pass to listeners.\r\n   */\r\n  abort() {\r\n    // reset loading flag\r\n    this.#isLoading = false;\r\n    // call listeners\r\n    this.onabort({});\r\n    this.onloadend({});\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided file.\r\n   *\r\n   * @param {object} file The file to check.\r\n   * @returns {boolean} True if the file can be loaded.\r\n   */\r\n  canLoadFile(file) {\r\n    const ext = getFileExtension(file.name);\r\n    return (ext === 'json');\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided url.\r\n   *\r\n   * @param {string} url The url to check.\r\n   * @param {object} [options] Optional url request options.\r\n   * @returns {boolean} True if the url can be loaded.\r\n   */\r\n  canLoadUrl(url, options) {\r\n    // if there are options.requestHeader, just base check on them\r\n    if (typeof options !== 'undefined' &&\r\n      typeof options.requestHeaders !== 'undefined') {\r\n      // starts with 'application/json' or 'application/dicom+json\r\n      const isJson = function (element) {\r\n        return element.name === 'Accept' &&\r\n          startsWith(element.value, 'application/json') &&\r\n          startsWith(element.value, 'application/dicom+json');\r\n      };\r\n      return typeof options.requestHeaders.find(isJson) !== 'undefined';\r\n    }\r\n\r\n    const urlObjext = getUrlFromUri(url);\r\n    const ext = getFileExtension(urlObjext.pathname);\r\n    return (ext === 'json');\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided memory object.\r\n   *\r\n   * @param {object} mem The memory object.\r\n   * @returns {boolean} True if the object can be loaded.\r\n   */\r\n  canLoadMemory(mem) {\r\n    const contentType = mem['Content-Type'];\r\n    if (typeof contentType !== 'undefined' &&\r\n      contentType.startsWith('application/json')) {\r\n      return true;\r\n    }\r\n    if (typeof mem.filename !== 'undefined') {\r\n      return this.canLoadFile({name: mem.filename});\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get the file content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'fileContentTypes'.\r\n   */\r\n  loadFileAs() {\r\n    return fileContentTypes.Text;\r\n  }\r\n\r\n  /**\r\n   * Get the url content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'urlContentTypes'.\r\n   */\r\n  loadUrlAs() {\r\n    return urlContentTypes.Text;\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event fired\r\n   *   when a file item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle an load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class JSONTextLoader\r\n","import {startsWith} from '../utils/string';\r\nimport {parseMultipart} from '../utils/array';\r\nimport {MemoryLoader} from './memoryLoader';\r\nimport {fileContentTypes} from './filesLoader';\r\nimport {urlContentTypes} from './urlsLoader';\r\n\r\n/**\r\n * Multipart data loader.\r\n */\r\nexport class MultipartLoader {\r\n\r\n  /**\r\n   * Loading flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isLoading = false;\r\n\r\n  /**\r\n   * Set the loader options.\r\n   *\r\n   * @param {object} _opt The input options.\r\n   */\r\n  setOptions(_opt) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Is the load ongoing?\r\n   *\r\n   * @returns {boolean} True if loading.\r\n   */\r\n  isLoading() {\r\n    return this.#isLoading;\r\n  }\r\n\r\n  /**\r\n   * Load data.\r\n   *\r\n   * @param {object} buffer The DICOM buffer.\r\n   * @param {string} origin The data origin.\r\n   * @param {number} index The data index.\r\n   */\r\n  load(buffer, origin, index) {\r\n    // send start event\r\n    this.onloadstart({\r\n      source: origin\r\n    });\r\n    // set loading flag\r\n    this.#isLoading = true;\r\n\r\n    const memoryIO = new MemoryLoader();\r\n    // memoryIO.onloadstart: nothing to do\r\n    memoryIO.onprogress = (progress) => {\r\n      // add 50% to take into account the un-Multipartping\r\n      progress.loaded = 50 + progress.loaded / 2;\r\n      // set data index\r\n      progress.index = index;\r\n      this.onprogress(progress);\r\n    };\r\n    memoryIO.onloaditem = this.onloaditem;\r\n    memoryIO.onload = this.onload;\r\n    memoryIO.onloadend = (event) => {\r\n      // reset loading flag\r\n      this.#isLoading = false;\r\n      // call listeners\r\n      this.onloadend(event);\r\n    };\r\n    memoryIO.onerror = this.onerror;\r\n    memoryIO.onabort = this.onabort;\r\n    // launch\r\n    memoryIO.load(parseMultipart(buffer));\r\n  }\r\n\r\n  /**\r\n   * Abort load: pass to listeners.\r\n   */\r\n  abort() {\r\n    // reset loading flag\r\n    this.#isLoading = false;\r\n    // call listeners\r\n    this.onabort({});\r\n    this.onloadend({});\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided file.\r\n   *\r\n   * @param {object} _file The file to check.\r\n   * @returns {boolean} True if the file can be loaded.\r\n   */\r\n  canLoadFile(_file) {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided url.\r\n   *\r\n   * @param {string} url The url to check.\r\n   * @param {object} [options] The url request options.\r\n   * @returns {boolean} True if the url can be loaded.\r\n   */\r\n  canLoadUrl(url, options) {\r\n    // if there are options.requestHeaders, just base check on them\r\n    if (typeof options !== 'undefined' &&\r\n      typeof options.requestHeaders !== 'undefined') {\r\n      const isMultipart = function (element) {\r\n        return element.name === 'Accept' &&\r\n          startsWith(element.value, 'multipart/related');\r\n      };\r\n      return typeof options.requestHeaders.find(isMultipart) !== 'undefined';\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided memory object.\r\n   *\r\n   * @param {object} _mem The memory object.\r\n   * @returns {boolean} True if the url can be loaded.\r\n   */\r\n  canLoadMemory(_mem) {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get the file content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'fileContentTypes'.\r\n   */\r\n  loadFileAs() {\r\n    return fileContentTypes.ArrayBuffer;\r\n  }\r\n\r\n  /**\r\n   * Get the url content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'urlContentTypes'.\r\n   */\r\n  loadUrlAs() {\r\n    return urlContentTypes.ArrayBuffer;\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a load progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event fired\r\n   *   when a file item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle an load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class MultipartLoader\r\n","import {startsWith, getFileExtension} from '../utils/string';\r\nimport {getUrlFromUri} from '../utils/uri';\r\nimport {getViewFromDOMImage} from '../image/domReader';\r\nimport {fileContentTypes} from './filesLoader';\r\nimport {urlContentTypes} from './urlsLoader';\r\n\r\n/**\r\n * Raw image loader.\r\n */\r\nexport class RawImageLoader {\r\n\r\n  /**\r\n   * if abort is triggered, all image.onload callbacks have to be cancelled\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #aborted = false;\r\n\r\n  /**\r\n   * Set the loader options.\r\n   *\r\n   * @param {object} _opt The input options.\r\n   */\r\n  setOptions(_opt) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Is the load ongoing? TODO...\r\n   *\r\n   * @returns {boolean} True if loading.\r\n   */\r\n  isLoading() {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Create a Data URI from an HTTP request response.\r\n   *\r\n   * @param {ArrayBuffer} response The HTTP request response.\r\n   * @param {string} dataType The data type.\r\n   * @returns {string} The data URI.\r\n   */\r\n  #createDataUri(response, dataType) {\r\n    // image type\r\n    let imageType = dataType;\r\n    if (!imageType || imageType === 'jpg') {\r\n      imageType = 'jpeg';\r\n    }\r\n    // create uri\r\n    const file = new Blob([response], {type: 'image/' + imageType});\r\n    return window.URL.createObjectURL(file);\r\n  }\r\n\r\n  /**\r\n   * Load data.\r\n   *\r\n   * @param {ArrayBuffer|string} buffer The read data.\r\n   * @param {string|File} origin The data origin.\r\n   * @param {number} index The data index.\r\n   */\r\n  load(buffer, origin, index) {\r\n    this.#aborted = false;\r\n    // create a DOM image\r\n    const image = new Image();\r\n    // triggered by ctx.drawImage\r\n    image.onload = (/*event*/) => {\r\n      try {\r\n        if (!this.#aborted) {\r\n          this.onprogress({\r\n            lengthComputable: true,\r\n            loaded: 100,\r\n            total: 100,\r\n            index: index,\r\n            source: origin\r\n          });\r\n          const data = getViewFromDOMImage(image, origin, index);\r\n          // only expecting one item\r\n          this.onloaditem(data);\r\n          this.onload(data);\r\n        }\r\n      } catch (error) {\r\n        this.onerror({\r\n          error: error,\r\n          source: origin\r\n        });\r\n      } finally {\r\n        this.onloadend({\r\n          source: origin\r\n        });\r\n      }\r\n    };\r\n    // storing values to pass them on\r\n    if (typeof buffer === 'string') {\r\n      // file case\r\n      image.src = buffer;\r\n    } else if (typeof origin === 'string') {\r\n      // url case\r\n      const ext = origin.split('.').pop().toLowerCase();\r\n      image.src = this.#createDataUri(buffer, ext);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Abort load.\r\n   */\r\n  abort() {\r\n    this.#aborted = true;\r\n    this.onabort({});\r\n    this.onloadend({});\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided file.\r\n   *\r\n   * @param {object} file The file to check.\r\n   * @returns {boolean} True if the file can be loaded.\r\n   */\r\n  canLoadFile(file) {\r\n    return (typeof file.type !== 'undefined' &&\r\n      file.type.match('image.*'));\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided url.\r\n   *\r\n   * @param {string} url The url to check.\r\n   * @param {object} [options] Optional url request options.\r\n   * @returns {boolean} True if the url can be loaded.\r\n   */\r\n  canLoadUrl(url, options) {\r\n    // if there are options.requestHeaders, just base check on them\r\n    if (typeof options !== 'undefined' &&\r\n      typeof options.requestHeaders !== 'undefined') {\r\n      // starts with 'image/'\r\n      const isImage = function (element) {\r\n        return element.name === 'Accept' &&\r\n          startsWith(element.value, 'image/');\r\n      };\r\n      return typeof options.requestHeaders.find(isImage) !== 'undefined';\r\n    }\r\n\r\n    const urlObjext = getUrlFromUri(url);\r\n    // extension\r\n    const ext = getFileExtension(urlObjext.pathname);\r\n    const hasImageExt = (ext === 'jpeg') || (ext === 'jpg') ||\r\n      (ext === 'png') || (ext === 'gif');\r\n    // content type (for wado url)\r\n    const contentType = urlObjext.searchParams.get('contentType');\r\n    const hasContentType = contentType !== null &&\r\n      typeof contentType !== 'undefined';\r\n    const hasImageContentType = (contentType === 'image/jpeg') ||\r\n      (contentType === 'image/png') ||\r\n      (contentType === 'image/gif');\r\n\r\n    return hasContentType ? hasImageContentType : hasImageExt;\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided memory object.\r\n   *\r\n   * @param {object} mem The memory object.\r\n   * @returns {boolean} True if the object can be loaded.\r\n   */\r\n  canLoadMemory(mem) {\r\n    if (typeof mem.filename !== 'undefined') {\r\n      return this.canLoadFile({name: mem.filename});\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get the file content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'fileContentTypes'.\r\n   */\r\n  loadFileAs() {\r\n    return fileContentTypes.DataURL;\r\n  }\r\n\r\n  /**\r\n   * Get the url content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'urlContentTypes'.\r\n   */\r\n  loadUrlAs() {\r\n    return urlContentTypes.ArrayBuffer;\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event fired\r\n   *   when a file item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle an load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class RawImageLoader","import {startsWith, getFileExtension} from '../utils/string';\r\nimport {getUrlFromUri} from '../utils/uri';\r\nimport {getViewFromDOMVideo} from '../image/domReader';\r\nimport {fileContentTypes} from './filesLoader';\r\nimport {urlContentTypes} from './urlsLoader';\r\n\r\n/**\r\n * Raw video loader.\r\n * url example (cors enabled):\r\n *   https://raw.githubusercontent.com/clappr/clappr/master/test/fixtures/SampleVideo_360x240_1mb.mp4\r\n */\r\nexport class RawVideoLoader {\r\n\r\n  /**\r\n   * Set the loader options.\r\n   *\r\n   * @param {object} _opt The input options.\r\n   */\r\n  setOptions(_opt) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Is the load ongoing? TODO...\r\n   *\r\n   * @returns {boolean} True if loading.\r\n   */\r\n  isLoading() {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Create a Data URI from an HTTP request response.\r\n   *\r\n   * @param {object} response The HTTP request response.\r\n   * @param {string} dataType The data type.\r\n   * @returns {string} The data URI.\r\n   */\r\n  #createDataUri(response, dataType) {\r\n    // image data as string\r\n    const bytes = new Uint8Array(response);\r\n    let videoDataStr = '';\r\n    for (let i = 0; i < bytes.byteLength; ++i) {\r\n      videoDataStr += String.fromCharCode(bytes[i]);\r\n    }\r\n    // create uri\r\n    const uri = 'data:video/' + dataType +\r\n      ';base64,' + window.btoa(videoDataStr);\r\n    return uri;\r\n  }\r\n\r\n  /**\r\n   * Internal Data URI load.\r\n   *\r\n   * @param {object} buffer The read data.\r\n   * @param {string} origin The data origin.\r\n   * @param {number} index The data index.\r\n   */\r\n  load(buffer, origin, index) {\r\n    // create a DOM video\r\n    const video = document.createElement('video');\r\n    if (typeof origin === 'string') {\r\n      // url case\r\n      const ext = origin.split('.').pop().toLowerCase();\r\n      video.src = this.#createDataUri(buffer, ext);\r\n    } else {\r\n      video.src = buffer;\r\n    }\r\n    // onload handler\r\n    video.onloadedmetadata = (event) => {\r\n      try {\r\n        getViewFromDOMVideo(event.target,\r\n          this.onloaditem, this.onload,\r\n          this.onprogress, this.onloadend,\r\n          origin, index);\r\n      } catch (error) {\r\n        this.onerror({\r\n          error: error,\r\n          source: origin\r\n        });\r\n        this.onloadend({\r\n          source: origin\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Abort load.\r\n   */\r\n  abort() {\r\n    this.onabort({});\r\n    this.onloadend({});\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided file.\r\n   *\r\n   * @param {object} file The file to check.\r\n   * @returns {boolean} True if the file can be loaded.\r\n   */\r\n  canLoadFile(file) {\r\n    return (typeof file.type !== 'undefined' &&\r\n      file.type.match('video.*'));\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided url.\r\n   *\r\n   * @param {string} url The url to check.\r\n   * @param {object} [options] Optional url request options.\r\n   * @returns {boolean} True if the url can be loaded.\r\n   */\r\n  canLoadUrl(url, options) {\r\n    // if there are options.requestHeaders, just base check on them\r\n    if (typeof options !== 'undefined' &&\r\n      typeof options.requestHeaders !== 'undefined') {\r\n      // starts with 'video/'\r\n      const isVideo = function (element) {\r\n        return element.name === 'Accept' &&\r\n          startsWith(element.value, 'video/');\r\n      };\r\n      return typeof options.requestHeaders.find(isVideo) !== 'undefined';\r\n    }\r\n\r\n    const urlObjext = getUrlFromUri(url);\r\n    const ext = getFileExtension(urlObjext.pathname);\r\n    return (ext === 'mp4') ||\r\n      (ext === 'ogg') ||\r\n      (ext === 'webm');\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided memory object.\r\n   *\r\n   * @param {object} mem The memory object.\r\n   * @returns {boolean} True if the object can be loaded.\r\n   */\r\n  canLoadMemory(mem) {\r\n    if (typeof mem.filename !== 'undefined') {\r\n      return this.canLoadFile({name: mem.filename});\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get the file content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'fileContentTypes'.\r\n   */\r\n  loadFileAs() {\r\n    return fileContentTypes.DataURL;\r\n  }\r\n\r\n  /**\r\n   * Get the url content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'urlContentTypes'.\r\n   */\r\n  loadUrlAs() {\r\n    return urlContentTypes.ArrayBuffer;\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event fired\r\n   * when a file item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   * when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle an load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class RawVideoLoader\r\n","import {startsWith, getFileExtension} from '../utils/string';\r\nimport {getUrlFromUri} from '../utils/uri';\r\nimport {fileContentTypes} from './filesLoader';\r\nimport {urlContentTypes} from './urlsLoader';\r\nimport {MemoryLoader} from './memoryLoader';\r\n\r\n/**\r\n * The zip library.\r\n *\r\n * @external JSZip\r\n * @see https://github.com/Stuk/jszip\r\n */\r\nimport JSZip from 'jszip';\r\n\r\n/**\r\n * ZIP data loader.\r\n */\r\nexport class ZipLoader {\r\n\r\n  /**\r\n   * Loading flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isLoading = false;\r\n\r\n  /**\r\n   * Set the loader options.\r\n   *\r\n   * @param {object} _opt The input options.\r\n   */\r\n  setOptions(_opt) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Is the load ongoing?\r\n   *\r\n   * @returns {boolean} True if loading.\r\n   */\r\n  isLoading() {\r\n    return this.#isLoading;\r\n  }\r\n\r\n  #filename = '';\r\n  #files = [];\r\n  #zobjs = null;\r\n\r\n  /**\r\n   * JSZip.async callback\r\n   *\r\n   * @param {ArrayBuffer} content unzipped file image\r\n   * @param {object} origin The origin of the file.\r\n   * @param {number} index The data index.\r\n   */\r\n  #zipAsyncCallback(content, origin, index) {\r\n    this.#files.push({filename: this.#filename, data: content});\r\n\r\n    // sent un-ziped progress with the data index\r\n    // (max 50% to take into account the memory loading)\r\n    const unzipPercent = this.#files.length * 100 / this.#zobjs.length;\r\n    this.onprogress({\r\n      lengthComputable: true,\r\n      loaded: (unzipPercent / 2),\r\n      total: 100,\r\n      index: index,\r\n      item: {\r\n        loaded: unzipPercent,\r\n        total: 100,\r\n        source: origin\r\n      }\r\n    });\r\n\r\n    // recursively call until we have all the files\r\n    if (this.#files.length < this.#zobjs.length) {\r\n      const num = this.#files.length;\r\n      this.#filename = this.#zobjs[num].name;\r\n      this.#zobjs[num].async('arrayBuffer').then((content) => {\r\n        this.#zipAsyncCallback(content, origin, index);\r\n      });\r\n    } else {\r\n      const memoryIO = new MemoryLoader();\r\n      // memoryIO.onloadstart: nothing to do\r\n      memoryIO.onprogress = (progress) => {\r\n        // add 50% to take into account the un-zipping\r\n        progress.loaded = 50 + progress.loaded / 2;\r\n        // set data index\r\n        progress.index = index;\r\n        this.onprogress(progress);\r\n      };\r\n      memoryIO.onloaditem = this.onloaditem;\r\n      memoryIO.onload = this.onload;\r\n      memoryIO.onloadend = (event) => {\r\n        // reset loading flag\r\n        this.#isLoading = false;\r\n        // call listeners\r\n        this.onloadend(event);\r\n      };\r\n      memoryIO.onerror = this.onerror;\r\n      memoryIO.onabort = this.onabort;\r\n      // launch\r\n      memoryIO.load(this.#files);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load data.\r\n   *\r\n   * @param {object} buffer The DICOM buffer.\r\n   * @param {string} origin The data origin.\r\n   * @param {number} index The data index.\r\n   */\r\n  load(buffer, origin, index) {\r\n    // send start event\r\n    this.onloadstart({\r\n      source: origin\r\n    });\r\n    // set loading flag\r\n    this.#isLoading = true;\r\n\r\n    JSZip.loadAsync(buffer).then((zip) => {\r\n      this.#files = [];\r\n      this.#zobjs = zip.file(/.*\\.dcm/);\r\n      // recursively load zip files into the files array\r\n      const num = this.#files.length;\r\n      this.#filename = this.#zobjs[num].name;\r\n      this.#zobjs[num].async('arrayBuffer').then((content) => {\r\n        this.#zipAsyncCallback(content, origin, index);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Abort load: pass to listeners.\r\n   */\r\n  abort() {\r\n    // reset loading flag\r\n    this.#isLoading = false;\r\n    // call listeners\r\n    this.onabort({});\r\n    this.onloadend({});\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided file.\r\n   *\r\n   * @param {object} file The file to check.\r\n   * @returns {boolean} True if the file can be loaded.\r\n   */\r\n  canLoadFile(file) {\r\n    const ext = getFileExtension(file.name);\r\n    return (ext === 'zip');\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided url.\r\n   *\r\n   * @param {string} url The url to check.\r\n   * @param {object} [options] Optional url request options.\r\n   * @returns {boolean} True if the url can be loaded.\r\n   */\r\n  canLoadUrl(url, options) {\r\n    // if there are options.requestHeaders, just base check on them\r\n    if (typeof options !== 'undefined' &&\r\n      typeof options.requestHeaders !== 'undefined') {\r\n      // starts with 'application/zip'\r\n      const isZip = function (element) {\r\n        return element.name === 'Accept' &&\r\n          startsWith(element.value, 'application/zip');\r\n      };\r\n      return typeof options.requestHeaders.find(isZip) !== 'undefined';\r\n    }\r\n\r\n    const urlObjext = getUrlFromUri(url);\r\n    const ext = getFileExtension(urlObjext.pathname);\r\n    return (ext === 'zip');\r\n  }\r\n\r\n  /**\r\n   * Check if the loader can load the provided memory object.\r\n   *\r\n   * @param {object} mem The memory object.\r\n   * @returns {boolean} True if the object can be loaded.\r\n   */\r\n  canLoadMemory(mem) {\r\n    const contentType = mem['Content-Type'];\r\n    if (typeof contentType !== 'undefined' &&\r\n      contentType.startsWith('application/zip')) {\r\n      return true;\r\n    }\r\n    if (typeof mem.filename !== 'undefined') {\r\n      return this.canLoadFile({name: mem.filename});\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get the file content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'fileContentTypes'.\r\n   */\r\n  loadFileAs() {\r\n    return fileContentTypes.ArrayBuffer;\r\n  }\r\n\r\n  /**\r\n   * Get the url content type needed by the loader.\r\n   *\r\n   * @returns {number} One of the 'urlContentTypes'.\r\n   */\r\n  loadUrlAs() {\r\n    return urlContentTypes.ArrayBuffer;\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a load progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event fired\r\n   *   when a file item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle an load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class DicomDataLoader\r\n","import {MultiProgressHandler} from '../utils/progress';\r\nimport {loaderList} from './loaderList';\r\n\r\n// file content types\r\nexport const fileContentTypes = {\r\n  Text: 0,\r\n  ArrayBuffer: 1,\r\n  DataURL: 2\r\n};\r\n\r\n/**\r\n * Files loader.\r\n */\r\nexport class FilesLoader {\r\n\r\n  /**\r\n   * Input data.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #inputData = null;\r\n\r\n  /**\r\n   * Array of launched file readers.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #readers = [];\r\n\r\n  /**\r\n   * Data loader.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #runningLoader = null;\r\n\r\n  /**\r\n   * Number of loaded data.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #nLoad = 0;\r\n\r\n  /**\r\n   * Number of load end events.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #nLoadend = 0;\r\n\r\n  /**\r\n   * The default character set (optional).\r\n   *\r\n   * @type {string}\r\n   */\r\n  #defaultCharacterSet;\r\n\r\n  /**\r\n   * Get the default character set.\r\n   *\r\n   * @returns {string} The default character set.\r\n   */\r\n  getDefaultCharacterSet() {\r\n    return this.#defaultCharacterSet;\r\n  }\r\n\r\n  /**\r\n   * Set the default character set.\r\n   *\r\n   * @param {string} characterSet The character set.\r\n   */\r\n  setDefaultCharacterSet(characterSet) {\r\n    this.#defaultCharacterSet = characterSet;\r\n  }\r\n\r\n  /**\r\n   * Store the current input.\r\n   *\r\n   * @param {object} data The input data.\r\n   */\r\n  #storeInputData(data) {\r\n    this.#inputData = data;\r\n    // reset counters\r\n    this.#nLoad = 0;\r\n    this.#nLoadend = 0;\r\n    // clear storage\r\n    this.#clearStoredReaders();\r\n    this.#clearStoredLoader();\r\n  }\r\n\r\n  /**\r\n   * Store a launched reader.\r\n   *\r\n   * @param {object} reader The launched reader.\r\n   */\r\n  #storeReader(reader) {\r\n    this.#readers.push(reader);\r\n  }\r\n\r\n  /**\r\n   * Clear the stored readers.\r\n   *\r\n   */\r\n  #clearStoredReaders() {\r\n    this.#readers = [];\r\n  }\r\n\r\n  /**\r\n   * Store the launched loader.\r\n   *\r\n   * @param {object} loader The launched loader.\r\n   */\r\n  #storeLoader(loader) {\r\n    this.#runningLoader = loader;\r\n  }\r\n\r\n  /**\r\n   * Clear the stored loader.\r\n   *\r\n   */\r\n  #clearStoredLoader() {\r\n    this.#runningLoader = null;\r\n  }\r\n\r\n  /**\r\n   * Increment the number of loaded data\r\n   *   and call onload if loaded all data.\r\n   *\r\n   * @param {object} _event The load data event.\r\n   */\r\n  #addLoad = (_event) => {\r\n    this.#nLoad++;\r\n    // call onload when all is loaded\r\n    // (not using the input event since it is\r\n    //   an individual load)\r\n    if (this.#nLoad === this.#inputData.length) {\r\n      this.onload({\r\n        source: this.#inputData\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Increment the counter of load end events\r\n   *   and run callbacks when all done, erroneus or not.\r\n   *\r\n   * @param {object} _event The load end event.\r\n   */\r\n  #addLoadend = (_event) => {\r\n    this.#nLoadend++;\r\n    // call onloadend when all is run\r\n    // (not using the input event since it is\r\n    //   an individual load end)\r\n    if (this.#nLoadend === this.#inputData.length) {\r\n      this.onloadend({\r\n        source: this.#inputData\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @callback eventFn\r\n   * @param {object} event The event.\r\n   */\r\n\r\n  /**\r\n   * Augment a callback event with a srouce.\r\n   *\r\n   * @param {object} callback The callback to augment its event.\r\n   * @param {object} source The source to add to the event.\r\n   * @returns {eventFn} The augmented callback.\r\n   */\r\n  #augmentCallbackEvent(callback, source) {\r\n    return (event) => {\r\n      event.source = source;\r\n      callback(event);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get a load handler for a data element.\r\n   *\r\n   * @param {object} loader The associated loader.\r\n   * @param {object} dataElement The data element.\r\n   * @param {number} i The index of the element.\r\n   * @returns {eventFn} A load handler.\r\n   */\r\n  #getLoadHandler(loader, dataElement, i) {\r\n    return (event) => {\r\n      loader.load(event.target.result, dataElement, i);\r\n    };\r\n  }\r\n\r\n\r\n  /**\r\n   * Load a list of files.\r\n   *\r\n   * @param {Array} data The list of files to load.\r\n   */\r\n  load(data) {\r\n    // check input\r\n    if (typeof data === 'undefined' || data.length === 0) {\r\n      return;\r\n    }\r\n    this.#storeInputData(data);\r\n\r\n    // send start event\r\n    this.onloadstart({\r\n      source: data\r\n    });\r\n\r\n    // create prgress handler\r\n    const mproghandler = new MultiProgressHandler(this.onprogress);\r\n    mproghandler.setNToLoad(data.length);\r\n\r\n    // create loaders\r\n    const loaders = [];\r\n    for (let m = 0; m < loaderList.length; ++m) {\r\n      loaders.push(new loaderList[m]());\r\n    }\r\n\r\n    // find an appropriate loader\r\n    let dataElement = data[0];\r\n    let loader = null;\r\n    let foundLoader = false;\r\n    for (let l = 0; l < loaders.length; ++l) {\r\n      loader = loaders[l];\r\n      if (loader.canLoadFile(dataElement)) {\r\n        foundLoader = true;\r\n        // load options\r\n        loader.setOptions({\r\n          numberOfFiles: data.length,\r\n          defaultCharacterSet: this.getDefaultCharacterSet()\r\n        });\r\n        // set loader callbacks\r\n        // loader.onloadstart: nothing to do\r\n        loader.onprogress = mproghandler.getUndefinedMonoProgressHandler(1);\r\n        loader.onloaditem = this.onloaditem;\r\n        loader.onload = this.#addLoad;\r\n        loader.onloadend = this.#addLoadend;\r\n        loader.onerror = this.onerror;\r\n        loader.onabort = this.onabort;\r\n\r\n        // store loader\r\n        this.#storeLoader(loader);\r\n        // exit\r\n        break;\r\n      }\r\n    }\r\n    if (!foundLoader) {\r\n      throw new Error('No loader found for file: ' + dataElement.name);\r\n    }\r\n\r\n    // loop on I/O elements\r\n    for (let i = 0; i < data.length; ++i) {\r\n      dataElement = data[i];\r\n\r\n      // check loader\r\n      if (!loader.canLoadFile(dataElement)) {\r\n        throw new Error('Input file of different type: ' + dataElement);\r\n      }\r\n\r\n      /**\r\n       * The file reader.\r\n       *\r\n       * @external FileReader\r\n       * @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\r\n       */\r\n      const reader = new FileReader();\r\n      // store reader\r\n      this.#storeReader(reader);\r\n\r\n      // set reader callbacks\r\n      // reader.onloadstart: nothing to do\r\n      reader.onprogress = this.#augmentCallbackEvent(\r\n        mproghandler.getMonoProgressHandler(i, 0), dataElement);\r\n      reader.onload = this.#getLoadHandler(loader, dataElement, i);\r\n      // reader.onloadend: nothing to do\r\n      const errorCallback =\r\n        this.#augmentCallbackEvent(this.onerror, dataElement);\r\n      reader.onerror = (event) => {\r\n        this.#addLoadend();\r\n        errorCallback(event);\r\n      };\r\n      const abortCallback =\r\n        this.#augmentCallbackEvent(this.onabort, dataElement);\r\n      reader.onabort = (event) => {\r\n        this.#addLoadend();\r\n        abortCallback(event);\r\n      };\r\n      // read\r\n      if (loader.loadFileAs() === fileContentTypes.Text) {\r\n        reader.readAsText(dataElement);\r\n      } else if (loader.loadFileAs() === fileContentTypes.DataURL) {\r\n        reader.readAsDataURL(dataElement);\r\n      } else if (loader.loadFileAs() === fileContentTypes.ArrayBuffer) {\r\n        reader.readAsArrayBuffer(dataElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Abort a load.\r\n   */\r\n  abort() {\r\n    // abort readers\r\n    for (let i = 0; i < this.#readers.length; ++i) {\r\n      // 0: EMPTY, 1: LOADING, 2: DONE\r\n      if (this.#readers[i].readyState === 1) {\r\n        this.#readers[i].abort();\r\n      }\r\n    }\r\n    // abort loader\r\n    if (this.#runningLoader && this.#runningLoader.isLoading()) {\r\n      this.#runningLoader.abort();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a load progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load item event fired\r\n   *   when a file item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle a load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class FilesLoader\r\n","import {FilesLoader} from '../io/filesLoader';\r\nimport {MemoryLoader} from '../io/memoryLoader';\r\nimport {UrlsLoader} from '../io/urlsLoader';\r\n\r\n/**\r\n * Load controller.\r\n */\r\nexport class LoadController {\r\n\r\n  /**\r\n   * The default character set.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #defaultCharacterSet;\r\n\r\n  /**\r\n   * List of current loaders.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #currentLoaders = {};\r\n\r\n  /**\r\n   * @param {string} defaultCharacterSet The default character set.\r\n   */\r\n  constructor(defaultCharacterSet) {\r\n    this.#defaultCharacterSet = defaultCharacterSet;\r\n  }\r\n\r\n  /**\r\n   * Load a list of files. Can be image files or a state file.\r\n   *\r\n   * @param {File[]} files The list of files to load.\r\n   * @param {string} dataId The data Id.\r\n   */\r\n  loadFiles(files, dataId) {\r\n    // has been checked for emptiness.\r\n    const ext = files[0].name.split('.').pop().toLowerCase();\r\n    if (ext === 'json') {\r\n      this.#loadStateFile(files[0], dataId);\r\n    } else {\r\n      this.#loadImageFiles(files, dataId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load a list of URLs. Can be image files or a state file.\r\n   *\r\n   * @param {string[]} urls The list of urls to load.\r\n   * @param {string} dataId The data Id.\r\n   * @param {object} [options] The load options:\r\n   * - requestHeaders: an array of {name, value} to use as request headers.\r\n   * - withCredentials: credentials flag to pass to the request.\r\n   */\r\n\r\n  loadURLs(urls, dataId, options) {\r\n    // has been checked for emptiness.\r\n    const ext = urls[0].split('.').pop().toLowerCase();\r\n    if (ext === 'json') {\r\n      this.#loadStateUrl(urls[0], dataId, options);\r\n    } else {\r\n      this.#loadImageUrls(urls, dataId, options);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load a list of ArrayBuffers.\r\n   *\r\n   * @param {Array} data The list of ArrayBuffers to load\r\n   *   in the form of [{name: '', filename: '', data: data}].\r\n   * @param {string} dataId The data Id.\r\n   */\r\n  loadImageObject(data, dataId) {\r\n    // create IO\r\n    const memoryIO = new MemoryLoader();\r\n    // load data\r\n    this.#loadData(data, memoryIO, 'image', dataId);\r\n  }\r\n\r\n  /**\r\n   * Abort the current loaders.\r\n   */\r\n  abort() {\r\n    const keys = Object.keys(this.#currentLoaders);\r\n    for (let i = 0; i < keys.length; ++i) {\r\n      this.#currentLoaders[i].loader.abort();\r\n      delete this.#currentLoaders[i];\r\n    }\r\n  }\r\n\r\n  // private ----------------------------------------------------------------\r\n\r\n  /**\r\n   * Load a list of image files.\r\n   *\r\n   * @param {File[]} files The list of image files to load.\r\n   * @param {string} dataId The data Id.\r\n   */\r\n  #loadImageFiles(files, dataId) {\r\n    // create IO\r\n    const fileIO = new FilesLoader();\r\n    fileIO.setDefaultCharacterSet(this.#defaultCharacterSet);\r\n    // load data\r\n    this.#loadData(files, fileIO, 'image', dataId);\r\n  }\r\n\r\n  /**\r\n   * Load a list of image URLs.\r\n   *\r\n   * @param {string[]} urls The list of urls to load.\r\n   * @param {string} [dataId] The data Id.\r\n   * @param {object} [options] The load options:\r\n   * - requestHeaders: an array of {name, value} to use as request headers.\r\n   * - withCredentials: credentials flag to pass to the request.\r\n   */\r\n  #loadImageUrls(urls, dataId, options) {\r\n    // create IO\r\n    const urlIO = new UrlsLoader();\r\n    urlIO.setDefaultCharacterSet(this.#defaultCharacterSet);\r\n    // load data\r\n    this.#loadData(urls, urlIO, 'image', dataId, options);\r\n  }\r\n\r\n  /**\r\n   * Load a State file.\r\n   *\r\n   * @param {File} file The state file to load.\r\n   * @param {string} dataId The data Id.\r\n   */\r\n  #loadStateFile(file, dataId) {\r\n    // create IO\r\n    const fileIO = new FilesLoader();\r\n    // load data\r\n    this.#loadData([file], fileIO, 'state', dataId);\r\n  }\r\n\r\n\r\n  /**\r\n   * Load a State url.\r\n   *\r\n   * @param {string} url The state url to load.\r\n   * @param {string} [dataId] The data Id.\r\n   * @param {object} [options] The load options:\r\n   * - requestHeaders: an array of {name, value} to use as request headers.\r\n   * - withCredentials: credentials flag to pass to the request.\r\n   */\r\n  #loadStateUrl(url, dataId, options) {\r\n    // create IO\r\n    const urlIO = new UrlsLoader();\r\n    // load data\r\n    this.#loadData([url], urlIO, 'state', dataId, options);\r\n  }\r\n\r\n  /**\r\n   * Load a list of data.\r\n   *\r\n   * @param {string[]|File[]|Array} data Array of data to load.\r\n   * @param {object} loader The data loader.\r\n   * @param {string} loadType The data load type: 'image' or 'state'.\r\n   * @param {string} dataId The data id.\r\n   * @param {object} [options] Options passed to the final loader.\r\n   */\r\n  #loadData(data, loader, loadType, dataId, options) {\r\n    const eventInfo = {\r\n      loadtype: loadType,\r\n      dataid: dataId\r\n    };\r\n\r\n    // set callbacks\r\n    loader.onloadstart = (event) => {\r\n      // store loader to allow abort\r\n      this.#currentLoaders[dataId] = {\r\n        loader: loader,\r\n        isFirstItem: true\r\n      };\r\n      // callback\r\n      this.#augmentCallbackEvent(this.onloadstart, eventInfo)(event);\r\n    };\r\n    loader.onprogress = this.#augmentCallbackEvent(this.onprogress, eventInfo);\r\n    loader.onloaditem = (event) => {\r\n      const eventInfoItem = {\r\n        loadtype: loadType,\r\n        dataid: dataId\r\n      };\r\n      if (typeof this.#currentLoaders[dataId] !== 'undefined') {\r\n        eventInfoItem.isfirstitem = this.#currentLoaders[dataId].isFirstItem;\r\n      }\r\n      // callback\r\n      this.#augmentCallbackEvent(this.onloaditem, eventInfoItem)(event);\r\n      // update loader\r\n      if (typeof this.#currentLoaders[dataId] !== 'undefined' &&\r\n        this.#currentLoaders[dataId].isFirstItem) {\r\n        this.#currentLoaders[dataId].isFirstItem = false;\r\n      }\r\n    };\r\n    loader.onload = this.#augmentCallbackEvent(this.onload, eventInfo);\r\n    loader.onloadend = (event) => {\r\n      // reset current loader\r\n      delete this.#currentLoaders[dataId];\r\n      // callback\r\n      this.#augmentCallbackEvent(this.onloadend, eventInfo)(event);\r\n    };\r\n    loader.onerror = this.#augmentCallbackEvent(this.onerror, eventInfo);\r\n    loader.onabort = this.#augmentCallbackEvent(this.onabort, eventInfo);\r\n    // launch load\r\n    try {\r\n      loader.load(data, options);\r\n    } catch (error) {\r\n      this.onerror({\r\n        error: error,\r\n        dataid: dataId\r\n      });\r\n      this.onloadend({\r\n        dataid: dataId\r\n      });\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Augment a callback event: adds loadtype to the event\r\n   *  passed to a callback.\r\n   *\r\n   * @param {object} callback The callback to update.\r\n   * @param {object} info Info object to append to the event.\r\n   * @returns {object} A function representing the modified callback.\r\n   */\r\n  #augmentCallbackEvent(callback, info) {\r\n    return function (event) {\r\n      const keys = Object.keys(info);\r\n      for (let i = 0; i < keys.length; ++i) {\r\n        const key = keys[i];\r\n        event[key] = info[key];\r\n      }\r\n      callback(event);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handle a load start event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load start event.\r\n   */\r\n  onloadstart(_event) {}\r\n\r\n  /**\r\n   * Handle a load progress event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The progress event.\r\n   */\r\n  onprogress(_event) {}\r\n\r\n  /**\r\n   * Handle a load event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when a file has been loaded successfully.\r\n   */\r\n  onload(_event) {}\r\n\r\n  /**\r\n   * Handle a load item event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load event fired\r\n   *   when an item has been loaded successfully.\r\n   */\r\n  onloaditem(_event) {}\r\n\r\n  /**\r\n   * Handle a load end event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The load end event fired\r\n   *  when a file load has completed, successfully or not.\r\n   */\r\n  onloadend(_event) {}\r\n\r\n  /**\r\n   * Handle an error event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The error event.\r\n   */\r\n  onerror(_event) {}\r\n\r\n  /**\r\n   * Handle an abort event.\r\n   * Default does nothing.\r\n   *\r\n   * @param {object} _event The abort event.\r\n   */\r\n  onabort(_event) {}\r\n\r\n} // class LoadController\r\n","import {ListenerHandler} from '../utils/listen';\r\nimport {mergeObjects} from '../utils/operator';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Image} from '../image/image';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Image and meta class.\r\n */\r\nclass ImageData {\r\n  /**\r\n   * Associated HTML div id.\r\n   *\r\n   * @type {Image}\r\n   */\r\n  image;\r\n  /**\r\n   * Associated HTML div id.\r\n   *\r\n   * @type {object}\r\n   */\r\n  meta;\r\n\r\n  /**\r\n   * @param {Image} image The image.\r\n   * @param {object} meta The image meta.\r\n   */\r\n  constructor(image, meta) {\r\n    this.image = image;\r\n    this.meta = meta;\r\n  }\r\n}\r\n\r\n/*\r\n * Data (list of {image, meta}) controller.\r\n */\r\nexport class DataController {\r\n\r\n  /**\r\n   * List of {image, meta}.\r\n   *\r\n   * @type {Object<string, ImageData>}\r\n   */\r\n  #dataList = {};\r\n\r\n  /**\r\n   * Distinct data loaded counter.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #dataIdCounter = -1;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Get the next data id.\r\n   *\r\n   * @returns {string} The data id.\r\n   */\r\n  getNextDataId() {\r\n    ++this.#dataIdCounter;\r\n    return this.#dataIdCounter.toString();\r\n  }\r\n\r\n  /**\r\n   * Get the list of ids in the data storage.\r\n   *\r\n   * @returns {string[]} The list of data ids.\r\n   */\r\n  getDataIds() {\r\n    return Object.keys(this.#dataList);\r\n  }\r\n\r\n  /**\r\n   * Reset the class: empty the data storage.\r\n   */\r\n  reset() {\r\n    this.#dataList = {};\r\n  }\r\n\r\n  /**\r\n   * Get a data at a given index.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {ImageData|undefined} The data as {image, meta}.\r\n   */\r\n  get(dataId) {\r\n    return this.#dataList[dataId];\r\n  }\r\n\r\n  /**\r\n   * Get the list of dataIds that contain the input UIDs.\r\n   *\r\n   * @param {string[]} uids A list of UIDs.\r\n   * @returns {string[]} The list of dataIds that contain the UIDs.\r\n   */\r\n  getDataIdsFromSopUids(uids) {\r\n    const res = [];\r\n    const keys = Object.keys(this.#dataList);\r\n    for (const key of keys) {\r\n      if (this.#dataList[key].image.containsImageUids(uids)) {\r\n        res.push(key);\r\n      }\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Set the image at a given index.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {Image} image The image to set.\r\n   */\r\n  setImage(dataId, image) {\r\n    this.#dataList[dataId].image = image;\r\n    // fire image set\r\n    this.#fireEvent({\r\n      type: 'imageset',\r\n      value: [image],\r\n      dataid: dataId\r\n    });\r\n    // listen to image change\r\n    image.addEventListener('imagechange', this.#getFireEvent(dataId));\r\n  }\r\n\r\n  /**\r\n   * Add a new data.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {Image} image The image.\r\n   * @param {object} meta The image meta.\r\n   */\r\n  addNew(dataId, image, meta) {\r\n    if (typeof this.#dataList[dataId] !== 'undefined') {\r\n      throw new Error('Data id already used in storage: ' + dataId);\r\n    }\r\n    // store the new image\r\n    this.#dataList[dataId] = new ImageData(image, meta);\r\n    // listen to image change\r\n    image.addEventListener('imagechange', this.#getFireEvent(dataId));\r\n  }\r\n\r\n  /**\r\n   * Update the current data.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {Image} image The image.\r\n   * @param {object} meta The image meta.\r\n   */\r\n  update(dataId, image, meta) {\r\n    if (typeof this.#dataList[dataId] === 'undefined') {\r\n      throw new Error('Cannot find data to update: ' + dataId);\r\n    }\r\n    const dataToUpdate = this.#dataList[dataId];\r\n\r\n    // add slice to current image\r\n    dataToUpdate.image.appendSlice(image);\r\n\r\n    // update meta data\r\n    // TODO add time support\r\n    let idKey = '';\r\n    if (typeof meta['00020010'] !== 'undefined') {\r\n      // dicom case, use 'InstanceNumber'\r\n      idKey = '00200013';\r\n    } else {\r\n      idKey = 'imageUid';\r\n    }\r\n    dataToUpdate.meta = mergeObjects(\r\n      dataToUpdate.meta,\r\n      meta,\r\n      idKey,\r\n      'value');\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Get a fireEvent function that adds the input data id\r\n   * to the event value.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {Function} A fireEvent function.\r\n   */\r\n  #getFireEvent(dataId) {\r\n    return (event) => {\r\n      event.dataid = dataId;\r\n      this.#fireEvent(event);\r\n    };\r\n  }\r\n\r\n} // DataController class\r\n","import {arrayEquals} from './array';\r\n\r\n/**\r\n * Merge two similar objects.\r\n * Objects need to be in the form of:\r\n * <code>\r\n * {\r\n *   idKey: {valueKey: [0]},\r\n *   key0: {valueKey: [\"abc\"]},\r\n *   key1: {valueKey: [33]}\r\n * }\r\n * </code>\r\n * Merged objects will be in the form of:\r\n * <code>\r\n * {\r\n *   idKey: {valueKey: [0,1,2], merged: true},\r\n *   key0: {valueKey: {\r\n *     0: [\"abc\"],\r\n *     1: [\"def\"],\r\n *     2: [\"ghi\"]\r\n *   }},\r\n *   key1: {valueKey: {\r\n *     0: [33],\r\n *     1: [44],\r\n *     2: [55]\r\n *   }}\r\n * }\r\n * </code>\r\n *\r\n * @param {object} obj1 The first object, can be the result of a previous merge.\r\n * @param {object} obj2 The second object.\r\n * @param {string} idKey The key to use as index for duplicate values.\r\n * @param {string} valueKey The key to use to access object values.\r\n * @returns {object} The merged object.\r\n */\r\nexport function mergeObjects(obj1, obj2, idKey, valueKey) {\r\n  const res = {};\r\n  // check id key\r\n  if (!idKey) {\r\n    throw new Error('Cannot merge object with an undefined id key: ' + idKey);\r\n  } else {\r\n    if (!Object.prototype.hasOwnProperty.call(obj1, idKey)) {\r\n      throw new Error('Id key not found in first object while merging: ' +\r\n        idKey + ', obj: ' + obj1);\r\n    }\r\n    if (!Object.prototype.hasOwnProperty.call(obj2, idKey)) {\r\n      throw new Error('Id key not found in second object while merging: ' +\r\n        idKey + ', obj: ' + obj2);\r\n    }\r\n  }\r\n  // check value key\r\n  if (!valueKey) {\r\n    throw new Error('Cannot merge object with an undefined value key: ' +\r\n      valueKey);\r\n  }\r\n\r\n  // check if merged object\r\n  let mergedObj1 = false;\r\n  if (Object.prototype.hasOwnProperty.call(obj1[idKey], 'merged') &&\r\n    obj1[idKey].merged) {\r\n    mergedObj1 = true;\r\n  }\r\n  // handle the id part\r\n  if (!Object.prototype.hasOwnProperty.call(obj1[idKey], valueKey)) {\r\n    throw new Error('Id value not found in first object while merging: ' +\r\n      idKey + ', valueKey: ' + valueKey + ', ojb: ' + obj1);\r\n  }\r\n  if (!Object.prototype.hasOwnProperty.call(obj2[idKey], valueKey)) {\r\n    throw new Error('Id value not found in second object while merging: ' +\r\n      idKey + ', valueKey: ' + valueKey + ', ojb: ' + obj2);\r\n  }\r\n  let id1 = obj1[idKey][valueKey];\r\n  const id2 = obj2[idKey][valueKey][0];\r\n  // update id key\r\n  res[idKey] = obj1[idKey];\r\n  if (mergedObj1) {\r\n    // check if array does not include id2\r\n    for (let k = 0; k < id1.length; ++k) {\r\n      if (id1[k] === id2) {\r\n        throw new Error('The first object already contains id2: ' +\r\n          id2 + ', id1: ' + id1);\r\n      }\r\n    }\r\n    res[idKey][valueKey].push(id2);\r\n  } else {\r\n    id1 = id1[0];\r\n    if (id1 === id2) {\r\n      throw new Error('Cannot merge object with same ids: ' +\r\n        id1 + ', id2: ' + id2);\r\n    }\r\n    // update merge object\r\n    res[idKey][valueKey].push(id2);\r\n    res[idKey].merged = true;\r\n  }\r\n\r\n  // get keys\r\n  const keys1 = Object.keys(obj1);\r\n  // keys2 without duplicates of keys1\r\n  const keys2 = Object.keys(obj2).filter(function (item) {\r\n    return keys1.indexOf(item) < 0;\r\n  });\r\n  const keys = keys1.concat(keys2);\r\n\r\n  // loop through keys\r\n  for (let i = 0; i < keys.length; ++i) {\r\n    const key = keys[i];\r\n    if (key !== idKey) {\r\n      // first\r\n      let value1;\r\n      let subValue1;\r\n      if (Object.prototype.hasOwnProperty.call(obj1, key)) {\r\n        value1 = obj1[key];\r\n        if (Object.prototype.hasOwnProperty.call(value1, valueKey)) {\r\n          subValue1 = value1[valueKey];\r\n        }\r\n      }\r\n      // second\r\n      let value2;\r\n      let subValue2;\r\n      if (Object.prototype.hasOwnProperty.call(obj2, key)) {\r\n        value2 = obj2[key];\r\n        if (Object.prototype.hasOwnProperty.call(value2, valueKey)) {\r\n          subValue2 = value2[valueKey];\r\n        }\r\n      }\r\n      // result value\r\n      let value;\r\n      // use existing to copy properties\r\n      if (typeof value1 !== 'undefined') {\r\n        value = value1;\r\n      } else if (typeof value2 !== 'undefined') {\r\n        value = value2;\r\n      }\r\n      // create merge object if different values\r\n      if (!arrayEquals(subValue1, subValue2)) {\r\n        // add to merged object or create new\r\n        if (mergedObj1) {\r\n          if (Array.isArray(subValue1)) {\r\n            // merged object with repeated value\r\n            // copy it with the index list\r\n            value[valueKey] = {};\r\n            for (let j = 0; j < id1.length; ++j) {\r\n              value[valueKey][id1[j]] = subValue1;\r\n            }\r\n          } else {\r\n            value[valueKey] = subValue1;\r\n          }\r\n          // add obj2 value\r\n          value[valueKey][id2] = subValue2;\r\n        } else {\r\n          // create merge object\r\n          const newValue = {};\r\n          newValue[id1] = subValue1;\r\n          newValue[id2] = subValue2;\r\n          value[valueKey] = newValue;\r\n        }\r\n      }\r\n      // store value in result object\r\n      res[key] = value;\r\n    }\r\n  }\r\n  return res;\r\n}\r\n","import {ListenerHandler} from '../utils/listen';\r\nimport {getReverseOrientation} from '../dicom/dicomParser';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Get a number toprecision function with the provided precision.\r\n *\r\n * @param {number} precision The precision to achieve.\r\n * @returns {Function} The to precision function.\r\n */\r\nfunction getNumberToPrecision(precision) {\r\n  return function (num) {\r\n    return Number(num).toPrecision(precision);\r\n  };\r\n}\r\n\r\n/**\r\n * Create a default replace format from a given length.\r\n * For example: '{v0}, {v1}'.\r\n *\r\n * @param {number} length The length of the format.\r\n * @returns {string} A replace format.\r\n */\r\nfunction createDefaultReplaceFormat(length) {\r\n  let res = '';\r\n  for (let i = 0; i < length; ++i) {\r\n    if (i !== 0) {\r\n      res += ', ';\r\n    }\r\n    res += '{v' + i + '}';\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Replace flags in a input string. Flags are keywords surrounded with curly\r\n * braces in the form: '{v0}, {v1}'.\r\n *\r\n * @param {string} inputStr The input string.\r\n * @param {Array} values An array of strings.\r\n * @example\r\n *    var values = [\"a\", \"b\"];\r\n *    var str = \"The length is: {v0}. The size is: {v1}\";\r\n *    var res = replaceFlags(str, values);\r\n *    // \"The length is: a. The size is: b\"\r\n * @returns {string} The result string.\r\n */\r\nfunction replaceFlags(inputStr, values) {\r\n  let res = inputStr;\r\n  for (let i = 0; i < values.length; ++i) {\r\n    res = res.replace('{v' + i + '}', values[i]);\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * DICOM Header overlay info.\r\n */\r\nexport class OverlayData {\r\n\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * Associated data id.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #dataId;\r\n\r\n  /**\r\n   * Overlay config.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #configs;\r\n\r\n  /**\r\n   * List of event used by the config.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #eventNames = [];\r\n\r\n  /**\r\n   * Flag to know if listening to app.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isListening;\r\n\r\n  /**\r\n   * Overlay data.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #data = [];\r\n\r\n  /**\r\n   * Current data uid: set on pos change.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #currentDataUid;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   * @param {string} dataId The associated data id.\r\n   * @param {object} configs The overlay config.\r\n   */\r\n  constructor(app, dataId, configs) {\r\n    this.#app = app;\r\n    this.#dataId = dataId;\r\n    this.#configs = configs;\r\n\r\n    // parse overlays to get the list of events to listen to\r\n    const keys = Object.keys(this.#configs);\r\n    for (let i = 0; i < keys.length; ++i) {\r\n      const config = this.#configs[keys[i]];\r\n      for (let j = 0; j < config.length; ++j) {\r\n        const eventType = config[j].event;\r\n        if (typeof eventType !== 'undefined') {\r\n          if (!this.#eventNames.includes(eventType)) {\r\n            this.#eventNames.push(eventType);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // add app listeners\r\n    this.addAppListeners();\r\n  }\r\n\r\n  /**\r\n   * Reset the data.\r\n   */\r\n  reset() {\r\n    this.#data = [];\r\n    this.#currentDataUid = undefined;\r\n  }\r\n\r\n  /**\r\n   * Handle a new loaded item event.\r\n   *\r\n   * @param {object} data The item meta data.\r\n   */\r\n  addItemMeta(data) {\r\n    // create and store overlay data\r\n    let dataUid;\r\n    // check if dicom data (00020010: transfer syntax)\r\n    if (typeof data['00020010'] !== 'undefined') {\r\n      if (typeof data['00080018'] !== 'undefined') {\r\n        // SOP instance UID\r\n        dataUid = data['00080018'].value[0];\r\n      } else {\r\n        dataUid = data.length;\r\n      }\r\n      this.#data[dataUid] = createOverlayData(data, this.#configs);\r\n    } else {\r\n      // image file case\r\n      const keys = Object.keys(data);\r\n      for (let d = 0; d < keys.length; ++d) {\r\n        const obj = data[keys[d]];\r\n        if (keys[d] === 'imageUid') {\r\n          dataUid = obj.value;\r\n          break;\r\n        }\r\n      }\r\n      this.#data[dataUid] = createOverlayDataForDom(data, this.#configs);\r\n    }\r\n    // store uid\r\n    this.#currentDataUid = dataUid;\r\n  }\r\n\r\n  /**\r\n   * Handle a changed slice event.\r\n   *\r\n   * @param {object} event The slicechange event.\r\n   */\r\n  #onSliceChange = (event) => {\r\n    if (event.dataid !== this.#dataId) {\r\n      return;\r\n    }\r\n    if (typeof event.data !== 'undefined' &&\r\n      typeof event.data.imageUid !== 'undefined' &&\r\n      this.#currentDataUid !== event.data.imageUid) {\r\n      this.#currentDataUid = event.data.imageUid;\r\n      this.#updateData(event);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Update the overlay data\r\n   *\r\n   * @param {object} event An event defined by the overlay map and\r\n   *   registered in toggleListeners\r\n   */\r\n  #updateData = (event) => {\r\n    if (event.dataid !== this.#dataId) {\r\n      return;\r\n    }\r\n\r\n    const sliceOverlayData = this.#data[this.#currentDataUid];\r\n    if (typeof sliceOverlayData === 'undefined') {\r\n      console.warn('No slice overlay data for: ' + this.#currentDataUid);\r\n      return;\r\n    }\r\n\r\n    for (let n = 0; n < sliceOverlayData.length; ++n) {\r\n      let text = undefined;\r\n      if (typeof sliceOverlayData[n].tags !== 'undefined') {\r\n        // update tags only on slice change\r\n        if (event.type === 'positionchange') {\r\n          text = sliceOverlayData[n].value;\r\n        }\r\n      } else {\r\n        // update text if the value is an event type\r\n        if (typeof sliceOverlayData[n].event !== 'undefined' &&\r\n          sliceOverlayData[n].event === event.type) {\r\n          const format = sliceOverlayData[n].format;\r\n          let values = event.value;\r\n          // optional number precision\r\n          if (typeof sliceOverlayData[n].precision !== 'undefined') {\r\n            let mapFunc = null;\r\n            if (sliceOverlayData[n].precision === 'round') {\r\n              mapFunc = Math.round;\r\n            } else {\r\n              mapFunc = getNumberToPrecision(sliceOverlayData[n].precision);\r\n            }\r\n            values = values.map(mapFunc);\r\n          }\r\n          text = replaceFlags(format, values);\r\n        }\r\n      }\r\n      if (typeof text !== 'undefined') {\r\n        sliceOverlayData[n].value = text;\r\n      }\r\n    }\r\n\r\n    // fire valuechange for listeners\r\n    this.#fireEvent({type: 'valuechange', data: sliceOverlayData});\r\n  };\r\n\r\n  /**\r\n   * Is this class listening to app events.\r\n   *\r\n   * @returns {boolean} True is listening to app events.\r\n   */\r\n  isListening() {\r\n    return this.#isListening;\r\n  }\r\n\r\n  /**\r\n   * Toggle info listeners.\r\n   */\r\n  addAppListeners() {\r\n    // listen to update tags data\r\n    this.#app.addEventListener('positionchange', this.#onSliceChange);\r\n    // add event listeners\r\n    for (let i = 0; i < this.#eventNames.length; ++i) {\r\n      this.#app.addEventListener(this.#eventNames[i], this.#updateData);\r\n    }\r\n    // update flag\r\n    this.#isListening = true;\r\n  }\r\n\r\n  /**\r\n   * Toggle info listeners.\r\n   */\r\n  removeAppListeners() {\r\n    // stop listening to update tags data\r\n    this.#app.removeEventListener('positionchange', this.#onSliceChange);\r\n    // remove event listeners\r\n    for (let i = 0; i < this.#eventNames.length; ++i) {\r\n      this.#app.removeEventListener(this.#eventNames[i], this.#updateData);\r\n    }\r\n    // update flag\r\n    this.#isListening = false;\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {object} callback The method associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {object} callback The method associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent(event) {\r\n    this.#listenerHandler.fireEvent(event);\r\n  }\r\n\r\n} // class OverlayData\r\n\r\n/**\r\n * Create overlay data array for a DICOM image.\r\n *\r\n * @param {object} dicomElements DICOM elements of the image.\r\n * @param {object} configs The overlay data configs.\r\n * @returns {Array} Overlay data array.\r\n */\r\nfunction createOverlayData(dicomElements, configs) {\r\n  const overlays = [];\r\n  let modality;\r\n  const modElement = dicomElements['00080060'];\r\n  if (typeof modElement !== 'undefined') {\r\n    modality = modElement.value[0];\r\n  } else {\r\n    return overlays;\r\n  }\r\n  const config = configs[modality] || configs['*'];\r\n  if (!config) {\r\n    return overlays;\r\n  }\r\n\r\n  for (let n = 0; n < config.length; ++n) {\r\n    // deep copy\r\n    const overlay = JSON.parse(JSON.stringify(config[n]));\r\n\r\n    // add tag values\r\n    const tags = overlay.tags;\r\n    if (typeof tags !== 'undefined' && tags.length !== 0) {\r\n      // get values\r\n      const values = [];\r\n      for (let i = 0; i < tags.length; ++i) {\r\n        const elem = dicomElements[tags[i]];\r\n        if (typeof elem !== 'undefined') {\r\n          values.push(dicomElements[tags[i]].value);\r\n        } else {\r\n          values.push('');\r\n        }\r\n      }\r\n      // format\r\n      if (typeof overlay.format === 'undefined' || overlay.format === null) {\r\n        overlay.format = createDefaultReplaceFormat(values.length);\r\n      }\r\n      overlay.value = replaceFlags(overlay.format, values).trim();\r\n    }\r\n\r\n    // store\r\n    overlays.push(overlay);\r\n  }\r\n\r\n  // (0020,0020) Patient Orientation\r\n  const poElement = dicomElements['00200020'];\r\n  if (typeof poElement !== 'undefined' &&\r\n    poElement.value.length === 2\r\n  ) {\r\n    const po0 = poElement.value[0];\r\n    const po1 = poElement.value[1];\r\n    overlays.push({\r\n      pos: 'cr', value: po0, format: '{v0}'\r\n    });\r\n    overlays.push({\r\n      pos: 'cl', value: getReverseOrientation(po0), format: '{v0}'\r\n    });\r\n    overlays.push({\r\n      pos: 'bc', value: po1, format: '{v0}'\r\n    });\r\n    overlays.push({\r\n      pos: 'tc', value: getReverseOrientation(po1), format: '{v0}'\r\n    });\r\n  }\r\n\r\n  return overlays;\r\n}\r\n\r\n/**\r\n * Create overlay data array for a DOM image.\r\n *\r\n * @param {object} info Meta data.\r\n * @param {object} configs The overlay data configs.\r\n * @returns {Array} Overlay data array.\r\n */\r\nfunction createOverlayDataForDom(info, configs) {\r\n  const overlays = [];\r\n  const config = configs.DOM;\r\n  if (!config) {\r\n    return overlays;\r\n  }\r\n\r\n  const infoKeys = Object.keys(info);\r\n\r\n  for (let n = 0; n < config.length; ++n) {\r\n    // deep copy\r\n    const overlay = JSON.parse(JSON.stringify(config[n]));\r\n\r\n    // add tag values\r\n    const tags = overlay.tags;\r\n    if (typeof tags !== 'undefined' && tags.length !== 0) {\r\n      // get values\r\n      const values = [];\r\n      for (let i = 0; i < tags.length; ++i) {\r\n        for (let j = 0; j < infoKeys.length; ++j) {\r\n          if (tags[i] === infoKeys[j]) {\r\n            values.push(info[infoKeys[j]].value);\r\n          }\r\n        }\r\n      }\r\n      // format\r\n      if (typeof overlay.format === 'undefined' || overlay.format === null) {\r\n        overlay.format = createDefaultReplaceFormat(values.length);\r\n      }\r\n      overlay.value = replaceFlags(overlay.format, values).trim();\r\n    }\r\n\r\n    // store\r\n    overlays.push(overlay);\r\n  }\r\n\r\n  return overlays;\r\n}\r\n","import {getLayerDetailsFromEvent} from '../gui/layerGroup';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Scroll wheel class: provides a wheel event handler\r\n *   that scroll the corresponding data.\r\n */\r\nexport class ScrollWheel {\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * Accumulated wheel event deltaY.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #wheelDeltaY = 0;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Handle mouse wheel event.\r\n   *\r\n   * @param {WheelEvent} event The mouse wheel event.\r\n   */\r\n  wheel(event) {\r\n    // deltaMode (deltaY values on my machine...):\r\n    // - 0 (DOM_DELTA_PIXEL): chrome, deltaY mouse scroll = 53\r\n    // - 1 (DOM_DELTA_LINE): firefox, deltaY mouse scroll = 6\r\n    // - 2 (DOM_DELTA_PAGE): ??\r\n    // TODO: check scroll event\r\n    let scrollMin = 52;\r\n    if (event.deltaMode === 1) {\r\n      scrollMin = 5.99;\r\n    }\r\n    this.#wheelDeltaY += event.deltaY;\r\n    if (Math.abs(this.#wheelDeltaY) < scrollMin) {\r\n      return;\r\n    } else {\r\n      this.#wheelDeltaY = 0;\r\n    }\r\n\r\n    const up = event.deltaY < 0 ? true : false;\r\n\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewController =\r\n      layerGroup.getActiveViewLayer().getViewController();\r\n    const imageSize = viewController.getImageSize();\r\n    if (imageSize.canScroll3D()) {\r\n      if (up) {\r\n        viewController.incrementScrollIndex();\r\n      } else {\r\n        viewController.decrementScrollIndex();\r\n      }\r\n    } else if (imageSize.moreThanOne(3)) {\r\n      if (up) {\r\n        viewController.incrementIndex(3);\r\n      } else {\r\n        viewController.decrementIndex(3);\r\n      }\r\n    }\r\n  }\r\n\r\n} // ScrollWheel class\r\n","/**\r\n * Namespace for translation function.\r\n * (in a namespace to allow for override from client)\r\n */\r\nexport const i18n = {\r\n\r\n  /**\r\n   * Get the translated text.\r\n   *\r\n   * @param {string} key The key to the text entry.\r\n   * @returns {string|undefined} The translated text.\r\n   */\r\n  t(key) {\r\n    // defaut expects something like 'unit.cm2'\r\n    const unit = {\r\n      mm: 'mm',\r\n      cm2: 'cm',\r\n      degree: ''\r\n    };\r\n    const props = key.split('.');\r\n    if (props.length !== 2) {\r\n      throw new Error('Unexpected translation key length.');\r\n    }\r\n    if (props[0] !== 'unit') {\r\n      throw new Error('Unexpected translation key prefix.');\r\n    }\r\n    return unit[props[1]];\r\n  }\r\n\r\n};\r\n","import {Point2D} from './point';\r\nimport {i18n} from '../utils/i18n';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ViewController} from '../app/viewController';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Line shape.\r\n */\r\nexport class Line {\r\n\r\n  /**\r\n   * Line begin point.\r\n   *\r\n   * @type {Point2D}\r\n   */\r\n  #begin;\r\n\r\n  /**\r\n   * Line end point.\r\n   *\r\n   * @type {Point2D}\r\n   */\r\n  #end;\r\n\r\n  /**\r\n   * @param {Point2D} begin A Point2D representing the beginning\r\n   *   of the line.\r\n   * @param {Point2D} end A Point2D representing the end of the line.\r\n   */\r\n  constructor(begin, end) {\r\n    this.#begin = begin;\r\n    this.#end = end;\r\n  }\r\n\r\n  /**\r\n   * Get the begin point of the line.\r\n   *\r\n   * @returns {Point2D} The beginning point of the line.\r\n   */\r\n  getBegin() {\r\n    return this.#begin;\r\n  }\r\n\r\n  /**\r\n   * Get the end point of the line.\r\n   *\r\n   * @returns {Point2D} The ending point of the line.\r\n   */\r\n  getEnd() {\r\n    return this.#end;\r\n  }\r\n\r\n  /**\r\n   * Check for equality.\r\n   *\r\n   * @param {Line} rhs The object to compare to.\r\n   * @returns {boolean} True if both objects are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      this.getBegin().equals(rhs.getBegin()) &&\r\n      this.getEnd().equals(rhs.getEnd());\r\n  }\r\n\r\n  /**\r\n   * Get the line delta in the X direction.\r\n   *\r\n   * @returns {number} The delta in the X direction.\r\n   */\r\n  getDeltaX() {\r\n    return this.getEnd().getX() - this.getBegin().getX();\r\n  }\r\n\r\n  /**\r\n   * Get the line delta in the Y direction.\r\n   *\r\n   * @returns {number} The delta in the Y direction.\r\n   */\r\n  getDeltaY() {\r\n    return this.getEnd().getY() - this.getBegin().getY();\r\n  }\r\n\r\n  /**\r\n   * Get the length of the line.\r\n   *\r\n   * @returns {number} The length of the line.\r\n   */\r\n  getLength() {\r\n    return Math.sqrt(\r\n      this.getDeltaX() * this.getDeltaX() +\r\n      this.getDeltaY() * this.getDeltaY()\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the length of the line according to a  spacing.\r\n   *\r\n   * @param {number} spacingX The X spacing.\r\n   * @param {number} spacingY The Y spacing.\r\n   * @returns {number} The length of the line with spacing\r\n   *  or null for null spacings.\r\n   */\r\n  getWorldLength(spacingX, spacingY) {\r\n    let wlen = null;\r\n    if (spacingX !== null && spacingY !== null) {\r\n      const dxs = this.getDeltaX() * spacingX;\r\n      const dys = this.getDeltaY() * spacingY;\r\n      wlen = Math.sqrt(dxs * dxs + dys * dys);\r\n    }\r\n    return wlen;\r\n  }\r\n\r\n  /**\r\n   * Get the mid point of the line.\r\n   *\r\n   * @returns {Point2D} The mid point of the line.\r\n   */\r\n  getMidpoint() {\r\n    return new Point2D(\r\n      (this.getBegin().getX() + this.getEnd().getX()) / 2,\r\n      (this.getBegin().getY() + this.getEnd().getY()) / 2\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the slope of the line.\r\n   *\r\n   * @returns {number} The slope of the line.\r\n   */\r\n  getSlope() {\r\n    return this.getDeltaY() / this.getDeltaX();\r\n  }\r\n\r\n  /**\r\n   * Get the intercept of the line.\r\n   *\r\n   * @returns {number} The slope of the line.\r\n   */\r\n  getIntercept() {\r\n    return (\r\n      this.getEnd().getX() * this.getBegin().getY() -\r\n      this.getBegin().getX() * this.getEnd().getY()\r\n    ) / this.getDeltaX();\r\n  }\r\n\r\n  /**\r\n   * Get the inclination of the line.\r\n   *\r\n   * @returns {number} The inclination of the line.\r\n   */\r\n  getInclination() {\r\n    // tan(theta) = slope\r\n    const angle =\r\n      Math.atan2(this.getDeltaY(), this.getDeltaX()) * 180 / Math.PI;\r\n    // shift?\r\n    return 180 - angle;\r\n  }\r\n\r\n  /**\r\n   * Quantify a line according to view information.\r\n   *\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @returns {object} A quantification object.\r\n   */\r\n  quantify(viewController) {\r\n    const quant = {};\r\n    // length\r\n    const spacing = viewController.get2DSpacing();\r\n    const length = this.getWorldLength(spacing[0], spacing[1]);\r\n    if (length !== null) {\r\n      quant.length = {value: length, unit: i18n.t('unit.mm')};\r\n    }\r\n    // return\r\n    return quant;\r\n  }\r\n\r\n} // Line class\r\n\r\n/**\r\n * Get the angle between two lines in degree.\r\n *\r\n * @param {Line} line0 The first line.\r\n * @param {Line} line1 The second line.\r\n * @returns {number} The angle.\r\n */\r\nexport function getAngle(line0, line1) {\r\n  const dx0 = line0.getDeltaX();\r\n  const dy0 = line0.getDeltaY();\r\n  const dx1 = line1.getDeltaX();\r\n  const dy1 = line1.getDeltaY();\r\n  // dot = ||a||*||b||*cos(theta)\r\n  const dot = dx0 * dx1 + dy0 * dy1;\r\n  // cross = ||a||*||b||*sin(theta)\r\n  const det = dx0 * dy1 - dy0 * dx1;\r\n  // tan = sin / cos\r\n  const angle = Math.atan2(det, dot) * 180 / Math.PI;\r\n  // complementary angle\r\n  // shift?\r\n  return 360 - (180 - angle);\r\n}\r\n\r\n/**\r\n * Get a perpendicular line to an input one.\r\n *\r\n * @param {Line} line The line to be perpendicular to.\r\n * @param {Point2D} point The middle point of the perpendicular line.\r\n * @param {number} length The length of the perpendicular line.\r\n * @returns {object} A perpendicular line.\r\n */\r\nexport function getPerpendicularLine(line, point, length) {\r\n  // begin point\r\n  let beginX = 0;\r\n  let beginY = 0;\r\n  // end point\r\n  let endX = 0;\r\n  let endY = 0;\r\n\r\n  // check slope:\r\n  // 0 -> horizontal\r\n  // Infinite -> vertical (a/Infinite = 0)\r\n  if (line.getSlope() !== 0) {\r\n    // a0 * a1 = -1\r\n    const slope = -1 / line.getSlope();\r\n    // y0 = a1*x0 + b1 -> b1 = y0 - a1*x0\r\n    const intercept = point.getY() - slope * point.getX();\r\n\r\n    // 1. (x - x0)^2 + (y - y0)^2 = d^2\r\n    // 2. a = (y - y0) / (x - x0) -> y = a*(x - x0) + y0\r\n    // ->  (x - x0)^2 + m^2 * (x - x0)^2 = d^2\r\n    // -> x = x0 +- d / sqrt(1+m^2)\r\n\r\n    // length is the distance between begin and end,\r\n    // point is half way between both -> d = length / 2\r\n    const dx = length / (2 * Math.sqrt(1 + slope * slope));\r\n\r\n    // begin point\r\n    beginX = point.getX() - dx;\r\n    beginY = slope * beginX + intercept;\r\n    // end point\r\n    endX = point.getX() + dx;\r\n    endY = slope * endX + intercept;\r\n  } else {\r\n    // horizontal input line -> perpendicular is vertical!\r\n    // begin point\r\n    beginX = point.getX();\r\n    beginY = point.getY() - length / 2;\r\n    // end point\r\n    endX = point.getX();\r\n    endY = point.getY() + length / 2;\r\n  }\r\n  // perpendicalar line\r\n  return new Line(\r\n    new Point2D(beginX, beginY),\r\n    new Point2D(endX, endY));\r\n}\r\n","/**\r\n * Statistics storage class.\r\n * 'simple' statistics do not include median, p25 nor p75.\r\n */\r\nexport class Statistics {\r\n  /**\r\n   * Minimum.\r\n   *\r\n   * @type {number}\r\n   */\r\n  min;\r\n  /**\r\n   * Maximum.\r\n   *\r\n   * @type {number}\r\n   */\r\n  max;\r\n  /**\r\n   * Mean.\r\n   *\r\n   * @type {number}\r\n   */\r\n  mean;\r\n  /**\r\n   * Standard deviation.\r\n   *\r\n   * @type {number}\r\n   */\r\n  stdDev;\r\n  /**\r\n   * Median.\r\n   *\r\n   * @type {number|undefined}\r\n   */\r\n  median;\r\n  /**\r\n   * 25th percentile.\r\n   *\r\n   * @type {number|undefined}\r\n   */\r\n  p25;\r\n  /**\r\n   * 75th percentile.\r\n   *\r\n   * @type {number|undefined}\r\n   */\r\n  p75;\r\n\r\n  /**\r\n   * @param {number} min The minimum.\r\n   * @param {number} max The maxnimum.\r\n   * @param {number} mean The mean.\r\n   * @param {number} stdDev The standard deviation.\r\n   */\r\n  constructor(min, max, mean, stdDev) {\r\n    this.min = min;\r\n    this.max = max;\r\n    this.mean = mean;\r\n    this.stdDev = stdDev;\r\n  }\r\n}\r\n\r\n/**\r\n * Get statistics on an input array of number.\r\n * Note: could use {@link https://github.com/tmcw/simple-statistics}.\r\n *\r\n * @param {number[]} values The array of values to extract stats from.\r\n * @param {string[]} flags A list of stat value names to calculate.\r\n * @returns {Statistics} A statistics object.\r\n */\r\nexport function getStats(values, flags) {\r\n  if (includesFullStatsFlags(flags)) {\r\n    return getFullStats(values);\r\n  } else {\r\n    return getSimpleStats(values);\r\n  }\r\n}\r\n\r\n/**\r\n * Does the input flag list contain a full stat element?\r\n *\r\n * @param {string[]} flags A list of stat values to calculate.\r\n * @returns {boolean} True if one of the flags is a full stat flag.\r\n */\r\nfunction includesFullStatsFlags(flags) {\r\n  return typeof flags !== 'undefined' &&\r\n    flags !== null &&\r\n    (flags.includes('median') ||\r\n    flags.includes('p25') ||\r\n    flags.includes('p75'));\r\n}\r\n\r\n/**\r\n * Get simple stats: minimum, maximum, mean and standard deviation\r\n * of an array of values.\r\n *\r\n * @param {number[]} values The array of values to extract stats from.\r\n * @returns {Statistics} Simple statistics (no median, p25 nor p75).\r\n */\r\nfunction getSimpleStats(values) {\r\n  let min = values[0];\r\n  let max = min;\r\n  let sum = 0;\r\n  let sumSqr = 0;\r\n  let val = 0;\r\n  const length = values.length;\r\n  for (let i = 0; i < length; ++i) {\r\n    val = values[i];\r\n    if (val < min) {\r\n      min = val;\r\n    } else if (val > max) {\r\n      max = val;\r\n    }\r\n    sum += val;\r\n    sumSqr += val * val;\r\n  }\r\n\r\n  const mean = sum / length;\r\n  // see http://en.wikipedia.org/wiki/Algorithms_for_calculating_variance\r\n  const variance = sumSqr / length - mean * mean;\r\n  const stdDev = Math.sqrt(variance);\r\n\r\n  return new Statistics(min, max, mean, stdDev);\r\n}\r\n\r\n/**\r\n * Get full stats: minimum, maximum, mean, standard deviation, median, 25%\r\n * and 75% percentile of an array of values.\r\n *\r\n * @param {number[]} values The array of values to extract stats from.\r\n * @returns {Statistics} Complete statistics (includes median, p25 and p75).\r\n */\r\nfunction getFullStats(values) {\r\n  // get simple stats\r\n  const stats = getSimpleStats(values);\r\n\r\n  // sort array... can get slow...\r\n  values.sort(function (a, b) {\r\n    return a - b;\r\n  });\r\n\r\n  stats.median = getPercentile(values, 0.5);\r\n  stats.p25 = getPercentile(values, 0.25);\r\n  stats.p75 = getPercentile(values, 0.75);\r\n\r\n  return stats;\r\n}\r\n\r\n/**\r\n * Get an arrays' percentile. Uses linear interpolation for percentiles\r\n * that lie between data points.\r\n * see https://en.wikipedia.org/wiki/Percentile (second variant interpolation)\r\n *\r\n * @param {number[]} values The sorted array of values.\r\n * @param {number} ratio The percentile ratio [0-1].\r\n * @returns {number} The percentile.\r\n */\r\nfunction getPercentile(values, ratio) {\r\n  // check input\r\n  if (values.length === 0) {\r\n    throw new Error('Empty array provided for percentile calculation.');\r\n  }\r\n  if (ratio < 0 || ratio > 1) {\r\n    throw new Error(\r\n      'Invalid ratio provided for percentile calculation: ' + ratio);\r\n  }\r\n  // return min for ratio=0 amd max for ratio=1\r\n  if (ratio === 0) {\r\n    return values[0];\r\n  } else if (ratio === 1) {\r\n    return values[values.length - 1];\r\n  }\r\n  // general case: interpolate between indices if needed\r\n  const i = (values.length - 1) * ratio;\r\n  const i0 = Math.floor(i);\r\n  const v0 = values[i0];\r\n  const v1 = values[i0 + 1];\r\n  return v0 + (v1 - v0) * (i - i0);\r\n}\r\n\r\n/**\r\n * Unique ID generator.\r\n * See {@link http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript}\r\n * and this {@link http://stackoverflow.com/a/13403498 answer}.\r\n *\r\n * @returns {string} A unique ID.\r\n */\r\nexport function guid() {\r\n  return Math.random().toString(36).substring(2, 15);\r\n}\r\n","import {logger} from '../utils/logger';\r\nimport {getShapeDisplayName, ChangeGroupCommand} from './drawCommands';\r\nimport {validateAnchorPosition} from './draw';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\nimport {ViewController} from '../app/viewController';\r\nimport {DrawLayer} from '../gui/drawLayer';\r\nimport {Style} from '../gui/style';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Get the default anchor shape.\r\n *\r\n * @param {number} x The X position.\r\n * @param {number} y The Y position.\r\n * @param {string} id The shape id.\r\n * @param {Style} style The application style.\r\n * @returns {Konva.Ellipse} The default anchor shape.\r\n */\r\nexport function getDefaultAnchor(x, y, id, style) {\r\n  const radius = style.applyZoomScale(3);\r\n  const absRadius = {\r\n    x: Math.abs(radius.x),\r\n    y: Math.abs(radius.y)\r\n  };\r\n  return new Konva.Ellipse({\r\n    x: x,\r\n    y: y,\r\n    stroke: '#999',\r\n    fill: 'rgba(100,100,100,0.7',\r\n    strokeWidth: style.getStrokeWidth(),\r\n    strokeScaleEnabled: false,\r\n    radius: absRadius,\r\n    radiusX: absRadius.x,\r\n    radiusY: absRadius.y,\r\n    name: 'anchor',\r\n    id: id.toString(),\r\n    dragOnTop: false,\r\n    draggable: true,\r\n    visible: false\r\n  });\r\n}\r\n\r\n/**\r\n * Shape editor.\r\n */\r\nexport class ShapeEditor {\r\n\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Shape factory list\r\n   *\r\n   * @type {object}\r\n   */\r\n  #shapeFactoryList = null;\r\n\r\n  /**\r\n   * Current shape factory.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #currentFactory = null;\r\n\r\n  /**\r\n   * Edited shape.\r\n   *\r\n   * @type {Konva.Shape}\r\n   */\r\n  #shape = null;\r\n\r\n  /**\r\n   * Associated draw layer. Used to bound anchor move.\r\n   *\r\n   * @type {DrawLayer}\r\n   */\r\n  #drawLayer;\r\n\r\n  /**\r\n   * Associated view controller. Used for quantification update.\r\n   *\r\n   * @type {ViewController}\r\n   */\r\n  #viewController = null;\r\n\r\n  /**\r\n   * Active flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isActive = false;\r\n\r\n  /**\r\n   * @callback eventFn\r\n   * @param {object} event The event.\r\n   */\r\n\r\n  /**\r\n   * Draw event callback.\r\n   *\r\n   * @type {eventFn}\r\n   */\r\n  #drawEventCallback = null;\r\n\r\n  /**\r\n   * Set the tool options.\r\n   *\r\n   * @param {Array} list The list of shape classes.\r\n   */\r\n  setFactoryList(list) {\r\n    this.#shapeFactoryList = list;\r\n  }\r\n\r\n  /**\r\n   * Set the shape to edit.\r\n   *\r\n   * @param {Konva.Shape} inshape The shape to edit.\r\n   * @param {DrawLayer} drawLayer The associated draw layer.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  setShape(inshape, drawLayer, viewController) {\r\n    this.#shape = inshape;\r\n    this.#drawLayer = drawLayer;\r\n    this.#viewController = viewController;\r\n    if (this.#shape) {\r\n      // remove old anchors\r\n      this.#removeAnchors();\r\n      // find a factory for the input shape\r\n      const group = this.#shape.getParent();\r\n      const keys = Object.keys(this.#shapeFactoryList);\r\n      this.#currentFactory = null;\r\n      for (let i = 0; i < keys.length; ++i) {\r\n        const factory = new this.#shapeFactoryList[keys[i]];\r\n        if (factory.isFactoryGroup(group)) {\r\n          this.#currentFactory = factory;\r\n          // stop at first find\r\n          break;\r\n        }\r\n      }\r\n      if (this.#currentFactory === null) {\r\n        throw new Error('Could not find a factory to update shape.');\r\n      }\r\n      // add new anchors\r\n      this.#addAnchors();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the edited shape.\r\n   *\r\n   * @returns {Konva.Shape} The edited shape.\r\n   */\r\n  getShape() {\r\n    return this.#shape;\r\n  }\r\n\r\n  /**\r\n   * Get the active flag.\r\n   *\r\n   * @returns {boolean} The active flag.\r\n   */\r\n  isActive() {\r\n    return this.#isActive;\r\n  }\r\n\r\n  /**\r\n   * Set the draw event callback.\r\n   *\r\n   * @param {eventFn} callback The callback.\r\n   */\r\n  setDrawEventCallback(callback) {\r\n    this.#drawEventCallback = callback;\r\n  }\r\n\r\n  /**\r\n   * Enable the editor. Redraws the layer.\r\n   */\r\n  enable() {\r\n    this.#isActive = true;\r\n    if (this.#shape) {\r\n      this.#setAnchorsVisible(true);\r\n      if (this.#shape.getLayer()) {\r\n        this.#shape.getLayer().draw();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disable the editor. Redraws the layer.\r\n   */\r\n  disable() {\r\n    this.#isActive = false;\r\n    if (this.#shape) {\r\n      this.#setAnchorsVisible(false);\r\n      if (this.#shape.getLayer()) {\r\n        this.#shape.getLayer().draw();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset the editor.\r\n   */\r\n  reset() {\r\n    this.#shape = undefined;\r\n    this.#drawLayer = undefined;\r\n    this.#viewController = undefined;\r\n  }\r\n\r\n  /**\r\n   * Reset the anchors.\r\n   */\r\n  resetAnchors() {\r\n    // remove previous controls\r\n    this.#removeAnchors();\r\n    // add anchors\r\n    this.#addAnchors();\r\n    // set them visible\r\n    this.#setAnchorsVisible(true);\r\n  }\r\n\r\n  /**\r\n   * Apply a function on all anchors.\r\n   *\r\n   * @param {object} func A f(shape) function.\r\n   */\r\n  #applyFuncToAnchors(func) {\r\n    if (this.#shape && this.#shape.getParent()) {\r\n      const anchors = this.#shape.getParent().find('.anchor');\r\n      anchors.forEach(func);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set anchors visibility.\r\n   *\r\n   * @param {boolean} flag The visible flag.\r\n   */\r\n  #setAnchorsVisible(flag) {\r\n    this.#applyFuncToAnchors(function (anchor) {\r\n      anchor.visible(flag);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set anchors active.\r\n   *\r\n   * @param {boolean} flag The active (on/off) flag.\r\n   */\r\n  setAnchorsActive(flag) {\r\n    let func = null;\r\n    if (flag) {\r\n      func = (anchor) => {\r\n        this.#setAnchorOn(anchor);\r\n      };\r\n    } else {\r\n      func = (anchor) => {\r\n        this.#setAnchorOff(anchor);\r\n      };\r\n    }\r\n    this.#applyFuncToAnchors(func);\r\n  }\r\n\r\n  /**\r\n   * Remove anchors.\r\n   */\r\n  #removeAnchors() {\r\n    this.#applyFuncToAnchors(function (anchor) {\r\n      anchor.remove();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the shape anchors.\r\n   */\r\n  #addAnchors() {\r\n    // exit if no shape or no layer\r\n    if (!this.#shape || !this.#shape.getLayer()) {\r\n      return;\r\n    }\r\n    // get shape group\r\n    const group = this.#shape.getParent();\r\n\r\n    // activate and add anchors to group\r\n    const anchors =\r\n      this.#currentFactory.getAnchors(this.#shape, this.#app.getStyle());\r\n    for (let i = 0; i < anchors.length; ++i) {\r\n      // set anchor on\r\n      this.#setAnchorOn(anchors[i]);\r\n      // add the anchor to the group\r\n      group.add(anchors[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a simple clone of the input anchor.\r\n   *\r\n   * @param {Konva.Shape} anchor The anchor to clone.\r\n   * @returns {object} A clone of the input anchor.\r\n   */\r\n  #getClone(anchor) {\r\n    // create closure to properties\r\n    const parent = anchor.getParent();\r\n    const id = anchor.id();\r\n    const x = anchor.x();\r\n    const y = anchor.y();\r\n    // create clone object\r\n    const clone = {};\r\n    clone.getParent = function () {\r\n      return parent;\r\n    };\r\n    clone.id = function () {\r\n      return id;\r\n    };\r\n    clone.x = function () {\r\n      return x;\r\n    };\r\n    clone.y = function () {\r\n      return y;\r\n    };\r\n    return clone;\r\n  }\r\n\r\n  /**\r\n   * Set the anchor on listeners.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The anchor to set on.\r\n   */\r\n  #setAnchorOn(anchor) {\r\n    let startAnchor = null;\r\n\r\n    // command name based on shape type\r\n    const shapeDisplayName = getShapeDisplayName(this.#shape);\r\n\r\n    // drag start listener\r\n    anchor.on('dragstart.edit', (event) => {\r\n      const anchor = event.target;\r\n      if (!(anchor instanceof Konva.Shape)) {\r\n        return;\r\n      }\r\n      startAnchor = this.#getClone(anchor);\r\n      // prevent bubbling upwards\r\n      event.cancelBubble = true;\r\n    });\r\n    // drag move listener\r\n    anchor.on('dragmove.edit', (event) => {\r\n      const anchor = event.target;\r\n      if (!(anchor instanceof Konva.Shape)) {\r\n        return;\r\n      }\r\n      // validate the anchor position\r\n      validateAnchorPosition(this.#drawLayer.getBaseSize(), anchor);\r\n      // update shape\r\n      this.#currentFactory.update(\r\n        anchor, this.#app.getStyle(), this.#viewController);\r\n      // redraw\r\n      if (anchor.getLayer()) {\r\n        anchor.getLayer().draw();\r\n      } else {\r\n        logger.warn('No layer to draw the anchor!');\r\n      }\r\n      // prevent bubbling upwards\r\n      event.cancelBubble = true;\r\n    });\r\n    // drag end listener\r\n    anchor.on('dragend.edit', (event) => {\r\n      const anchor = event.target;\r\n      if (!(anchor instanceof Konva.Shape)) {\r\n        return;\r\n      }\r\n      const endAnchor = this.#getClone(anchor);\r\n      // store the change command\r\n      const chgcmd = new ChangeGroupCommand(\r\n        shapeDisplayName,\r\n        this.#currentFactory,\r\n        startAnchor,\r\n        endAnchor,\r\n        this.#drawLayer,\r\n        this.#viewController,\r\n        this.#app.getStyle()\r\n      );\r\n      chgcmd.onExecute = this.#drawEventCallback;\r\n      chgcmd.onUndo = this.#drawEventCallback;\r\n      chgcmd.execute();\r\n      this.#app.addToUndoStack(chgcmd);\r\n      // reset start anchor\r\n      startAnchor = endAnchor;\r\n      // prevent bubbling upwards\r\n      event.cancelBubble = true;\r\n    });\r\n    // mouse down listener\r\n    anchor.on('mousedown touchstart', (event) => {\r\n      const anchor = event.target;\r\n      anchor.moveToTop();\r\n    });\r\n    // mouse over styling\r\n    anchor.on('mouseover.edit', (event) => {\r\n      const anchor = event.target;\r\n      if (!(anchor instanceof Konva.Shape)) {\r\n        return;\r\n      }\r\n      // style is handled by the group\r\n      anchor.stroke('#ddd');\r\n      if (anchor.getLayer()) {\r\n        anchor.getLayer().draw();\r\n      } else {\r\n        logger.warn('No layer to draw the anchor!');\r\n      }\r\n    });\r\n    // mouse out styling\r\n    anchor.on('mouseout.edit', (event) => {\r\n      const anchor = event.target;\r\n      if (!(anchor instanceof Konva.Shape)) {\r\n        return;\r\n      }\r\n      // style is handled by the group\r\n      anchor.stroke('#999');\r\n      if (anchor.getLayer()) {\r\n        anchor.getLayer().draw();\r\n      } else {\r\n        logger.warn('No layer to draw the anchor!');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the anchor off listeners.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The anchor to set off.\r\n   */\r\n  #setAnchorOff(anchor) {\r\n    anchor.off('dragstart.edit');\r\n    anchor.off('dragmove.edit');\r\n    anchor.off('dragend.edit');\r\n    anchor.off('mousedown touchstart');\r\n    anchor.off('mouseover.edit');\r\n    anchor.off('mouseout.edit');\r\n  }\r\n\r\n} // class Editor\r\n","import {getLayerDetailsFromEvent} from '../gui/layerGroup';\r\nimport {\r\n  getEventOffset,\r\n  customUI\r\n} from '../gui/generic';\r\nimport {Point2D} from '../math/point';\r\nimport {guid} from '../math/stats';\r\nimport {logger} from '../utils/logger';\r\nimport {replaceFlags} from '../utils/string';\r\nimport {\r\n  getShapeDisplayName,\r\n  DrawGroupCommand,\r\n  DeleteGroupCommand,\r\n  MoveGroupCommand\r\n} from './drawCommands';\r\nimport {\r\n  canNodeChangeColour,\r\n  isNodeNameShape\r\n} from '../app/drawController';\r\nimport {ScrollWheel} from './scrollWheel';\r\nimport {ShapeEditor} from './editor';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\nimport {Style} from '../gui/style';\r\nimport {LayerGroup} from '../gui/layerGroup';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Draw Debug flag.\r\n */\r\nexport const DRAW_DEBUG = false;\r\n\r\n/**\r\n * Drawing tool.\r\n *\r\n * This tool is responsible for the draw layer group structure. The layout is:\r\n *\r\n * drawLayer\r\n * |_ positionGroup: name=\"position-group\", id=\"#2-0#_#3-1\"\"\r\n *    |_ shapeGroup: name=\"{shape name}-group\", id=\"#\"\r\n *       |_ shape: name=\"shape\"\r\n *       |_ label: name=\"label\"\r\n *       |_ extra: line tick, protractor arc...\r\n *\r\n * Discussion:\r\n * - posGroup > shapeGroup\r\n *    pro: slice/frame display: 1 loop\r\n *    cons: multi-slice shape splitted in positionGroups\r\n * - shapeGroup > posGroup\r\n *    pros: more logical\r\n *    cons: slice/frame display: 2 loops\r\n */\r\nexport class Draw {\r\n\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * Scroll wheel handler.\r\n   *\r\n   * @type {ScrollWheel}\r\n   */\r\n  #scrollWhell;\r\n\r\n  /**\r\n   * Shape editor.\r\n   *\r\n   * @type {ShapeEditor}\r\n   */\r\n  #shapeEditor;\r\n\r\n  /**\r\n   * Trash draw: a cross.\r\n   *\r\n   * @type {Konva.Group}\r\n   */\r\n  #trash;\r\n\r\n  /**\r\n   * Drawing style.\r\n   *\r\n   * @type {Style}\r\n   */\r\n  #style;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#scrollWhell = new ScrollWheel(app);\r\n    this.#shapeEditor = new ShapeEditor(app);\r\n    // associate the event listeners of the editor\r\n    //  with those of the draw tool\r\n    this.#shapeEditor.setDrawEventCallback(this.#fireEvent);\r\n\r\n    this.#style = app.getStyle();\r\n\r\n    // trash cross\r\n    this.#trash = new Konva.Group();\r\n    // first line of the cross\r\n    const trashLine1 = new Konva.Line({\r\n      points: [-10, -10, 10, 10],\r\n      stroke: 'red'\r\n    });\r\n    // second line of the cross\r\n    const trashLine2 = new Konva.Line({\r\n      points: [10, -10, -10, 10],\r\n      stroke: 'red'\r\n    });\r\n    this.#trash.width(20);\r\n    this.#trash.height(20);\r\n    this.#trash.add(trashLine1);\r\n    this.#trash.add(trashLine2);\r\n  }\r\n\r\n  /**\r\n   * Interaction start flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #started = false;\r\n\r\n  /**\r\n   * Shape factory list\r\n   *\r\n   * @type {object}\r\n   */\r\n  #shapeFactoryList = null;\r\n\r\n  /**\r\n   * Current shape factory.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #currentFactory = null;\r\n\r\n  /**\r\n   * Draw command.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #command = null;\r\n\r\n  /**\r\n   * Current shape group.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #tmpShapeGroup = null;\r\n\r\n  /**\r\n   * Shape name.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #shapeName;\r\n\r\n  /**\r\n   * List of points.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #points = [];\r\n\r\n  /**\r\n   * Last selected point.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #lastPoint = null;\r\n\r\n  /**\r\n   * Active shape, ie shape with mouse over.\r\n   *\r\n   * @type {Konva.Group}\r\n   */\r\n  #activeShapeGroup;\r\n\r\n  /**\r\n   * Original mouse cursor.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #originalCursor;\r\n\r\n  /**\r\n   * Mouse cursor.\r\n   *\r\n   * @type {string}\r\n   */\r\n  #mouseOverCursor = 'pointer';\r\n\r\n  /**\r\n   * With scroll flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #withScroll = true;\r\n\r\n  /**\r\n   * Auto shape colour: will use defaults colours and\r\n   * vary them according to the layer.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #autoShapeColour = true;\r\n\r\n  /**\r\n   * Event listeners.\r\n   */\r\n  #listeners = {};\r\n\r\n  /**\r\n   *  Load stored drawings\r\n   * \r\n   * @param {object} dbObject The object from the database.\r\n   */\r\n  loadDrawing = (dbObject) => {\r\n    const layerGroup = this.#app.getLayerGroupByDivId(dbObject.groupDivId);\r\n\r\n    // set shapename\r\n    this.#shapeName = dbObject.shapeName;\r\n\r\n    // disable edition\r\n    this.#shapeEditor.disable();\r\n    this.#shapeEditor.reset();\r\n\r\n    // start storing points\r\n    this.#started = true;\r\n\r\n    // set factory\r\n    this.#currentFactory = new this.#shapeFactoryList[this.#shapeName]();\r\n\r\n    // clear array\r\n    this.#points = [];\r\n\r\n    // store point\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const pos1 = viewLayer.displayToPlanePos(dbObject.x1, dbObject.y1);\r\n    this.#lastPoint = new Point2D(pos1.x, pos1.y);\r\n    this.#points.push(this.#lastPoint);\r\n\r\n    const pos2 = viewLayer.displayToPlanePos(dbObject.x2, dbObject.y2);\r\n    this.#lastPoint = new Point2D(pos2.x, pos2.y);\r\n    this.#points.push(this.#lastPoint);\r\n\r\n    // store points\r\n    this.#onFinalPoints(this.#points, layerGroup, null);\r\n    // reset flag\r\n    this.#started = false;\r\n  };\r\n\r\n\r\n  /**\r\n   * Handle mouse down event.\r\n   *\r\n   * @param {object} event The mouse down event.\r\n   */\r\n  mousedown = (event) => {\r\n    // exit if a draw was started (handle at mouse move or up)\r\n    if (this.#started) {\r\n      return;\r\n    }\r\n\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const drawLayer = layerGroup.getActiveDrawLayer();\r\n\r\n    // determine if the click happened in an existing shape\r\n    const stage = drawLayer.getKonvaStage();\r\n    const kshape = stage.getIntersection({\r\n      x: event._x,\r\n      y: event._y\r\n    });\r\n\r\n    // update scale\r\n    this.#style.setZoomScale(stage.scale());\r\n\r\n    if (kshape) {\r\n      const group = kshape.getParent();\r\n      const selectedShape = group.find('.shape')[0];\r\n      // reset editor if click on other shape\r\n      // (and avoid anchors mouse down)\r\n      if (selectedShape &&\r\n        selectedShape instanceof Konva.Shape &&\r\n        selectedShape !== this.#shapeEditor.getShape()) {\r\n        this.#shapeEditor.disable();\r\n        const viewController =\r\n          layerGroup.getActiveViewLayer().getViewController();\r\n        this.#shapeEditor.setShape(selectedShape, drawLayer, viewController);\r\n        this.#shapeEditor.enable();\r\n      }\r\n    } else {\r\n      // disable edition\r\n      this.#shapeEditor.disable();\r\n      this.#shapeEditor.reset();\r\n      // start storing points\r\n      this.#started = true;\r\n      // set factory\r\n      this.#currentFactory = new this.#shapeFactoryList[this.#shapeName]();\r\n      // clear array\r\n      this.#points = [];\r\n      // store point\r\n      const viewLayer = layerGroup.getActiveViewLayer();\r\n      const pos = viewLayer.displayToPlanePos(event._x, event._y);\r\n      this.#lastPoint = new Point2D(pos.x, pos.y);\r\n      this.#points.push(this.#lastPoint);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse move event.\r\n   *\r\n   * @param {object} event The mouse move event.\r\n   */\r\n  mousemove = (event) => {\r\n    // exit if not started draw\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const pos = viewLayer.displayToPlanePos(event._x, event._y);\r\n\r\n    // draw line to current pos\r\n    if (Math.abs(pos.x - this.#lastPoint.getX()) > 0 ||\r\n      Math.abs(pos.y - this.#lastPoint.getY()) > 0) {\r\n      // clear last added point from the list (but not the first one)\r\n      // if it was marked as temporary\r\n      if (this.#points.length !== 1 &&\r\n        typeof this.#points[this.#points.length - 1].tmp !== 'undefined') {\r\n        this.#points.pop();\r\n      }\r\n      // current point\r\n      this.#lastPoint = new Point2D(pos.x, pos.y);\r\n      // mark it as temporary\r\n      this.#lastPoint.tmp = true;\r\n      // add it to the list\r\n      this.#points.push(this.#lastPoint);\r\n      // update points\r\n      this.#onNewPoints(this.#points, layerGroup);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse up event.\r\n   *\r\n   * @param {object} event The mouse up event.\r\n   */\r\n  mouseup = (event) => {\r\n    // exit if not started draw\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n    // exit if no points\r\n    if (this.#points.length === 0) {\r\n      logger.warn('Draw mouseup but no points...');\r\n      return;\r\n    }\r\n\r\n    // do we have all the needed points\r\n    if (this.#points.length === this.#currentFactory.getNPoints()) {\r\n      // store points\r\n      const layerDetails = getLayerDetailsFromEvent(event);\r\n      const layerGroup =\r\n        this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n      this.#onFinalPoints(this.#points, layerGroup, this.#app.getUpdateParent());\r\n      // reset flag\r\n      this.#started = false;\r\n    } else {\r\n      // remove temporary flag\r\n      if (typeof this.#points[this.#points.length - 1].tmp !== 'undefined') {\r\n        delete this.#points[this.#points.length - 1].tmp;\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle double click event: some tools use it to finish interaction.\r\n   *\r\n   * @param {object} event The double click event.\r\n   */\r\n  dblclick = (event) => {\r\n    // only end by double click undefined NPoints\r\n    if (typeof this.#currentFactory.getNPoints() !== 'undefined') {\r\n      return;\r\n    }\r\n    // exit if not started draw\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n    // exit if no points\r\n    if (this.#points.length === 0) {\r\n      logger.warn('Draw dblclick but no points...');\r\n      return;\r\n    }\r\n\r\n    // store points\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    this.#onFinalPoints(this.#points, layerGroup, this.#app.getUpdateParent());\r\n    // reset flag\r\n    this.#started = false;\r\n  };\r\n\r\n  /**\r\n   * Handle mouse out event.\r\n   *\r\n   * @param {object} event The mouse out event.\r\n   */\r\n  mouseout = (event) => {\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch start event.\r\n   *\r\n   * @param {object} event The touch start event.\r\n   */\r\n  touchstart = (event) => {\r\n    this.mousedown(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch move event.\r\n   *\r\n   * @param {object} event The touch move event.\r\n   */\r\n  touchmove = (event) => {\r\n    // exit if not started draw\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const pos = viewLayer.displayToPlanePos(event._x, event._y);\r\n\r\n    if (Math.abs(pos.x - this.#lastPoint.getX()) > 0 ||\r\n      Math.abs(pos.y - this.#lastPoint.getY()) > 0) {\r\n      // clear last added point from the list (but not the first one)\r\n      if (this.#points.length !== 1) {\r\n        this.#points.pop();\r\n      }\r\n      // current point\r\n      this.#lastPoint = new Point2D(pos.x, pos.y);\r\n      // add current one to the list\r\n      this.#points.push(this.#lastPoint);\r\n      // allow for anchor points\r\n      if (this.#points.length < this.#currentFactory.getNPoints()) {\r\n        clearTimeout(this.timer);\r\n        this.timer = setTimeout(() => {\r\n          this.#points.push(this.#lastPoint);\r\n        }, this.#currentFactory.getTimeout());\r\n      }\r\n      // update points\r\n      this.#onNewPoints(this.#points, layerGroup);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle touch end event.\r\n   *\r\n   * @param {object} event The touch end event.\r\n   */\r\n  touchend = (event) => {\r\n    this.dblclick(event);\r\n  };\r\n\r\n  /**\r\n   * Handle mouse wheel event.\r\n   *\r\n   * @param {WheelEvent} event The mouse wheel event.\r\n   */\r\n  wheel = (event) => {\r\n    if (this.#withScroll) {\r\n      this.#scrollWhell.wheel(event);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle key down event.\r\n   *\r\n   * @param {object} event The key down event.\r\n   */\r\n  keydown = (event) => {\r\n    // call app handler if we are not in the middle of a draw\r\n    if (!this.#started) {\r\n      event.context = 'Draw';\r\n      this.#app.onKeydown(event);\r\n    }\r\n\r\n    // press delete or backspace key\r\n    if ((event.key === 'Delete' ||\r\n      event.key === 'Backspace') &&\r\n      this.#shapeEditor.isActive()) {\r\n      // get shape\r\n      const shapeGroup = this.#shapeEditor.getShape().getParent();\r\n      if (!(shapeGroup instanceof Konva.Group)) {\r\n        return;\r\n      }\r\n      const shape = shapeGroup.getChildren(isNodeNameShape)[0];\r\n      if (!(shape instanceof Konva.Shape)) {\r\n        return;\r\n      }\r\n      const shapeDisplayName = getShapeDisplayName(shape);\r\n      // delete command\r\n      const drawLayer = this.#app.getActiveLayerGroup().getActiveDrawLayer();\r\n      const delcmd = new DeleteGroupCommand(\r\n        shapeGroup,\r\n        shapeDisplayName,\r\n        drawLayer\r\n      );\r\n      delcmd.onExecute = this.#fireEvent;\r\n      delcmd.onUndo = this.#fireEvent;\r\n      delcmd.execute();\r\n      this.#app.addToUndoStack(delcmd);\r\n    }\r\n\r\n    // escape key: exit shape creation\r\n    if (event.key === 'Escape' && this.#tmpShapeGroup !== null) {\r\n      const konvaLayer = this.#tmpShapeGroup.getLayer();\r\n      // reset temporary shape group\r\n      this.#tmpShapeGroup.destroy();\r\n      this.#tmpShapeGroup = null;\r\n      // reset flag and points\r\n      this.#started = false;\r\n      this.#points = [];\r\n      // redraw\r\n      konvaLayer.draw();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Update the current draw with new points.\r\n   *\r\n   * @param {Array} tmpPoints The array of new points.\r\n   * @param {LayerGroup} layerGroup The origin layer group.\r\n   */\r\n  #onNewPoints(tmpPoints, layerGroup) {\r\n    const drawLayer = layerGroup.getActiveDrawLayer();\r\n    const konvaLayer = drawLayer.getKonvaLayer();\r\n\r\n    // remove temporary shape draw\r\n    if (this.#tmpShapeGroup) {\r\n      this.#tmpShapeGroup.destroy();\r\n      this.#tmpShapeGroup = null;\r\n    }\r\n\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n\r\n    // auto mode: vary shape colour with layer id\r\n    if (this.#autoShapeColour) {\r\n      const colours = [\r\n        '#ffff80', '#ff80ff', '#80ffff', '#80ff80', '8080ff', 'ff8080'\r\n      ];\r\n      // warning: depends on layer id nomenclature\r\n      const viewLayerId = viewLayer.getId();\r\n      const layerId = viewLayerId.substring(viewLayerId.length - 1);\r\n      // expecting one draw layer per view layer\r\n      const layerIndex = parseInt(layerId, 10) / 2;\r\n      const colour = colours[layerIndex];\r\n      if (typeof colour !== 'undefined') {\r\n        this.#style.setLineColour(colour);\r\n      }\r\n    }\r\n\r\n    // create shape group\r\n    const viewController = viewLayer.getViewController();\r\n    this.#tmpShapeGroup = this.#currentFactory.create(\r\n      tmpPoints, this.#style, viewController);\r\n    // do not listen during creation\r\n    const shape = this.#tmpShapeGroup.getChildren(isNodeNameShape)[0];\r\n    shape.listening(false);\r\n    konvaLayer.listening(false);\r\n    // draw shape\r\n    konvaLayer.add(this.#tmpShapeGroup);\r\n    konvaLayer.draw();\r\n  }\r\n\r\n  /**\r\n   * Create the final shape from a point list.\r\n   *\r\n   * @param {Point2D[]} finalPoints The array of points.\r\n   * @param {LayerGroup} layerGroup The origin layer group.\r\n   * @param {function} updateParent The parent component update function.\r\n   */\r\n  #onFinalPoints(finalPoints, layerGroup, updateParent) {\r\n    // reset temporary shape group\r\n    if (this.#tmpShapeGroup) {\r\n      this.#tmpShapeGroup.destroy();\r\n      this.#tmpShapeGroup = null;\r\n    }\r\n\r\n    const drawLayer = layerGroup.getActiveDrawLayer();\r\n    const konvaLayer = drawLayer.getKonvaLayer();\r\n    const drawController = drawLayer.getDrawController();\r\n\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const viewController = viewLayer.getViewController();\r\n\r\n    // create final shape\r\n    const finalShapeGroup = this.#currentFactory.create(\r\n      finalPoints, this.#style, viewController);\r\n    finalShapeGroup.id(guid());\r\n\r\n    // get the position group\r\n    const posGroup = drawController.getCurrentPosGroup();\r\n    // add shape group to position group\r\n    posGroup.add(finalShapeGroup);\r\n\r\n    // re-activate layer\r\n    konvaLayer.listening(true);\r\n    // draw shape command\r\n    this.#command = new DrawGroupCommand(\r\n      finalShapeGroup,\r\n      this.#shapeName,\r\n      drawLayer\r\n    );\r\n    this.#command.onExecute = this.#fireEvent;\r\n    this.#command.onUndo = this.#fireEvent;\r\n    // execute it\r\n    this.#command.execute();\r\n    // save it in undo stack\r\n    this.#app.addToUndoStack(this.#command);\r\n\r\n    // activate shape listeners\r\n    this.setShapeOn(finalShapeGroup, layerGroup);\r\n\r\n    if(updateParent) {\r\n      let finalPointsObject = { \r\n        \"x1\": finalPoints[0].getX(), \r\n        \"y1\": finalPoints[0].getY(), \r\n        \"x2\": finalPoints[1].getX(), \r\n        \"y2\": finalPoints[1].getY(),\r\n        \"groupDivId\": layerGroup.getDivId(),\r\n        \"shapeName\": this.#shapeName\r\n      };\r\n      updateParent(finalPointsObject);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate the tool.\r\n   *\r\n   * @param {boolean} flag The flag to activate or not.\r\n   */\r\n  activate(flag) {\r\n    // reset shape display properties\r\n    this.#shapeEditor.disable();\r\n    this.#shapeEditor.reset();\r\n    // get the current draw layer\r\n    const layerGroup = this.#app.getActiveLayerGroup();\r\n    this.#activateCurrentPositionShapes(flag, layerGroup);\r\n    // listen to app change to update the draw layer\r\n    if (flag) {\r\n      // store cursor\r\n      this.#originalCursor = document.body.style.cursor;\r\n      // TODO: merge with drawController.activateDrawLayer?\r\n      this.#app.addEventListener('positionchange', () => {\r\n        this.#updateDrawLayer(layerGroup);\r\n      });\r\n    } else {\r\n      // reset shape and cursor\r\n      this.#resetActiveShapeGroup();\r\n      // reset local var\r\n      this.#originalCursor = undefined;\r\n      // remove listeners\r\n      this.#app.removeEventListener('positionchange', () => {\r\n        this.#updateDrawLayer(layerGroup);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the draw layer.\r\n   *\r\n   * @param {LayerGroup} layerGroup The origin layer group.\r\n   */\r\n  #updateDrawLayer(layerGroup) {\r\n    // activate the shape at current position\r\n    this.#activateCurrentPositionShapes(true, layerGroup);\r\n  }\r\n\r\n  /**\r\n   * Activate shapes at current position.\r\n   *\r\n   * @param {boolean} visible Set the draw layer visible or not.\r\n   * @param {LayerGroup} layerGroup The origin layer group.\r\n   */\r\n  #activateCurrentPositionShapes(visible, layerGroup) {\r\n    const drawLayer = layerGroup.getActiveDrawLayer();\r\n    if (typeof drawLayer === 'undefined') {\r\n      return;\r\n    }\r\n    const drawController = drawLayer.getDrawController();\r\n\r\n    // get shape groups at the current position\r\n    const shapeGroups =\r\n      drawController.getCurrentPosGroup().getChildren();\r\n\r\n    // set shape display properties\r\n    if (visible) {\r\n      // activate shape listeners\r\n      shapeGroups.forEach((group) => {\r\n        this.setShapeOn(group, layerGroup);\r\n      });\r\n    } else {\r\n      // de-activate shape listeners\r\n      shapeGroups.forEach((group) => {\r\n        this.#setShapeOff(group);\r\n      });\r\n    }\r\n    // draw\r\n    const konvaLayer = drawLayer.getKonvaLayer();\r\n    if (shapeGroups.length !== 0) {\r\n      konvaLayer.listening(true);\r\n    }\r\n    konvaLayer.draw();\r\n  }\r\n\r\n  /**\r\n   * Set shape group off properties.\r\n   *\r\n   * @param {Konva.Group} shapeGroup The shape group to set off.\r\n   */\r\n  #setShapeOff(shapeGroup) {\r\n    // mouse styling\r\n    shapeGroup.off('mouseover');\r\n    shapeGroup.off('mouseout');\r\n    // drag\r\n    shapeGroup.draggable(false);\r\n    shapeGroup.off('dragstart.draw');\r\n    shapeGroup.off('dragmove.draw');\r\n    shapeGroup.off('dragend.draw');\r\n    shapeGroup.off('dblclick');\r\n  }\r\n\r\n  /**\r\n   * Get the real position from an event.\r\n   * TODO: use layer method?\r\n   *\r\n   * @param {object} index The input index as {x,y}.\r\n   * @param {LayerGroup} layerGroup The origin layer group.\r\n   * @returns {object} The real position in the image as {x,y}.\r\n   */\r\n  #getRealPosition(index, layerGroup) {\r\n    const drawLayer = layerGroup.getActiveDrawLayer();\r\n    const stage = drawLayer.getKonvaStage();\r\n    return {\r\n      x: stage.offset().x + index.x / stage.scale().x,\r\n      y: stage.offset().y + index.y / stage.scale().y\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Reset the active shape group and mouse cursor to their original state.\r\n   */\r\n  #resetActiveShapeGroup() {\r\n    if (typeof this.#originalCursor !== 'undefined') {\r\n      document.body.style.cursor = this.#originalCursor;\r\n    }\r\n    if (typeof this.#activeShapeGroup !== 'undefined') {\r\n      this.#activeShapeGroup.opacity(1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set shape group on properties.\r\n   *\r\n   * @param {Konva.Group} shapeGroup The shape group to set on.\r\n   * @param {LayerGroup} layerGroup The origin layer group.\r\n   */\r\n  setShapeOn(shapeGroup, layerGroup) {\r\n    // adapt shape and cursor when mouse over\r\n    const mouseOnShape = () => {\r\n      document.body.style.cursor = this.#mouseOverCursor;\r\n      shapeGroup.opacity(0.75);\r\n    };\r\n    // mouse over event hanlding\r\n    shapeGroup.on('mouseover', () => {\r\n      // save local vars\r\n      this.#activeShapeGroup = shapeGroup;\r\n      // adapt shape\r\n      mouseOnShape();\r\n    });\r\n    // mouse out event hanlding\r\n    shapeGroup.on('mouseout', () => {\r\n      // reset shape\r\n      this.#resetActiveShapeGroup();\r\n      // reset local vars\r\n      this.#activeShapeGroup = undefined;\r\n    });\r\n\r\n    const drawLayer = layerGroup.getActiveDrawLayer();\r\n    const konvaLayer = drawLayer.getKonvaLayer();\r\n\r\n    // make it draggable\r\n    shapeGroup.draggable(true);\r\n    // cache drag start position\r\n    let dragStartPos = {x: shapeGroup.x(), y: shapeGroup.y()};\r\n\r\n    // command name based on shape type\r\n    const shape = shapeGroup.getChildren(isNodeNameShape)[0];\r\n    if (!(shape instanceof Konva.Shape)) {\r\n      return;\r\n    }\r\n    const shapeDisplayName = getShapeDisplayName(shape);\r\n\r\n    let colour = null;\r\n\r\n    // drag start event handling\r\n    shapeGroup.on('dragstart.draw', (/*event*/) => {\r\n      // store colour\r\n      const shape = shapeGroup.getChildren(isNodeNameShape)[0];\r\n      if (!(shape instanceof Konva.Shape)) {\r\n        return;\r\n      }\r\n      colour = shape.stroke();\r\n      // display trash\r\n      const stage = drawLayer.getKonvaStage();\r\n      const scale = stage.scale();\r\n      const invscale = {x: 1 / scale.x, y: 1 / scale.y};\r\n      this.#trash.x(stage.offset().x + (stage.width() / (2 * scale.x)));\r\n      this.#trash.y(stage.offset().y + (stage.height() / (15 * scale.y)));\r\n      this.#trash.scale(invscale);\r\n      konvaLayer.add(this.#trash);\r\n      // deactivate anchors to avoid events on null shape\r\n      this.#shapeEditor.setAnchorsActive(false);\r\n      // draw\r\n      konvaLayer.draw();\r\n    });\r\n    // drag move event handling\r\n    shapeGroup.on('dragmove.draw', (event) => {\r\n      const group = event.target;\r\n      if (!(group instanceof Konva.Group)) {\r\n        return;\r\n      }\r\n      // validate the group position\r\n      validateGroupPosition(drawLayer.getBaseSize(), group);\r\n      // get appropriate factory\r\n      let factory;\r\n      const keys = Object.keys(this.#shapeFactoryList);\r\n      for (let i = 0; i < keys.length; ++i) {\r\n        factory = new this.#shapeFactoryList[keys[i]];\r\n        if (factory.isFactoryGroup(shapeGroup)) {\r\n          // stop at first find\r\n          break;\r\n        }\r\n      }\r\n      if (typeof factory === 'undefined') {\r\n        throw new Error('Cannot find factory to update quantification.');\r\n      }\r\n      // update quantification if possible\r\n      if (typeof factory.updateQuantification !== 'undefined') {\r\n        const vc = layerGroup.getActiveViewLayer().getViewController();\r\n        factory.updateQuantification(group, vc);\r\n      }\r\n      // highlight trash when on it\r\n      const offset = getEventOffset(event.evt)[0];\r\n      const eventPos = this.#getRealPosition(offset, layerGroup);\r\n      const trashHalfWidth =\r\n        this.#trash.width() * Math.abs(this.#trash.scaleX()) / 2;\r\n      const trashHalfHeight =\r\n        this.#trash.height() * Math.abs(this.#trash.scaleY()) / 2;\r\n      if (Math.abs(eventPos.x - this.#trash.x()) < trashHalfWidth &&\r\n        Math.abs(eventPos.y - this.#trash.y()) < trashHalfHeight) {\r\n        this.#trash.getChildren().forEach(function (tshape) {\r\n          if (tshape instanceof Konva.Shape) {\r\n            tshape.stroke('orange');\r\n          }\r\n        });\r\n        // change the group shapes colour\r\n        shapeGroup.getChildren(canNodeChangeColour).forEach(\r\n          function (ashape) {\r\n            if (ashape instanceof Konva.Shape) {\r\n              ashape.stroke('red');\r\n            }\r\n          });\r\n      } else {\r\n        this.#trash.getChildren().forEach(function (tshape) {\r\n          if (tshape instanceof Konva.Shape) {\r\n            tshape.stroke('red');\r\n          }\r\n        });\r\n        // reset the group shapes colour\r\n        shapeGroup.getChildren(canNodeChangeColour).forEach(\r\n          function (ashape) {\r\n            if (ashape instanceof Konva.Shape &&\r\n              typeof ashape.stroke !== 'undefined') {\r\n              ashape.stroke(colour);\r\n            }\r\n          });\r\n      }\r\n      // draw\r\n      konvaLayer.draw();\r\n    });\r\n    // drag end event handling\r\n    shapeGroup.on('dragend.draw', (event) => {\r\n      const group = event.target;\r\n      if (!(group instanceof Konva.Group)) {\r\n        return;\r\n      }\r\n      // remove trash\r\n      this.#trash.remove();\r\n      // activate(false) will also trigger a dragend.draw\r\n      if (typeof event === 'undefined' ||\r\n        typeof event.evt === 'undefined') {\r\n        return;\r\n      }\r\n      const pos = {x: group.x(), y: group.y()};\r\n      // delete case\r\n      const offset = getEventOffset(event.evt)[0];\r\n      const eventPos = this.#getRealPosition(offset, layerGroup);\r\n      const trashHalfWidth =\r\n        this.#trash.width() * Math.abs(this.#trash.scaleX()) / 2;\r\n      const trashHalfHeight =\r\n        this.#trash.height() * Math.abs(this.#trash.scaleY()) / 2;\r\n      if (Math.abs(eventPos.x - this.#trash.x()) < trashHalfWidth &&\r\n        Math.abs(eventPos.y - this.#trash.y()) < trashHalfHeight) {\r\n        // compensate for the drag translation\r\n        group.x(dragStartPos.x);\r\n        group.y(dragStartPos.y);\r\n        // disable editor\r\n        this.#shapeEditor.disable();\r\n        this.#shapeEditor.reset();\r\n        // reset colour\r\n        shapeGroup.getChildren(canNodeChangeColour).forEach(\r\n          function (ashape) {\r\n            if (ashape instanceof Konva.Shape) {\r\n              ashape.stroke(colour);\r\n            }\r\n          });\r\n        // reset cursor\r\n        document.body.style.cursor = this.#originalCursor;\r\n        // delete command\r\n        const delcmd = new DeleteGroupCommand(\r\n          group,\r\n          shapeDisplayName,\r\n          drawLayer\r\n        );\r\n        delcmd.onExecute = this.#fireEvent;\r\n        delcmd.onUndo = this.#fireEvent;\r\n        delcmd.execute();\r\n        this.#app.addToUndoStack(delcmd);\r\n        const updateParent = this.#app.getUpdateParent()\r\n        updateParent({\r\n          \"groupDivId\": layerGroup.getDivId(),\r\n          \"shapeName\": this.#shapeName\r\n        })\r\n      } else {\r\n        // save drag move\r\n        const translation = {\r\n          x: pos.x - dragStartPos.x,\r\n          y: pos.y - dragStartPos.y\r\n        };\r\n        if (translation.x !== 0 || translation.y !== 0) {\r\n          const mvcmd = new MoveGroupCommand(\r\n            group,\r\n            shapeDisplayName,\r\n            translation,\r\n            drawLayer\r\n          );\r\n          mvcmd.onExecute = this.#fireEvent;\r\n          mvcmd.onUndo = this.#fireEvent;\r\n          this.#app.addToUndoStack(mvcmd);\r\n\r\n          // the move is handled by Konva, trigger an event manually\r\n          this.#fireEvent({\r\n            type: 'drawmove',\r\n            id: group.id(),\r\n            srclayerid: drawLayer.getId(),\r\n            dataid: drawLayer.getDataId()\r\n          });\r\n        }\r\n        // reset anchors\r\n        this.#shapeEditor.setAnchorsActive(true);\r\n        this.#shapeEditor.resetAnchors();\r\n      }\r\n      // draw\r\n      konvaLayer.draw();\r\n      // reset start position\r\n      dragStartPos = {x: group.x(), y: group.y()};\r\n    });\r\n    // double click handling: update label\r\n    shapeGroup.on('dblclick', (event) => {\r\n      const group = event.currentTarget;\r\n      if (!(group instanceof Konva.Group)) {\r\n        return;\r\n      }\r\n      // get the label object for this shape\r\n      const label = group.findOne('Label');\r\n      if (!(label instanceof Konva.Label)) {\r\n        return;\r\n      }\r\n      // should just be one\r\n      if (typeof label === 'undefined') {\r\n        throw new Error('Could not find the shape label.');\r\n      }\r\n      const ktext = label.getText();\r\n      // id for event\r\n      const groupId = group.id();\r\n\r\n      const onSaveCallback = (meta) => {\r\n        // store meta\r\n        // @ts-expect-error\r\n        ktext.meta = meta;\r\n        // update text expression\r\n        ktext.setText(replaceFlags(\r\n          meta.textExpr, meta.quantification));\r\n        // hide label if no text\r\n        label.visible(meta.textExpr.length !== 0);\r\n\r\n        // trigger event\r\n        this.#fireEvent({\r\n          type: 'drawchange',\r\n          id: groupId,\r\n          srclayerid: drawLayer.getId(),\r\n          dataid: drawLayer.getDataId()\r\n        });\r\n        // draw\r\n        konvaLayer.draw();\r\n      };\r\n\r\n      // call roi dialog\r\n      // @ts-expect-error\r\n      customUI.openRoiDialog(ktext.meta, onSaveCallback);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the tool configuration options.\r\n   *\r\n   * @param {object} options The list of shape names amd classes.\r\n   */\r\n  setOptions(options) {\r\n    // save the options as the shape factory list\r\n    this.#shapeFactoryList = options;\r\n    // pass them to the editor\r\n    this.#shapeEditor.setFactoryList(options);\r\n  }\r\n\r\n  /**\r\n   * Get the type of tool options: here 'factory' since the shape\r\n   * list contains factories to create each possible shape.\r\n   *\r\n   * @returns {string} The type.\r\n   */\r\n  getOptionsType() {\r\n    return 'factory';\r\n  }\r\n\r\n  /**\r\n   * Set the tool live features: shape colour and shape name.\r\n   *\r\n   * @param {object} features The list of features.\r\n   */\r\n  setFeatures(features) {\r\n    if (typeof features.autoShapeColour !== 'undefined') {\r\n      this.#autoShapeColour = features.autoShapeColour;\r\n    }\r\n    if (typeof features.shapeColour !== 'undefined') {\r\n      this.#style.setLineColour(features.shapeColour);\r\n      this.#autoShapeColour = false;\r\n    }\r\n    if (typeof features.shapeName !== 'undefined') {\r\n      // check if we have it\r\n      if (!this.hasShape(features.shapeName)) {\r\n        throw new Error('Unknown shape: \\'' + features.shapeName + '\\'');\r\n      }\r\n      this.#shapeName = features.shapeName;\r\n    }\r\n    if (typeof features.mouseOverCursor !== 'undefined') {\r\n      this.#mouseOverCursor = features.mouseOverCursor;\r\n    }\r\n    if (typeof features.withScroll !== 'undefined') {\r\n      this.#withScroll = features.withScroll;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialise the tool.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Get the list of event names that this tool can fire.\r\n   *\r\n   * @returns {Array} The list of event names.\r\n   */\r\n  getEventNames() {\r\n    return [\r\n      'drawcreate', 'drawchange', 'drawmove', 'drawdelete'\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Add an event listener on the app.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} listener The function associated with the provided\r\n   *   event type.\r\n   */\r\n  addEventListener(type, listener) {\r\n    if (typeof this.#listeners[type] === 'undefined') {\r\n      this.#listeners[type] = [];\r\n    }\r\n    this.#listeners[type].push(listener);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from the app.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} listener The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, listener) {\r\n    if (typeof this.#listeners[type] === 'undefined') {\r\n      return;\r\n    }\r\n    for (let i = 0; i < this.#listeners[type].length; ++i) {\r\n      if (this.#listeners[type][i] === listener) {\r\n        this.#listeners[type].splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Private Methods -----------------------------------------------------------\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    if (typeof this.#listeners[event.type] === 'undefined') {\r\n      return;\r\n    }\r\n    for (let i = 0; i < this.#listeners[event.type].length; ++i) {\r\n      this.#listeners[event.type][i](event);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Check if the shape is in the shape list.\r\n   *\r\n   * @param {string} name The name of the shape.\r\n   * @returns {boolean} True if there is a factory for the shape.\r\n   */\r\n  hasShape(name) {\r\n    return typeof this.#shapeFactoryList[name] !== 'undefined';\r\n  }\r\n\r\n} // Draw class\r\n\r\n/**\r\n * Get the minimum position in a groups' anchors.\r\n *\r\n * @param {Konva.Group} group The group that contains anchors.\r\n * @returns {object|undefined} The minimum position as {x,y}.\r\n */\r\nfunction getAnchorMin(group) {\r\n  const anchors = group.find('.anchor');\r\n  if (anchors.length === 0) {\r\n    return undefined;\r\n  }\r\n  let minX = anchors[0].x();\r\n  let minY = anchors[0].y();\r\n  for (let i = 0; i < anchors.length; ++i) {\r\n    minX = Math.min(minX, anchors[i].x());\r\n    minY = Math.min(minY, anchors[i].y());\r\n  }\r\n\r\n  return {x: minX, y: minY};\r\n}\r\n\r\n/**\r\n * Bound a node position.\r\n *\r\n * @param {Konva.Node} node The node to bound the position.\r\n * @param {object} min The minimum position as {x,y}.\r\n * @param {object} max The maximum position as {x,y}.\r\n * @returns {boolean} True if the position was corrected.\r\n */\r\nfunction boundNodePosition(node, min, max) {\r\n  let changed = false;\r\n  if (node.x() < min.x) {\r\n    node.x(min.x);\r\n    changed = true;\r\n  } else if (node.x() > max.x) {\r\n    node.x(max.x);\r\n    changed = true;\r\n  }\r\n  if (node.y() < min.y) {\r\n    node.y(min.y);\r\n    changed = true;\r\n  } else if (node.y() > max.y) {\r\n    node.y(max.y);\r\n    changed = true;\r\n  }\r\n  return changed;\r\n}\r\n\r\n/**\r\n * Validate a group position.\r\n *\r\n * @param {object} stageSize The stage size {x,y}.\r\n * @param {Konva.Group} group The group to evaluate.\r\n * @returns {boolean} True if the position was corrected.\r\n */\r\nfunction validateGroupPosition(stageSize, group) {\r\n  // if anchors get mixed, width/height can be negative\r\n  const shape = group.getChildren(isNodeNameShape)[0];\r\n  const anchorMin = getAnchorMin(group);\r\n  // handle no anchor: when dragging the label, the editor does\r\n  //   not activate\r\n  if (typeof anchorMin === 'undefined') {\r\n    return null;\r\n  }\r\n\r\n  const min = {\r\n    x: -anchorMin.x,\r\n    y: -anchorMin.y\r\n  };\r\n  const max = {\r\n    x: stageSize.x -\r\n      (anchorMin.x + Math.abs(shape.width())),\r\n    y: stageSize.y -\r\n      (anchorMin.y + Math.abs(shape.height()))\r\n  };\r\n\r\n  return boundNodePosition(group, min, max);\r\n}\r\n\r\n/**\r\n * Validate an anchor position.\r\n *\r\n * @param {object} stageSize The stage size {x,y}.\r\n * @param {Konva.Shape} anchor The anchor to evaluate.\r\n * @returns {boolean} True if the position was corrected.\r\n */\r\nexport function validateAnchorPosition(stageSize, anchor) {\r\n  const group = anchor.getParent();\r\n\r\n  const min = {\r\n    x: -group.x(),\r\n    y: -group.y()\r\n  };\r\n  const max = {\r\n    x: stageSize.x - group.x(),\r\n    y: stageSize.y - group.y()\r\n  };\r\n\r\n  return boundNodePosition(anchor, min, max);\r\n}\r\n","// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Point2D} from '../math/point';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Region Of Interest shape.\r\n * Note: should be a closed path.\r\n */\r\nexport class ROI {\r\n\r\n  /**\r\n   * List of points.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #points = [];\r\n\r\n  /**\r\n   * Get a point of the list at a given index.\r\n   *\r\n   * @param {number} index The index of the point to get\r\n   *   (beware, no size check).\r\n   * @returns {Point2D} The Point2D at the given index.\r\n   */\r\n  getPoint(index) {\r\n    return this.#points[index];\r\n  }\r\n\r\n  /**\r\n   * Get the length of the point list.\r\n   *\r\n   * @returns {number} The length of the point list.\r\n   */\r\n  getLength() {\r\n    return this.#points.length;\r\n  }\r\n\r\n  /**\r\n   * Add a point to the ROI.\r\n   *\r\n   * @param {Point2D} point The Point2D to add.\r\n   */\r\n  addPoint(point) {\r\n    this.#points.push(point);\r\n  }\r\n\r\n  /**\r\n   * Add points to the ROI.\r\n   *\r\n   * @param {Array} rhs The array of POints2D to add.\r\n   */\r\n  addPoints(rhs) {\r\n    this.#points = this.#points.concat(rhs);\r\n  }\r\n\r\n} // ROI class\r\n","// linting 'type {Object.<bla, bla>}' will give:\r\n// warning  Use object shorthand or index signatures instead of `Object`,\r\n//   e.g., `{[key: string]: string}` jsdoc/check-types\r\n// pb: jsdoc does not support the object shorthand\r\n//   and ignoring will give vscode warning since the doc linting is not\r\n//   activated by default.\r\n\r\n// Overridable default object.\r\nexport const defaults = {\r\n  /**\r\n   * List of default window level presets.\r\n   *\r\n   * @type {Object.<string, Object.<string, string>>}\r\n   */\r\n  labelText: {\r\n    arrow: {\r\n      '*': ''\r\n    },\r\n    circle: {\r\n      '*': '{surface}'\r\n    },\r\n    ellipse: {\r\n      '*': '{surface}'\r\n    },\r\n    freeHand: {\r\n      '*': ''\r\n    },\r\n    protractor: {\r\n      '*': '{angle}'\r\n    },\r\n    rectangle: {\r\n      '*': '{surface}'\r\n    },\r\n    roi: {\r\n      '*': ''\r\n    },\r\n    ruler: {\r\n      '*': '{length}'\r\n    }\r\n  }\r\n};\r\n","import {ROI} from '../math/roi';\r\nimport {defaults} from '../app/defaults';\r\nimport {getDefaultAnchor} from './editor';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Point2D} from '../math/point';\r\nimport {ViewController} from '../app/viewController';\r\nimport {Style} from '../gui/style';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * ROI factory.\r\n */\r\nexport class RoiFactory {\r\n  /**\r\n   * Get the name of the shape group.\r\n   *\r\n   * @returns {string} The name.\r\n   */\r\n  getGroupName() {\r\n    return 'roi-group';\r\n  }\r\n\r\n  /**\r\n   * Get the number of points needed to build the shape.\r\n   *\r\n   * @returns {number|undefined} The number of points.\r\n   */\r\n  getNPoints() {\r\n    // undefined to end with double click\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Get the timeout between point storage.\r\n   *\r\n   * @returns {number} The timeout in milliseconds.\r\n   */\r\n  getTimeout() {\r\n    return 100;\r\n  }\r\n\r\n  /**\r\n   * Is the input group a group of this factory?\r\n   *\r\n   * @param {Konva.Group} group The group to test.\r\n   * @returns {boolean} True if the group is from this fcatory.\r\n   */\r\n  isFactoryGroup(group) {\r\n    return this.getGroupName() === group.name();\r\n  }\r\n\r\n  /**\r\n   * Create a roi shape to be displayed.\r\n   *\r\n   * @param {Point2D[]} points The points from which to extract the line.\r\n   * @param {Style} style The drawing style.\r\n   * @param {ViewController} [viewController] The associated view controller.\r\n   * @returns {Konva.Group} The Konva group.\r\n   */\r\n  create(points, style, viewController) {\r\n    // physical shape\r\n    const roi = new ROI();\r\n    // add input points to the ROI\r\n    roi.addPoints(points);\r\n    // points stored the Konvajs way\r\n    const arr = [];\r\n    for (let i = 0; i < roi.getLength(); ++i) {\r\n      arr.push(roi.getPoint(i).getX());\r\n      arr.push(roi.getPoint(i).getY());\r\n    }\r\n    // draw shape\r\n    const kshape = new Konva.Line({\r\n      points: arr,\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape',\r\n      closed: true\r\n    });\r\n\r\n    // text\r\n    const ktext = new Konva.Text({\r\n      fontSize: style.getFontSize(),\r\n      fontFamily: style.getFontFamily(),\r\n      fill: style.getLineColour(),\r\n      name: 'text'\r\n    });\r\n    let textExpr = '';\r\n    if (typeof viewController !== 'undefined') {\r\n      const modality = viewController.getModality();\r\n      if (typeof defaults.labelText.roi[modality] !== 'undefined') {\r\n        textExpr = defaults.labelText.roi[modality];\r\n      } else {\r\n        textExpr = defaults.labelText.roi['*'];\r\n      }\r\n    }\r\n    ktext.setText(textExpr);\r\n    // augment text with meta\r\n    // @ts-ignore\r\n    ktext.meta = {\r\n      textExpr: textExpr,\r\n      quantification: {}\r\n    };\r\n\r\n    // label\r\n    const klabel = new Konva.Label({\r\n      x: roi.getPoint(0).getX(),\r\n      y: roi.getPoint(0).getY() + style.scale(10),\r\n      scale: style.applyZoomScale(1),\r\n      visible: textExpr.length !== 0,\r\n      name: 'label'\r\n    });\r\n    klabel.add(ktext);\r\n    klabel.add(new Konva.Tag({\r\n      fill: style.getLineColour(),\r\n      opacity: style.getTagOpacity()\r\n    }));\r\n\r\n    // return group\r\n    const group = new Konva.Group();\r\n    group.name(this.getGroupName());\r\n    group.add(klabel);\r\n    group.add(kshape);\r\n    group.visible(true); // dont inherit\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get anchors to update a roi shape.\r\n   *\r\n   * @param {Konva.Line} shape The associated shape.\r\n   * @param {Style} style The application style.\r\n   * @returns {Konva.Ellipse[]} A list of anchors.\r\n   */\r\n  getAnchors(shape, style) {\r\n    const points = shape.points();\r\n\r\n    const anchors = [];\r\n    for (let i = 0; i < points.length; i = i + 2) {\r\n      const px = points[i] + shape.x();\r\n      const py = points[i + 1] + shape.y();\r\n      const name = i.toString();\r\n      anchors.push(getDefaultAnchor(\r\n        px, py, name, style\r\n      ));\r\n    }\r\n    return anchors;\r\n  }\r\n\r\n  /**\r\n   * Update a roi shape.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The active anchor.\r\n   * @param {Style} style The app style.\r\n   * @param {ViewController} _viewController The associated view controller.\r\n   */\r\n  update(anchor, style, _viewController) {\r\n    // parent group\r\n    const group = anchor.getParent();\r\n    // associated shape\r\n    const kroi = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    if (!(kroi instanceof Konva.Line)) {\r\n      return;\r\n    }\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    if (!(klabel instanceof Konva.Label)) {\r\n      return;\r\n    }\r\n\r\n    // update self\r\n    const point = group.getChildren(function (node) {\r\n      return node.id() === anchor.id();\r\n    })[0];\r\n    point.x(anchor.x());\r\n    point.y(anchor.y());\r\n    // update the roi point and compensate for possible drag\r\n    // (the anchor id is the index of the point in the list)\r\n    const points = kroi.points();\r\n    const index = parseInt(anchor.id(), 10);\r\n    points[index] = anchor.x() - kroi.x();\r\n    points[index + 1] = anchor.y() - kroi.y();\r\n    kroi.points(points);\r\n\r\n    // update text\r\n    const ktext = klabel.getText();\r\n    // @ts-expect-error\r\n    const meta = ktext.meta;\r\n    ktext.setText(meta.textExpr);\r\n    // update position\r\n    const textPos = {\r\n      x: points[0] + kroi.x(),\r\n      y: points[1] + kroi.y() + style.scale(10)\r\n    };\r\n    klabel.position(textPos);\r\n  }\r\n\r\n} // class RoiFactory\r\n","// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Point2D} from '../math/point';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Path shape.\r\n */\r\nexport class Path {\r\n\r\n  /**\r\n   * @param {Array} [inputPointArray] The list of Point2D that make\r\n   *   the path (optional).\r\n   * @param {Array} [inputControlPointIndexArray] The list of control\r\n   *  point of path, as indexes (optional).\r\n   * Note: first and last point do not need to be equal.\r\n   */\r\n  constructor(inputPointArray, inputControlPointIndexArray) {\r\n    /**\r\n     * List of points.\r\n     *\r\n     * @type {Array}\r\n     */\r\n    this.pointArray = inputPointArray ? inputPointArray.slice() : [];\r\n    /**\r\n     * List of control points.\r\n     *\r\n     * @type {Array}\r\n     */\r\n    this.controlPointIndexArray = inputControlPointIndexArray\r\n      ? inputControlPointIndexArray.slice() : [];\r\n  }\r\n\r\n  /**\r\n   * Get a point of the list.\r\n   *\r\n   * @param {number} index The index of the point\r\n   *   to get (beware, no size check).\r\n   * @returns {Point2D} The Point2D at the given index.\r\n   */\r\n  getPoint(index) {\r\n    return this.pointArray[index];\r\n  }\r\n\r\n  /**\r\n   * Is the given point a control point.\r\n   *\r\n   * @param {Point2D} point The Point2D to check.\r\n   * @returns {boolean} True if a control point.\r\n   */\r\n  isControlPoint(point) {\r\n    const index = this.pointArray.indexOf(point);\r\n    if (index !== -1) {\r\n      return this.controlPointIndexArray.indexOf(index) !== -1;\r\n    } else {\r\n      throw new Error('Error: isControlPoint called with not in list point.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the length of the path.\r\n   *\r\n   * @returns {number} The length of the path.\r\n   */\r\n  getLength() {\r\n    return this.pointArray.length;\r\n  }\r\n\r\n  /**\r\n   * Add a point to the path.\r\n   *\r\n   * @param {Point2D} point The Point2D to add.\r\n   */\r\n  addPoint(point) {\r\n    this.pointArray.push(point);\r\n  }\r\n\r\n  /**\r\n   * Add a control point to the path.\r\n   *\r\n   * @param {Point2D} point The Point2D to make a control point.\r\n   */\r\n  addControlPoint(point) {\r\n    const index = this.pointArray.indexOf(point);\r\n    if (index !== -1) {\r\n      this.controlPointIndexArray.push(index);\r\n    } else {\r\n      throw new Error(\r\n        'Cannot mark a non registered point as control point.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add points to the path.\r\n   *\r\n   * @param {Array} newPointArray The list of Point2D to add.\r\n   */\r\n  addPoints(newPointArray) {\r\n    this.pointArray = this.pointArray.concat(newPointArray);\r\n  }\r\n\r\n  /**\r\n   * Append a Path to this one.\r\n   *\r\n   * @param {Path} other The Path to append.\r\n   */\r\n  appenPath(other) {\r\n    const oldSize = this.pointArray.length;\r\n    this.pointArray = this.pointArray.concat(other.pointArray);\r\n    const indexArray = [];\r\n    for (let i = 0; i < other.controlPointIndexArray.length; ++i) {\r\n      indexArray[i] = other.controlPointIndexArray[i] + oldSize;\r\n    }\r\n    this.controlPointIndexArray =\r\n      this.controlPointIndexArray.concat(indexArray);\r\n  }\r\n\r\n} // Path class\r\n","/**\r\n * Circular Bucket Queue.\r\n *\r\n * Returns input'd points in sorted order. All operations run in roughly O(1)\r\n * time (for input with small cost values), but it has a strict requirement:\r\n *\r\n * If the most recent point had a cost of c, any points added should have a cost\r\n * c' in the range c <= c' <= c + (capacity - 1).\r\n */\r\nexport class BucketQueue {\r\n\r\n  /**\r\n   * @param {number} bits Number of bits.\r\n   * @param {Function} cost_functor The cost functor.\r\n   */\r\n  constructor(bits, cost_functor) {\r\n    this.bucketCount = 1 << bits; // # of buckets = 2^bits\r\n    this.mask = this.bucketCount - 1; // 2^bits - 1 = index mask\r\n    this.size = 0;\r\n\r\n    this.loc = 0; // Current index in bucket list\r\n    // Cost defaults to item value\r\n    this.cost = (typeof (cost_functor) !== 'undefined')\r\n      ? cost_functor : function (item) {\r\n        return item;\r\n      };\r\n    this.buckets = this.buildArray(this.bucketCount);\r\n  }\r\n\r\n  push(item) {\r\n    // Prepend item to the list in the appropriate bucket\r\n    const bucket = this.getBucket(item);\r\n    item.next = this.buckets[bucket];\r\n    this.buckets[bucket] = item;\r\n\r\n    this.size++;\r\n  }\r\n\r\n  pop() {\r\n    if (this.size === 0) {\r\n      throw new Error('Cannot pop, bucketQueue is empty.');\r\n    }\r\n\r\n    // Find first empty bucket\r\n    while (this.buckets[this.loc] === null) {\r\n      this.loc = (this.loc + 1) % this.bucketCount;\r\n    }\r\n\r\n    // All items in bucket have same cost, return the first one\r\n    const ret = this.buckets[this.loc];\r\n    this.buckets[this.loc] = ret.next;\r\n    ret.next = null;\r\n\r\n    this.size--;\r\n    return ret;\r\n  }\r\n\r\n  // TODO: needs at least two items...\r\n  remove(item) {\r\n    // Tries to remove item from queue. Returns true on success, false otherwise\r\n    if (!item) {\r\n      return false;\r\n    }\r\n\r\n    // To find node, go to bucket and search through unsorted list.\r\n    const bucket = this.getBucket(item);\r\n    let node = this.buckets[bucket];\r\n\r\n    while (node !== null &&\r\n      !(node.next !== null &&\r\n      item.x === node.next.x &&\r\n      item.y === node.next.y)) {\r\n      node = node.next;\r\n    }\r\n\r\n    if (node === null) {\r\n      // Item not in list, ergo item not in queue\r\n      return false;\r\n    } else {\r\n      // Found item, do standard list node deletion\r\n      node.next = node.next.next;\r\n\r\n      this.size--;\r\n      return true;\r\n    }\r\n  }\r\n\r\n  isEmpty() {\r\n    return this.size === 0;\r\n  }\r\n\r\n  getBucket(item) {\r\n    // Bucket index is the masked cost\r\n    return this.cost(item) & this.mask;\r\n  }\r\n\r\n  buildArray(newSize) {\r\n    // Create array and initialze pointers to null\r\n    const buckets = new Array(newSize);\r\n\r\n    for (let i = 0; i < buckets.length; i++) {\r\n      buckets[i] = null;\r\n    }\r\n\r\n    return buckets;\r\n  }\r\n\r\n} // class BucketQueue\r\n","import {BucketQueue} from './bucketQueue';\r\n\r\n// Pre-created to reduce allocation in inner loops\r\nconst __twothirdpi = (2 / (3 * Math.PI));\r\n\r\n/**\r\n * @param {Array} data The input data.\r\n * @param {number} width The width of the output.\r\n * @param {number} height The height of the output.\r\n * @returns {object} A greyscale object\r\n */\r\nfunction computeGreyscale(data, width, height) {\r\n  // Returns 2D augmented array containing greyscale data\r\n  // Greyscale values found by averaging colour channels\r\n  // Input should be in a flat RGBA array, with values between 0 and 255\r\n  const greyscale = {\r\n    data: []\r\n  };\r\n\r\n  // Compute actual values\r\n  for (let y = 0; y < height; y++) {\r\n    greyscale.data[y] = [];\r\n\r\n    for (let x = 0; x < width; x++) {\r\n      const p = (y * width + x) * 4;\r\n      greyscale.data[y][x] = (data[p] + data[p + 1] + data[p + 2]) / (3 * 255);\r\n    }\r\n  }\r\n\r\n  // Augment with convenience functions\r\n  greyscale.dx = function (x, y) {\r\n    if (x + 1 === this.data[y].length) {\r\n      // If we're at the end, back up one\r\n      x--;\r\n    }\r\n    return this.data[y][x + 1] - this.data[y][x];\r\n  };\r\n\r\n  greyscale.dy = function (x, y) {\r\n    if (y + 1 === this.data.length) {\r\n      // If we're at the end, back up one\r\n      y--;\r\n    }\r\n    return this.data[y][x] - this.data[y + 1][x];\r\n  };\r\n\r\n  greyscale.gradMagnitude = function (x, y) {\r\n    const dx = this.dx(x, y);\r\n    const dy = this.dy(x, y);\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  };\r\n\r\n  greyscale.laplace = function (x, y) {\r\n    // Laplacian of Gaussian\r\n    let lap = -16 * this.data[y][x];\r\n    lap += this.data[y - 2][x];\r\n    lap += this.data[y - 1][x - 1] +\r\n      2 * this.data[y - 1][x] +\r\n      this.data[y - 1][x + 1];\r\n    lap += this.data[y][x - 2] +\r\n      2 * this.data[y][x - 1] +\r\n      2 * this.data[y][x + 1] +\r\n      this.data[y][x + 2];\r\n    lap += this.data[y + 1][x - 1] +\r\n      2 * this.data[y + 1][x] +\r\n      this.data[y + 1][x + 1];\r\n    lap += this.data[y + 2][x];\r\n\r\n    return lap;\r\n  };\r\n\r\n  return greyscale;\r\n}\r\n\r\n/**\r\n * @param {object} greyscale The input greyscale-\r\n * @returns {object} A gradient object\r\n */\r\nfunction computeGradient(greyscale) {\r\n  // Returns a 2D array of gradient magnitude values for greyscale. The values\r\n  // are scaled between 0 and 1, and then flipped, so that it works as a cost\r\n  // function.\r\n  const gradient = [];\r\n\r\n  let max = 0; // Maximum gradient found, for scaling purposes\r\n\r\n  let x = 0;\r\n  let y = 0;\r\n\r\n  for (y = 0; y < greyscale.data.length - 1; y++) {\r\n    gradient[y] = [];\r\n\r\n    for (x = 0; x < greyscale.data[y].length - 1; x++) {\r\n      gradient[y][x] = greyscale.gradMagnitude(x, y);\r\n      max = Math.max(gradient[y][x], max);\r\n    }\r\n\r\n    gradient[y][greyscale.data[y].length - 1] =\r\n      gradient[y][greyscale.data.length - 2];\r\n  }\r\n\r\n  gradient[greyscale.data.length - 1] = [];\r\n  for (let i = 0; i < gradient[0].length; i++) {\r\n    gradient[greyscale.data.length - 1][i] =\r\n      gradient[greyscale.data.length - 2][i];\r\n  }\r\n\r\n  // Flip and scale.\r\n  for (y = 0; y < gradient.length; y++) {\r\n    for (x = 0; x < gradient[y].length; x++) {\r\n      // @ts-ignore\r\n      gradient[y][x] = 1 - (gradient[y][x] / max);\r\n    }\r\n  }\r\n\r\n  return gradient;\r\n}\r\n\r\n/**\r\n * @param {object} greyscale The input greyscale.\r\n * @returns {object} A laplace object.\r\n */\r\nfunction computeLaplace(greyscale) {\r\n  // Returns a 2D array of Laplacian of Gaussian values\r\n  const laplace = [];\r\n\r\n  // Make the edges low cost here.\r\n\r\n  laplace[0] = [];\r\n  laplace[1] = [];\r\n  for (let i = 1; i < greyscale.data.length; i++) {\r\n    // Pad top, since we can't compute Laplacian\r\n    laplace[0][i] = 1;\r\n    laplace[1][i] = 1;\r\n  }\r\n\r\n  for (let y = 2; y < greyscale.data.length - 2; y++) {\r\n    laplace[y] = [];\r\n    // Pad left, ditto\r\n    laplace[y][0] = 1;\r\n    laplace[y][1] = 1;\r\n\r\n    for (let x = 2; x < greyscale.data[y].length - 2; x++) {\r\n      // Threshold needed to get rid of clutter.\r\n      laplace[y][x] = (greyscale.laplace(x, y) > 0.33) ? 0 : 1;\r\n    }\r\n\r\n    // Pad right, ditto\r\n    laplace[y][greyscale.data[y].length - 2] = 1;\r\n    laplace[y][greyscale.data[y].length - 1] = 1;\r\n  }\r\n\r\n  laplace[greyscale.data.length - 2] = [];\r\n  laplace[greyscale.data.length - 1] = [];\r\n  for (let j = 1; j < greyscale.data.length; j++) {\r\n    // Pad bottom, ditto\r\n    laplace[greyscale.data.length - 2][j] = 1;\r\n    laplace[greyscale.data.length - 1][j] = 1;\r\n  }\r\n\r\n  return laplace;\r\n}\r\n\r\n/**\r\n * Compute the X gradient.\r\n *\r\n * @param {object} greyscale The values.\r\n * @returns {Array} The gradient.\r\n */\r\nfunction computeGradX(greyscale) {\r\n  // Returns 2D array of x-gradient values for greyscale\r\n  const gradX = [];\r\n\r\n  for (let y = 0; y < greyscale.data.length; y++) {\r\n    gradX[y] = [];\r\n\r\n    for (let x = 0; x < greyscale.data[y].length - 1; x++) {\r\n      gradX[y][x] = greyscale.dx(x, y);\r\n    }\r\n\r\n    gradX[y][greyscale.data[y].length - 1] =\r\n      gradX[y][greyscale.data[y].length - 2];\r\n  }\r\n\r\n  return gradX;\r\n}\r\n\r\n/**\r\n * Compute the Y gradient.\r\n *\r\n * @param {object} greyscale The values.\r\n * @returns {Array} The gradient.\r\n */\r\nfunction computeGradY(greyscale) {\r\n  // Returns 2D array of y-gradient values for greyscale\r\n  const gradY = [];\r\n\r\n  for (let y = 0; y < greyscale.data.length - 1; y++) {\r\n    gradY[y] = [];\r\n\r\n    for (let x = 0; x < greyscale.data[y].length; x++) {\r\n      gradY[y][x] = greyscale.dy(x, y);\r\n    }\r\n  }\r\n\r\n  gradY[greyscale.data.length - 1] = [];\r\n  for (let i = 0; i < greyscale.data[0].length; i++) {\r\n    gradY[greyscale.data.length - 1][i] = gradY[greyscale.data.length - 2][i];\r\n  }\r\n\r\n  return gradY;\r\n}\r\n\r\n/**\r\n * Compute the gradient unit vector.\r\n *\r\n * @param {Array} gradX The X gradient.\r\n * @param {Array} gradY The Y gradient.\r\n * @param {number} px The point X.\r\n * @param {number} py The point Y.\r\n * @param {object} out The result.\r\n */\r\nfunction gradUnitVector(gradX, gradY, px, py, out) {\r\n  // Returns the gradient vector at (px,py), scaled to a magnitude of 1\r\n  const ox = gradX[py][px];\r\n  const oy = gradY[py][px];\r\n\r\n  let gvm = Math.sqrt(ox * ox + oy * oy);\r\n  gvm = Math.max(gvm, 1e-100); // To avoid possible divide-by-0 errors\r\n\r\n  out.x = ox / gvm;\r\n  out.y = oy / gvm;\r\n}\r\n\r\n/**\r\n * Compute the gradient direction.\r\n *\r\n * @param {Array} gradX The X gradient.\r\n * @param {Array} gradY The Y gradient.\r\n * @param {number} px The point X.\r\n * @param {number} py The point Y.\r\n * @param {number} qx The q X.\r\n * @param {number} qy The q Y.\r\n * @returns {number} The direction.\r\n */\r\nfunction gradDirection(gradX, gradY, px, py, qx, qy) {\r\n  const __dgpuv = {x: -1, y: -1};\r\n  const __gdquv = {x: -1, y: -1};\r\n  // Compute the gradiant direction, in radians, between to points\r\n  gradUnitVector(gradX, gradY, px, py, __dgpuv);\r\n  gradUnitVector(gradX, gradY, qx, qy, __gdquv);\r\n\r\n  let dp = __dgpuv.y * (qx - px) - __dgpuv.x * (qy - py);\r\n  let dq = __gdquv.y * (qx - px) - __gdquv.x * (qy - py);\r\n\r\n  // Make sure dp is positive, to keep things consistant\r\n  if (dp < 0) {\r\n    dp = -dp;\r\n    dq = -dq;\r\n  }\r\n\r\n  if (px !== qx && py !== qy) {\r\n    // We're going diagonally between pixels\r\n    dp *= Math.SQRT1_2;\r\n    dq *= Math.SQRT1_2;\r\n  }\r\n\r\n  return __twothirdpi * (Math.acos(dp) + Math.acos(dq));\r\n}\r\n\r\n/**\r\n * Compute the sides.\r\n *\r\n * @param {number} dist The distance.\r\n * @param {Array} gradX The X gradient.\r\n * @param {Array} gradY The Y gradient.\r\n * @param {object} greyscale The value.\r\n * @returns {object} The sides.\r\n */\r\nfunction computeSides(dist, gradX, gradY, greyscale) {\r\n  // Returns 2 2D arrays, containing inside and outside greyscale values.\r\n  // These greyscale values are the intensity just a little bit along the\r\n  // gradient vector, in either direction, from the supplied point. These\r\n  // values are used when using active-learning Intelligent Scissors\r\n\r\n  const sides = {};\r\n  sides.inside = [];\r\n  sides.outside = [];\r\n\r\n  const guv = {x: -1, y: -1}; // Current gradient unit vector\r\n\r\n  for (let y = 0; y < gradX.length; y++) {\r\n    sides.inside[y] = [];\r\n    sides.outside[y] = [];\r\n\r\n    for (let x = 0; x < gradX[y].length; x++) {\r\n      gradUnitVector(gradX, gradY, x, y, guv);\r\n\r\n      //(x, y) rotated 90 = (y, -x)\r\n\r\n      let ix = Math.round(x + dist * guv.y);\r\n      let iy = Math.round(y - dist * guv.x);\r\n      let ox = Math.round(x - dist * guv.y);\r\n      let oy = Math.round(y + dist * guv.x);\r\n\r\n      ix = Math.max(Math.min(ix, gradX[y].length - 1), 0);\r\n      ox = Math.max(Math.min(ox, gradX[y].length - 1), 0);\r\n      iy = Math.max(Math.min(iy, gradX.length - 1), 0);\r\n      oy = Math.max(Math.min(oy, gradX.length - 1), 0);\r\n\r\n      sides.inside[y][x] = greyscale.data[iy][ix];\r\n      sides.outside[y][x] = greyscale.data[oy][ox];\r\n    }\r\n  }\r\n\r\n  return sides;\r\n}\r\n\r\n/**\r\n * Gaussian blur an input buffer.\r\n *\r\n * @param {Array} buffer The input buffer.\r\n * @param {Array} out The result.\r\n */\r\nfunction gaussianBlur(buffer, out) {\r\n  // Smooth values over to fill in gaps in the mapping\r\n  out[0] = 0.4 * buffer[0] + 0.5 * buffer[1] + 0.1 * buffer[1];\r\n  out[1] = 0.25 * buffer[0] + 0.4 * buffer[1] + 0.25 * buffer[2] +\r\n    0.1 * buffer[3];\r\n\r\n  for (let i = 2; i < buffer.length - 2; i++) {\r\n    out[i] = 0.05 * buffer[i - 2] + 0.25 * buffer[i - 1] +\r\n      0.4 * buffer[i] + 0.25 * buffer[i + 1] + 0.05 * buffer[i + 2];\r\n  }\r\n\r\n  const len = buffer.length;\r\n  out[len - 2] = 0.25 * buffer[len - 1] + 0.4 * buffer[len - 2] +\r\n    0.25 * buffer[len - 3] + 0.1 * buffer[len - 4];\r\n  out[len - 1] = 0.4 * buffer[len - 1] + 0.5 * buffer[len - 2] +\r\n    0.1 * buffer[len - 3];\r\n}\r\n\r\n/**\r\n * Scissors\r\n *\r\n * Ref: Eric N. Mortensen, William A. Barrett, Interactive Segmentation with\r\n *   Intelligent Scissors, Graphical Models and Image Processing, Volume 60,\r\n *   Issue 5, September 1998, Pages 349-384, ISSN 1077-3169,\r\n *   DOI: 10.1006/gmip.1998.0480.\r\n *\r\n * {@link http://www.sciencedirect.com/science/article/B6WG4-45JB8WN-9/2/6fe59d8089fd1892c2bfb82283065579}\r\n *\r\n * Highly inspired from {@link http://code.google.com/p/livewire-javascript/}\r\n */\r\nexport class Scissors {\r\n\r\n  constructor() {\r\n    this.width = -1;\r\n    this.height = -1;\r\n\r\n    this.curPoint = null; // Corrent point we're searching on.\r\n    this.searchGranBits = 8; // Bits of resolution for BucketQueue.\r\n    this.searchGran = 1 << this.searchGranBits; //bits.\r\n    this.pointsPerPost = 500;\r\n\r\n    // Precomputed image data. All in ranges 0 >= x >= 1 and\r\n    //   all inverted (1 - x).\r\n    this.greyscale = null; // Greyscale of image\r\n    this.laplace = null; // Laplace zero-crossings (either 0 or 1).\r\n    this.gradient = null; // Gradient magnitudes.\r\n    this.gradX = null; // X-differences.\r\n    this.gradY = null; // Y-differences.\r\n\r\n    // Matrix mapping point => parent along shortest-path to root.\r\n    this.parents = null;\r\n\r\n    this.working = false; // Currently computing shortest paths?\r\n\r\n    // Begin Training:\r\n    this.trained = false;\r\n    this.trainingPoints = null;\r\n\r\n    this.edgeWidth = 2;\r\n    this.trainingLength = 32;\r\n\r\n    this.edgeGran = 256;\r\n    this.edgeTraining = null;\r\n\r\n    this.gradPointsNeeded = 32;\r\n    this.gradGran = 1024;\r\n    this.gradTraining = null;\r\n\r\n    this.insideGran = 256;\r\n    this.insideTraining = null;\r\n\r\n    this.outsideGran = 256;\r\n    this.outsideTraining = null;\r\n  }\r\n  // End Training\r\n\r\n\r\n  // Begin training methods //\r\n  getTrainingIdx(granularity, value) {\r\n    return Math.round((granularity - 1) * value);\r\n  }\r\n\r\n  getTrainedEdge(edge) {\r\n    return this.edgeTraining[this.getTrainingIdx(this.edgeGran, edge)];\r\n  }\r\n\r\n  getTrainedGrad(grad) {\r\n    return this.gradTraining[this.getTrainingIdx(this.gradGran, grad)];\r\n  }\r\n\r\n  getTrainedInside(inside) {\r\n    return this.insideTraining[this.getTrainingIdx(this.insideGran, inside)];\r\n  }\r\n\r\n  getTrainedOutside(outside) {\r\n    return this.outsideTraining[this.getTrainingIdx(this.outsideGran, outside)];\r\n  }\r\n  // End training methods //\r\n\r\n  setWorking(working) {\r\n    // Sets working flag\r\n    this.working = working;\r\n  }\r\n\r\n  setDimensions(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  setData(data) {\r\n    if (this.width === -1 || this.height === -1) {\r\n      // The width and height should have already been set\r\n      throw new Error('Dimensions have not been set.');\r\n    }\r\n\r\n    this.greyscale = computeGreyscale(data, this.width, this.height);\r\n    this.laplace = computeLaplace(this.greyscale);\r\n    this.gradient = computeGradient(this.greyscale);\r\n    this.gradX = computeGradX(this.greyscale);\r\n    this.gradY = computeGradY(this.greyscale);\r\n\r\n    const sides = computeSides(\r\n      this.edgeWidth, this.gradX, this.gradY, this.greyscale);\r\n    this.inside = sides.inside;\r\n    this.outside = sides.outside;\r\n    this.edgeTraining = [];\r\n    this.gradTraining = [];\r\n    this.insideTraining = [];\r\n    this.outsideTraining = [];\r\n  }\r\n\r\n  findTrainingPoints(p) {\r\n    // Grab the last handful of points for training\r\n    const points = [];\r\n\r\n    if (this.parents !== null) {\r\n      for (let i = 0; i < this.trainingLength && p; i++) {\r\n        points.push(p);\r\n        p = this.parents[p.y][p.x];\r\n      }\r\n    }\r\n\r\n    return points;\r\n  }\r\n\r\n  resetTraining() {\r\n    this.trained = false; // Training is ignored with this flag set\r\n  }\r\n\r\n  doTraining(p) {\r\n    // Compute training weights and measures\r\n    this.trainingPoints = this.findTrainingPoints(p);\r\n\r\n    if (this.trainingPoints.length < 8) {\r\n      return; // Not enough points, I think. It might crash if length = 0.\r\n    }\r\n\r\n    const buffer = [];\r\n    this.calculateTraining(\r\n      buffer, this.edgeGran, this.greyscale, this.edgeTraining);\r\n    this.calculateTraining(\r\n      buffer, this.gradGran, this.gradient, this.gradTraining);\r\n    this.calculateTraining(\r\n      buffer, this.insideGran, this.inside, this.insideTraining);\r\n    this.calculateTraining(\r\n      buffer, this.outsideGran, this.outside, this.outsideTraining);\r\n\r\n    if (this.trainingPoints.length < this.gradPointsNeeded) {\r\n      // If we have two few training points, the gradient weight map might not\r\n      // be smooth enough, so average with normal weights.\r\n      this.addInStaticGrad(this.trainingPoints.length, this.gradPointsNeeded);\r\n    }\r\n\r\n    this.trained = true;\r\n  }\r\n\r\n  calculateTraining(\r\n    buffer, granularity, input, output) {\r\n    let i = 0;\r\n    // Build a map of raw-weights to trained-weights by favoring input values\r\n    buffer.length = granularity;\r\n    for (i = 0; i < granularity; i++) {\r\n      buffer[i] = 0;\r\n    }\r\n\r\n    let maxVal = 1;\r\n    for (i = 0; i < this.trainingPoints.length; i++) {\r\n      const p = this.trainingPoints[i];\r\n      const idx = this.getTrainingIdx(granularity, input[p.y][p.x]);\r\n      buffer[idx] += 1;\r\n\r\n      maxVal = Math.max(maxVal, buffer[idx]);\r\n    }\r\n\r\n    // Invert and scale.\r\n    for (i = 0; i < granularity; i++) {\r\n      buffer[i] = 1 - buffer[i] / maxVal;\r\n    }\r\n\r\n    // Blur it, as suggested. Gets rid of static.\r\n    gaussianBlur(buffer, output);\r\n  }\r\n\r\n  addInStaticGrad(have, need) {\r\n    // Average gradient raw-weights to trained-weights map with standard weight\r\n    // map so that we don't end up with something to spiky\r\n    for (let i = 0; i < this.gradGran; i++) {\r\n      this.gradTraining[i] = Math.min(\r\n        this.gradTraining[i],\r\n        1 - i * (need - have) / (need * this.gradGran)\r\n      );\r\n    }\r\n  }\r\n\r\n  gradDirection(px, py, qx, qy) {\r\n    return gradDirection(this.gradX, this.gradY, px, py, qx, qy);\r\n  }\r\n\r\n  dist(px, py, qx, qy) {\r\n    // The grand culmunation of most of the code: the weighted distance function\r\n    let grad = this.gradient[qy][qx];\r\n\r\n    if (px === qx || py === qy) {\r\n      // The distance is Euclidean-ish; non-diagonal edges should be shorter\r\n      grad *= Math.SQRT1_2;\r\n    }\r\n\r\n    const lap = this.laplace[qy][qx];\r\n    const dir = this.gradDirection(px, py, qx, qy);\r\n\r\n    if (this.trained) {\r\n      // Apply training magic\r\n      const gradT = this.getTrainedGrad(grad);\r\n      const edgeT = this.getTrainedEdge(this.greyscale.data[py][px]);\r\n      const insideT = this.getTrainedInside(this.inside[py][px]);\r\n      const outsideT = this.getTrainedOutside(this.outside[py][px]);\r\n\r\n      return 0.3 * gradT + 0.3 * lap + 0.1 * (dir + edgeT + insideT + outsideT);\r\n    } else {\r\n      // Normal weights\r\n      return 0.43 * grad + 0.43 * lap + 0.11 * dir;\r\n    }\r\n  }\r\n\r\n  adj(p) {\r\n    const list = [];\r\n\r\n    const sx = Math.max(p.x - 1, 0);\r\n    const sy = Math.max(p.y - 1, 0);\r\n    const ex = Math.min(p.x + 1, this.greyscale.data[0].length - 1);\r\n    const ey = Math.min(p.y + 1, this.greyscale.data.length - 1);\r\n\r\n    let idx = 0;\r\n    for (let y = sy; y <= ey; y++) {\r\n      for (let x = sx; x <= ex; x++) {\r\n        if (x !== p.x || y !== p.y) {\r\n          list[idx++] = {x: x, y: y};\r\n        }\r\n      }\r\n    }\r\n\r\n    return list;\r\n  }\r\n\r\n  #costFunction = (p) => {\r\n    return Math.round(this.searchGran * this.cost[p.y][p.x]);\r\n  };\r\n\r\n  setPoint(sp) {\r\n    this.setWorking(true);\r\n\r\n    this.curPoint = sp;\r\n\r\n    let x = 0;\r\n    let y = 0;\r\n\r\n    this.visited = [];\r\n    for (y = 0; y < this.height; y++) {\r\n      this.visited[y] = [];\r\n      for (x = 0; x < this.width; x++) {\r\n        this.visited[y][x] = false;\r\n      }\r\n    }\r\n\r\n    this.parents = [];\r\n    for (y = 0; y < this.height; y++) {\r\n      this.parents[y] = [];\r\n    }\r\n\r\n    this.cost = [];\r\n    for (y = 0; y < this.height; y++) {\r\n      this.cost[y] = [];\r\n      for (x = 0; x < this.width; x++) {\r\n        this.cost[y][x] = Number.MAX_VALUE;\r\n      }\r\n    }\r\n    this.cost[sp.y][sp.x] = 0;\r\n\r\n    this.pq = new BucketQueue(this.searchGranBits, this.#costFunction);\r\n    this.pq.push(sp);\r\n  }\r\n\r\n  doWork() {\r\n    if (!this.working) {\r\n      return;\r\n    }\r\n\r\n    this.timeout = null;\r\n\r\n    let pointCount = 0;\r\n    const newPoints = [];\r\n    while (!this.pq.isEmpty() && pointCount < this.pointsPerPost) {\r\n      const p = this.pq.pop();\r\n      newPoints.push(p);\r\n      newPoints.push(this.parents[p.y][p.x]);\r\n\r\n      this.visited[p.y][p.x] = true;\r\n\r\n      const adjList = this.adj(p);\r\n      for (let i = 0; i < adjList.length; i++) {\r\n        const q = adjList[i];\r\n\r\n        const pqCost = this.cost[p.y][p.x] + this.dist(p.x, p.y, q.x, q.y);\r\n\r\n        if (pqCost < this.cost[q.y][q.x]) {\r\n          if (this.cost[q.y][q.x] !== Number.MAX_VALUE) {\r\n            // Already in PQ, must remove it so we can re-add it.\r\n            this.pq.remove(q);\r\n          }\r\n\r\n          this.cost[q.y][q.x] = pqCost;\r\n          this.parents[q.y][q.x] = p;\r\n          this.pq.push(q);\r\n        }\r\n      }\r\n\r\n      pointCount++;\r\n    }\r\n\r\n    return newPoints;\r\n  }\r\n\r\n} // Scissors class\r\n","import {i18n} from '../utils/i18n';\r\nimport {getStats} from './stats';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Point2D} from '../math/point';\r\nimport {ViewController} from '../app/viewController';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Mulitply the three inputs if the last two are not null.\r\n *\r\n * @param {number} a The first input.\r\n * @param {number} b The second input.\r\n * @param {number} c The third input.\r\n * @returns {number} The multiplication of the three inputs or\r\n *  null if one of the last two is null.\r\n */\r\nfunction mulABC(a, b, c) {\r\n  let res = null;\r\n  if (b !== null && c !== null) {\r\n    res = a * b * c;\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Circle shape.\r\n */\r\nexport class Circle {\r\n\r\n  /**\r\n   * Circle centre.\r\n   *\r\n   * @type {Point2D}\r\n   */\r\n  #centre;\r\n\r\n  /**\r\n   * Circle radius.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #radius;\r\n\r\n  /**\r\n   * @param {Point2D} centre A Point2D representing the centre\r\n   *   of the circle.\r\n   * @param {number} radius The radius of the circle.\r\n   */\r\n  constructor(centre, radius) {\r\n    this.#centre = centre;\r\n    this.#radius = radius;\r\n  }\r\n\r\n  /**\r\n   * Get the centre (point) of the circle.\r\n   *\r\n   * @returns {Point2D} The center (point) of the circle.\r\n   */\r\n  getCenter() {\r\n    return this.#centre;\r\n  }\r\n\r\n  /**\r\n   * Get the radius of the circle.\r\n   *\r\n   * @returns {number} The radius of the circle.\r\n   */\r\n  getRadius() {\r\n    return this.#radius;\r\n  }\r\n\r\n\r\n  /**\r\n   * Check for equality.\r\n   *\r\n   * @param {Circle} rhs The object to compare to.\r\n   * @returns {boolean} True if both objects are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      this.getCenter().equals(rhs.getCenter()) &&\r\n      this.getRadius() === rhs.getRadius();\r\n  }\r\n\r\n  /**\r\n   * Get the surface of the circle.\r\n   *\r\n   * @returns {number} The surface of the circle.\r\n   */\r\n  getSurface() {\r\n    return Math.PI * this.getRadius() * this.getRadius();\r\n  }\r\n\r\n  /**\r\n   * Get the surface of the circle according to a spacing.\r\n   *\r\n   * @param {number} spacingX The X spacing.\r\n   * @param {number} spacingY The Y spacing.\r\n   * @returns {number} The surface of the circle multiplied by the given\r\n   *  spacing or null for null spacings.\r\n   */\r\n  getWorldSurface(spacingX, spacingY) {\r\n    return mulABC(this.getSurface(), spacingX, spacingY);\r\n  }\r\n\r\n  /**\r\n   * Get the rounded limits of the circle.\r\n   * (see https://en.wikipedia.org/wiki/Circle#Equations)\r\n   * Circle formula: x*x + y*y = r*r\r\n   * => y = (+-) sqrt(r*r - x*x)\r\n   *\r\n   * @returns {Array} The rounded limits.\r\n   */\r\n  getRound() {\r\n    const centerX = this.getCenter().getX();\r\n    const centerY = this.getCenter().getY();\r\n    const radius = this.getRadius();\r\n    const rSquare = Math.pow(radius, 2);\r\n    // Y bounds\r\n    const minY = centerY - radius;\r\n    const maxY = centerY + radius;\r\n    const regions = [];\r\n    // loop through lines and store limits\r\n    for (let y = minY; y < maxY; ++y) {\r\n      const diff = rSquare - Math.pow(y - centerY, 2);\r\n      // remove small values (possibly negative)\r\n      if (Math.abs(diff) < 1e-7) {\r\n        continue;\r\n      }\r\n      const transX = Math.sqrt(diff);\r\n      // remove small values\r\n      if (transX < 0.5) {\r\n        continue;\r\n      }\r\n      regions.push([\r\n        [Math.round(centerX - transX), Math.round(y)],\r\n        [Math.round(centerX + transX), Math.round(y)]\r\n      ]);\r\n    }\r\n    return regions;\r\n  }\r\n\r\n  /**\r\n   * Quantify an circle according to view information.\r\n   *\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @param {string[]} flags A list of stat values to calculate.\r\n   * @returns {object} A quantification object.\r\n   */\r\n  quantify(viewController, flags) {\r\n    const quant = {};\r\n    // shape quantification\r\n    const spacing = viewController.get2DSpacing();\r\n    quant.radius = {\r\n      value: this.getRadius() * spacing[0],\r\n      unit: i18n.t('unit.mm')\r\n    };\r\n    const surface = this.getWorldSurface(spacing[0], spacing[1]);\r\n    if (surface !== null) {\r\n      quant.surface = {value: surface / 100, unit: i18n.t('unit.cm2')};\r\n    }\r\n\r\n    // pixel values quantification\r\n    if (viewController.canQuantifyImage()) {\r\n      const regions = this.getRound();\r\n      if (regions.length !== 0) {\r\n        const values = viewController.getImageVariableRegionValues(regions);\r\n        const unit = viewController.getPixelUnit();\r\n        const quantif = getStats(values, flags);\r\n        quant.min = {value: quantif.min, unit: unit};\r\n        quant.max = {value: quantif.max, unit: unit};\r\n        quant.mean = {value: quantif.mean, unit: unit};\r\n        quant.stdDev = {value: quantif.stdDev, unit: unit};\r\n        if (typeof quantif.median !== 'undefined') {\r\n          quant.median = {value: quantif.median, unit: unit};\r\n        }\r\n        if (typeof quantif.p25 !== 'undefined') {\r\n          quant.p25 = {value: quantif.p25, unit: unit};\r\n        }\r\n        if (typeof quantif.p75 !== 'undefined') {\r\n          quant.p75 = {value: quantif.p75, unit: unit};\r\n        }\r\n      }\r\n    }\r\n\r\n    // return\r\n    return quant;\r\n  }\r\n\r\n} // Circle class\r\n","import {i18n} from '../utils/i18n';\r\nimport {getStats} from './stats';\r\nimport {Index} from './index';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Point2D} from '../math/point';\r\nimport {ViewController} from '../app/viewController';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Mulitply the three inputs if the last two are not null.\r\n *\r\n * @param {number} a The first input.\r\n * @param {number} b The second input.\r\n * @param {number} c The third input.\r\n * @returns {number} The multiplication of the three inputs or\r\n *  null if one of the last two is null.\r\n */\r\nfunction mulABC(a, b, c) {\r\n  let res = null;\r\n  if (b !== null && c !== null) {\r\n    res = a * b * c;\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Ellipse shape.\r\n */\r\nexport class Ellipse {\r\n\r\n  /**\r\n   * Ellipse centre.\r\n   *\r\n   * @type {Point2D}\r\n   */\r\n  #centre;\r\n\r\n  /**\r\n   * Ellipse horizontal radius.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #a;\r\n\r\n  /**\r\n   * Ellipse vertical radius.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #b;\r\n\r\n  /**\r\n   * @param {Point2D} centre A Point2D representing the centre\r\n   *   of the ellipse.\r\n   * @param {number} a The radius of the ellipse on the horizontal axe.\r\n   * @param {number} b The radius of the ellipse on the vertical axe.\r\n   */\r\n  constructor(centre, a, b) {\r\n    this.#centre = centre;\r\n    this.#a = a;\r\n    this.#b = b;\r\n  }\r\n\r\n  /**\r\n   * Get the centre (point) of the ellipse.\r\n   *\r\n   * @returns {Point2D} The center (point) of the ellipse.\r\n   */\r\n  getCenter() {\r\n    return this.#centre;\r\n  }\r\n\r\n  /**\r\n   * Get the radius of the ellipse on the horizontal axe.\r\n   *\r\n   * @returns {number} The radius of the ellipse on the horizontal axe.\r\n   */\r\n  getA() {\r\n    return this.#a;\r\n  }\r\n\r\n  /**\r\n   * Get the radius of the ellipse on the vertical axe.\r\n   *\r\n   * @returns {number} The radius of the ellipse on the vertical axe.\r\n   */\r\n  getB() {\r\n    return this.#b;\r\n  }\r\n\r\n  /**\r\n   * Check for equality.\r\n   *\r\n   * @param {Ellipse} rhs The object to compare to.\r\n   * @returns {boolean} True if both objects are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      this.getCenter().equals(rhs.getCenter()) &&\r\n      this.getA() === rhs.getA() &&\r\n      this.getB() === rhs.getB();\r\n  }\r\n\r\n  /**\r\n   * Get the surface of the ellipse.\r\n   *\r\n   * @returns {number} The surface of the ellipse.\r\n   */\r\n  getSurface() {\r\n    return Math.PI * this.getA() * this.getB();\r\n  }\r\n\r\n  /**\r\n   * Get the surface of the ellipse according to a spacing.\r\n   *\r\n   * @param {number} spacingX The X spacing.\r\n   * @param {number} spacingY The Y spacing.\r\n   * @returns {number} The surface of the ellipse multiplied by the given\r\n   *  spacing or null for null spacings.\r\n   */\r\n  getWorldSurface(spacingX, spacingY) {\r\n    return mulABC(this.getSurface(), spacingX, spacingY);\r\n  }\r\n\r\n  /**\r\n   * Get the rounded limits of the ellipse.\r\n   * (see https://en.wikipedia.org/wiki/Ellipse#Standard_equation)\r\n   * Ellipse formula: x*x / a*a + y*y / b*b = 1\r\n   * => y = (+-)(b/a) * sqrt(a*a - x*x)\r\n   *\r\n   * @returns {Array} The rounded limits.\r\n   */\r\n  getRound() {\r\n    const centerX = this.getCenter().getX();\r\n    const centerY = this.getCenter().getY();\r\n    const radiusX = this.getA();\r\n    const radiusY = this.getB();\r\n    const radiusRatio = radiusX / radiusY;\r\n    const rySquare = Math.pow(radiusY, 2);\r\n    // Y bounds\r\n    const minY = centerY - radiusY;\r\n    const maxY = centerY + radiusY;\r\n    const regions = [];\r\n    // loop through lines and store limits\r\n    for (let y = minY; y < maxY; ++y) {\r\n      const diff = rySquare - Math.pow(y - centerY, 2);\r\n      // remove small values (possibly negative)\r\n      if (Math.abs(diff) < 1e-7) {\r\n        continue;\r\n      }\r\n      const transX = radiusRatio * Math.sqrt(diff);\r\n      // remove small values\r\n      if (transX < 0.5) {\r\n        continue;\r\n      }\r\n      regions.push([\r\n        [Math.round(centerX - transX), Math.round(y)],\r\n        [Math.round(centerX + transX), Math.round(y)]\r\n      ]);\r\n    }\r\n    return regions;\r\n  }\r\n\r\n  /**\r\n   * Quantify an ellipse according to view information.\r\n   *\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @param {string[]} flags A list of stat values to calculate.\r\n   * @returns {object} A quantification object.\r\n   */\r\n  quantify(viewController, flags) {\r\n    const quant = {};\r\n    // shape quantification\r\n    const spacing = viewController.get2DSpacing();\r\n    quant.a = {\r\n      value: this.getA() * spacing[0],\r\n      unit: i18n.t('unit.mm')\r\n    };\r\n    quant.b = {\r\n      value: this.getB() * spacing[1],\r\n      unit: i18n.t('unit.mm')\r\n    };\r\n    const surface = this.getWorldSurface(spacing[0], spacing[1]);\r\n    if (surface !== null) {\r\n      quant.surface = {value: surface / 100, unit: i18n.t('unit.cm2')};\r\n    }\r\n\r\n    // pixel values quantification\r\n    if (viewController.canQuantifyImage()) {\r\n      const regions = this.getRound();\r\n      if (regions.length !== 0) {\r\n        const values = viewController.getImageVariableRegionValues(regions);\r\n        const unit = viewController.getPixelUnit();\r\n        const quantif = getStats(values, flags);\r\n        quant.min = {value: quantif.min, unit: unit};\r\n        quant.max = {value: quantif.max, unit: unit};\r\n        quant.mean = {value: quantif.mean, unit: unit};\r\n        quant.stdDev = {value: quantif.stdDev, unit: unit};\r\n        if (typeof quantif.median !== 'undefined') {\r\n          quant.median = {value: quantif.median, unit: unit};\r\n        }\r\n        if (typeof quantif.p25 !== 'undefined') {\r\n          quant.p25 = {value: quantif.p25, unit: unit};\r\n        }\r\n        if (typeof quantif.p75 !== 'undefined') {\r\n          quant.p75 = {value: quantif.p75, unit: unit};\r\n        }\r\n      }\r\n    }\r\n\r\n    // return\r\n    return quant;\r\n  }\r\n\r\n} // Ellipse class\r\n\r\n/**\r\n * Get the indices that form a ellpise.\r\n *\r\n * @param {Index} center The ellipse center.\r\n * @param {Array} radius The 2 ellipse radiuses.\r\n * @param {Array} dir The 2 ellipse directions.\r\n * @returns {Array} The indices of the ellipse.\r\n */\r\nexport function getEllipseIndices(center, radius, dir) {\r\n  const centerValues = center.getValues();\r\n  // keep all values for possible extra dimensions\r\n  const values = centerValues.slice();\r\n  const indices = [];\r\n  const radiusI = radius[0];\r\n  const radiusJ = radius[1];\r\n  const radiusRatio = radiusI / radiusJ;\r\n  const radiusJ2 = Math.pow(radiusJ, 2);\r\n  const di = dir[0];\r\n  const dj = dir[1];\r\n  // deduce 4 positions from top right\r\n  for (let j = 0; j < radiusJ; ++j) {\r\n    // right triangle formed by radiuses, j and len\r\n    // ellipse: i*i / a*a + j*j / b*b = 1\r\n    // -> i = a/b * sqrt(b*b - j*j)\r\n    const len = Math.round(\r\n      radiusRatio * Math.sqrt(radiusJ2 - Math.pow(j, 2)));\r\n    const jmax = centerValues[dj] + j;\r\n    const jmin = centerValues[dj] - j;\r\n    for (let i = 0; i < len; ++i) {\r\n      const imax = centerValues[di] + i;\r\n      const imin = centerValues[di] - i;\r\n\r\n      // right\r\n      values[di] = imax;\r\n      // right - top\r\n      values[dj] = jmax;\r\n      indices.push(new Index(values.slice()));\r\n      // right - bottom\r\n      if (jmin !== jmax) {\r\n        values[dj] = jmin;\r\n        indices.push(new Index(values.slice()));\r\n      }\r\n\r\n      // left\r\n      if (imin !== imax) {\r\n        values[di] = imin;\r\n        // left - top\r\n        values[dj] = jmax;\r\n        indices.push(new Index(values.slice()));\r\n        // left - bottom\r\n        if (jmin !== jmax) {\r\n          values[dj] = jmin;\r\n          indices.push(new Index(values.slice()));\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return indices;\r\n}\r\n","import {Point2D} from './point';\r\nimport {getStats} from './stats';\r\nimport {i18n} from '../utils/i18n';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ViewController} from '../app/viewController';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Mulitply the three inputs if the last two are not null.\r\n *\r\n * @param {number} a The first input.\r\n * @param {number} b The second input.\r\n * @param {number} c The third input.\r\n * @returns {number} The multiplication of the three inputs or\r\n *  null if one of the last two is null.\r\n */\r\nfunction mulABC(a, b, c) {\r\n  let res = null;\r\n  if (b !== null && c !== null) {\r\n    res = a * b * c;\r\n  }\r\n  return res;\r\n}\r\n\r\n/**\r\n * Rectangle shape.\r\n */\r\nexport class Rectangle {\r\n\r\n  /**\r\n   * Rectangle begin point.\r\n   *\r\n   * @type {Point2D}\r\n   */\r\n  #begin;\r\n\r\n  /**\r\n   * Rectangle end point.\r\n   *\r\n   * @type {Point2D}\r\n   */\r\n  #end;\r\n\r\n  /**\r\n   * @param {Point2D} begin A Point2D representing the beginning\r\n   *   of the rectangle.\r\n   * @param {Point2D} end A Point2D representing the end\r\n   *   of the rectangle.\r\n   */\r\n  constructor(begin, end) {\r\n    this.#begin = new Point2D(\r\n      Math.min(begin.getX(), end.getX()),\r\n      Math.min(begin.getY(), end.getY())\r\n    );\r\n    this.#end = new Point2D(\r\n      Math.max(begin.getX(), end.getX()),\r\n      Math.max(begin.getY(), end.getY())\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the begin point of the rectangle.\r\n   *\r\n   * @returns {Point2D} The begin point of the rectangle\r\n   */\r\n  getBegin() {\r\n    return this.#begin;\r\n  }\r\n\r\n  /**\r\n   * Get the end point of the rectangle.\r\n   *\r\n   * @returns {Point2D} The end point of the rectangle\r\n   */\r\n  getEnd() {\r\n    return this.#end;\r\n  }\r\n\r\n  /**\r\n   * Check for equality.\r\n   *\r\n   * @param {Rectangle} rhs The object to compare to.\r\n   * @returns {boolean} True if both objects are equal.\r\n   */\r\n  equals(rhs) {\r\n    return rhs !== null &&\r\n      this.getBegin().equals(rhs.getBegin()) &&\r\n      this.getEnd().equals(rhs.getEnd());\r\n  }\r\n\r\n  /**\r\n   * Get the surface of the rectangle.\r\n   *\r\n   * @returns {number} The surface of the rectangle.\r\n   */\r\n  getSurface() {\r\n    const begin = this.getBegin();\r\n    const end = this.getEnd();\r\n    return Math.abs(end.getX() - begin.getX()) *\r\n      Math.abs(end.getY() - begin.getY());\r\n  }\r\n\r\n  /**\r\n   * Get the surface of the rectangle according to a spacing.\r\n   *\r\n   * @param {number} spacingX The X spacing.\r\n   * @param {number} spacingY The Y spacing.\r\n   * @returns {number} The surface of the rectangle multiplied by the given\r\n   *  spacing or null for null spacings.\r\n   */\r\n  getWorldSurface(spacingX, spacingY) {\r\n    return mulABC(this.getSurface(), spacingX, spacingY);\r\n  }\r\n\r\n  /**\r\n   * Get the real width of the rectangle.\r\n   *\r\n   * @returns {number} The real width of the rectangle.\r\n   */\r\n  getRealWidth() {\r\n    return this.getEnd().getX() - this.getBegin().getX();\r\n  }\r\n\r\n  /**\r\n   * Get the real height of the rectangle.\r\n   *\r\n   * @returns {number} The real height of the rectangle.\r\n   */\r\n  getRealHeight() {\r\n    return this.getEnd().getY() - this.getBegin().getY();\r\n  }\r\n\r\n  /**\r\n   * Get the width of the rectangle.\r\n   *\r\n   * @returns {number} The width of the rectangle.\r\n   */\r\n  getWidth() {\r\n    return Math.abs(this.getRealWidth());\r\n  }\r\n\r\n  /**\r\n   * Get the height of the rectangle.\r\n   *\r\n   * @returns {number} The height of the rectangle.\r\n   */\r\n  getHeight() {\r\n    return Math.abs(this.getRealHeight());\r\n  }\r\n\r\n  /**\r\n   * Get the rounded limits of the rectangle.\r\n   *\r\n   * @returns {object} The rounded limits.\r\n   */\r\n  getRound() {\r\n    return {\r\n      min: this.getBegin().getRound(),\r\n      max: this.getEnd().getRound()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Quantify a rectangle according to view information.\r\n   *\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @param {string[]} flags A list of stat values to calculate.\r\n   * @returns {object} A quantification object.\r\n   */\r\n  quantify(viewController, flags) {\r\n    const quant = {};\r\n    // shape quantification\r\n    const spacing = viewController.get2DSpacing();\r\n    quant.width = {\r\n      value: this.getWidth() * spacing[0],\r\n      unit: i18n.t('unit.mm')\r\n    };\r\n    quant.height = {\r\n      value: this.getHeight() * spacing[1],\r\n      unit: i18n.t('unit.mm')\r\n    };\r\n    const surface = this.getWorldSurface(spacing[0], spacing[1]);\r\n    if (surface !== null) {\r\n      quant.surface = {value: surface / 100, unit: i18n.t('unit.cm2')};\r\n    }\r\n\r\n    // pixel values quantification\r\n    if (viewController.canQuantifyImage()) {\r\n      const round = this.getRound();\r\n      const values = viewController.getImageRegionValues(round.min, round.max);\r\n      const unit = viewController.getPixelUnit();\r\n      const quantif = getStats(values, flags);\r\n      quant.min = {value: quantif.min, unit: unit};\r\n      quant.max = {value: quantif.max, unit: unit};\r\n      quant.mean = {value: quantif.mean, unit: unit};\r\n      quant.stdDev = {value: quantif.stdDev, unit: unit};\r\n      if (typeof quantif.median !== 'undefined') {\r\n        quant.median = {value: quantif.median, unit: unit};\r\n      }\r\n      if (typeof quantif.p25 !== 'undefined') {\r\n        quant.p25 = {value: quantif.p25, unit: unit};\r\n      }\r\n      if (typeof quantif.p75 !== 'undefined') {\r\n        quant.p75 = {value: quantif.p75, unit: unit};\r\n      }\r\n    }\r\n\r\n    // return\r\n    return quant;\r\n  }\r\n\r\n} // Rectangle class\r\n","// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Image} from './image';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Threshold an image between an input minimum and maximum.\r\n */\r\nexport class Threshold {\r\n  /**\r\n   * Threshold minimum.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #min = 0;\r\n\r\n  /**\r\n   * Threshold maximum.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #max = 0;\r\n\r\n  /**\r\n   * Get the threshold minimum.\r\n   *\r\n   * @returns {number} The threshold minimum.\r\n   */\r\n  getMin() {\r\n    return this.#min;\r\n  }\r\n\r\n  /**\r\n   * Set the threshold minimum.\r\n   *\r\n   * @param {number} val The threshold minimum.\r\n   */\r\n  setMin(val) {\r\n    this.#min = val;\r\n  }\r\n\r\n  /**\r\n   * Get the threshold maximum.\r\n   *\r\n   * @returns {number} The threshold maximum.\r\n   */\r\n  getMax() {\r\n    return this.#max;\r\n  }\r\n\r\n  /**\r\n   * Set the threshold maximum.\r\n   *\r\n   * @param {number} val The threshold maximum.\r\n   */\r\n  setMax(val) {\r\n    this.#max = val;\r\n  }\r\n\r\n  /**\r\n   * Get the name of the filter.\r\n   *\r\n   * @returns {string} The name of the filter.\r\n   */\r\n  getName() {\r\n    return 'Threshold';\r\n  }\r\n\r\n  /**\r\n   * Original image.\r\n   *\r\n   * @type {Image}\r\n   */\r\n  #originalImage = null;\r\n\r\n  /**\r\n   * Set the original image.\r\n   *\r\n   * @param {Image} image The original image.\r\n   */\r\n  setOriginalImage(image) {\r\n    this.#originalImage = image;\r\n  }\r\n\r\n  /**\r\n   * Get the original image.\r\n   *\r\n   * @returns {Image} image The original image.\r\n   */\r\n  getOriginalImage() {\r\n    return this.#originalImage;\r\n  }\r\n\r\n  /**\r\n   * Transform the main image using this filter.\r\n   *\r\n   * @returns {Image} The transformed image.\r\n   */\r\n  update() {\r\n    const image = this.getOriginalImage();\r\n    const imageMin = image.getDataRange().min;\r\n    const threshFunction = (value) => {\r\n      if (value < this.getMin() || value > this.getMax()) {\r\n        return imageMin;\r\n      } else {\r\n        return value;\r\n      }\r\n    };\r\n    return image.transform(threshFunction);\r\n  }\r\n\r\n} // class Threshold\r\n\r\n/**\r\n * Sharpen an image using a sharpen convolution matrix.\r\n */\r\nexport class Sharpen {\r\n  /**\r\n   * Get the name of the filter.\r\n   *\r\n   * @returns {string} The name of the filter.\r\n   */\r\n  getName() {\r\n    return 'Sharpen';\r\n  }\r\n\r\n  /**\r\n   * Original image.\r\n   *\r\n   * @type {Image}\r\n   */\r\n  #originalImage = null;\r\n\r\n  /**\r\n   * Set the original image.\r\n   *\r\n   * @param {Image} image The original image.\r\n   */\r\n  setOriginalImage(image) {\r\n    this.#originalImage = image;\r\n  }\r\n\r\n  /**\r\n   * Get the original image.\r\n   *\r\n   * @returns {Image} image The original image.\r\n   */\r\n  getOriginalImage() {\r\n    return this.#originalImage;\r\n  }\r\n\r\n  /**\r\n   * Transform the main image using this filter.\r\n   *\r\n   * @returns {Image} The transformed image.\r\n   */\r\n  update() {\r\n    const image = this.getOriginalImage();\r\n    /* eslint-disable array-element-newline */\r\n    return image.convolute2D([\r\n      0, -1, 0,\r\n      -1, 5, -1,\r\n      0, -1, 0\r\n    ]);\r\n    /* eslint-enable array-element-newline */\r\n  }\r\n\r\n} // class Sharpen\r\n\r\n/**\r\n * Apply a Sobel filter to an image.\r\n */\r\nexport class Sobel {\r\n  /**\r\n   * Get the name of the filter.\r\n   *\r\n   * @returns {string} The name of the filter.\r\n   */\r\n  getName() {\r\n    return 'Sobel';\r\n  }\r\n\r\n  /**\r\n   * Original image.\r\n   *\r\n   * @type {Image}\r\n   */\r\n  #originalImage = null;\r\n\r\n  /**\r\n   * Set the original image.\r\n   *\r\n   * @param {Image} image The original image.\r\n   */\r\n  setOriginalImage(image) {\r\n    this.#originalImage = image;\r\n  }\r\n\r\n  /**\r\n   * Get the original image.\r\n   *\r\n   * @returns {Image} image The original image.\r\n   */\r\n  getOriginalImage() {\r\n    return this.#originalImage;\r\n  }\r\n\r\n  /**\r\n   * Transform the main image using this filter.\r\n   *\r\n   * @returns {Image} The transformed image.\r\n   */\r\n  update() {\r\n    const image = this.getOriginalImage();\r\n    /* eslint-disable array-element-newline */\r\n    const gradX = image.convolute2D([\r\n      1, 0, -1,\r\n      2, 0, -2,\r\n      1, 0, -1\r\n    ]);\r\n    const gradY = image.convolute2D([\r\n      1, 2, 1,\r\n      0, 0, 0,\r\n      -1, -2, -1\r\n    ]);\r\n    /* eslint-enable array-element-newline */\r\n    return gradX.compose(gradY, function (x, y) {\r\n      return Math.sqrt(x * x + y * y);\r\n    });\r\n  }\r\n\r\n} // class Sobel\r\n","import {ListenerHandler} from '../utils/listen';\r\nimport {\r\n  Threshold as ThresholdFilter,\r\n  Sobel as SobelFilter,\r\n  Sharpen as SharpenFilter\r\n} from '../image/filter';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Filter tool.\r\n */\r\nexport class Filter {\r\n\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Filter list\r\n   *\r\n   * @type {object}\r\n   */\r\n  #filterList = null;\r\n\r\n  /**\r\n   * Selected filter.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #selectedFilter = 0;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Activate the tool.\r\n   *\r\n   * @param {boolean} bool Flag to activate or not.\r\n   */\r\n  activate(bool) {\r\n    // setup event listening\r\n    for (const key in this.#filterList) {\r\n      if (bool) {\r\n        this.#filterList[key].addEventListener('filterrun', this.#fireEvent);\r\n        this.#filterList[key].addEventListener('filter-undo', this.#fireEvent);\r\n      } else {\r\n        this.#filterList[key].removeEventListener(\r\n          'filterrun', this.#fireEvent);\r\n        this.#filterList[key].removeEventListener(\r\n          'filter-undo', this.#fireEvent);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the tool options.\r\n   *\r\n   * @param {object} options The list of filter names amd classes.\r\n   */\r\n  setOptions(options) {\r\n    this.#filterList = {};\r\n    // try to instanciate filters from the options\r\n    for (const key in options) {\r\n      this.#filterList[key] = new options[key](this.#app);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the type of tool options: here 'instance' since the filter\r\n   * list contains instances of each possible filter.\r\n   *\r\n   * @returns {string} The type.\r\n   */\r\n  getOptionsType() {\r\n    return 'instance';\r\n  }\r\n\r\n  /**\r\n   * Initialise the filter. Called once the image is loaded.\r\n   */\r\n  init() {\r\n    // setup event listening\r\n    for (const key in this.#filterList) {\r\n      this.#filterList[key].init();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle keydown event.\r\n   *\r\n   * @param {object} event The keydown event.\r\n   */\r\n  keydown = (event) => {\r\n    event.context = 'Filter';\r\n    this.#app.onKeydown(event);\r\n  };\r\n\r\n  /**\r\n   * Get the list of event names that this tool can fire.\r\n   *\r\n   * @returns {Array} The list of event names.\r\n   */\r\n  getEventNames() {\r\n    return ['filterrun', 'filterundo'];\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Get the selected filter.\r\n   *\r\n   * @returns {object} The selected filter.\r\n   */\r\n  getSelectedFilter() {\r\n    return this.#selectedFilter;\r\n  }\r\n\r\n  /**\r\n   * Set the tool live features: filter name.\r\n   *\r\n   * @param {object} features The list of features.\r\n   */\r\n  setFeatures(features) {\r\n    if (typeof features.filterName !== 'undefined') {\r\n      // check if we have it\r\n      if (!this.hasFilter(features.filterName)) {\r\n        throw new Error('Unknown filter: \\'' + features.filterName + '\\'');\r\n      }\r\n      // de-activate last selected\r\n      if (this.#selectedFilter) {\r\n        this.#selectedFilter.activate(false);\r\n      }\r\n      // enable new one\r\n      this.#selectedFilter = this.#filterList[features.filterName];\r\n      // activate the selected filter\r\n      this.#selectedFilter.activate(true);\r\n    }\r\n    if (typeof features.run !== 'undefined' && features.run) {\r\n      let args = {};\r\n      if (typeof features.runArgs !== 'undefined') {\r\n        args = features.runArgs;\r\n      }\r\n      this.getSelectedFilter().run(args);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the list of filters.\r\n   *\r\n   * @returns {Array} The list of filter objects.\r\n   */\r\n  getFilterList() {\r\n    return this.#filterList;\r\n  }\r\n\r\n  /**\r\n   * Check if a filter is in the filter list.\r\n   *\r\n   * @param {string} name The name to check.\r\n   * @returns {string} The filter list element for the given name.\r\n   */\r\n  hasFilter(name) {\r\n    return this.#filterList[name];\r\n  }\r\n\r\n} // class Filter\r\n\r\n/**\r\n * Threshold filter tool.\r\n */\r\nexport class Threshold {\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Associated filter.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #filter = new ThresholdFilter();\r\n\r\n  /**\r\n   * Flag to know wether to reset the image or not.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #resetImage = true;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Activate the filter.\r\n   *\r\n   * @param {boolean} bool Flag to activate or not.\r\n   */\r\n  activate(bool) {\r\n    // reset the image when the tool is activated\r\n    if (bool) {\r\n      this.#resetImage = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialise the filter. Called once the image is loaded.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Run the filter.\r\n   *\r\n   * @param {*} args The filter arguments.\r\n   */\r\n  run(args) {\r\n    this.#filter.setMin(args.min);\r\n    this.#filter.setMax(args.max);\r\n    // reset the image if asked\r\n    if (this.#resetImage) {\r\n      this.#filter.setOriginalImage(this.#app.getLastImage());\r\n      this.#resetImage = false;\r\n    }\r\n    const command = new RunFilterCommand(this.#filter, this.#app);\r\n    command.onExecute = this.#fireEvent;\r\n    command.onUndo = this.#fireEvent;\r\n    command.execute();\r\n    // save command in undo stack\r\n    this.#app.addToUndoStack(command);\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *  event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n} // class Threshold\r\n\r\n/**\r\n * Sharpen filter tool.\r\n */\r\nexport class Sharpen {\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Activate the filter.\r\n   *\r\n   * @param {boolean} _bool Flag to activate or not.\r\n   */\r\n  activate(_bool) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Initialise the filter. Called once the image is loaded.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Run the filter.\r\n   *\r\n   * @param {*} _args The filter arguments.\r\n   */\r\n  run(_args) {\r\n    const filter = new SharpenFilter();\r\n    filter.setOriginalImage(this.#app.getLastImage());\r\n    const command = new RunFilterCommand(filter, this.#app);\r\n    command.onExecute = this.#fireEvent;\r\n    command.onUndo = this.#fireEvent;\r\n    command.execute();\r\n    // save command in undo stack\r\n    this.#app.addToUndoStack(command);\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *    event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n} // filter.Sharpen\r\n\r\n/**\r\n * Sobel filter tool.\r\n */\r\nexport class Sobel {\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Activate the filter.\r\n   *\r\n   * @param {boolean} _bool Flag to activate or not.\r\n   */\r\n  activate(_bool) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Initialise the filter. Called once the image is loaded.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Run the filter.\r\n   *\r\n   * @param {*} _args The filter arguments.\r\n   */\r\n  run(_args) {\r\n    const filter = new SobelFilter();\r\n    filter.setOriginalImage(this.#app.getLastImage());\r\n    const command = new RunFilterCommand(filter, this.#app);\r\n    command.onExecute = this.#fireEvent;\r\n    command.onUndo = this.#fireEvent;\r\n    command.execute();\r\n    // save command in undo stack\r\n    this.#app.addToUndoStack(command);\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *  event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n} // class filter.Sobel\r\n\r\n/**\r\n * Run filter command.\r\n */\r\nexport class RunFilterCommand {\r\n\r\n  /**\r\n   * The filter to run.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #filter;\r\n\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * @param {object} filter The filter to run.\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(filter, app) {\r\n    this.#filter = filter;\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Get the command name.\r\n   *\r\n   * @returns {string} The command name.\r\n   */\r\n  getName() {\r\n    return 'Filter-' + this.#filter.getName();\r\n  }\r\n\r\n  /**\r\n   * Execute the command.\r\n   *\r\n   * @fires RunFilterCommand#filterrun\r\n   */\r\n  execute() {\r\n    // run filter and set app image\r\n    this.#app.setLastImage(this.#filter.update());\r\n    // update display\r\n    this.#app.render(this.#app.getDataIds()[0]); //todo: fix\r\n    /**\r\n     * Filter run event.\r\n     *\r\n     * @event RunFilterCommand#filterrun\r\n     * @type {object}\r\n     * @property {string} type The event type: filterrun.\r\n     * @property {number} id The id of the run command.\r\n     */\r\n    const event = {\r\n      type: 'filterrun',\r\n      id: this.getName()\r\n    };\r\n    // callback\r\n    this.onExecute(event);\r\n  }\r\n\r\n  /**\r\n   * Undo the command.\r\n   *\r\n   * @fires RunFilterCommand#filterundo\r\n   */\r\n  undo() {\r\n    // reset the image\r\n    this.#app.setLastImage(this.#filter.getOriginalImage());\r\n    // update display\r\n    this.#app.render(this.#app.getDataIds()[0]); //todo: fix\r\n    /**\r\n     * Filter undo event.\r\n     *\r\n     * @event RunFilterCommand#filterundo\r\n     * @type {object}\r\n     * @property {string} type The event type: filterundo.\r\n     * @property {number} id The id of the undone run command.\r\n     */\r\n    const event = {\r\n      type: 'filterundo',\r\n      id: this.getName()\r\n    }; // callback\r\n    this.onUndo(event);\r\n  }\r\n\r\n  /**\r\n   * Handle an execute event.\r\n   *\r\n   * @param {object} _event The execute event with type and id.\r\n   */\r\n  onExecute(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n  /**\r\n   * Handle an undo event.\r\n   *\r\n   * @param {object} _event The undo event with type and id.\r\n   */\r\n  onUndo(_event) {\r\n    // default does nothing.\r\n  }\r\n\r\n} // RunFilterCommand class\r\n","import {WindowLevel} from './windowLevel';\r\nimport {Scroll} from './scroll';\r\nimport {ZoomAndPan} from './zoomPan';\r\nimport {Opacity} from './opacity';\r\nimport {Draw} from './draw';\r\nimport {Floodfill} from './floodfill';\r\nimport {Livewire} from './livewire';\r\n\r\nimport {ArrowFactory} from './arrow';\r\nimport {CircleFactory} from './circle';\r\nimport {EllipseFactory} from './ellipse';\r\nimport {FreeHandFactory} from './freeHand';\r\nimport {ProtractorFactory} from './protractor';\r\nimport {RectangleFactory} from './rectangle';\r\nimport {RoiFactory} from './roi';\r\nimport {RulerFactory} from './ruler';\r\n\r\nimport {Filter, Threshold, Sobel, Sharpen} from './filter';\r\n\r\n/**\r\n * List of client provided tools to be added to\r\n * the default ones.\r\n *\r\n * @type {Object<string, any>}\r\n */\r\nexport const toolList = {};\r\n\r\nexport const defaultToolList = {\r\n  WindowLevel,\r\n  Scroll,\r\n  ZoomAndPan,\r\n  Opacity,\r\n  Draw,\r\n  Filter,\r\n  Floodfill,\r\n  Livewire\r\n};\r\n\r\nexport const toolOptions = {\r\n  draw: {\r\n    ArrowFactory,\r\n    CircleFactory,\r\n    EllipseFactory,\r\n    FreeHandFactory,\r\n    ProtractorFactory,\r\n    RectangleFactory,\r\n    RoiFactory,\r\n    RulerFactory\r\n  },\r\n  filter: {\r\n    Threshold,\r\n    Sobel,\r\n    Sharpen\r\n  }\r\n};","import {ScrollWheel} from './scrollWheel';\r\nimport {getLayerDetailsFromEvent} from '../gui/layerGroup';\r\nimport {\r\n  validateWindowWidth,\r\n  WindowLevel as WindowLevelValues\r\n} from '../image/windowLevel';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * WindowLevel tool: handle window/level related events.\r\n *\r\n * @example\r\n * // create the dwv app\r\n * const app = new dwv.App();\r\n * // initialise\r\n * const viewConfig0 = new dwv.ViewConfig('layerGroup0');\r\n * const viewConfigs = {'*': [viewConfig0]};\r\n * const options = new dwv.AppOptions(viewConfigs);\r\n * options.tools = {WindowLevel: new dwv.ToolConfig()};\r\n * app.init(options);\r\n * // activate tool\r\n * app.addEventListener('load', function () {\r\n *   app.setTool('WindowLevel');\r\n * });\r\n * // load dicom data\r\n * app.loadURLs([\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\r\n * ]);\r\n */\r\nexport class WindowLevel {\r\n\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * Interaction start flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #started = false;\r\n\r\n  /**\r\n   * Scroll wheel handler.\r\n   *\r\n   * @type {ScrollWheel}\r\n   */\r\n  #scrollWhell;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#scrollWhell = new ScrollWheel(app);\r\n  }\r\n\r\n  /**\r\n   * Handle mouse down event.\r\n   *\r\n   * @param {object} event The mouse down event.\r\n   */\r\n  mousedown = (event) => {\r\n    // set start flag\r\n    this.#started = true;\r\n    // store initial position\r\n    this.x0 = event._x;\r\n    this.y0 = event._y;\r\n  };\r\n\r\n  /**\r\n   * Handle mouse move event.\r\n   *\r\n   * @param {object} event The mouse move event.\r\n   */\r\n  mousemove = (event) => {\r\n    // check start flag\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewController =\r\n      layerGroup.getActiveViewLayer().getViewController();\r\n\r\n    // difference to last position\r\n    const diffX = event._x - this.x0;\r\n    const diffY = this.y0 - event._y;\r\n    // data range\r\n    const range = viewController.getImageRescaledDataRange();\r\n    // 1/1000 seems to give reasonable results...\r\n    const pixelToIntensity = (range.max - range.min) * 0.01;\r\n\r\n    // calculate new window level\r\n    const center = viewController.getWindowLevel().center;\r\n    const width = viewController.getWindowLevel().width;\r\n    const windowCenter = center + Math.round(diffY * pixelToIntensity);\r\n    let windowWidth = width + Math.round(diffX * pixelToIntensity);\r\n    // bound window width\r\n    windowWidth = validateWindowWidth(windowWidth);\r\n    // set\r\n    const wl = new WindowLevelValues(windowCenter, windowWidth);\r\n    viewController.setWindowLevel(wl);\r\n\r\n    // store position\r\n    this.x0 = event._x;\r\n    this.y0 = event._y;\r\n  };\r\n\r\n  /**\r\n   * Handle mouse up event.\r\n   *\r\n   * @param {object} _event The mouse up event.\r\n   */\r\n  mouseup = (_event) => {\r\n    // set start flag\r\n    if (this.#started) {\r\n      this.#started = false;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse out event.\r\n   *\r\n   * @param {object} event The mouse out event.\r\n   */\r\n  mouseout = (event) => {\r\n    // treat as mouse up\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch start event.\r\n   *\r\n   * @param {object} event The touch start event.\r\n   */\r\n  touchstart = (event) => {\r\n    this.mousedown(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch move event.\r\n   *\r\n   * @param {object} event The touch move event.\r\n   */\r\n  touchmove = (event) => {\r\n    this.mousemove(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch end event.\r\n   *\r\n   * @param {object} event The touch end event.\r\n   */\r\n  touchend = (event) => {\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle double click event.\r\n   *\r\n   * @param {object} event The double click event.\r\n   */\r\n  dblclick = (event) => {\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const index = viewLayer.displayToPlaneIndex(event._x, event._y);\r\n    const viewController = viewLayer.getViewController();\r\n    const image = this.#app.getImage(viewLayer.getDataId());\r\n\r\n    // update view controller\r\n    const wl = new WindowLevelValues(\r\n      image.getRescaledValueAtIndex(\r\n        viewController.getCurrentIndex().getWithNew2D(\r\n          index.get(0),\r\n          index.get(1)\r\n        )\r\n      ),\r\n      viewController.getWindowLevel().width\r\n    );\r\n    viewController.setWindowLevel(wl);\r\n  };\r\n\r\n  /**\r\n   * Handle mouse wheel event.\r\n   *\r\n   * @param {WheelEvent} event The mouse wheel event.\r\n   */\r\n  wheel = (event) => {\r\n    this.#scrollWhell.wheel(event);\r\n  };\r\n\r\n  /**\r\n   * Handle key down event.\r\n   *\r\n   * @param {object} event The key down event.\r\n   */\r\n  keydown = (event) => {\r\n    event.context = 'WindowLevel';\r\n    this.#app.onKeydown(event);\r\n  };\r\n\r\n  /**\r\n   * Activate the tool.\r\n   *\r\n   * @param {boolean} _bool The flag to activate or not.\r\n   */\r\n  activate(_bool) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Initialise the tool.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n} // WindowLevel class\r\n","import {getLayerDetailsFromEvent} from '../gui/layerGroup';\r\nimport {precisionRound} from '../utils/string';\r\nimport {ScrollWheel} from './scrollWheel';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Scroll class.\r\n *\r\n * @example\r\n * // create the dwv app\r\n * const app = new dwv.App();\r\n * // initialise\r\n * const viewConfig0 = new dwv.ViewConfig('layerGroup0');\r\n * const viewConfigs = {'*': [viewConfig0]};\r\n * const options = new dwv.AppOptions(viewConfigs);\r\n * options.tools = {Scroll: new dwv.ToolConfig()};\r\n * app.init(options);\r\n * // activate tool\r\n * app.addEventListener('load', function () {\r\n *   app.setTool('Scroll');\r\n * });\r\n * // load dicom data\r\n * app.loadURLs([\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm',\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323707.dcm',\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323563.dcm'\r\n * ]);\r\n * @example <caption>Example with slider</caption>\r\n * // create the dwv app\r\n * const app = new dwv.App();\r\n * // initialise\r\n * const viewConfig0 = new dwv.ViewConfig('layerGroup0');\r\n * const viewConfigs = {'*': [viewConfig0]};\r\n * const options = new dwv.AppOptions(viewConfigs);\r\n * options.tools = {Scroll: new dwv.ToolConfig()};\r\n * app.init(options);\r\n * // create range\r\n * const range = document.createElement('input');\r\n * range.type = 'range';\r\n * range.min = 0;\r\n * range.id = 'sliceRange';\r\n * document.body.appendChild(range);\r\n * // update app on slider change\r\n * range.oninput = function () {\r\n *   const lg = app.getLayerGroupByDivId('layerGroup0');\r\n *   const vc = lg.getActiveViewLayer().getViewController();\r\n *   const index = vc.getCurrentIndex();\r\n *   const values = index.getValues();\r\n *   values[2] = this.value;\r\n *   vc.setCurrentIndex(new dwv.Index(values));\r\n * }\r\n * // activate tool and update range max on load\r\n * app.addEventListener('load', function () {\r\n *   app.setTool('Scroll');\r\n *   const size = app.getImage(0).getGeometry().getSize();\r\n *   range.max = size.get(2) - 1;\r\n * });\r\n * // update slider on slice change (for ex via mouse wheel)\r\n * app.addEventListener('positionchange', function () {\r\n *   const lg = app.getLayerGroupByDivId('layerGroup0');\r\n *   const vc = lg.getActiveViewLayer().getViewController();\r\n *   range.value = vc.getCurrentIndex().get(2);\r\n * });\r\n * // load dicom data\r\n * app.loadURLs([\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm',\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323707.dcm',\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323563.dcm'\r\n * ]);\r\n */\r\nexport class Scroll {\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * Interaction start flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #started = false;\r\n\r\n  /**\r\n   * Scroll wheel handler.\r\n   *\r\n   * @type {ScrollWheel}\r\n   */\r\n  #scrollWhell;\r\n\r\n  /**\r\n   * Touch timer ID (created by setTimeout).\r\n   *\r\n   * @type {number}\r\n   */\r\n  #touchTimerID;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#scrollWhell = new ScrollWheel(app);\r\n  }\r\n\r\n  /**\r\n   * Option to show or not a value tooltip on mousemove.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #displayTooltip = false;\r\n\r\n  /**\r\n   * Handle mouse down event.\r\n   *\r\n   * @param {object} event The mouse down event.\r\n   */\r\n  mousedown = (event) => {\r\n    // optional tooltip\r\n    this.#removeTooltipDiv();\r\n\r\n    // stop viewer if playing\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const viewController = viewLayer.getViewController();\r\n    if (viewController.isPlaying()) {\r\n      viewController.stop();\r\n    }\r\n    // start flag\r\n    this.#started = true;\r\n    // first position\r\n    this.x0 = event._x;\r\n    this.y0 = event._y;\r\n\r\n    // update controller position\r\n    const planePos = viewLayer.displayToPlanePos(event._x, event._y);\r\n    const position = viewController.getPositionFromPlanePoint(\r\n      planePos.x, planePos.y);\r\n    viewController.setCurrentPosition(position);\r\n  };\r\n\r\n  /**\r\n   * Handle mouse move event.\r\n   *\r\n   * @param {object} event The mouse move event.\r\n   */\r\n  mousemove = (event) => {\r\n    if (!this.#started) {\r\n      // optional tooltip\r\n      if (this.#displayTooltip) {\r\n        this.#showTooltip(event);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const viewController = viewLayer.getViewController();\r\n\r\n    // difference to last Y position\r\n    const diffY = event._y - this.y0;\r\n    const yMove = (Math.abs(diffY) > 15);\r\n    // do not trigger for small moves\r\n    if (yMove && viewController.canScroll()) {\r\n      // update view controller\r\n      if (diffY > 0) {\r\n        viewController.decrementScrollIndex();\r\n      } else {\r\n        viewController.incrementScrollIndex();\r\n      }\r\n    }\r\n\r\n    // difference to last X position\r\n    const diffX = event._x - this.x0;\r\n    const xMove = (Math.abs(diffX) > 15);\r\n    // do not trigger for small moves\r\n    const imageSize = viewController.getImageSize();\r\n    if (xMove && imageSize.moreThanOne(3)) {\r\n      // update view controller\r\n      if (diffX > 0) {\r\n        viewController.incrementIndex(3);\r\n      } else {\r\n        viewController.decrementIndex(3);\r\n      }\r\n    }\r\n\r\n    // reset origin point\r\n    if (xMove) {\r\n      this.x0 = event._x;\r\n    }\r\n    if (yMove) {\r\n      this.y0 = event._y;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse up event.\r\n   *\r\n   * @param {object} _event The mouse up event.\r\n   */\r\n  mouseup = (_event) => {\r\n    if (this.#started) {\r\n      // stop recording\r\n      this.#started = false;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse out event.\r\n   *\r\n   * @param {object} event The mouse out event.\r\n   */\r\n  mouseout = (event) => {\r\n    this.mouseup(event);\r\n    // remove possible tooltip div\r\n    this.#removeTooltipDiv();\r\n  };\r\n\r\n  /**\r\n   * Handle touch start event.\r\n   *\r\n   * @param {object} event The touch start event.\r\n   */\r\n  touchstart = (event) => {\r\n    // long touch triggers the dblclick\r\n    // @ts-ignore\r\n    this.#touchTimerID = setTimeout(this.dblclick, 500);\r\n    // call mouse equivalent\r\n    this.mousedown(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch move event.\r\n   *\r\n   * @param {object} event The touch move event.\r\n   */\r\n  touchmove = (event) => {\r\n    // abort timer if move\r\n    if (this.#touchTimerID !== null) {\r\n      clearTimeout(this.#touchTimerID);\r\n      this.#touchTimerID = null;\r\n    }\r\n    // call mouse equivalent\r\n    this.mousemove(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch end event.\r\n   *\r\n   * @param {object} event The touch end event.\r\n   */\r\n  touchend = (event) => {\r\n    // abort timer\r\n    if (this.#touchTimerID !== null) {\r\n      clearTimeout(this.#touchTimerID);\r\n      this.#touchTimerID = null;\r\n    }\r\n    // call mouse equivalent\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle mouse wheel event.\r\n   *\r\n   * @param {WheelEvent} event The mouse wheel event.\r\n   */\r\n  wheel = (event) => {\r\n    this.#scrollWhell.wheel(event);\r\n  };\r\n\r\n  /**\r\n   * Handle key down event.\r\n   *\r\n   * @param {object} event The key down event.\r\n   */\r\n  keydown = (event) => {\r\n    event.context = 'Scroll';\r\n    this.#app.onKeydown(event);\r\n  };\r\n\r\n  /**\r\n   * Handle double click.\r\n   *\r\n   * @param {object} event The key down event.\r\n   */\r\n  dblclick = (event) => {\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewController =\r\n      layerGroup.getActiveViewLayer().getViewController();\r\n    viewController.play();\r\n  };\r\n\r\n  /**\r\n   * Displays a tooltip in a temparary `span`.\r\n   * Works with css to hide/show the span only on mouse hover.\r\n   *\r\n   * @param {object} event The mouse move event.\r\n   */\r\n  #showTooltip(event) {\r\n    // remove previous div\r\n    this.#removeTooltipDiv();\r\n\r\n    // get image value at position\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const viewController = viewLayer.getViewController();\r\n    const planePos = viewLayer.displayToPlanePos(event._x, event._y);\r\n    const position = viewController.getPositionFromPlanePoint(\r\n      planePos.x, planePos.y);\r\n    const value = viewController.getRescaledImageValue(position);\r\n\r\n    // create\r\n    if (typeof value !== 'undefined') {\r\n      const span = document.createElement('span');\r\n      span.id = 'scroll-tooltip';\r\n      // place span in layer group to avoid upper layer opacity\r\n      const layerDiv = document.getElementById(viewLayer.getId());\r\n      layerDiv.parentElement.appendChild(span);\r\n      // position tooltip\r\n      span.style.left = (event._x + 10) + 'px';\r\n      span.style.top = (event._y + 10) + 'px';\r\n      let text = precisionRound(value, 3).toString();\r\n      if (typeof viewController.getPixelUnit() !== 'undefined') {\r\n        text += ' ' + viewController.getPixelUnit();\r\n      }\r\n      span.appendChild(document.createTextNode(text));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the tooltip html div.\r\n   */\r\n  #removeTooltipDiv() {\r\n    const div = document.getElementById('scroll-tooltip');\r\n    if (div) {\r\n      div.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate the tool.\r\n   *\r\n   * @param {boolean} _bool The flag to activate or not.\r\n   */\r\n  activate(_bool) {\r\n    // remove tooltip html when deactivating\r\n    if (!_bool) {\r\n      this.#removeTooltipDiv();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the tool live features: disaply tooltip.\r\n   *\r\n   * @param {object} features The list of features.\r\n   */\r\n  setFeatures(features) {\r\n    if (typeof features.displayTooltip !== 'undefined') {\r\n      this.#displayTooltip = features.displayTooltip;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialise the tool.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n} // Scroll class\r\n","import {Point2D} from '../math/point';\r\nimport {Line} from '../math/line';\r\nimport {getLayerDetailsFromEvent} from '../gui/layerGroup';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * ZoomAndPan class.\r\n *\r\n * @example\r\n * // create the dwv app\r\n * const app = new dwv.App();\r\n * // initialise\r\n * const viewConfig0 = new dwv.ViewConfig('layerGroup0');\r\n * const viewConfigs = {'*': [viewConfig0]};\r\n * const options = new dwv.AppOptions(viewConfigs);\r\n * options.tools = {ZoomAndPan: new dwv.ToolConfig()};\r\n * app.init(options);\r\n * // activate tool\r\n * app.addEventListener('load', function () {\r\n *   app.setTool('ZoomAndPan');\r\n * });\r\n * // load dicom data\r\n * app.loadURLs([\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\r\n * ]);\r\n */\r\nexport class ZoomAndPan {\r\n\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * Interaction start flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #started = false;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Handle mouse down event.\r\n   *\r\n   * @param {object} event The mouse down event.\r\n   */\r\n  mousedown = (event) => {\r\n    this.#started = true;\r\n    // first position\r\n    this.x0 = event._x;\r\n    this.y0 = event._y;\r\n  };\r\n\r\n  /**\r\n   * Handle two touch down event.\r\n   *\r\n   * @param {object} event The touch down event.\r\n   */\r\n  twotouchdown = (event) => {\r\n    this.#started = true;\r\n    // store first point\r\n    this.x0 = event._x;\r\n    this.y0 = event._y;\r\n    // first line\r\n    const point0 = new Point2D(event._x, event._y);\r\n    const point1 = new Point2D(event._x1, event._y1);\r\n    this.line0 = new Line(point0, point1);\r\n    this.midPoint = this.line0.getMidpoint();\r\n  };\r\n\r\n  /**\r\n   * Handle mouse move event.\r\n   *\r\n   * @param {object} event The mouse move event.\r\n   */\r\n  mousemove = (event) => {\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n    // calculate translation\r\n    const tx = event._x - this.x0;\r\n    const ty = event._y - this.y0;\r\n    // apply translation\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const viewController = viewLayer.getViewController();\r\n    const planeOffset = viewLayer.displayToPlaneScale(tx, ty);\r\n    const offset3D = viewController.getOffset3DFromPlaneOffset(planeOffset);\r\n    layerGroup.addTranslation({\r\n      x: offset3D.getX(),\r\n      y: offset3D.getY(),\r\n      z: offset3D.getZ()\r\n    });\r\n    layerGroup.draw();\r\n    // reset origin point\r\n    this.x0 = event._x;\r\n    this.y0 = event._y;\r\n  };\r\n\r\n  /**\r\n   * Handle two touch move event.\r\n   *\r\n   * @param {object} event The touch move event.\r\n   */\r\n  twotouchmove = (event) => {\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n    const point0 = new Point2D(event._x, event._y);\r\n    const point1 = new Point2D(event._x1, event._y1);\r\n    const newLine = new Line(point0, point1);\r\n    const lineRatio = newLine.getLength() / this.line0.getLength();\r\n\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const viewController = viewLayer.getViewController();\r\n\r\n    if (lineRatio === 1) {\r\n      // scroll mode\r\n      // difference  to last position\r\n      const diffY = event._y - this.y0;\r\n      // do not trigger for small moves\r\n      if (Math.abs(diffY) < 15) {\r\n        return;\r\n      }\r\n      // update view controller\r\n      if (viewController.canScroll()) {\r\n        if (diffY > 0) {\r\n          viewController.incrementScrollIndex();\r\n        } else {\r\n          viewController.decrementScrollIndex();\r\n        }\r\n      }\r\n    } else {\r\n      // zoom mode\r\n      const zoom = (lineRatio - 1) / 10;\r\n      if (Math.abs(zoom) % 0.1 <= 0.05) {\r\n        const planePos = viewLayer.displayToMainPlanePos(\r\n          this.midPoint.getX(), this.midPoint.getY());\r\n        const center = viewController.getPlanePositionFromPlanePoint(planePos);\r\n        layerGroup.addScale(zoom, center);\r\n        layerGroup.draw();\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse up event.\r\n   *\r\n   * @param {object} _event The mouse up event.\r\n   */\r\n  mouseup = (_event) => {\r\n    if (this.#started) {\r\n      // stop recording\r\n      this.#started = false;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse out event.\r\n   *\r\n   * @param {object} event The mouse out event.\r\n   */\r\n  mouseout = (event) => {\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch start event.\r\n   *\r\n   * @param {object} event The touch start event.\r\n   */\r\n  touchstart = (event) => {\r\n    const touches = event.targetTouches;\r\n    if (touches.length === 1) {\r\n      this.mousedown(event);\r\n    } else if (touches.length === 2) {\r\n      this.twotouchdown(event);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle touch move event.\r\n   *\r\n   * @param {object} event The touch move event.\r\n   */\r\n  touchmove = (event) => {\r\n    const touches = event.targetTouches;\r\n    if (touches.length === 1) {\r\n      this.mousemove(event);\r\n    } else if (touches.length === 2) {\r\n      this.twotouchmove(event);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle touch end event.\r\n   *\r\n   * @param {object} event The touch end event.\r\n   */\r\n  touchend = (event) => {\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle mouse wheel event.\r\n   *\r\n   * @param {object} event The mouse wheel event.\r\n   */\r\n  wheel = (event) => {\r\n    const step = -event.deltaY / 500;\r\n\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const viewController = viewLayer.getViewController();\r\n    const planePos = viewLayer.displayToMainPlanePos(event._x, event._y);\r\n    const center = viewController.getPlanePositionFromPlanePoint(planePos);\r\n    layerGroup.addScale(step, center);\r\n    layerGroup.draw();\r\n  };\r\n\r\n  /**\r\n   * Handle key down event.\r\n   *\r\n   * @param {object} event The key down event.\r\n   */\r\n  keydown = (event) => {\r\n    event.context = 'ZoomAndPan';\r\n    this.#app.onKeydown(event);\r\n  };\r\n\r\n  /**\r\n   * Activate the tool.\r\n   *\r\n   * @param {boolean} _bool The flag to activate or not.\r\n   */\r\n  activate(_bool) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Initialise the tool.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n} // ZoomAndPan class\r\n","import {getLayerDetailsFromEvent} from '../gui/layerGroup';\r\nimport {ScrollWheel} from './scrollWheel';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Opacity class.\r\n *\r\n * @example\r\n * // create the dwv app\r\n * const app = new dwv.App();\r\n * // initialise\r\n * const viewConfig0 = new dwv.ViewConfig('layerGroup0');\r\n * const viewConfigs = {'*': [viewConfig0]};\r\n * const options = new dwv.AppOptions(viewConfigs);\r\n * options.tools = {Opacity: new dwv.ToolConfig()};\r\n * app.init(options);\r\n * // activate tool\r\n * app.addEventListener('load', function () {\r\n *   app.setTool('Opacity');\r\n * });\r\n * // load dicom data\r\n * app.loadURLs([\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\r\n * ]);\r\n */\r\nexport class Opacity {\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * Interaction start flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #started = false;\r\n\r\n  /**\r\n   * Scroll wheel handler.\r\n   *\r\n   * @type {ScrollWheel}\r\n   */\r\n  #scrollWhell;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#scrollWhell = new ScrollWheel(app);\r\n  }\r\n\r\n  /**\r\n   * Handle mouse down event.\r\n   *\r\n   * @param {object} event The mouse down event.\r\n   */\r\n  mousedown = (event) => {\r\n    // start flag\r\n    this.#started = true;\r\n    // first position\r\n    this.x0 = event._x;\r\n    this.y0 = event._y;\r\n  };\r\n\r\n  /**\r\n   * Handle mouse move event.\r\n   *\r\n   * @param {object} event The mouse move event.\r\n   */\r\n  mousemove = (event) => {\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n\r\n    // difference to last X position\r\n    const diffX = event._x - this.x0;\r\n    const xMove = (Math.abs(diffX) > 15);\r\n    // do not trigger for small moves\r\n    if (xMove) {\r\n      const layerDetails = getLayerDetailsFromEvent(event);\r\n      const layerGroup =\r\n        this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n      const viewLayer = layerGroup.getActiveViewLayer();\r\n      const op = viewLayer.getOpacity();\r\n      viewLayer.setOpacity(op + (diffX / 200));\r\n      viewLayer.draw();\r\n\r\n      // reset origin point\r\n      this.x0 = event._x;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse up event.\r\n   *\r\n   * @param {object} _event The mouse up event.\r\n   */\r\n  mouseup = (_event) => {\r\n    if (this.#started) {\r\n      // stop recording\r\n      this.#started = false;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse out event.\r\n   *\r\n   * @param {object} event The mouse out event.\r\n   */\r\n  mouseout = (event) => {\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch start event.\r\n   *\r\n   * @param {object} event The touch start event.\r\n   */\r\n  touchstart = (event) => {\r\n    // call mouse equivalent\r\n    this.mousedown(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch move event.\r\n   *\r\n   * @param {object} event The touch move event.\r\n   */\r\n  touchmove = (event) => {\r\n    // call mouse equivalent\r\n    this.mousemove(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch end event.\r\n   *\r\n   * @param {object} event The touch end event.\r\n   */\r\n  touchend = (event) => {\r\n    // call mouse equivalent\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle mouse wheel event.\r\n   *\r\n   * @param {object} event The mouse wheel event.\r\n   */\r\n  wheel = (event) => {\r\n    this.#scrollWhell.wheel(event);\r\n  };\r\n\r\n  /**\r\n   * Handle key down event.\r\n   *\r\n   * @param {object} event The key down event.\r\n   */\r\n  keydown = (event) => {\r\n    event.context = 'Opacity';\r\n    this.#app.onKeydown(event);\r\n  };\r\n\r\n  /**\r\n   * Activate the tool.\r\n   *\r\n   * @param {boolean} _bool The flag to activate or not.\r\n   */\r\n  activate(_bool) {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Initialise the tool.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n} // Opacity class\r\n","import {DrawGroupCommand} from '../tools/drawCommands';\r\nimport {RoiFactory} from '../tools/roi';\r\nimport {guid} from '../math/stats';\r\nimport {Point2D} from '../math/point';\r\nimport {Style} from '../gui/style';\r\nimport {getLayerDetailsFromEvent} from '../gui/layerGroup';\r\nimport {ListenerHandler} from '../utils/listen';\r\nimport {logger} from '../utils/logger';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\nimport {LayerGroup} from '../gui/layerGroup';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * The magic wand namespace.\r\n *\r\n * @external MagicWand\r\n * @see https://github.com/Tamersoul/magic-wand-js\r\n */\r\nimport MagicWand from 'magic-wand-tool';\r\n\r\n/**\r\n * Floodfill painting tool.\r\n */\r\nexport class Floodfill {\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Original variables from external library. Used as in the lib example.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #blurRadius = 5;\r\n  /**\r\n   * Original variables from external library. Used as in the lib example.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #simplifyTolerant = 0;\r\n\r\n  /**\r\n   * Original variables from external library. Used as in the lib example.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #simplifyCount = 2000;\r\n\r\n  /**\r\n   * Canvas info\r\n   *\r\n   * @type {object}\r\n   */\r\n  #imageInfo = null;\r\n\r\n  /**\r\n   * Object created by MagicWand lib containing border points\r\n   *\r\n   * @type {object}\r\n   */\r\n  #mask = null;\r\n\r\n  /**\r\n   * threshold default tolerance of the tool border\r\n   *\r\n   * @type {number}\r\n   */\r\n  #initialthreshold = 10;\r\n\r\n  /**\r\n   * threshold tolerance of the tool border\r\n   *\r\n   * @type {number}\r\n   */\r\n  #currentthreshold = null;\r\n\r\n  /**\r\n   * Interaction start flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #started = false;\r\n  /**\r\n   * Draw command.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #command = null;\r\n\r\n  /**\r\n   * Current shape group.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #shapeGroup = null;\r\n\r\n  /**\r\n   * Coordinates of the fist mousedown event.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #initialpoint;\r\n\r\n  /**\r\n   * Floodfill border.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #border = null;\r\n\r\n  /**\r\n   * List of parent points.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #parentPoints = [];\r\n\r\n  /**\r\n   * Assistant variable to paint border on all slices.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #extender = false;\r\n\r\n  /**\r\n   * Timeout for painting on mousemove.\r\n   *\r\n   */\r\n  #painterTimeout;\r\n\r\n  /**\r\n   * Drawing style.\r\n   *\r\n   * @type {Style}\r\n   */\r\n  #style = new Style();\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Set extend option for painting border on all slices.\r\n   *\r\n   * @param {boolean} bool The option to set\r\n   */\r\n  setExtend(bool) {\r\n    this.#extender = bool;\r\n  }\r\n\r\n  /**\r\n   * Get extend option for painting border on all slices.\r\n   *\r\n   * @returns {boolean} The actual value of of the variable to use Floodfill\r\n   *   on museup.\r\n   */\r\n  getExtend() {\r\n    return this.#extender;\r\n  }\r\n\r\n  /**\r\n   * Get (x, y) coordinates referenced to the canvas\r\n   *\r\n   * @param {object} event The original event.\r\n   * @returns {object} The coordinates as a {x,y}.\r\n   */\r\n  #getCoord = (event) => {\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const index = viewLayer.displayToPlaneIndex(event._x, event._y);\r\n    return {\r\n      x: index.get(0),\r\n      y: index.get(1)\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Calculate border.\r\n   *\r\n   * @param {object} points The input points.\r\n   * @param {number} threshold The threshold of the floodfill.\r\n   * @param {boolean} simple Return first points or a list.\r\n   * @returns {Array} The parent points.\r\n   */\r\n  #calcBorder(points, threshold, simple) {\r\n\r\n    this.#parentPoints = [];\r\n    const image = {\r\n      data: this.#imageInfo.data,\r\n      width: this.#imageInfo.width,\r\n      height: this.#imageInfo.height,\r\n      bytes: 4\r\n    };\r\n\r\n    this.#mask = MagicWand.floodFill(image, points.x, points.y, threshold);\r\n    this.#mask = MagicWand.gaussBlurOnlyBorder(this.#mask, this.#blurRadius);\r\n\r\n    let cs = MagicWand.traceContours(this.#mask);\r\n    cs = MagicWand.simplifyContours(\r\n      cs, this.#simplifyTolerant, this.#simplifyCount);\r\n\r\n    if (cs.length > 0 && cs[0].points[0].x) {\r\n      if (simple) {\r\n        return cs[0].points;\r\n      }\r\n      for (let j = 0, icsl = cs[0].points.length; j < icsl; j++) {\r\n        this.#parentPoints.push(new Point2D(\r\n          cs[0].points[j].x,\r\n          cs[0].points[j].y\r\n        ));\r\n      }\r\n      return this.#parentPoints;\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Paint Floodfill.\r\n   *\r\n   * @param {object} point The start point.\r\n   * @param {number} threshold The border threshold.\r\n   * @param {LayerGroup} layerGroup The origin layer group.\r\n   * @returns {boolean} False if no border.\r\n   */\r\n  #paintBorder(point, threshold, layerGroup) {\r\n    // Calculate the border\r\n    this.#border = this.#calcBorder(point, threshold, false);\r\n    // Paint the border\r\n    if (this.#border) {\r\n      const factory = new RoiFactory();\r\n      this.#shapeGroup = factory.create(this.#border, this.#style);\r\n      this.#shapeGroup.id(guid());\r\n\r\n      const drawLayer = layerGroup.getActiveDrawLayer();\r\n      const drawController = drawLayer.getDrawController();\r\n\r\n      // get the position group\r\n      const posGroup = drawController.getCurrentPosGroup();\r\n      // add shape group to position group\r\n      posGroup.add(this.#shapeGroup);\r\n\r\n      // draw shape command\r\n      this.#command = new DrawGroupCommand(\r\n        this.#shapeGroup,\r\n        'floodfill',\r\n        drawLayer\r\n      );\r\n      this.#command.onExecute = this.#fireEvent;\r\n      this.#command.onUndo = this.#fireEvent;\r\n      // // draw\r\n      this.#command.execute();\r\n      // save it in undo stack\r\n      this.#app.addToUndoStack(this.#command);\r\n\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create Floodfill in all the prev and next slices while border is found\r\n   *\r\n   * @param {number} ini The first slice to extend to.\r\n   * @param {number} end The last slice to extend to.\r\n   * @param {object} layerGroup The origin layer group.\r\n   */\r\n  extend(ini, end, layerGroup) {\r\n    //avoid errors\r\n    if (!this.#initialpoint) {\r\n      throw '\\'initialpoint\\' not found. User must click before use extend!';\r\n    }\r\n    // remove previous draw\r\n    if (this.#shapeGroup) {\r\n      this.#shapeGroup.destroy();\r\n    }\r\n\r\n    const viewController =\r\n      layerGroup.getActiveViewLayer().getViewController();\r\n\r\n    const pos = viewController.getCurrentIndex();\r\n    const imageSize = viewController.getImageSize();\r\n    const threshold = this.#currentthreshold || this.#initialthreshold;\r\n\r\n    // Iterate over the next images and paint border on each slice.\r\n    for (let i = pos.get(2),\r\n      len = end\r\n        ? end : imageSize.get(2);\r\n      i < len; i++) {\r\n      if (!this.#paintBorder(this.#initialpoint, threshold, layerGroup)) {\r\n        break;\r\n      }\r\n      viewController.incrementIndex(2);\r\n    }\r\n    viewController.setCurrentPosition(pos);\r\n\r\n    // Iterate over the prev images and paint border on each slice.\r\n    for (let j = pos.get(2), jl = ini ? ini : 0; j > jl; j--) {\r\n      if (!this.#paintBorder(this.#initialpoint, threshold, layerGroup)) {\r\n        break;\r\n      }\r\n      viewController.decrementIndex(2);\r\n    }\r\n    viewController.setCurrentPosition(pos);\r\n  }\r\n\r\n  /**\r\n   * Modify tolerance threshold and redraw ROI.\r\n   *\r\n   * @param {number} modifyThreshold The new threshold.\r\n   * @param {object} shape The shape to update.\r\n   */\r\n  modifyThreshold(modifyThreshold, shape) {\r\n\r\n    if (!shape && this.#shapeGroup) {\r\n      shape = this.#shapeGroup.getChildren(function (node) {\r\n        return node.name() === 'shape';\r\n      })[0];\r\n    } else {\r\n      throw 'No shape found';\r\n    }\r\n\r\n    clearTimeout(this.#painterTimeout);\r\n    this.#painterTimeout = setTimeout(() => {\r\n      this.#border = this.#calcBorder(\r\n        this.#initialpoint, modifyThreshold, true);\r\n      if (!this.#border) {\r\n        return false;\r\n      }\r\n      const arr = [];\r\n      for (let i = 0, bl = this.#border.length; i < bl; ++i) {\r\n        arr.push(this.#border[i].x);\r\n        arr.push(this.#border[i].y);\r\n      }\r\n      shape.setPoints(arr);\r\n      const shapeLayer = shape.getLayer();\r\n      shapeLayer.draw();\r\n      this.onThresholdChange(modifyThreshold);\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Event fired when threshold change\r\n   *\r\n   * @param {number} _value Current threshold\r\n   */\r\n  onThresholdChange(_value) {\r\n    // Defaults do nothing\r\n  }\r\n\r\n  /**\r\n   * Handle mouse down event.\r\n   *\r\n   * @param {object} event The mouse down event.\r\n   */\r\n  mousedown = (event) => {\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const drawLayer = layerGroup.getActiveDrawLayer();\r\n\r\n    this.#imageInfo = viewLayer.getImageData();\r\n    if (!this.#imageInfo) {\r\n      logger.error('No image found');\r\n      return;\r\n    }\r\n\r\n    // update zoom scale\r\n    this.#style.setZoomScale(\r\n      drawLayer.getKonvaLayer().getAbsoluteScale());\r\n\r\n    this.#started = true;\r\n    this.#initialpoint = this.#getCoord(event);\r\n    this.#paintBorder(this.#initialpoint, this.#initialthreshold, layerGroup);\r\n    this.onThresholdChange(this.#initialthreshold);\r\n  };\r\n\r\n  /**\r\n   * Handle mouse move event.\r\n   *\r\n   * @param {object} event The mouse move event.\r\n   */\r\n  mousemove = (event) => {\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n    const movedpoint = this.#getCoord(event);\r\n    this.#currentthreshold = Math.round(Math.sqrt(\r\n      Math.pow((this.#initialpoint.x - movedpoint.x), 2) +\r\n      Math.pow((this.#initialpoint.y - movedpoint.y), 2)) / 2);\r\n    this.#currentthreshold = this.#currentthreshold < this.#initialthreshold\r\n      ? this.#initialthreshold\r\n      : this.#currentthreshold - this.#initialthreshold;\r\n    this.modifyThreshold(this.#currentthreshold);\r\n  };\r\n\r\n  /**\r\n   * Handle mouse up event.\r\n   *\r\n   * @param {object} _event The mouse up event.\r\n   */\r\n  mouseup = (_event) => {\r\n    this.#started = false;\r\n    // TODO: re-activate\r\n    // if (this.#extender) {\r\n    //   const layerDetails = getLayerDetailsFromEvent(event);\r\n    //   const layerGroup =\r\n    //     this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    //   this.extend(layerGroup);\r\n    // }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse out event.\r\n   *\r\n   * @param {object} event The mouse out event.\r\n   */\r\n  mouseout = (event) => {\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch start event.\r\n   *\r\n   * @param {object} event The touch start event.\r\n   */\r\n  touchstart = (event) => {\r\n    // treat as mouse down\r\n    this.mousedown(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch move event.\r\n   *\r\n   * @param {object} event The touch move event.\r\n   */\r\n  touchmove = (event) => {\r\n    // treat as mouse move\r\n    this.mousemove(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch end event.\r\n   *\r\n   * @param {object} event The touch end event.\r\n   */\r\n  touchend = (event) => {\r\n    // treat as mouse up\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle key down event.\r\n   *\r\n   * @param {object} event The key down event.\r\n   */\r\n  keydown = (event) => {\r\n    event.context = 'Floodfill';\r\n    this.#app.onKeydown(event);\r\n  };\r\n\r\n  /**\r\n   * Activate the tool.\r\n   *\r\n   * @param {boolean} bool The flag to activate or not.\r\n   */\r\n  activate(bool) {\r\n    if (bool) {\r\n      // init with the app window scale\r\n      this.#style.setBaseScale(this.#app.getBaseScale());\r\n      // set the default to the first in the list\r\n      this.setFeatures({shapeColour: this.#style.getLineColour()});\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialise the tool.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Get the list of event names that this tool can fire.\r\n   *\r\n   * @returns {Array} The list of event names.\r\n   */\r\n  getEventNames() {\r\n    return ['drawcreate', 'drawchange', 'drawmove', 'drawdelete'];\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Set the tool live features: shape colour.\r\n   *\r\n   * @param {object} features The list of features.\r\n   */\r\n  setFeatures(features) {\r\n    if (typeof features.shapeColour !== 'undefined') {\r\n      this.#style.setLineColour(features.shapeColour);\r\n    }\r\n  }\r\n\r\n} // Floodfill class\r\n","import {Style} from '../gui/style';\r\nimport {Point2D} from '../math/point';\r\nimport {Path} from '../math/path';\r\nimport {Scissors} from '../math/scissors';\r\nimport {guid} from '../math/stats';\r\nimport {getLayerDetailsFromEvent} from '../gui/layerGroup';\r\nimport {ListenerHandler} from '../utils/listen';\r\nimport {RoiFactory} from '../tools/roi';\r\nimport {DrawGroupCommand} from '../tools/drawCommands';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {App} from '../app/application';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Livewire painting tool.\r\n */\r\nexport class Livewire {\r\n  /**\r\n   * Associated app.\r\n   *\r\n   * @type {App}\r\n   */\r\n  #app;\r\n\r\n  /**\r\n   * @param {App} app The associated application.\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n  }\r\n\r\n  /**\r\n   * Interaction start flag.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #started = false;\r\n\r\n  /**\r\n   * Draw command.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #command = null;\r\n\r\n  /**\r\n   * Current shape group.\r\n   *\r\n   * @type {object}\r\n   */\r\n  #shapeGroup = null;\r\n\r\n  /**\r\n   * Drawing style.\r\n   *\r\n   * @type {Style}\r\n   */\r\n  #style = new Style();\r\n\r\n  /**\r\n   * Path storage. Paths are stored in reverse order.\r\n   *\r\n   * @type {Path}\r\n   */\r\n  #path = new Path();\r\n\r\n  /**\r\n   * Current path storage. Paths are stored in reverse order.\r\n   *\r\n   * @type {Path}\r\n   */\r\n  #currentPath = new Path();\r\n\r\n  /**\r\n   * List of parent points.\r\n   *\r\n   * @type {Array}\r\n   */\r\n  #parentPoints = [];\r\n\r\n  /**\r\n   * Tolerance.\r\n   *\r\n   * @type {number}\r\n   */\r\n  #tolerance = 5;\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  /**\r\n   * Clear the parent points list.\r\n   *\r\n   * @param {object} imageSize The image size.\r\n   */\r\n  #clearParentPoints(imageSize) {\r\n    const nrows = imageSize.get(1);\r\n    for (let i = 0; i < nrows; ++i) {\r\n      this.#parentPoints[i] = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the stored paths.\r\n   */\r\n  #clearPaths() {\r\n    this.#path = new Path();\r\n    this.#currentPath = new Path();\r\n  }\r\n\r\n  /**\r\n   * Scissor representation.\r\n   *\r\n   * @type {Scissors}\r\n   */\r\n  #scissors = new Scissors();\r\n\r\n  /**\r\n   * Finish a livewire (roi) shape.\r\n   */\r\n  #finishShape() {\r\n    // fire creation event (was not propagated during draw)\r\n    this.#fireEvent({\r\n      type: 'drawcreate',\r\n      id: this.#shapeGroup.id()\r\n    });\r\n    // listen\r\n    this.#command.onExecute = this.#fireEvent;\r\n    this.#command.onUndo = this.#fireEvent;\r\n    // save command in undo stack\r\n    this.#app.addToUndoStack(this.#command);\r\n    // set flag\r\n    this.#started = false;\r\n  }\r\n\r\n  /**\r\n   * Handle mouse down event.\r\n   *\r\n   * @param {object} event The mouse down event.\r\n   */\r\n  mousedown = (event) => {\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const imageSize = viewLayer.getViewController().getImageSize();\r\n    const index = viewLayer.displayToPlaneIndex(event._x, event._y);\r\n\r\n    // first time\r\n    if (!this.#started) {\r\n      this.#started = true;\r\n      this.x0 = index.get(0);\r\n      this.y0 = index.get(1);\r\n      // clear vars\r\n      this.#clearPaths();\r\n      this.#clearParentPoints(imageSize);\r\n      this.#shapeGroup = null;\r\n      // update zoom scale\r\n      const drawLayer = layerGroup.getActiveDrawLayer();\r\n      this.#style.setZoomScale(\r\n        drawLayer.getKonvaLayer().getAbsoluteScale());\r\n      // do the training from the first point\r\n      const p = {x: index.get(0), y: index.get(1)};\r\n      this.#scissors.doTraining(p);\r\n      // add the initial point to the path\r\n      const p0 = new Point2D(index.get(0), index.get(1));\r\n      this.#path.addPoint(p0);\r\n      this.#path.addControlPoint(p0);\r\n    } else {\r\n      // final point: at 'tolerance' of the initial point\r\n      if ((Math.abs(index.get(0) - this.x0) < this.#tolerance) &&\r\n        (Math.abs(index.get(1) - this.y0) < this.#tolerance)) {\r\n        // finish\r\n        this.#finishShape();\r\n      } else {\r\n        // anchor point\r\n        this.#path = this.#currentPath;\r\n        this.#clearParentPoints(imageSize);\r\n        const pn = {x: index.get(0), y: index.get(1)};\r\n        this.#scissors.doTraining(pn);\r\n        this.#path.addControlPoint(this.#currentPath.getPoint(0));\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle mouse move event.\r\n   *\r\n   * @param {object} event The mouse move event.\r\n   */\r\n  mousemove = (event) => {\r\n    if (!this.#started) {\r\n      return;\r\n    }\r\n    const layerDetails = getLayerDetailsFromEvent(event);\r\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\r\n    const viewLayer = layerGroup.getActiveViewLayer();\r\n    const index = viewLayer.displayToPlaneIndex(event._x, event._y);\r\n\r\n    // set the point to find the path to\r\n    let p = {x: index.get(0), y: index.get(1)};\r\n    this.#scissors.setPoint(p);\r\n    // do the work\r\n    let results = [];\r\n    let stop = false;\r\n    while (!this.#parentPoints[p.y][p.x] && !stop) {\r\n      results = this.#scissors.doWork();\r\n\r\n      if (results.length === 0) {\r\n        stop = true;\r\n      } else {\r\n        // fill parents\r\n        for (let i = 0; i < results.length - 1; i += 2) {\r\n          const _p = results[i];\r\n          const _q = results[i + 1];\r\n          this.#parentPoints[_p.y][_p.x] = _q;\r\n        }\r\n      }\r\n    }\r\n\r\n    // get the path\r\n    this.#currentPath = new Path();\r\n    stop = false;\r\n    while (p && !stop) {\r\n      this.#currentPath.addPoint(new Point2D(p.x, p.y));\r\n      if (!this.#parentPoints[p.y]) {\r\n        stop = true;\r\n      } else {\r\n        if (!this.#parentPoints[p.y][p.x]) {\r\n          stop = true;\r\n        } else {\r\n          p = this.#parentPoints[p.y][p.x];\r\n        }\r\n      }\r\n    }\r\n    this.#currentPath.appenPath(this.#path);\r\n\r\n    // remove previous draw\r\n    if (this.#shapeGroup) {\r\n      this.#shapeGroup.destroy();\r\n    }\r\n    // create shape\r\n    const factory = new RoiFactory();\r\n    this.#shapeGroup = factory.create(\r\n      this.#currentPath.pointArray, this.#style);\r\n    this.#shapeGroup.id(guid());\r\n\r\n    const drawLayer = layerGroup.getActiveDrawLayer();\r\n    const drawController = drawLayer.getDrawController();\r\n\r\n    // get the position group\r\n    const posGroup = drawController.getCurrentPosGroup();\r\n    // add shape group to position group\r\n    posGroup.add(this.#shapeGroup);\r\n\r\n    // draw shape command\r\n    this.#command = new DrawGroupCommand(\r\n      this.#shapeGroup,\r\n      'livewire',\r\n      drawLayer\r\n    );\r\n    // draw\r\n    this.#command.execute();\r\n  };\r\n\r\n  /**\r\n   * Handle mouse up event.\r\n   *\r\n   * @param {object} _event The mouse up event.\r\n   */\r\n  mouseup(_event) {\r\n    // nothing to do\r\n  }\r\n\r\n  /**\r\n   * Handle mouse out event.\r\n   *\r\n   * @param {object} event The mouse out event.\r\n   */\r\n  mouseout = (event) => {\r\n    // treat as mouse up\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle double click event.\r\n   *\r\n   * @param {object} _event The double click event.\r\n   */\r\n  dblclick = (_event) => {\r\n    this.#finishShape();\r\n  };\r\n\r\n  /**\r\n   * Handle touch start event.\r\n   *\r\n   * @param {object} event The touch start event.\r\n   */\r\n  touchstart = (event) => {\r\n    // treat as mouse down\r\n    this.mousedown(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch move event.\r\n   *\r\n   * @param {object} event The touch move event.\r\n   */\r\n  touchmove = (event) => {\r\n    // treat as mouse move\r\n    this.mousemove(event);\r\n  };\r\n\r\n  /**\r\n   * Handle touch end event.\r\n   *\r\n   * @param {object} event The touch end event.\r\n   */\r\n  touchend = (event) => {\r\n    // treat as mouse up\r\n    this.mouseup(event);\r\n  };\r\n\r\n  /**\r\n   * Handle key down event.\r\n   *\r\n   * @param {object} event The key down event.\r\n   */\r\n  keydown = (event) => {\r\n    event.context = 'Livewire';\r\n    this.#app.onKeydown(event);\r\n  };\r\n\r\n  /**\r\n   * Activate the tool.\r\n   *\r\n   * @param {boolean} bool The flag to activate or not.\r\n   */\r\n  activate(bool) {\r\n    // start scissors if displayed\r\n    if (bool) {\r\n      const layerGroup = this.#app.getActiveLayerGroup();\r\n      const viewLayer = layerGroup.getActiveViewLayer();\r\n\r\n      //scissors = new Scissors();\r\n      const imageSize = viewLayer.getViewController().getImageSize();\r\n      this.#scissors.setDimensions(\r\n        imageSize.get(0),\r\n        imageSize.get(1));\r\n      this.#scissors.setData(viewLayer.getImageData().data);\r\n\r\n      // init with the app window scale\r\n      this.#style.setBaseScale(this.#app.getBaseScale());\r\n      // set the default to the first in the list\r\n      this.setFeatures({shapeColour: this.#style.getLineColour()});\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialise the tool.\r\n   */\r\n  init() {\r\n    // does nothing\r\n  }\r\n\r\n  /**\r\n   * Get the list of event names that this tool can fire.\r\n   *\r\n   * @returns {Array} The list of event names.\r\n   */\r\n  getEventNames() {\r\n    return ['drawcreate', 'drawchange', 'drawmove', 'drawdelete'];\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *    event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Set the tool live features: shape colour.\r\n   *\r\n   * @param {object} features The list of features.\r\n   */\r\n  setFeatures(features) {\r\n    if (typeof features.shapeColour !== 'undefined') {\r\n      this.#style.setLineColour(features.shapeColour);\r\n    }\r\n  }\r\n\r\n} // Livewire class\r\n","import {Point2D} from '../math/point';\r\nimport {Line, getPerpendicularLine, getAngle} from '../math/line';\r\nimport {defaults} from '../app/defaults';\r\nimport {getDefaultAnchor} from './editor';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ViewController} from '../app/viewController';\r\nimport {Style} from '../gui/style';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Arrow factory.\r\n */\r\nexport class ArrowFactory {\r\n  /**\r\n   * Get the name of the shape group.\r\n   *\r\n   * @returns {string} The name.\r\n   */\r\n  getGroupName() {\r\n    return 'line-group';\r\n  }\r\n\r\n  /**\r\n   * Get the number of points needed to build the shape.\r\n   *\r\n   * @returns {number} The number of points.\r\n   */\r\n  getNPoints() {\r\n    return 2;\r\n  }\r\n\r\n  /**\r\n   * Get the timeout between point storage.\r\n   *\r\n   * @returns {number} The timeout in milliseconds.\r\n   */\r\n  getTimeout() {\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Is the input group a group of this factory?\r\n   *\r\n   * @param {Konva.Group} group The group to test.\r\n   * @returns {boolean} True if the group is from this fcatory.\r\n   */\r\n  isFactoryGroup(group) {\r\n    return this.getGroupName() === group.name();\r\n  }\r\n\r\n  /**\r\n   * Create an arrow shape to be displayed.\r\n   *\r\n   * @param {Point2D[]} points The points from which to extract the line.\r\n   * @param {Style} style The drawing style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @returns {Konva.Group} The Konva group.\r\n   */\r\n  create(points, style, viewController) {\r\n    // physical shape\r\n    const line = new Line(points[0], points[1]);\r\n    // draw shape\r\n    const kshape = new Konva.Line({\r\n      points: [line.getBegin().getX(),\r\n        line.getBegin().getY(),\r\n        line.getEnd().getX(),\r\n        line.getEnd().getY()],\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape'\r\n    });\r\n    // larger hitfunc\r\n    const linePerp0 = getPerpendicularLine(\r\n      line, points[0], style.scale(10));\r\n    const linePerp1 = getPerpendicularLine(\r\n      line, points[1], style.scale(10));\r\n    kshape.hitFunc(function (context) {\r\n      context.beginPath();\r\n      context.moveTo(linePerp0.getBegin().getX(), linePerp0.getBegin().getY());\r\n      context.lineTo(linePerp0.getEnd().getX(), linePerp0.getEnd().getY());\r\n      context.lineTo(linePerp1.getEnd().getX(), linePerp1.getEnd().getY());\r\n      context.lineTo(linePerp1.getBegin().getX(), linePerp1.getBegin().getY());\r\n      context.closePath();\r\n      context.fillStrokeShape(kshape);\r\n    });\r\n    // triangle\r\n    const beginTy = new Point2D(\r\n      line.getBegin().getX(),\r\n      line.getBegin().getY() - 10);\r\n    const verticalLine = new Line(line.getBegin(), beginTy);\r\n    const angle = getAngle(line, verticalLine);\r\n    const angleRad = angle * Math.PI / 180;\r\n    const radius = 5 * style.getScaledStrokeWidth();\r\n    const kpoly = new Konva.RegularPolygon({\r\n      x: line.getBegin().getX() + radius * Math.sin(angleRad),\r\n      y: line.getBegin().getY() + radius * Math.cos(angleRad),\r\n      sides: 3,\r\n      radius: radius,\r\n      rotation: -angle,\r\n      fill: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape-triangle'\r\n    });\r\n    // quantification\r\n    const ktext = new Konva.Text({\r\n      fontSize: style.getFontSize(),\r\n      fontFamily: style.getFontFamily(),\r\n      fill: style.getLineColour(),\r\n      padding: style.getTextPadding(),\r\n      shadowColor: style.getShadowLineColour(),\r\n      shadowOffset: style.getShadowOffset(),\r\n      name: 'text'\r\n    });\r\n    let textExpr = '';\r\n    const modality = viewController.getModality();\r\n    if (typeof defaults.labelText.arrow[modality] !== 'undefined') {\r\n      textExpr = defaults.labelText.arrow[modality];\r\n    } else {\r\n      textExpr = defaults.labelText.arrow['*'];\r\n    }\r\n    ktext.setText(textExpr);\r\n    // augment text with meta data\r\n    // @ts-ignore\r\n    ktext.meta = {\r\n      textExpr: textExpr,\r\n      quantification: {}\r\n    };\r\n    // label\r\n    const dX = line.getBegin().getX() > line.getEnd().getX() ? 0 : -1;\r\n    const dY = line.getBegin().getY() > line.getEnd().getY() ? -1 : 0;\r\n    const klabel = new Konva.Label({\r\n      x: line.getEnd().getX() + dX * ktext.width(),\r\n      y: line.getEnd().getY() + dY * style.applyZoomScale(15).y,\r\n      scale: style.applyZoomScale(1),\r\n      visible: textExpr.length !== 0,\r\n      name: 'label'\r\n    });\r\n    klabel.add(ktext);\r\n    klabel.add(new Konva.Tag({\r\n      fill: style.getLineColour(),\r\n      opacity: style.getTagOpacity()\r\n    }));\r\n\r\n    // return group\r\n    const group = new Konva.Group();\r\n    group.name(this.getGroupName());\r\n    group.add(klabel);\r\n    group.add(kpoly);\r\n    group.add(kshape);\r\n    group.visible(true); // dont inherit\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get anchors to update an arrow shape.\r\n   *\r\n   * @param {Konva.Line} shape The associated shape.\r\n   * @param {Style} style The application style.\r\n   * @returns {Konva.Ellipse[]} A list of anchors.\r\n   */\r\n  getAnchors(shape, style) {\r\n    const points = shape.points();\r\n\r\n    const anchors = [];\r\n    anchors.push(getDefaultAnchor(\r\n      points[0] + shape.x(), points[1] + shape.y(), 'begin', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      points[2] + shape.x(), points[3] + shape.y(), 'end', style\r\n    ));\r\n    return anchors;\r\n  }\r\n\r\n  /**\r\n   * Update an arrow shape.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The active anchor.\r\n   * @param {Style} style The app style.\r\n   * @param {ViewController} _viewController The associated view controller.\r\n   */\r\n  update(anchor, style, _viewController) {\r\n    // parent group\r\n    const group = anchor.getParent();\r\n    // associated shape\r\n    const kline = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    if (!(kline instanceof Konva.Line)) {\r\n      return;\r\n    }\r\n    // associated triangle shape\r\n    const ktriangle = group.getChildren(function (node) {\r\n      return node.name() === 'shape-triangle';\r\n    })[0];\r\n    if (!(ktriangle instanceof Konva.RegularPolygon)) {\r\n      return;\r\n    }\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    if (!(klabel instanceof Konva.Label)) {\r\n      return;\r\n    }\r\n    // find special points\r\n    const begin = group.getChildren(function (node) {\r\n      return node.id() === 'begin';\r\n    })[0];\r\n    const end = group.getChildren(function (node) {\r\n      return node.id() === 'end';\r\n    })[0];\r\n    // update special points\r\n    switch (anchor.id()) {\r\n    case 'begin':\r\n      begin.x(anchor.x());\r\n      begin.y(anchor.y());\r\n      break;\r\n    case 'end':\r\n      end.x(anchor.x());\r\n      end.y(anchor.y());\r\n      break;\r\n    }\r\n    // update shape and compensate for possible drag\r\n    // note: shape.position() and shape.size() won't work...\r\n    const bx = begin.x() - kline.x();\r\n    const by = begin.y() - kline.y();\r\n    const ex = end.x() - kline.x();\r\n    const ey = end.y() - kline.y();\r\n    kline.points([bx, by, ex, ey]);\r\n    // new line\r\n    const p2d0 = new Point2D(begin.x(), begin.y());\r\n    const p2d1 = new Point2D(end.x(), end.y());\r\n    const line = new Line(p2d0, p2d1);\r\n    // larger hitfunc\r\n    const p2b = new Point2D(bx, by);\r\n    const p2e = new Point2D(ex, ey);\r\n    const linePerp0 = getPerpendicularLine(line, p2b, 10);\r\n    const linePerp1 = getPerpendicularLine(line, p2e, 10);\r\n    kline.hitFunc(function (context) {\r\n      context.beginPath();\r\n      context.moveTo(linePerp0.getBegin().getX(), linePerp0.getBegin().getY());\r\n      context.lineTo(linePerp0.getEnd().getX(), linePerp0.getEnd().getY());\r\n      context.lineTo(linePerp1.getEnd().getX(), linePerp1.getEnd().getY());\r\n      context.lineTo(linePerp1.getBegin().getX(), linePerp1.getBegin().getY());\r\n      context.closePath();\r\n      context.fillStrokeShape(kline);\r\n    });\r\n    // udate triangle\r\n    const beginTy = new Point2D(\r\n      line.getBegin().getX(),\r\n      line.getBegin().getY() - 10);\r\n    const verticalLine = new Line(line.getBegin(), beginTy);\r\n    const angle = getAngle(line, verticalLine);\r\n    const angleRad = angle * Math.PI / 180;\r\n    ktriangle.x(\r\n      line.getBegin().getX() + ktriangle.radius() * Math.sin(angleRad));\r\n    ktriangle.y(\r\n      line.getBegin().getY() + ktriangle.radius() * Math.cos(angleRad));\r\n    ktriangle.rotation(-angle);\r\n\r\n    // update text\r\n    const ktext = klabel.getText();\r\n    // @ts-expect-error\r\n    ktext.setText(ktext.meta.textExpr);\r\n    // update position\r\n    const dX = line.getBegin().getX() > line.getEnd().getX() ? 0 : -1;\r\n    const dY = line.getBegin().getY() > line.getEnd().getY() ? -1 : 0;\r\n    const textPos = {\r\n      x: line.getEnd().getX() + dX * ktext.width(),\r\n      y: line.getEnd().getY() + dY * style.applyZoomScale(15).y\r\n    };\r\n    klabel.position(textPos);\r\n  }\r\n\r\n} // class ArrowFactory\r\n","import {Circle} from '../math/circle';\r\nimport {Point2D} from '../math/point';\r\nimport {getFlags, replaceFlags} from '../utils/string';\r\nimport {logger} from '../utils/logger';\r\nimport {defaults} from '../app/defaults';\r\nimport {getDefaultAnchor} from './editor';\r\nimport {DRAW_DEBUG} from './draw';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ViewController} from '../app/viewController';\r\nimport {Style} from '../gui/style';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Circle factory.\r\n */\r\nexport class CircleFactory {\r\n  /**\r\n   * Get the name of the shape group.\r\n   *\r\n   * @returns {string} The name.\r\n   */\r\n  getGroupName() {\r\n    return 'circle-group';\r\n  }\r\n\r\n  /**\r\n   * Get the number of points needed to build the shape.\r\n   *\r\n   * @returns {number} The number of points.\r\n   */\r\n  getNPoints() {\r\n    return 2;\r\n  }\r\n\r\n  /**\r\n   * Get the timeout between point storage.\r\n   *\r\n   * @returns {number} The timeout in milliseconds.\r\n   */\r\n  getTimeout() {\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Is the input group a group of this factory?\r\n   *\r\n   * @param {Konva.Group} group The group to test.\r\n   * @returns {boolean} True if the group is from this fcatory.\r\n   */\r\n  isFactoryGroup(group) {\r\n    return this.getGroupName() === group.name();\r\n  }\r\n\r\n  /**\r\n   * Create a circle shape to be displayed.\r\n   *\r\n   * @param {Point2D[]} points The points from which to extract the circle.\r\n   * @param {Style} style The drawing style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @returns {Konva.Group} The Konva group.\r\n   */\r\n  create(points, style, viewController) {\r\n    // calculate radius\r\n    const a = Math.abs(points[0].getX() - points[1].getX());\r\n    const b = Math.abs(points[0].getY() - points[1].getY());\r\n    const radius = Math.round(Math.sqrt(a * a + b * b));\r\n    // physical shape\r\n    const circle = new Circle(points[0], radius);\r\n    // draw shape\r\n    const kshape = new Konva.Circle({\r\n      x: circle.getCenter().getX(),\r\n      y: circle.getCenter().getY(),\r\n      radius: circle.getRadius(),\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape'\r\n    });\r\n    // quantification\r\n    const ktext = new Konva.Text({\r\n      fontSize: style.getFontSize(),\r\n      fontFamily: style.getFontFamily(),\r\n      fill: style.getLineColour(),\r\n      padding: style.getTextPadding(),\r\n      shadowColor: style.getShadowLineColour(),\r\n      shadowOffset: style.getShadowOffset(),\r\n      name: 'text'\r\n    });\r\n    let textExpr = '';\r\n    const modality = viewController.getModality();\r\n    if (typeof defaults.labelText.circle[modality] !== 'undefined') {\r\n      textExpr = defaults.labelText.circle[modality];\r\n    } else {\r\n      textExpr = defaults.labelText.circle['*'];\r\n    }\r\n    const quant = circle.quantify(\r\n      viewController,\r\n      getFlags(textExpr));\r\n    ktext.setText(replaceFlags(textExpr, quant));\r\n    // augment text with meta data\r\n    // @ts-expect-error\r\n    ktext.meta = {\r\n      textExpr: textExpr,\r\n      quantification: quant\r\n    };\r\n    // label\r\n    const klabel = new Konva.Label({\r\n      x: circle.getCenter().getX() - circle.getRadius(),\r\n      y: circle.getCenter().getY() + circle.getRadius(),\r\n      scale: style.applyZoomScale(1),\r\n      visible: textExpr.length !== 0,\r\n      name: 'label'\r\n    });\r\n    klabel.add(ktext);\r\n    klabel.add(new Konva.Tag({\r\n      fill: style.getLineColour(),\r\n      opacity: style.getTagOpacity()\r\n    }));\r\n\r\n    // debug shadow\r\n    let kshadow;\r\n    if (DRAW_DEBUG) {\r\n      kshadow = this.#getShadowCircle(circle);\r\n    }\r\n\r\n    // return group\r\n    const group = new Konva.Group();\r\n    group.name(this.getGroupName());\r\n    if (kshadow) {\r\n      group.add(kshadow);\r\n    }\r\n    group.add(klabel);\r\n    group.add(kshape);\r\n    group.visible(true); // dont inherit\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get anchors to update a circle shape.\r\n   *\r\n   * @param {Konva.Circle} shape The associated shape.\r\n   * @param {Style} style The application style.\r\n   * @returns {Konva.Ellipse[]} A list of anchors.\r\n   */\r\n  getAnchors(shape, style) {\r\n    const centerX = shape.x();\r\n    const centerY = shape.y();\r\n    const radius = shape.radius();\r\n\r\n    const anchors = [];\r\n    anchors.push(getDefaultAnchor(\r\n      centerX - radius, centerY, 'left', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      centerX + radius, centerY, 'right', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      centerX, centerY + radius, 'bottom', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      centerX, centerY - radius, 'top', style\r\n    ));\r\n    return anchors;\r\n  }\r\n\r\n  /**\r\n   * Update a circle shape.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The active anchor.\r\n   * @param {Style} _style The app style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  update(anchor, _style, viewController) {\r\n    // parent group\r\n    const group = anchor.getParent();\r\n    if (!(group instanceof Konva.Group)) {\r\n      return;\r\n    }\r\n    // associated shape\r\n    const kcircle = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    if (!(kcircle instanceof Konva.Circle)) {\r\n      return;\r\n    }\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    // find special points\r\n    const left = group.getChildren(function (node) {\r\n      return node.id() === 'left';\r\n    })[0];\r\n    const right = group.getChildren(function (node) {\r\n      return node.id() === 'right';\r\n    })[0];\r\n    const bottom = group.getChildren(function (node) {\r\n      return node.id() === 'bottom';\r\n    })[0];\r\n    const top = group.getChildren(function (node) {\r\n      return node.id() === 'top';\r\n    })[0];\r\n    // debug shadow\r\n    let kshadow;\r\n    if (DRAW_DEBUG) {\r\n      kshadow = group.getChildren(function (node) {\r\n        return node.name() === 'shadow';\r\n      })[0];\r\n    }\r\n\r\n    // circle center\r\n    const center = {\r\n      x: kcircle.x(),\r\n      y: kcircle.y()\r\n    };\r\n\r\n    let radius;\r\n\r\n    // update 'self' (undo case) and special points\r\n    switch (anchor.id()) {\r\n    case 'left':\r\n      radius = center.x - anchor.x();\r\n      // update self (while blocking y)\r\n      left.x(anchor.x());\r\n      left.y(right.y());\r\n      // update others\r\n      right.x(center.x + radius);\r\n      bottom.y(center.y + radius);\r\n      top.y(center.y - radius);\r\n      break;\r\n    case 'right':\r\n      radius = anchor.x() - center.x;\r\n      // update self (while blocking y)\r\n      right.x(anchor.x());\r\n      right.y(left.y());\r\n      // update others\r\n      left.x(center.x - radius);\r\n      bottom.y(center.y + radius);\r\n      top.y(center.y - radius);\r\n      break;\r\n    case 'bottom':\r\n      radius = anchor.y() - center.y;\r\n      // update self (while blocking x)\r\n      bottom.x(top.x());\r\n      bottom.y(anchor.y());\r\n      // update others\r\n      left.x(center.x - radius);\r\n      right.x(center.x + radius);\r\n      top.y(center.y - radius);\r\n      break;\r\n    case 'top':\r\n      radius = center.y - anchor.y();\r\n      // update self (while blocking x)\r\n      top.x(bottom.x());\r\n      top.y(anchor.y());\r\n      // update others\r\n      left.x(center.x - radius);\r\n      right.x(center.x + radius);\r\n      bottom.y(center.y + radius);\r\n      break;\r\n    default :\r\n      logger.error('Unhandled anchor id: ' + anchor.id());\r\n      break;\r\n    }\r\n\r\n    // update shape: just update the radius\r\n    kcircle.radius(Math.abs(radius));\r\n    // new circle\r\n    const centerPoint = new Point2D(\r\n      group.x() + center.x,\r\n      group.y() + center.y\r\n    );\r\n    const circle = new Circle(centerPoint, radius);\r\n\r\n    // debug shadow\r\n    if (kshadow) {\r\n      // remove previous\r\n      kshadow.destroy();\r\n      // add new\r\n      group.add(this.#getShadowCircle(circle, group));\r\n    }\r\n\r\n    // update label position\r\n    const textPos = {\r\n      x: center.x - Math.abs(radius),\r\n      y: center.y + Math.abs(radius)\r\n    };\r\n    klabel.position(textPos);\r\n\r\n    // update quantification\r\n    this.#updateCircleQuantification(group, viewController);\r\n  }\r\n\r\n  /**\r\n   * Update the quantification of a Circle.\r\n   *\r\n   * @param {Konva.Group} group The group with the shape.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  updateQuantification(group, viewController) {\r\n    this.#updateCircleQuantification(group, viewController);\r\n  }\r\n\r\n  /**\r\n   * Update the quantification of a Circle (as a static\r\n   *   function to be used in update).\r\n   *\r\n   * @param {Konva.Group} group The group with the shape.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  #updateCircleQuantification(\r\n    group, viewController) {\r\n    // associated shape\r\n    const kcircle = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    if (!(kcircle instanceof Konva.Circle)) {\r\n      return;\r\n    }\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    if (!(klabel instanceof Konva.Label)) {\r\n      return;\r\n    }\r\n\r\n    // positions: add possible group offset\r\n    const centerPoint = new Point2D(\r\n      group.x() + kcircle.x(),\r\n      group.y() + kcircle.y()\r\n    );\r\n    // circle\r\n    const circle = new Circle(centerPoint, kcircle.radius());\r\n\r\n    // update text\r\n    const ktext = klabel.getText();\r\n    // @ts-expect-error\r\n    const meta = ktext.meta;\r\n    const quantification = circle.quantify(\r\n      viewController,\r\n      getFlags(meta.textExpr));\r\n    ktext.setText(replaceFlags(meta.textExpr, quantification));\r\n    // update meta\r\n    meta.quantification = quantification;\r\n  }\r\n\r\n  /**\r\n   * Get the debug shadow.\r\n   *\r\n   * @param {Circle} circle The circle to shadow.\r\n   * @param {Konva.Group} [group] The associated group.\r\n   * @returns {Konva.Group} The shadow konva group.\r\n   */\r\n  #getShadowCircle(circle, group) {\r\n    // possible group offset\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n    if (typeof group !== 'undefined') {\r\n      offsetX = group.x();\r\n      offsetY = group.y();\r\n    }\r\n    const kshadow = new Konva.Group();\r\n    kshadow.name('shadow');\r\n    const regions = circle.getRound();\r\n    for (let i = 0; i < regions.length; ++i) {\r\n      const region = regions[i];\r\n      const minX = region[0][0];\r\n      const minY = region[0][1];\r\n      const maxX = region[1][0];\r\n      const pixelLine = new Konva.Rect({\r\n        x: minX - offsetX,\r\n        y: minY - offsetY,\r\n        width: maxX - minX,\r\n        height: 1,\r\n        fill: 'grey',\r\n        strokeWidth: 0,\r\n        strokeScaleEnabled: false,\r\n        opacity: 0.3,\r\n        name: 'shadow-element'\r\n      });\r\n      kshadow.add(pixelLine);\r\n    }\r\n    return kshadow;\r\n  }\r\n\r\n} // class CircleFactory\r\n","import {Ellipse} from '../math/ellipse';\r\nimport {Point2D} from '../math/point';\r\nimport {getFlags, replaceFlags} from '../utils/string';\r\nimport {logger} from '../utils/logger';\r\nimport {defaults} from '../app/defaults';\r\nimport {getDefaultAnchor} from './editor';\r\nimport {DRAW_DEBUG} from './draw';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ViewController} from '../app/viewController';\r\nimport {Style} from '../gui/style';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Ellipse factory.\r\n */\r\nexport class EllipseFactory {\r\n  /**\r\n   * Get the name of the shape group.\r\n   *\r\n   * @returns {string} The name.\r\n   */\r\n  getGroupName() {\r\n    return 'ellipse-group';\r\n  }\r\n\r\n  /**\r\n   * Get the number of points needed to build the shape.\r\n   *\r\n   * @returns {number} The number of points.\r\n   */\r\n  getNPoints() {\r\n    return 2;\r\n  }\r\n\r\n  /**\r\n   * Get the timeout between point storage.\r\n   *\r\n   * @returns {number} The timeout in milliseconds.\r\n   */\r\n  getTimeout() {\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Is the input group a group of this factory?\r\n   *\r\n   * @param {Konva.Group} group The group to test.\r\n   * @returns {boolean} True if the group is from this fcatory.\r\n   */\r\n  isFactoryGroup(group) {\r\n    return this.getGroupName() === group.name();\r\n  }\r\n\r\n  /**\r\n   * Create an ellipse shape to be displayed.\r\n   *\r\n   * @param {Point2D[]} points The points from which to extract the ellipse.\r\n   * @param {Style} style The drawing style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @returns {Konva.Group} The Konva group.\r\n   */\r\n  create(\r\n    points, style, viewController) {\r\n    // calculate radius\r\n    const a = Math.abs(points[0].getX() - points[1].getX());\r\n    const b = Math.abs(points[0].getY() - points[1].getY());\r\n    // physical shape\r\n    const ellipse = new Ellipse(points[0], a, b);\r\n    // draw shape\r\n    const radius = {x: ellipse.getA(), y: ellipse.getB()};\r\n    const kshape = new Konva.Ellipse({\r\n      x: ellipse.getCenter().getX(),\r\n      y: ellipse.getCenter().getY(),\r\n      radius: radius,\r\n      radiusX: radius.x,\r\n      radiusY: radius.y,\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape'\r\n    });\r\n    // quantification\r\n    const ktext = new Konva.Text({\r\n      fontSize: style.getFontSize(),\r\n      fontFamily: style.getFontFamily(),\r\n      fill: style.getLineColour(),\r\n      padding: style.getTextPadding(),\r\n      shadowColor: style.getShadowLineColour(),\r\n      shadowOffset: style.getShadowOffset(),\r\n      name: 'text'\r\n    });\r\n    let textExpr = '';\r\n    const modality = viewController.getModality();\r\n    if (typeof defaults.labelText.ellipse[modality] !== 'undefined') {\r\n      textExpr = defaults.labelText.ellipse[modality];\r\n    } else {\r\n      textExpr = defaults.labelText.ellipse['*'];\r\n    }\r\n    const quant = ellipse.quantify(\r\n      viewController,\r\n      getFlags(textExpr));\r\n    ktext.setText(replaceFlags(textExpr, quant));\r\n    // augment text with meta\r\n    // @ts-ignore\r\n    ktext.meta = {\r\n      textExpr: textExpr,\r\n      quantification: quant\r\n    };\r\n    // label\r\n    const klabel = new Konva.Label({\r\n      x: ellipse.getCenter().getX() - ellipse.getA(),\r\n      y: ellipse.getCenter().getY() + ellipse.getB(),\r\n      scale: style.applyZoomScale(1),\r\n      visible: textExpr.length !== 0,\r\n      name: 'label'\r\n    });\r\n    klabel.add(ktext);\r\n    klabel.add(new Konva.Tag({\r\n      fill: style.getLineColour(),\r\n      opacity: style.getTagOpacity()\r\n    }));\r\n\r\n    // debug shadow\r\n    let kshadow;\r\n    if (DRAW_DEBUG) {\r\n      kshadow = this.#getShadowEllipse(ellipse);\r\n    }\r\n\r\n    // return group\r\n    const group = new Konva.Group();\r\n    group.name(this.getGroupName());\r\n    if (kshadow) {\r\n      group.add(kshadow);\r\n    }\r\n    group.add(klabel);\r\n    group.add(kshape);\r\n    group.visible(true); // dont inherit\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get anchors to update an ellipse shape.\r\n   *\r\n   * @param {Konva.Ellipse} shape The associated shape.\r\n   * @param {Style} style The application style.\r\n   * @returns {Konva.Ellipse[]} A list of anchors.\r\n   */\r\n  getAnchors(shape, style) {\r\n    const ellipseX = shape.x();\r\n    const ellipseY = shape.y();\r\n    const radius = shape.radius();\r\n\r\n    const anchors = [];\r\n    anchors.push(getDefaultAnchor(\r\n      ellipseX - radius.x, ellipseY, 'left', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      ellipseX + radius.x, ellipseY, 'right', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      ellipseX, ellipseY + radius.y, 'bottom', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      ellipseX, ellipseY - radius.y, 'top', style\r\n    ));\r\n    return anchors;\r\n  }\r\n\r\n  /**\r\n   * Update an ellipse shape.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The active anchor.\r\n   * @param {Style} _style The app style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  update(anchor, _style, viewController) {\r\n    // parent group\r\n    const group = anchor.getParent();\r\n    if (!(group instanceof Konva.Group)) {\r\n      return;\r\n    }\r\n    // associated shape\r\n    const kellipse = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    if (!(kellipse instanceof Konva.Ellipse)) {\r\n      return;\r\n    }\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    // find special points\r\n    const left = group.getChildren(function (node) {\r\n      return node.id() === 'left';\r\n    })[0];\r\n    const right = group.getChildren(function (node) {\r\n      return node.id() === 'right';\r\n    })[0];\r\n    const bottom = group.getChildren(function (node) {\r\n      return node.id() === 'bottom';\r\n    })[0];\r\n    const top = group.getChildren(function (node) {\r\n      return node.id() === 'top';\r\n    })[0];\r\n    // debug shadow\r\n    let kshadow;\r\n    if (DRAW_DEBUG) {\r\n      kshadow = group.getChildren(function (node) {\r\n        return node.name() === 'shadow';\r\n      })[0];\r\n    }\r\n\r\n    // ellipse center\r\n    const center = {\r\n      x: kellipse.x(),\r\n      y: kellipse.y()\r\n    };\r\n\r\n    let radiusX;\r\n    let radiusY;\r\n\r\n    // update 'self' (undo case) and special points\r\n    switch (anchor.id()) {\r\n    case 'left':\r\n      radiusX = center.x - anchor.x();\r\n      radiusY = top.y() - center.y;\r\n      // update self (while blocking y)\r\n      left.x(anchor.x());\r\n      left.y(right.y());\r\n      // update others\r\n      right.x(center.x + radiusX);\r\n      break;\r\n    case 'right':\r\n      radiusX = anchor.x() - center.x;\r\n      radiusY = top.y() - center.y;\r\n      // update self (while blocking y)\r\n      right.x(anchor.x());\r\n      right.y(left.y());\r\n      // update others\r\n      left.x(center.x - radiusX);\r\n      break;\r\n    case 'bottom':\r\n      radiusX = center.x - left.x();\r\n      radiusY = anchor.y() - center.y;\r\n      // update self (while blocking x)\r\n      bottom.x(top.x());\r\n      bottom.y(anchor.y());\r\n      // update others\r\n      top.y(center.y - radiusY);\r\n      break;\r\n    case 'top':\r\n      radiusX = center.x - left.x();\r\n      radiusY = center.y - anchor.y();\r\n      // update self (while blocking x)\r\n      top.x(bottom.x());\r\n      top.y(anchor.y());\r\n      // update others\r\n      bottom.y(center.y + radiusY);\r\n      break;\r\n    default :\r\n      logger.error('Unhandled anchor id: ' + anchor.id());\r\n      break;\r\n    }\r\n    // update shape\r\n    kellipse.position(center);\r\n    const radiusAbs = {\r\n      x: Math.abs(radiusX),\r\n      y: Math.abs(radiusY)\r\n    };\r\n    if (radiusAbs) {\r\n      kellipse.radius(radiusAbs);\r\n    }\r\n    // new ellipse\r\n    const centerPoint = new Point2D(\r\n      group.x() + center.x,\r\n      group.y() + center.y\r\n    );\r\n    const ellipse = new Ellipse(centerPoint, radiusAbs.x, radiusAbs.y);\r\n\r\n    // debug shadow\r\n    if (kshadow) {\r\n      // remove previous\r\n      kshadow.destroy();\r\n      // add new\r\n      group.add(this.#getShadowEllipse(ellipse, group));\r\n    }\r\n\r\n    // update label position\r\n    const textPos = {\r\n      x: center.x - radiusAbs.x,\r\n      y: center.y + radiusAbs.y\r\n    };\r\n    klabel.position(textPos);\r\n\r\n    // update quantification\r\n    this.#updateEllipseQuantification(group, viewController);\r\n  }\r\n\r\n  /**\r\n   * Update the quantification of an Ellipse.\r\n   *\r\n   * @param {Konva.Group} group The group with the shape.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  updateQuantification(group, viewController) {\r\n    this.#updateEllipseQuantification(group, viewController);\r\n  }\r\n\r\n  /**\r\n   * Update the quantification of an Ellipse (as a static\r\n   *   function to be used in update).\r\n   *\r\n   * @param {Konva.Group} group The group with the shape.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  #updateEllipseQuantification(group, viewController) {\r\n    // associated shape\r\n    const kellipse = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    if (!(kellipse instanceof Konva.Ellipse)) {\r\n      return;\r\n    }\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    if (!(klabel instanceof Konva.Label)) {\r\n      return;\r\n    }\r\n\r\n    // positions: add possible group offset\r\n    const centerPoint = new Point2D(\r\n      group.x() + kellipse.x(),\r\n      group.y() + kellipse.y()\r\n    );\r\n    // circle\r\n    const ellipse = new Ellipse(\r\n      centerPoint, kellipse.radius().x, kellipse.radius().y);\r\n\r\n    // update text\r\n    const ktext = klabel.getText();\r\n    // @ts-expect-error\r\n    const meta = ktext.meta;\r\n    const quantification = ellipse.quantify(\r\n      viewController,\r\n      getFlags(meta.textExpr));\r\n    ktext.setText(replaceFlags(meta.textExpr, quantification));\r\n    // update meta\r\n    meta.quantification = quantification;\r\n  }\r\n\r\n  /**\r\n   * Get the debug shadow.\r\n   *\r\n   * @param {Ellipse} ellipse The ellipse to shadow.\r\n   * @param {Konva.Group} [group] The associated group.\r\n   * @returns {Konva.Group} The shadow konva group.\r\n   */\r\n  #getShadowEllipse(ellipse, group) {\r\n    // possible group offset\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n    if (typeof group !== 'undefined') {\r\n      offsetX = group.x();\r\n      offsetY = group.y();\r\n    }\r\n    const kshadow = new Konva.Group();\r\n    kshadow.name('shadow');\r\n    const regions = ellipse.getRound();\r\n    for (let i = 0; i < regions.length; ++i) {\r\n      const region = regions[i];\r\n      const minX = region[0][0];\r\n      const minY = region[0][1];\r\n      const maxX = region[1][0];\r\n      const pixelLine = new Konva.Rect({\r\n        x: minX - offsetX,\r\n        y: minY - offsetY,\r\n        width: maxX - minX,\r\n        height: 1,\r\n        fill: 'grey',\r\n        strokeWidth: 0,\r\n        strokeScaleEnabled: false,\r\n        opacity: 0.3,\r\n        name: 'shadow-element'\r\n      });\r\n      kshadow.add(pixelLine);\r\n    }\r\n    return kshadow;\r\n  }\r\n\r\n} // class EllipseFactory\r\n","import {defaults} from '../app/defaults';\r\nimport {getDefaultAnchor} from './editor';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {Point2D} from '../math/point';\r\nimport {ViewController} from '../app/viewController';\r\nimport {Style} from '../gui/style';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * FreeHand factory.\r\n */\r\nexport class FreeHandFactory {\r\n  /**\r\n   * Get the name of the shape group.\r\n   *\r\n   * @returns {string} The name.\r\n   */\r\n  getGroupName() {\r\n    return 'freeHand-group';\r\n  }\r\n\r\n  /**\r\n   * Get the number of points needed to build the shape.\r\n   *\r\n   * @returns {number|undefined} The number of points.\r\n   */\r\n  getNPoints() {\r\n    // undefined to end with double click\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Get the timeout between point storage.\r\n   *\r\n   * @returns {number} The timeout in milliseconds.\r\n   */\r\n  getTimeout() {\r\n    return 25;\r\n  }\r\n\r\n  /**\r\n   * Is the input group a group of this factory?\r\n   *\r\n   * @param {Konva.Group} group The group to test.\r\n   * @returns {boolean} True if the group is from this fcatory.\r\n   */\r\n  isFactoryGroup(group) {\r\n    return this.getGroupName() === group.name();\r\n  }\r\n\r\n  /**\r\n   * Create a roi shape to be displayed.\r\n   *\r\n   * @param {Point2D[]} points The points from which to extract the line.\r\n   * @param {Style} style The drawing style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @returns {Konva.Group} The Konva group.\r\n   */\r\n  create(points, style, viewController) {\r\n    // points stored the Konvajs way\r\n    const arr = [];\r\n    for (let i = 0; i < points.length; ++i) {\r\n      arr.push(points[i].getX());\r\n      arr.push(points[i].getY());\r\n    }\r\n    // draw shape\r\n    const kshape = new Konva.Line({\r\n      points: arr,\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape',\r\n      tension: 0.5\r\n    });\r\n\r\n    // text\r\n    const ktext = new Konva.Text({\r\n      fontSize: style.getFontSize(),\r\n      fontFamily: style.getFontFamily(),\r\n      fill: style.getLineColour(),\r\n      name: 'text'\r\n    });\r\n    let textExpr = '';\r\n    const modality = viewController.getModality();\r\n    if (typeof defaults.labelText.freeHand[modality] !== 'undefined') {\r\n      textExpr = defaults.labelText.freeHand[modality];\r\n    } else {\r\n      textExpr = defaults.labelText.freeHand['*'];\r\n    }\r\n    ktext.setText(textExpr);\r\n    // augment text with meta\r\n    // @ts-ignore\r\n    ktext.meta = {\r\n      textExpr: textExpr,\r\n      quantification: {}\r\n    };\r\n\r\n    // label\r\n    const klabel = new Konva.Label({\r\n      x: points[0].getX(),\r\n      y: points[0].getY() + style.scale(10),\r\n      scale: style.applyZoomScale(1),\r\n      visible: textExpr.length !== 0,\r\n      name: 'label'\r\n    });\r\n    klabel.add(ktext);\r\n    klabel.add(new Konva.Tag({\r\n      fill: style.getLineColour(),\r\n      opacity: style.getTagOpacity()\r\n    }));\r\n\r\n    // return group\r\n    const group = new Konva.Group();\r\n    group.name(this.getGroupName());\r\n    group.add(klabel);\r\n    group.add(kshape);\r\n    group.visible(true); // dont inherit\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get anchors to update a free hand shape.\r\n   *\r\n   * @param {Konva.Line} shape The associated shape.\r\n   * @param {Style} style The application style.\r\n   * @returns {Konva.Ellipse[]} A list of anchors.\r\n   */\r\n  getAnchors(shape, style) {\r\n    const points = shape.points();\r\n\r\n    const anchors = [];\r\n    for (let i = 0; i < points.length; i = i + 2) {\r\n      const px = points[i] + shape.x();\r\n      const py = points[i + 1] + shape.y();\r\n      const name = i.toString();\r\n      anchors.push(getDefaultAnchor(\r\n        px, py, name, style\r\n      ));\r\n    }\r\n    return anchors;\r\n  }\r\n\r\n  /**\r\n   * Update a FreeHand shape.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The active anchor.\r\n   * @param {Style} style The app style.\r\n   * @param {ViewController} _viewController The associated view controller.\r\n   */\r\n  update(anchor, style, _viewController) {\r\n    // parent group\r\n    const group = anchor.getParent();\r\n    // associated shape\r\n    const kline = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    if (!(kline instanceof Konva.Line)) {\r\n      return;\r\n    }\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    if (!(klabel instanceof Konva.Label)) {\r\n      return;\r\n    }\r\n\r\n    // update self\r\n    const point = group.getChildren(function (node) {\r\n      return node.id() === anchor.id();\r\n    })[0];\r\n    point.x(anchor.x());\r\n    point.y(anchor.y());\r\n    // update the roi point and compensate for possible drag\r\n    // (the anchor id is the index of the point in the list)\r\n    const points = kline.points();\r\n    const index = parseInt(anchor.id(), 10);\r\n    points[index] = anchor.x() - kline.x();\r\n    points[index + 1] = anchor.y() - kline.y();\r\n    // concat to make Konva think it is a new array\r\n    kline.points(points.concat());\r\n\r\n    // update text\r\n    const ktext = klabel.getText();\r\n    // @ts-expect-error\r\n    const meta = ktext.meta;\r\n    ktext.setText(meta.textExpr);\r\n    // update position\r\n    const textPos = {\r\n      x: points[0] + kline.x(),\r\n      y: points[1] + kline.y() + style.scale(10)\r\n    };\r\n    klabel.position(textPos);\r\n  }\r\n\r\n} // class FreeHandFactory\r\n","import {Line, getAngle} from '../math/line';\r\nimport {Point2D} from '../math/point';\r\nimport {replaceFlags} from '../utils/string';\r\nimport {defaults} from '../app/defaults';\r\nimport {i18n} from '../utils/i18n';\r\nimport {getDefaultAnchor} from './editor';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ViewController} from '../app/viewController';\r\nimport {Style} from '../gui/style';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Protractor factory.\r\n */\r\nexport class ProtractorFactory {\r\n  /**\r\n   * Get the name of the shape group.\r\n   *\r\n   * @returns {string} The name.\r\n   */\r\n  getGroupName() {\r\n    return 'protractor-group';\r\n  }\r\n\r\n  /**\r\n   * Get the number of points needed to build the shape.\r\n   *\r\n   * @returns {number} The number of points.\r\n   */\r\n  getNPoints() {\r\n    return 3;\r\n  }\r\n\r\n  /**\r\n   * Get the timeout between point storage.\r\n   *\r\n   * @returns {number} The timeout in milliseconds.\r\n   */\r\n  getTimeout() {\r\n    return 500;\r\n  }\r\n\r\n  /**\r\n   * Is the input group a group of this factory?\r\n   *\r\n   * @param {Konva.Group} group The group to test.\r\n   * @returns {boolean} True if the group is from this fcatory.\r\n   */\r\n  isFactoryGroup(group) {\r\n    return this.getGroupName() === group.name();\r\n  }\r\n\r\n  /**\r\n   * Create a protractor shape to be displayed.\r\n   *\r\n   * @param {Point2D[]} points The points from which to extract the protractor.\r\n   * @param {Style} style The drawing style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @returns {Konva.Group} The Konva group.\r\n   */\r\n  create(points, style, viewController) {\r\n    // physical shape\r\n    const line0 = new Line(points[0], points[1]);\r\n    // points stored the Konvajs way\r\n    const pointsArray = [];\r\n    for (let i = 0; i < points.length; ++i) {\r\n      pointsArray.push(points[i].getX());\r\n      pointsArray.push(points[i].getY());\r\n    }\r\n    // draw shape\r\n    const kshape = new Konva.Line({\r\n      points: pointsArray,\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape'\r\n    });\r\n    const group = new Konva.Group();\r\n    group.name(this.getGroupName());\r\n    // text and decoration\r\n    if (points.length === 3) {\r\n      const line1 = new Line(points[1], points[2]);\r\n      // larger hitfunc\r\n      kshape.hitFunc(function (context) {\r\n        context.beginPath();\r\n        context.moveTo(points[0].getX(), points[0].getY());\r\n        context.lineTo(points[1].getX(), points[1].getY());\r\n        context.lineTo(points[2].getX(), points[2].getY());\r\n        context.closePath();\r\n        context.fillStrokeShape(kshape);\r\n      });\r\n      // quantification\r\n      let angle = getAngle(line0, line1);\r\n      let inclination = line0.getInclination();\r\n      if (angle > 180) {\r\n        angle = 360 - angle;\r\n        inclination += angle;\r\n      }\r\n\r\n      // quantification\r\n      const ktext = new Konva.Text({\r\n        fontSize: style.getFontSize(),\r\n        fontFamily: style.getFontFamily(),\r\n        fill: style.getLineColour(),\r\n        padding: style.getTextPadding(),\r\n        shadowColor: style.getShadowLineColour(),\r\n        shadowOffset: style.getShadowOffset(),\r\n        name: 'text'\r\n      });\r\n      let textExpr = '';\r\n      const modality = viewController.getModality();\r\n      if (typeof defaults.labelText.protractor[modality] !== 'undefined') {\r\n        textExpr = defaults.labelText.protractor[modality];\r\n      } else {\r\n        textExpr = defaults.labelText.protractor['*'];\r\n      }\r\n      const quant = {\r\n        angle: {\r\n          value: angle,\r\n          unit: i18n.t('unit.degree')\r\n        }\r\n      };\r\n      ktext.setText(replaceFlags(textExpr, quant));\r\n      // augment text with meta\r\n      // @ts-ignore\r\n      ktext.meta = {\r\n        textExpr: textExpr,\r\n        quantification: quant\r\n      };\r\n\r\n      // label\r\n      const midX =\r\n        (line0.getMidpoint().getX() + line1.getMidpoint().getX()) / 2;\r\n      const midY =\r\n        (line0.getMidpoint().getY() + line1.getMidpoint().getY()) / 2;\r\n      const klabel = new Konva.Label({\r\n        x: midX,\r\n        y: midY - style.applyZoomScale(15).y,\r\n        scale: style.applyZoomScale(1),\r\n        visible: textExpr.length !== 0,\r\n        name: 'label'\r\n      });\r\n      klabel.add(ktext);\r\n      klabel.add(new Konva.Tag({\r\n        fill: style.getLineColour(),\r\n        opacity: style.getTagOpacity()\r\n      }));\r\n\r\n      // arc\r\n      const radius = Math.min(line0.getLength(), line1.getLength()) * 33 / 100;\r\n      const karc = new Konva.Arc({\r\n        innerRadius: radius,\r\n        outerRadius: radius,\r\n        stroke: style.getLineColour(),\r\n        strokeWidth: style.getStrokeWidth(),\r\n        strokeScaleEnabled: false,\r\n        angle: angle,\r\n        rotation: -inclination,\r\n        x: points[1].getX(),\r\n        y: points[1].getY(),\r\n        name: 'shape-arc'\r\n      });\r\n      // add to group\r\n      group.add(klabel);\r\n      group.add(karc);\r\n    }\r\n    // add shape to group\r\n    group.add(kshape);\r\n    group.visible(true); // dont inherit\r\n    // return group\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get anchors to update a protractor shape.\r\n   *\r\n   * @param {Konva.Line} shape The associated shape.\r\n   * @param {Style} style The application style.\r\n   * @returns {Array} A list of anchors.\r\n   */\r\n  getAnchors(shape, style) {\r\n    const points = shape.points();\r\n\r\n    const anchors = [];\r\n    anchors.push(getDefaultAnchor(\r\n      points[0] + shape.x(), points[1] + shape.y(), 'begin', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      points[2] + shape.x(), points[3] + shape.y(), 'mid', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      points[4] + shape.x(), points[5] + shape.y(), 'end', style\r\n    ));\r\n    return anchors;\r\n  }\r\n\r\n  /**\r\n   * Update a protractor shape.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The active anchor.\r\n   * @param {Style} style The app style.\r\n   * @param {ViewController} _viewController The associated view controller.\r\n   */\r\n  update(anchor, style, _viewController) {\r\n    // parent group\r\n    const group = anchor.getParent();\r\n    // associated shape\r\n    const kline = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    if (!(kline instanceof Konva.Line)) {\r\n      return;\r\n    }\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    if (!(klabel instanceof Konva.Label)) {\r\n      return;\r\n    }\r\n    // associated arc\r\n    const karc = group.getChildren(function (node) {\r\n      return node.name() === 'shape-arc';\r\n    })[0];\r\n    if (!(karc instanceof Konva.Arc)) {\r\n      return;\r\n    }\r\n    // find special points\r\n    const begin = group.getChildren(function (node) {\r\n      return node.id() === 'begin';\r\n    })[0];\r\n    const mid = group.getChildren(function (node) {\r\n      return node.id() === 'mid';\r\n    })[0];\r\n    const end = group.getChildren(function (node) {\r\n      return node.id() === 'end';\r\n    })[0];\r\n    // update special points\r\n    switch (anchor.id()) {\r\n    case 'begin':\r\n      begin.x(anchor.x());\r\n      begin.y(anchor.y());\r\n      break;\r\n    case 'mid':\r\n      mid.x(anchor.x());\r\n      mid.y(anchor.y());\r\n      break;\r\n    case 'end':\r\n      end.x(anchor.x());\r\n      end.y(anchor.y());\r\n      break;\r\n    }\r\n    // update shape and compensate for possible drag\r\n    // note: shape.position() and shape.size() won't work...\r\n    const bx = begin.x() - kline.x();\r\n    const by = begin.y() - kline.y();\r\n    const mx = mid.x() - kline.x();\r\n    const my = mid.y() - kline.y();\r\n    const ex = end.x() - kline.x();\r\n    const ey = end.y() - kline.y();\r\n    kline.points([bx, by, mx, my, ex, ey]);\r\n    // larger hitfunc\r\n    kline.hitFunc(function (context) {\r\n      context.beginPath();\r\n      context.moveTo(bx, by);\r\n      context.lineTo(mx, my);\r\n      context.lineTo(ex, ey);\r\n      context.closePath();\r\n      context.fillStrokeShape(kline);\r\n    });\r\n    // update text\r\n    const p2d0 = new Point2D(begin.x(), begin.y());\r\n    const p2d1 = new Point2D(mid.x(), mid.y());\r\n    const p2d2 = new Point2D(end.x(), end.y());\r\n    const line0 = new Line(p2d0, p2d1);\r\n    const line1 = new Line(p2d1, p2d2);\r\n    let angle = getAngle(line0, line1);\r\n    let inclination = line0.getInclination();\r\n    if (angle > 180) {\r\n      angle = 360 - angle;\r\n      inclination += angle;\r\n    }\r\n\r\n    // update text\r\n    const ktext = klabel.getText();\r\n    // @ts-expect-error\r\n    const meta = ktext.meta;\r\n    const quantification = {\r\n      angle: {value: angle, unit: i18n.t('unit.degree')}\r\n    };\r\n    ktext.setText(replaceFlags(meta.textExpr, quantification));\r\n    // update meta\r\n    meta.quantification = quantification;\r\n    // update position\r\n    const midX = (line0.getMidpoint().getX() + line1.getMidpoint().getX()) / 2;\r\n    const midY = (line0.getMidpoint().getY() + line1.getMidpoint().getY()) / 2;\r\n    const textPos = {\r\n      x: midX,\r\n      y: midY - style.applyZoomScale(15).y\r\n    };\r\n    klabel.position(textPos);\r\n\r\n    // arc\r\n    const radius = Math.min(line0.getLength(), line1.getLength()) * 33 / 100;\r\n    karc.innerRadius(radius);\r\n    karc.outerRadius(radius);\r\n    karc.angle(angle);\r\n    karc.rotation(-inclination);\r\n    const arcPos = {x: mid.x(), y: mid.y()};\r\n    karc.position(arcPos);\r\n  }\r\n\r\n} // class ProtractorFactory\r\n","import {Rectangle} from '../math/rectangle';\r\nimport {Point2D} from '../math/point';\r\nimport {getFlags, replaceFlags} from '../utils/string';\r\nimport {logger} from '../utils/logger';\r\nimport {defaults} from '../app/defaults';\r\nimport {getDefaultAnchor} from './editor';\r\nimport {DRAW_DEBUG} from './draw';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ViewController} from '../app/viewController';\r\nimport {Style} from '../gui/style';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Rectangle factory.\r\n */\r\nexport class RectangleFactory {\r\n  /**\r\n   * Get the name of the shape group.\r\n   *\r\n   * @returns {string} The name.\r\n   */\r\n  getGroupName() {\r\n    return 'rectangle-group';\r\n  }\r\n\r\n  /**\r\n   * Get the number of points needed to build the shape.\r\n   *\r\n   * @returns {number} The number of points.\r\n   */\r\n  getNPoints() {\r\n    return 2;\r\n  }\r\n\r\n  /**\r\n   * Get the timeout between point storage.\r\n   *\r\n   * @returns {number} The timeout in milliseconds.\r\n   */\r\n  getTimeout() {\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Is the input group a group of this factory?\r\n   *\r\n   * @param {Konva.Group} group The group to test.\r\n   * @returns {boolean} True if the group is from this fcatory.\r\n   */\r\n  isFactoryGroup(group) {\r\n    return this.getGroupName() === group.name();\r\n  }\r\n\r\n  /**\r\n   * Create a rectangle shape to be displayed.\r\n   *\r\n   * @param {Point2D[]} points The points from which to extract the rectangle.\r\n   * @param {Style} style The drawing style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @returns {Konva.Group} The Konva group.\r\n   */\r\n  create(points, style, viewController) {\r\n    // physical shape\r\n    const rectangle = new Rectangle(points[0], points[1]);\r\n    // draw shape\r\n    const kshape = new Konva.Rect({\r\n      x: rectangle.getBegin().getX(),\r\n      y: rectangle.getBegin().getY(),\r\n      width: rectangle.getWidth(),\r\n      height: rectangle.getHeight(),\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape'\r\n    });\r\n    // label text\r\n    const ktext = new Konva.Text({\r\n      fontSize: style.getFontSize(),\r\n      fontFamily: style.getFontFamily(),\r\n      fill: style.getLineColour(),\r\n      padding: style.getTextPadding(),\r\n      shadowColor: style.getShadowLineColour(),\r\n      shadowOffset: style.getShadowOffset(),\r\n      name: 'text'\r\n    });\r\n    let textExpr = '';\r\n    const modality = viewController.getModality();\r\n    if (typeof defaults.labelText.rectangle[modality] !== 'undefined') {\r\n      textExpr = defaults.labelText.rectangle[modality];\r\n    } else {\r\n      textExpr = defaults.labelText.rectangle['*'];\r\n    }\r\n    const quant = rectangle.quantify(\r\n      viewController,\r\n      getFlags(textExpr));\r\n    ktext.setText(replaceFlags(textExpr, quant));\r\n    // augment text with meta\r\n    // @ts-ignore\r\n    ktext.meta = {\r\n      textExpr: textExpr,\r\n      quantification: quant\r\n    };\r\n    // label\r\n    const klabel = new Konva.Label({\r\n      x: rectangle.getBegin().getX(),\r\n      y: rectangle.getEnd().getY(),\r\n      scale: style.applyZoomScale(1),\r\n      visible: textExpr.length !== 0,\r\n      name: 'label'\r\n    });\r\n    klabel.add(ktext);\r\n    klabel.add(new Konva.Tag({\r\n      fill: style.getLineColour(),\r\n      opacity: style.getTagOpacity()\r\n    }));\r\n\r\n    // debug shadow\r\n    let kshadow;\r\n    if (DRAW_DEBUG) {\r\n      kshadow = this.#getShadowRectangle(rectangle);\r\n    }\r\n\r\n    // return group\r\n    const group = new Konva.Group();\r\n    group.name(this.getGroupName());\r\n    if (kshadow) {\r\n      group.add(kshadow);\r\n    }\r\n    group.add(klabel);\r\n    group.add(kshape);\r\n    group.visible(true); // dont inherit\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get anchors to update a rectangle shape.\r\n   *\r\n   * @param {Konva.Shape} shape The associated shape.\r\n   * @param {Style} style The application style.\r\n   * @returns {Konva.Ellipse[]} A list of anchors.\r\n   */\r\n  getAnchors(shape, style) {\r\n    const rectX = shape.x();\r\n    const rectY = shape.y();\r\n    const rectWidth = shape.width();\r\n    const rectHeight = shape.height();\r\n\r\n    const anchors = [];\r\n    anchors.push(getDefaultAnchor(\r\n      rectX, rectY, 'topLeft', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      rectX + rectWidth, rectY, 'topRight', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      rectX + rectWidth, rectY + rectHeight, 'bottomRight', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      rectX, rectY + rectHeight, 'bottomLeft', style\r\n    ));\r\n    return anchors;\r\n  }\r\n\r\n  /**\r\n   * Update a rectangle shape.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The active anchor.\r\n   * @param {Style} style The app style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  update(anchor, style, viewController) {\r\n    // parent group\r\n    const group = anchor.getParent();\r\n    if (!(group instanceof Konva.Group)) {\r\n      return;\r\n    }\r\n    // associated shape\r\n    const krect = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n      // find special points\r\n    const topLeft = group.getChildren(function (node) {\r\n      return node.id() === 'topLeft';\r\n    })[0];\r\n    const topRight = group.getChildren(function (node) {\r\n      return node.id() === 'topRight';\r\n    })[0];\r\n    const bottomRight = group.getChildren(function (node) {\r\n      return node.id() === 'bottomRight';\r\n    })[0];\r\n    const bottomLeft = group.getChildren(function (node) {\r\n      return node.id() === 'bottomLeft';\r\n    })[0];\r\n    // debug shadow\r\n    let kshadow;\r\n    if (DRAW_DEBUG) {\r\n      kshadow = group.getChildren(function (node) {\r\n        return node.name() === 'shadow';\r\n      })[0];\r\n    }\r\n\r\n    // update 'self' (undo case) and special points\r\n    switch (anchor.id()) {\r\n    case 'topLeft':\r\n      topLeft.x(anchor.x());\r\n      topLeft.y(anchor.y());\r\n      topRight.y(anchor.y());\r\n      bottomLeft.x(anchor.x());\r\n      break;\r\n    case 'topRight':\r\n      topRight.x(anchor.x());\r\n      topRight.y(anchor.y());\r\n      topLeft.y(anchor.y());\r\n      bottomRight.x(anchor.x());\r\n      break;\r\n    case 'bottomRight':\r\n      bottomRight.x(anchor.x());\r\n      bottomRight.y(anchor.y());\r\n      bottomLeft.y(anchor.y());\r\n      topRight.x(anchor.x());\r\n      break;\r\n    case 'bottomLeft':\r\n      bottomLeft.x(anchor.x());\r\n      bottomLeft.y(anchor.y());\r\n      bottomRight.y(anchor.y());\r\n      topLeft.x(anchor.x());\r\n      break;\r\n    default :\r\n      logger.error('Unhandled anchor id: ' + anchor.id());\r\n      break;\r\n    }\r\n    // update shape\r\n    krect.position(topLeft.position());\r\n    const width = topRight.x() - topLeft.x();\r\n    const height = bottomLeft.y() - topLeft.y();\r\n    if (width && height) {\r\n      krect.size({width: width, height: height});\r\n    }\r\n    // positions: add possible group offset\r\n    const p2d0 = new Point2D(\r\n      group.x() + topLeft.x(),\r\n      group.y() + topLeft.y()\r\n    );\r\n    const p2d1 = new Point2D(\r\n      group.x() + bottomRight.x(),\r\n      group.y() + bottomRight.y()\r\n    );\r\n    // new rect\r\n    const rect = new Rectangle(p2d0, p2d1);\r\n\r\n    // debug shadow based on round (used in quantification)\r\n    if (kshadow) {\r\n      const round = rect.getRound();\r\n      const rWidth = round.max.getX() - round.min.getX();\r\n      const rHeight = round.max.getY() - round.min.getY();\r\n      kshadow.position({\r\n        x: round.min.getX() - group.x(),\r\n        y: round.min.getY() - group.y()\r\n      });\r\n      kshadow.size({width: rWidth, height: rHeight});\r\n    }\r\n\r\n    // update label position\r\n    const textPos = {\r\n      x: rect.getBegin().getX() - group.x(),\r\n      y: rect.getEnd().getY() - group.y()\r\n    };\r\n    klabel.position(textPos);\r\n\r\n    // update quantification\r\n    this.#updateRectangleQuantification(group, viewController);\r\n  }\r\n\r\n  /**\r\n   * Update the quantification of a Rectangle.\r\n   *\r\n   * @param {Konva.Group} group The group with the shape.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  updateQuantification(group, viewController) {\r\n    this.#updateRectangleQuantification(group, viewController);\r\n  }\r\n\r\n  /**\r\n   * Update the quantification of a Rectangle (as a static\r\n   *   function to be used in update).\r\n   *\r\n   * @param {Konva.Group} group The group with the shape.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  #updateRectangleQuantification(group, viewController) {\r\n    // associated shape\r\n    const krect = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    if (!(klabel instanceof Konva.Label)) {\r\n      return;\r\n    }\r\n\r\n    // positions: add possible group offset\r\n    const p2d0 = new Point2D(\r\n      group.x() + krect.x(),\r\n      group.y() + krect.y()\r\n    );\r\n    const p2d1 = new Point2D(\r\n      p2d0.getX() + krect.width(),\r\n      p2d0.getY() + krect.height()\r\n    );\r\n    // rectangle\r\n    const rect = new Rectangle(p2d0, p2d1);\r\n\r\n    // update text\r\n    const ktext = klabel.getText();\r\n    // @ts-expect-error\r\n    const meta = ktext.meta;\r\n    const quantification = rect.quantify(\r\n      viewController,\r\n      getFlags(meta.textExpr));\r\n    ktext.setText(replaceFlags(meta.textExpr, quantification));\r\n    // update meta\r\n    meta.quantification = quantification;\r\n  }\r\n\r\n  /**\r\n   * Get the debug shadow.\r\n   *\r\n   * @param {Rectangle} rectangle The rectangle to shadow.\r\n   * @returns {Konva.Rect} The shadow konva shape.\r\n   */\r\n  #getShadowRectangle(rectangle) {\r\n    const round = rectangle.getRound();\r\n    const rWidth = round.max.getX() - round.min.getX();\r\n    const rHeight = round.max.getY() - round.min.getY();\r\n    return new Konva.Rect({\r\n      x: round.min.getX(),\r\n      y: round.min.getY(),\r\n      width: rWidth,\r\n      height: rHeight,\r\n      fill: 'grey',\r\n      strokeWidth: 0,\r\n      strokeScaleEnabled: false,\r\n      opacity: 0.3,\r\n      name: 'shadow'\r\n    });\r\n  }\r\n\r\n} // class RectangleFactory\r\n","import {Line, getPerpendicularLine} from '../math/line';\r\nimport {Point2D} from '../math/point';\r\nimport {replaceFlags} from '../utils/string';\r\nimport {defaults} from '../app/defaults';\r\nimport {getDefaultAnchor} from './editor';\r\n// external\r\nimport Konva from 'konva';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {ViewController} from '../app/viewController';\r\nimport {Style} from '../gui/style';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * Ruler factory.\r\n */\r\nexport class RulerFactory {\r\n  /**\r\n   * Get the name of the shape group.\r\n   *\r\n   * @returns {string} The name.\r\n   */\r\n  getGroupName() {\r\n    return 'ruler-group';\r\n  }\r\n\r\n  /**\r\n   * Get the number of points needed to build the shape.\r\n   *\r\n   * @returns {number} The number of points.\r\n   */\r\n  getNPoints() {\r\n    return 2;\r\n  }\r\n\r\n  /**\r\n   * Get the timeout between point storage.\r\n   *\r\n   * @returns {number} The timeout in milliseconds.\r\n   */\r\n  getTimeout() {\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Is the input group a group of this factory?\r\n   *\r\n   * @param {Konva.Group} group The group to test.\r\n   * @returns {boolean} True if the group is from this fcatory.\r\n   */\r\n  isFactoryGroup(group) {\r\n    return this.getGroupName() === group.name();\r\n  }\r\n\r\n  /**\r\n   * Create a ruler shape to be displayed.\r\n   *\r\n   * @param {Point2D[]} points The points from which to extract the line.\r\n   * @param {Style} style The drawing style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   * @returns {Konva.Group} The Konva group.\r\n   */\r\n  create(points, style, viewController) {\r\n    // physical shape\r\n    const line = new Line(points[0], points[1]);\r\n    // draw shape\r\n    const kshape = new Konva.Line({\r\n      points: [line.getBegin().getX(),\r\n        line.getBegin().getY(),\r\n        line.getEnd().getX(),\r\n        line.getEnd().getY()],\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape'\r\n    });\r\n\r\n    const tickLen = style.scale(10);\r\n\r\n    // tick begin\r\n    const linePerp0 = getPerpendicularLine(line, points[0], tickLen);\r\n    const ktick0 = new Konva.Line({\r\n      points: [linePerp0.getBegin().getX(),\r\n        linePerp0.getBegin().getY(),\r\n        linePerp0.getEnd().getX(),\r\n        linePerp0.getEnd().getY()],\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape-tick0'\r\n    });\r\n\r\n    // tick end\r\n    const linePerp1 = getPerpendicularLine(line, points[1], tickLen);\r\n    const ktick1 = new Konva.Line({\r\n      points: [linePerp1.getBegin().getX(),\r\n        linePerp1.getBegin().getY(),\r\n        linePerp1.getEnd().getX(),\r\n        linePerp1.getEnd().getY()],\r\n      stroke: style.getLineColour(),\r\n      strokeWidth: style.getStrokeWidth(),\r\n      strokeScaleEnabled: false,\r\n      name: 'shape-tick1'\r\n    });\r\n\r\n    // larger hitfunc\r\n    kshape.hitFunc(function (context) {\r\n      context.beginPath();\r\n      context.moveTo(linePerp0.getBegin().getX(), linePerp0.getBegin().getY());\r\n      context.lineTo(linePerp0.getEnd().getX(), linePerp0.getEnd().getY());\r\n      context.lineTo(linePerp1.getEnd().getX(), linePerp1.getEnd().getY());\r\n      context.lineTo(linePerp1.getBegin().getX(), linePerp1.getBegin().getY());\r\n      context.closePath();\r\n      context.fillStrokeShape(kshape);\r\n    });\r\n\r\n    // quantification\r\n    const ktext = new Konva.Text({\r\n      fontSize: style.getFontSize(),\r\n      fontFamily: style.getFontFamily(),\r\n      fill: style.getLineColour(),\r\n      padding: style.getTextPadding(),\r\n      shadowColor: style.getShadowLineColour(),\r\n      shadowOffset: style.getShadowOffset(),\r\n      name: 'text'\r\n    });\r\n    let textExpr = '';\r\n    const modality = viewController.getModality();\r\n    if (typeof defaults.labelText.ruler[modality] !== 'undefined') {\r\n      textExpr = defaults.labelText.ruler[modality];\r\n    } else {\r\n      textExpr = defaults.labelText.ruler['*'];\r\n    }\r\n    const quant = line.quantify(viewController);\r\n    ktext.setText(replaceFlags(textExpr, quant));\r\n    // augment text with meta\r\n    // @ts-ignore\r\n    ktext.meta = {\r\n      textExpr: textExpr,\r\n      quantification: quant\r\n    };\r\n\r\n    // label\r\n    const dX = line.getBegin().getX() > line.getEnd().getX() ? 0 : -1;\r\n    const dY = line.getBegin().getY() > line.getEnd().getY() ? -1 : 0;\r\n    const klabel = new Konva.Label({\r\n      x: line.getEnd().getX() + dX * ktext.width(),\r\n      y: line.getEnd().getY() + dY * style.applyZoomScale(15).y,\r\n      scale: style.applyZoomScale(1),\r\n      visible: textExpr.length !== 0,\r\n      name: 'label'\r\n    });\r\n    klabel.add(ktext);\r\n    klabel.add(new Konva.Tag({\r\n      fill: style.getLineColour(),\r\n      opacity: style.getTagOpacity()\r\n    }));\r\n\r\n    // return group\r\n    const group = new Konva.Group();\r\n    group.name(this.getGroupName());\r\n    group.add(klabel);\r\n    group.add(ktick0);\r\n    group.add(ktick1);\r\n    group.add(kshape);\r\n    group.visible(true); // dont inherit\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get anchors to update a ruler shape.\r\n   *\r\n   * @param {Konva.Line} shape The associated shape.\r\n   * @param {Style} style The application style.\r\n   * @returns {Konva.Ellipse[]} A list of anchors.\r\n   */\r\n  getAnchors(shape, style) {\r\n    const points = shape.points();\r\n\r\n    const anchors = [];\r\n    anchors.push(getDefaultAnchor(\r\n      points[0] + shape.x(), points[1] + shape.y(), 'begin', style\r\n    ));\r\n    anchors.push(getDefaultAnchor(\r\n      points[2] + shape.x(), points[3] + shape.y(), 'end', style\r\n    ));\r\n    return anchors;\r\n  }\r\n\r\n  /**\r\n   * Update a ruler shape.\r\n   *\r\n   * @param {Konva.Ellipse} anchor The active anchor.\r\n   * @param {Style} style The app style.\r\n   * @param {ViewController} viewController The associated view controller.\r\n   */\r\n  update(anchor, style, viewController) {\r\n    // parent group\r\n    const group = anchor.getParent();\r\n    // associated shape\r\n    const kline = group.getChildren(function (node) {\r\n      return node.name() === 'shape';\r\n    })[0];\r\n    if (!(kline instanceof Konva.Line)) {\r\n      return;\r\n    }\r\n    // associated tick0\r\n    const ktick0 = group.getChildren(function (node) {\r\n      return node.name() === 'shape-tick0';\r\n    })[0];\r\n    if (!(ktick0 instanceof Konva.Line)) {\r\n      return;\r\n    }\r\n    // associated tick1\r\n    const ktick1 = group.getChildren(function (node) {\r\n      return node.name() === 'shape-tick1';\r\n    })[0];\r\n    if (!(ktick1 instanceof Konva.Line)) {\r\n      return;\r\n    }\r\n    // associated label\r\n    const klabel = group.getChildren(function (node) {\r\n      return node.name() === 'label';\r\n    })[0];\r\n    if (!(klabel instanceof Konva.Label)) {\r\n      return;\r\n    }\r\n    // find special points\r\n    const begin = group.getChildren(function (node) {\r\n      return node.id() === 'begin';\r\n    })[0];\r\n    const end = group.getChildren(function (node) {\r\n      return node.id() === 'end';\r\n    })[0];\r\n\r\n    // update special points\r\n    switch (anchor.id()) {\r\n    case 'begin':\r\n      begin.x(anchor.x());\r\n      begin.y(anchor.y());\r\n      break;\r\n    case 'end':\r\n      end.x(anchor.x());\r\n      end.y(anchor.y());\r\n      break;\r\n    }\r\n    // update shape and compensate for possible drag\r\n    // note: shape.position() and shape.size() won't work...\r\n    const bx = begin.x() - kline.x();\r\n    const by = begin.y() - kline.y();\r\n    const ex = end.x() - kline.x();\r\n    const ey = end.y() - kline.y();\r\n    kline.points([bx, by, ex, ey]);\r\n    // new line\r\n    const p2d0 = new Point2D(begin.x(), begin.y());\r\n    const p2d1 = new Point2D(end.x(), end.y());\r\n    const line = new Line(p2d0, p2d1);\r\n    // tick\r\n    const p2b = new Point2D(bx, by);\r\n    const p2e = new Point2D(ex, ey);\r\n    const linePerp0 = getPerpendicularLine(line, p2b, style.scale(10));\r\n    ktick0.points([linePerp0.getBegin().getX(),\r\n      linePerp0.getBegin().getY(),\r\n      linePerp0.getEnd().getX(),\r\n      linePerp0.getEnd().getY()]);\r\n    const linePerp1 = getPerpendicularLine(line, p2e, style.scale(10));\r\n    ktick1.points([linePerp1.getBegin().getX(),\r\n      linePerp1.getBegin().getY(),\r\n      linePerp1.getEnd().getX(),\r\n      linePerp1.getEnd().getY()]);\r\n    // larger hitfunc\r\n    kline.hitFunc(function (context) {\r\n      context.beginPath();\r\n      context.moveTo(linePerp0.getBegin().getX(), linePerp0.getBegin().getY());\r\n      context.lineTo(linePerp0.getEnd().getX(), linePerp0.getEnd().getY());\r\n      context.lineTo(linePerp1.getEnd().getX(), linePerp1.getEnd().getY());\r\n      context.lineTo(linePerp1.getBegin().getX(), linePerp1.getBegin().getY());\r\n      context.closePath();\r\n      context.fillStrokeShape(kline);\r\n    });\r\n\r\n    // update text\r\n    const ktext = klabel.getText();\r\n    // @ts-expect-error\r\n    const meta = ktext.meta;\r\n    const quantification = line.quantify(viewController);\r\n    ktext.setText(replaceFlags(meta.textExpr, quantification));\r\n    // update meta\r\n    meta.quantification = quantification;\r\n    // update position\r\n    const dX = line.getBegin().getX() > line.getEnd().getX() ? 0 : -1;\r\n    const dY = line.getBegin().getY() > line.getEnd().getY() ? -1 : 0;\r\n    const textPos = {\r\n      x: line.getEnd().getX() + dX * ktext.width(),\r\n      y: line.getEnd().getY() + dY * style.applyZoomScale(15).y\r\n    };\r\n    klabel.position(textPos);\r\n  }\r\n\r\n} // class RulerFactory\r\n","import {viewEventNames} from '../image/view';\r\nimport {ViewFactory} from '../image/viewFactory';\r\nimport {\r\n  getMatrixFromName,\r\n  getOrientationStringLPS\r\n} from '../math/matrix';\r\nimport {Point3D} from '../math/point';\r\nimport {Stage} from '../gui/stage';\r\nimport {Style} from '../gui/style';\r\nimport {\r\n  getViewOrientation,\r\n  getLayerDetailsFromLayerDivId\r\n} from '../gui/layerGroup';\r\nimport {ListenerHandler} from '../utils/listen';\r\nimport {State} from '../io/state';\r\nimport {logger} from '../utils/logger';\r\nimport {getUriQuery, decodeQuery} from '../utils/uri';\r\nimport {UndoStack} from '../tools/undo';\r\nimport {ToolboxController} from './toolboxController';\r\nimport {LoadController} from './loadController';\r\nimport {DataController} from './dataController';\r\nimport {OverlayData} from '../gui/overlayData';\r\nimport {toolList, defaultToolList, toolOptions} from '../tools';\r\nimport {binderList} from '../gui/stage';\r\nimport {WindowLevel} from '../image/windowLevel';\r\n\r\n// doc imports\r\n/* eslint-disable no-unused-vars */\r\nimport {LayerGroup} from '../gui/layerGroup';\r\nimport {ViewLayer} from '../gui/viewLayer';\r\nimport {DrawLayer} from '../gui/drawLayer';\r\nimport {Image} from '../image/image';\r\nimport {Matrix33} from '../math/matrix';\r\nimport {DataElement} from '../dicom/dataElement';\r\n/* eslint-enable no-unused-vars */\r\n\r\n/**\r\n * View configuration: mainly defines the divId\r\n * of the associated HTML div.\r\n */\r\nexport class ViewConfig {\r\n  /**\r\n   * Associated HTML div id.\r\n   *\r\n   * @type {string}\r\n   */\r\n  divId;\r\n  /**\r\n   * Optional orientation of the data; 'axial', 'coronal' or 'sagittal'.\r\n   * If undefined, will use the data aquisition plane.\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  orientation;\r\n  /**\r\n   * Optional view colour map name.\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  colourMap;\r\n  /**\r\n   * Optional layer opacity; in [0, 1] range.\r\n   *\r\n   * @type {number|undefined}\r\n   */\r\n  opacity;\r\n  /**\r\n   * Optional layer window center.\r\n   *\r\n   * @type {number|undefined}\r\n   */\r\n  windowCenter;\r\n  /**\r\n   * Optional layer window width.\r\n   *\r\n   * @type {number|undefined}\r\n   */\r\n  windowWidth;\r\n\r\n  /**\r\n   * @param {string} divId The associated HTML div id.\r\n   */\r\n  constructor(divId) {\r\n    this.divId = divId;\r\n  }\r\n}\r\n\r\n/**\r\n * Tool configuration.\r\n */\r\nexport class ToolConfig {\r\n  /**\r\n   * Optional tool options.\r\n   * For Draw: list of shape names.\r\n   * For Filter: list of filter names.\r\n   *\r\n   * @type {string[]|undefined}\r\n   */\r\n  options;\r\n\r\n  /**\r\n   * @param {string[]} [options] Optional tool options.\r\n   */\r\n  constructor(options) {\r\n    this.options = options;\r\n  }\r\n}\r\n\r\n/**\r\n * Application options.\r\n */\r\nexport class AppOptions {\r\n  /**\r\n   * DataId indexed object containing the data view configurations.\r\n   *\r\n   * @type {Object<string, ViewConfig[]>|undefined}\r\n   */\r\n  dataViewConfigs;\r\n  /**\r\n   * Tool name indexed object containing individual tool configurations.\r\n   *\r\n   * @type {Object<string, ToolConfig>|undefined}\r\n   */\r\n  tools;\r\n  /**\r\n   * Optional array of layerGroup binder names.\r\n   *\r\n   * @type {string[]|undefined}\r\n   */\r\n  binders;\r\n  /**\r\n   * Optional boolean flag to trigger the first data render\r\n   *   after the first loaded data or not. Defaults to true;\r\n   *\r\n   * @type {boolean|undefined}\r\n   */\r\n  viewOnFirstLoadItem;\r\n  /**\r\n   * Optional default chraracter set string used for DICOM parsing if\r\n   * not passed in DICOM file.\r\n   * Valid values: https://developer.mozilla.org/en-US/docs/Web/API/Encoding_API/Encodings\r\n   *\r\n   * @type {string|undefined}\r\n   */\r\n  defaultCharacterSet;\r\n  /**\r\n   * Optional overlay config.\r\n   *\r\n   * @type {object|undefined}\r\n   */\r\n  overlayConfig;\r\n\r\n  /**\r\n   * @param {Object<string, ViewConfig[]>} [dataViewConfigs] Optional dataId\r\n   *   indexed object containing the data view configurations.\r\n   */\r\n  constructor(dataViewConfigs) {\r\n    this.dataViewConfigs = dataViewConfigs;\r\n  }\r\n}\r\n\r\n/**\r\n * List of ViewConfigs indexed by dataIds.\r\n *\r\n * @typedef {Object<string, ViewConfig[]>} DataViewConfigs\r\n */\r\n\r\n/**\r\n * Main application class.\r\n *\r\n * @example\r\n * // create the dwv app\r\n * const app = new dwv.App();\r\n * // initialise\r\n * const viewConfig0 = new dwv.ViewConfig('layerGroup0');\r\n * const viewConfigs = {'*': [viewConfig0]};\r\n * const options = new dwv.AppOptions(viewConfigs);\r\n * app.init(options);\r\n * // load dicom data\r\n * app.loadURLs([\r\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\r\n * ]);\r\n */\r\nexport class App {\r\n\r\n  /**\r\n   * App options.\r\n   *\r\n   * @type {AppOptions}\r\n   */\r\n  #options = null;\r\n\r\n  /**\r\n   * Data controller.\r\n   *\r\n   * @type {DataController}\r\n   */\r\n  #dataController = null;\r\n\r\n  /**\r\n   * Toolbox controller.\r\n   *\r\n   * @type {ToolboxController}\r\n   */\r\n  #toolboxController = null;\r\n\r\n  /**\r\n   * Load controller.\r\n   *\r\n   * @type {LoadController}\r\n   */\r\n  #loadController = null;\r\n\r\n  /**\r\n   * Stage.\r\n   *\r\n   * @type {Stage}\r\n   */\r\n  #stage = null;\r\n\r\n  /**\r\n   * Undo stack.\r\n   *\r\n   * @type {UndoStack}\r\n   */\r\n  #undoStack = null;\r\n\r\n  /**\r\n   * Style.\r\n   *\r\n   * @type {Style}\r\n   */\r\n  #style = new Style();\r\n\r\n  // overlay datas\r\n  #overlayDatas = {};\r\n\r\n  /**\r\n   * Listener handler.\r\n   *\r\n   * @type {ListenerHandler}\r\n   */\r\n  #listenerHandler = new ListenerHandler();\r\n\r\n  #updateParent = null;\r\n\r\n  #databaseObjects = null;\r\n\r\n  /**\r\n   * Get the image.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {Image|undefined} The associated image.\r\n   */\r\n  getImage(dataId) {\r\n    let res;\r\n    if (typeof this.#dataController.get(dataId) !== 'undefined') {\r\n      res = this.#dataController.get(dataId).image;\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Get the last loaded image.\r\n   *\r\n   * @returns {Image|undefined} The image.\r\n   */\r\n  getLastImage() {\r\n    const dataIds = this.#dataController.getDataIds();\r\n    const lastId = dataIds[dataIds.length - 1];\r\n    return this.getImage(lastId);\r\n  }\r\n\r\n  /**\r\n   * Set the image at the given id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {Image} img The associated image.\r\n   */\r\n  setImage(dataId, img) {\r\n    this.#dataController.setImage(dataId, img);\r\n  }\r\n\r\n  /**\r\n   * Set the last image.\r\n   *\r\n   * @param {Image} img The associated image.\r\n   */\r\n  setLastImage(img) {\r\n    const dataIds = this.#dataController.getDataIds();\r\n    const lastId = dataIds[dataIds.length - 1];\r\n    this.#dataController.setImage(lastId, img);\r\n  }\r\n\r\n  /**\r\n   * Add a new image.\r\n   *\r\n   * @param {Image} image The new image.\r\n   * @param {object} meta The image meta.\r\n   * @param {string} source The source of the new image,\r\n   *   will be passed with load events.\r\n   * @returns {string} The new image data id.\r\n   */\r\n  addNewImage(image, meta, source) {\r\n    const dataId = this.#dataController.getNextDataId();\r\n\r\n    // load start event\r\n    this.#fireEvent({\r\n      type: 'loadstart',\r\n      loadtype: 'image',\r\n      source: source,\r\n      dataid: dataId\r\n    });\r\n\r\n    // add image to data controller\r\n    this.#dataController.addNew(dataId, image, meta);\r\n\r\n    // load item event\r\n    this.#fireEvent({\r\n      type: 'loaditem',\r\n      loadtype: 'image',\r\n      data: meta,\r\n      source: source,\r\n      dataid: dataId,\r\n      isfirstitem: true\r\n    });\r\n\r\n    // optional render\r\n    if (this.#options.viewOnFirstLoadItem) {\r\n      this.render(dataId);\r\n    }\r\n\r\n    // load events\r\n    this.#fireEvent({\r\n      type: 'load',\r\n      loadtype: 'image',\r\n      source: source,\r\n      dataid: dataId\r\n    });\r\n    this.#fireEvent({\r\n      type: 'loadend',\r\n      loadtype: 'image',\r\n      source: source,\r\n      dataid: dataId\r\n    });\r\n\r\n    return dataId;\r\n  }\r\n\r\n  /**\r\n   * Get the meta data.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {Object<string, DataElement>|undefined} The list of meta data.\r\n   */\r\n  getMetaData(dataId) {\r\n    let res;\r\n    if (typeof this.#dataController.get(dataId) !== 'undefined') {\r\n      res = this.#dataController.get(dataId).meta;\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Get the list of ids in the data storage.\r\n   *\r\n   * @returns {string[]} The list of data ids.\r\n   */\r\n  getDataIds() {\r\n    return this.#dataController.getDataIds();\r\n  }\r\n\r\n  /**\r\n   * Get the list of dataIds that contain the input UIDs.\r\n   *\r\n   * @param {string[]} uids A list of UIDs.\r\n   * @returns {string[]} The list of dataIds that contain the UIDs.\r\n   */\r\n  getDataIdsFromSopUids(uids) {\r\n    return this.#dataController.getDataIdsFromSopUids(uids);\r\n  }\r\n\r\n  /**\r\n   * Can the data be scrolled?\r\n   *\r\n   * @returns {boolean} True if the data has a third dimension greater than one.\r\n   */\r\n  canScroll() {\r\n    const viewLayer = this.#stage.getActiveLayerGroup().getActiveViewLayer();\r\n    const controller = viewLayer.getViewController();\r\n    return controller.canScroll();\r\n  }\r\n\r\n  /**\r\n   * Can window and level be applied to the data?\r\n   *\r\n   * @returns {boolean} True if the data is monochrome.\r\n   */\r\n  canWindowLevel() {\r\n    const viewLayer = this.#stage.getActiveLayerGroup().getActiveViewLayer();\r\n    const controller = viewLayer.getViewController();\r\n    return controller.canWindowLevel();\r\n  }\r\n\r\n  /**\r\n   * Get the layer scale on top of the base scale.\r\n   *\r\n   * @returns {object} The scale as {x,y}.\r\n   */\r\n  getAddedScale() {\r\n    return this.#stage.getActiveLayerGroup().getAddedScale();\r\n  }\r\n\r\n  /**\r\n   * Get the base scale.\r\n   *\r\n   * @returns {object} The scale as {x,y}.\r\n   */\r\n  getBaseScale() {\r\n    return this.#stage.getActiveLayerGroup().getBaseScale();\r\n  }\r\n\r\n  /**\r\n   * Get the layer offset.\r\n   *\r\n   * @returns {object} The offset.\r\n   */\r\n  getOffset() {\r\n    return this.#stage.getActiveLayerGroup().getOffset();\r\n  }\r\n\r\n  /**\r\n   * Get the toolbox controller.\r\n   *\r\n   * @returns {ToolboxController} The controller.\r\n   */\r\n  getToolboxController() {\r\n    return this.#toolboxController;\r\n  }\r\n\r\n  /**\r\n   * Get the active layer group.\r\n   * The layer is available after the first loaded item.\r\n   *\r\n   * @returns {LayerGroup} The layer group.\r\n   */\r\n  getActiveLayerGroup() {\r\n    return this.#stage.getActiveLayerGroup();\r\n  }\r\n\r\n  /**\r\n   * Set the active layer group.\r\n   *\r\n   * @param {number} index The layer group index.\r\n   */\r\n  setActiveLayerGroup(index) {\r\n    this.#stage.setActiveLayerGroup(index);\r\n  }\r\n\r\n  /**\r\n   * Get the view layers associated to a data id.\r\n   * The layer are available after the first loaded item.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {ViewLayer[]} The layers.\r\n   */\r\n  getViewLayersByDataId(dataId) {\r\n    return this.#stage.getViewLayersByDataId(dataId);\r\n  }\r\n\r\n  /**\r\n   * Get the draw layers associated to a data id.\r\n   * The layer are available after the first loaded item.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {DrawLayer[]} The layers.\r\n   */\r\n  getDrawLayersByDataId(dataId) {\r\n    return this.#stage.getDrawLayersByDataId(dataId);\r\n  }\r\n\r\n  /**\r\n   * Get a layer group by div id.\r\n   * The layer is available after the first loaded item.\r\n   *\r\n   * @param {string} divId The div id.\r\n   * @returns {LayerGroup} The layer group.\r\n   */\r\n  getLayerGroupByDivId(divId) {\r\n    return this.#stage.getLayerGroupByDivId(divId);\r\n  }\r\n\r\n  /**\r\n   * Get the number of layer groups.\r\n   *\r\n   * @returns {number} The number of groups.\r\n   */\r\n  getNumberOfLayerGroups() {\r\n    return this.#stage.getNumberOfLayerGroups();\r\n  }\r\n\r\n  /**\r\n   * Get the app style.\r\n   *\r\n   * @returns {object} The app style.\r\n   */\r\n  getStyle() {\r\n    return this.#style;\r\n  }\r\n\r\n  /**\r\n   * Add a command to the undo stack.\r\n   *\r\n   * @param {object} cmd The command to add.\r\n   * @fires UndoStack#undoadd\r\n   * @function\r\n   */\r\n  addToUndoStack = (cmd) => {\r\n    if (this.#undoStack !== null) {\r\n      this.#undoStack.add(cmd);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Initialise the application.\r\n   *\r\n   * @param {AppOptions} opt The application options\r\n   * @example\r\n   * // create the dwv app\r\n   * const app = new dwv.App();\r\n   * // initialise\r\n   * const viewConfig0 = new dwv.ViewConfig('layerGroup0');\r\n   * const viewConfigs = {'*': [viewConfig0]};\r\n   * const options = new dwv.AppOptions(viewConfigs);\r\n   * options.viewOnFirstLoadItem = false;\r\n   * app.init(options);\r\n   * // render button\r\n   * const button = document.createElement('button');\r\n   * button.id = 'render';\r\n   * button.disabled = true;\r\n   * button.appendChild(document.createTextNode('render'));\r\n   * document.body.appendChild(button);\r\n   * app.addEventListener('load', function () {\r\n   *   const button = document.getElementById('render');\r\n   *   button.disabled = false;\r\n   *   button.onclick = function () {\r\n   *     // render data #0\r\n   *     app.render(0);\r\n   *   };\r\n   * });\r\n   * // load dicom data\r\n   * app.loadURLs([\r\n   *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\r\n   * ]);\r\n   */\r\n  init(opt) {\r\n    // store\r\n    this.#options = opt;\r\n    // defaults\r\n    if (typeof this.#options.viewOnFirstLoadItem === 'undefined') {\r\n      this.#options.viewOnFirstLoadItem = true;\r\n    }\r\n    if (typeof this.#options.dataViewConfigs === 'undefined') {\r\n      this.#options.dataViewConfigs = {};\r\n    }\r\n\r\n    // undo stack\r\n    this.#undoStack = new UndoStack();\r\n    this.#undoStack.addEventListener('undoadd', this.#fireEvent);\r\n    this.#undoStack.addEventListener('undo', this.#fireEvent);\r\n    this.#undoStack.addEventListener('redo', this.#fireEvent);\r\n\r\n    // tools\r\n    if (typeof this.#options.tools !== 'undefined') {\r\n      // setup the tool list\r\n      const appToolList = {};\r\n      const keys = Object.keys(this.#options.tools);\r\n      for (let t = 0; t < keys.length; ++t) {\r\n        const toolName = keys[t];\r\n        // find the tool in the default tool list\r\n        let toolConstructor = defaultToolList[toolName];\r\n        // or use external one\r\n        if (typeof toolConstructor === 'undefined') {\r\n          toolConstructor = toolList[toolName];\r\n        }\r\n        if (typeof toolConstructor !== 'undefined') {\r\n          // create tool instance\r\n          appToolList[toolName] = new toolConstructor(this);\r\n          // register listeners\r\n          if (typeof appToolList[toolName].addEventListener !== 'undefined') {\r\n            const names = appToolList[toolName].getEventNames();\r\n            for (let j = 0; j < names.length; ++j) {\r\n              appToolList[toolName].addEventListener(names[j], this.#fireEvent);\r\n            }\r\n          }\r\n          // tool options\r\n          const toolParams = this.#options.tools[toolName];\r\n          if (typeof toolParams.options !== 'undefined' &&\r\n            toolParams.options.length !== 0) {\r\n            let type = 'raw';\r\n            if (typeof appToolList[toolName].getOptionsType !== 'undefined') {\r\n              type = appToolList[toolName].getOptionsType();\r\n            }\r\n            let appToolOptions;\r\n            if (type === 'instance' || type === 'factory') {\r\n              appToolOptions = {};\r\n              for (let i = 0; i < toolParams.options.length; ++i) {\r\n                const optionName = toolParams.options[i];\r\n                let optionClassName = optionName;\r\n                if (type === 'factory') {\r\n                  optionClassName += 'Factory';\r\n                }\r\n                const toolNamespace = toolName.charAt(0).toLowerCase() +\r\n                  toolName.slice(1);\r\n                if (typeof toolOptions[toolNamespace][optionClassName] !==\r\n                  'undefined') {\r\n                  appToolOptions[optionName] =\r\n                    toolOptions[toolNamespace][optionClassName];\r\n                } else {\r\n                  logger.warn('Could not find option class for: ' +\r\n                    optionName);\r\n                }\r\n              }\r\n            } else {\r\n              appToolOptions = toolParams.options;\r\n            }\r\n            appToolList[toolName].setOptions(appToolOptions);\r\n          }\r\n        } else {\r\n          logger.warn('Could not initialise unknown tool: ' + toolName);\r\n        }\r\n      }\r\n      // add tools to the controller\r\n      this.#toolboxController = new ToolboxController(appToolList);\r\n    }\r\n\r\n    // create load controller\r\n    this.#loadController =\r\n      new LoadController(this.#options.defaultCharacterSet);\r\n    this.#loadController.onloadstart = this.#onloadstart;\r\n    this.#loadController.onprogress = this.#onloadprogress;\r\n    this.#loadController.onloaditem = this.#onloaditem;\r\n    this.#loadController.onload = this.#onload;\r\n    this.#loadController.onloadend = this.#onloadend;\r\n    this.#loadController.onerror = this.#onloaderror;\r\n    this.#loadController.onabort = this.#onloadabort;\r\n\r\n    // create data controller\r\n    this.#dataController = new DataController();\r\n    // create stage\r\n    this.#stage = new Stage();\r\n    if (typeof this.#options.binders !== 'undefined') {\r\n      this.#stage.setBinders(this.#options.binders);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset the application.\r\n   */\r\n  reset() {\r\n    // clear objects\r\n    this.#dataController.reset();\r\n    this.#stage.empty();\r\n    this.#overlayDatas = {};\r\n    // reset undo/redo\r\n    if (this.#undoStack) {\r\n      this.#undoStack = new UndoStack();\r\n      this.#undoStack.addEventListener('undoadd', this.#fireEvent);\r\n      this.#undoStack.addEventListener('undo', this.#fireEvent);\r\n      this.#undoStack.addEventListener('redo', this.#fireEvent);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset the layout of the application.\r\n   */\r\n  resetLayout() {\r\n    this.#stage.reset();\r\n    this.#stage.draw();\r\n  }\r\n\r\n  /**\r\n   * Add an event listener to this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type, will be called with the fired event.\r\n   */\r\n  addEventListener(type, callback) {\r\n    this.#listenerHandler.add(type, callback);\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener from this class.\r\n   *\r\n   * @param {string} type The event type.\r\n   * @param {Function} callback The function associated with the provided\r\n   *   event type.\r\n   */\r\n  removeEventListener(type, callback) {\r\n    this.#listenerHandler.remove(type, callback);\r\n  }\r\n\r\n  // load API [begin] -------------------------------------------------------\r\n\r\n  /**\r\n   * Load a list of files. Can be image files or a state file.\r\n   *\r\n   * @param {File[]} files The list of files to load.\r\n   * @fires App#loadstart\r\n   * @fires App#loadprogress\r\n   * @fires App#loaditem\r\n   * @fires App#loadend\r\n   * @fires App#error\r\n   * @fires App#abort\r\n   * @function\r\n   */\r\n  loadFiles = (files) => {\r\n    // Get new data id\r\n    const dataId = this.#dataController.getNextDataId();\r\n    if (files.length === 0) {\r\n      logger.warn('Ignoring empty input file list.');\r\n      return;\r\n    }\r\n    this.#loadController.loadFiles(files, dataId);\r\n  };\r\n\r\n  /**\r\n   * Load a list of URLs. Can be image files or a state file.\r\n   *\r\n   * @param {string[]} urls The list of urls to load.\r\n   * @param {object} [options] The options object, can contain:\r\n   *  - requestHeaders: an array of {name, value} to use as request headers\r\n   *  - withCredentials: boolean xhr.withCredentials flag to pass to the request\r\n   *  - batchSize: the size of the request url batch\r\n   * @fires App#loadstart\r\n   * @fires App#loadprogress\r\n   * @fires App#loaditem\r\n   * @fires App#loadend\r\n   * @fires App#error\r\n   * @fires App#abort\r\n   * @function\r\n   */\r\n  loadURLs = (urls, options) => {\r\n    // Get new data id\r\n    const dataId = this.#dataController.getNextDataId();\r\n    if (urls.length === 0) {\r\n      logger.warn('Ignoring empty input url list.');\r\n      return;\r\n    }\r\n    this.#loadController.loadURLs(urls, dataId, options);\r\n  };\r\n\r\n  /**\r\n   * Load from an input uri.\r\n   *\r\n   * @param {string} uri The input uri, for example: 'window.location.href'.\r\n   * @param {object} [options] Optional url request options.\r\n   * @function\r\n   */\r\n  loadFromUri = (uri, options) => {\r\n    const query = getUriQuery(uri);\r\n\r\n    // load end callback: loads the state.\r\n    const onLoadEnd = (/*event*/) => {\r\n      this.removeEventListener('loadend', onLoadEnd);\r\n      this.loadURLs([query.state]);\r\n    };\r\n\r\n    // check query\r\n    if (query && typeof query.input !== 'undefined') {\r\n      // optional display state\r\n      if (typeof query.state !== 'undefined') {\r\n        // queue after main data load\r\n        this.addEventListener('loadend', onLoadEnd);\r\n      }\r\n      // load base image\r\n      decodeQuery(query, this.loadURLs, options);\r\n    }\r\n    // no else to allow for empty uris\r\n  };\r\n\r\n  /**\r\n   * Load a list of ArrayBuffers.\r\n   *\r\n   * @param {Array} data The list of ArrayBuffers to load\r\n   *   in the form of [{name: \"\", filename: \"\", data: data}].\r\n   * @fires App#loadstart\r\n   * @fires App#loadprogress\r\n   * @fires App#loaditem\r\n   * @fires App#loadend\r\n   * @fires App#error\r\n   * @fires App#abort\r\n   * @function\r\n   */\r\n  loadImageObject = (data) => {\r\n    // Get new data id\r\n    const dataId = this.#dataController.getNextDataId();\r\n    this.#loadController.loadImageObject(data, dataId);\r\n  };\r\n\r\n  /**\r\n   * Abort the current load.\r\n   */\r\n  abortLoad() {\r\n    this.#loadController.abort();\r\n  }\r\n\r\n  // load API [end] ---------------------------------------------------------\r\n\r\n  /**\r\n   * Fit the display to the data of each layer group.\r\n   * To be called once the image is loaded.\r\n   */\r\n  fitToContainer() {\r\n    this.#stage.syncLayerGroupScale();\r\n  }\r\n\r\n  /**\r\n   * Init the Window/Level display\r\n   */\r\n  initWLDisplay() {\r\n    const viewLayer = this.#stage.getActiveLayerGroup().getActiveViewLayer();\r\n    const controller = viewLayer.getViewController();\r\n    controller.initialise();\r\n  }\r\n\r\n  /**\r\n   * Set the imageSmoothing flag value. Default is false.\r\n   *\r\n   * @param {boolean} flag True to enable smoothing.\r\n   */\r\n  setImageSmoothing(flag) {\r\n    this.#stage.setImageSmoothing(flag);\r\n    this.#stage.draw();\r\n  }\r\n\r\n  /**\r\n   * Get the layer group configuration from a data id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {boolean} [excludeStarConfig] Exclude the star config\r\n   *  (default to false).\r\n   * @returns {ViewConfig[]} The list of associated configs.\r\n   */\r\n  getViewConfigs(dataId, excludeStarConfig) {\r\n    // check options\r\n    if (this.#options.dataViewConfigs === null ||\r\n      typeof this.#options.dataViewConfigs === 'undefined') {\r\n      throw new Error('No available data view configuration');\r\n    }\r\n    let configs = [];\r\n    if (typeof this.#options.dataViewConfigs[dataId] !== 'undefined') {\r\n      configs = this.#options.dataViewConfigs[dataId];\r\n    } else if (!excludeStarConfig &&\r\n      typeof this.#options.dataViewConfigs['*'] !== 'undefined') {\r\n      configs = this.#options.dataViewConfigs['*'];\r\n    }\r\n    return configs;\r\n  }\r\n\r\n  /**\r\n   * Get the layer group configuration for a data id and group\r\n   * div id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {string} groupDivId The layer group div id.\r\n   * @param {boolean} [excludeStarConfig] Exclude the star config\r\n   *  (default to false).\r\n   * @returns {ViewConfig|undefined} The associated config.\r\n   */\r\n  getViewConfig(dataId, groupDivId, excludeStarConfig) {\r\n    const configs = this.getViewConfigs(dataId, excludeStarConfig);\r\n    return configs.find(function (item) {\r\n      return item.divId === groupDivId;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the data view config.\r\n   * Carefull, returns a reference, do not modify without resetting.\r\n   *\r\n   * @returns {Object<string, ViewConfig[]>} The configuration list.\r\n   */\r\n  getDataViewConfigs() {\r\n    return this.#options.dataViewConfigs;\r\n  }\r\n\r\n  /**\r\n   * Set the data view configuration.\r\n   * Resets the stage and recreates all the views.\r\n   *\r\n   * @param {Object<string, ViewConfig[]>} configs The configuration list.\r\n   */\r\n  setDataViewConfigs(configs) {\r\n    // clean up\r\n    this.#stage.empty();\r\n    // set new\r\n    this.#options.dataViewConfigs = configs;\r\n    // create layer groups\r\n    this.#createLayerGroups(configs);\r\n  }\r\n\r\n  /**\r\n   * Add a data view config.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {ViewConfig} config The view configuration.\r\n   */\r\n  addDataViewConfig(dataId, config) {\r\n    // add to list\r\n    const configs = this.#options.dataViewConfigs;\r\n    if (typeof configs[dataId] === 'undefined') {\r\n      configs[dataId] = [];\r\n    }\r\n    const equalDivId = function (item) {\r\n      return item.divId === config.divId;\r\n    };\r\n    const itemIndex = configs[dataId].findIndex(equalDivId);\r\n    if (itemIndex === -1) {\r\n      this.#options.dataViewConfigs[dataId].push(config);\r\n    } else {\r\n      throw new Error('Duplicate view config for data ' + dataId +\r\n        ' and div ' + config.divId);\r\n    }\r\n\r\n    // add layer group if not done\r\n    if (typeof this.#stage.getLayerGroupByDivId(config.divId) === 'undefined') {\r\n      this.#createLayerGroup(config);\r\n    }\r\n\r\n    // render (will create layers)\r\n    this.render(dataId, [config]);\r\n  }\r\n\r\n  /**\r\n   * Remove a data view config.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {ViewConfig} config The view configuration.\r\n   */\r\n  removeDataViewConfig(dataId, config) {\r\n    // remove from list\r\n    const configs = this.#options.dataViewConfigs;\r\n    if (typeof configs[dataId] === 'undefined') {\r\n      // no config for dataId\r\n      return;\r\n    }\r\n    const equalDivId = function (item) {\r\n      return item.divId === config.divId;\r\n    };\r\n    const itemIndex = configs[dataId].findIndex(equalDivId);\r\n    if (itemIndex === -1) {\r\n      // no config for divId\r\n      return;\r\n    }\r\n    configs[dataId].splice(itemIndex, 1);\r\n    if (configs[dataId].length === 0) {\r\n      delete configs[dataId];\r\n    }\r\n\r\n    // data is loaded, remove view\r\n    if (typeof this.#dataController.get(dataId) !== 'undefined') {\r\n      const lg = this.#stage.getLayerGroupByDivId(config.divId);\r\n      if (typeof lg !== 'undefined') {\r\n        const vls = lg.getViewLayersByDataId(dataId);\r\n        if (vls.length === 1) {\r\n          lg.removeLayer(vls[0]);\r\n        } else {\r\n          throw new Error('Expected one view layer, got ' + vls.length);\r\n        }\r\n        const dls = lg.getDrawLayersByDataId(dataId);\r\n        if (dls.length === 1) {\r\n          lg.removeLayer(dls[0]);\r\n        } else {\r\n          throw new Error('Expected one draw layer, got ' + dls.length);\r\n        }\r\n        if (lg.getNumberOfLayers() === 0) {\r\n          this.#stage.removeLayerGroup(lg);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update an existing data view config.\r\n   * Removes and re-creates the layer if found.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {string} divId The div id.\r\n   * @param {ViewConfig} config The view configuration.\r\n   */\r\n  updateDataViewConfig(dataId, divId, config) {\r\n    const configs = this.#options.dataViewConfigs;\r\n    // check data id\r\n    if (typeof configs[dataId] === 'undefined') {\r\n      throw new Error('No config for dataId: ' + dataId);\r\n    }\r\n    // check div id\r\n    const equalDivId = function (item) {\r\n      return item.divId === divId;\r\n    };\r\n    const itemIndex = configs[dataId].findIndex(equalDivId);\r\n    if (itemIndex === -1) {\r\n      throw new Error('No config for dataId: ' +\r\n        dataId + ' and divId: ' + divId);\r\n    }\r\n    // update config\r\n    const configToUpdate = configs[dataId][itemIndex];\r\n    for (const prop in config) {\r\n      configToUpdate[prop] = config[prop];\r\n    }\r\n\r\n    // remove previous layers\r\n    const lg = this.#stage.getLayerGroupByDivId(configToUpdate.divId);\r\n    if (typeof lg !== 'undefined') {\r\n      const vls = lg.getViewLayersByDataId(dataId);\r\n      if (vls.length === 1) {\r\n        lg.removeLayer(vls[0]);\r\n      } else {\r\n        throw new Error('Expected one view layer, got ' + vls.length);\r\n      }\r\n      const dls = lg.getDrawLayersByDataId(dataId);\r\n      if (dls.length === 1) {\r\n        lg.removeLayer(dls[0]);\r\n      } else {\r\n        throw new Error('Expected one draw layer, got ' + dls.length);\r\n      }\r\n    }\r\n\r\n    // render (will create layer)\r\n    this.render(dataId, [configToUpdate]);\r\n  }\r\n\r\n  /**\r\n   * Create layer groups according to a data view config:\r\n   * adds them to stage and binds them.\r\n   *\r\n   * @param {DataViewConfigs} dataViewConfigs The data view config.\r\n   */\r\n  #createLayerGroups(dataViewConfigs) {\r\n    const dataKeys = Object.keys(dataViewConfigs);\r\n    const divIds = [];\r\n    for (let i = 0; i < dataKeys.length; ++i) {\r\n      const viewConfigs = dataViewConfigs[dataKeys[i]];\r\n      for (let j = 0; j < viewConfigs.length; ++j) {\r\n        const viewConfig = viewConfigs[j];\r\n        // view configs can contain the same divIds, avoid duplicating\r\n        if (!divIds.includes(viewConfig.divId)) {\r\n          this.#createLayerGroup(viewConfig);\r\n          divIds.push(viewConfig.divId);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a layer group according to a view config:\r\n   * adds it to stage and binds it.\r\n   *\r\n   * @param {ViewConfig} viewConfig The view config.\r\n   */\r\n  #createLayerGroup(viewConfig) {\r\n    // create new layer group\r\n    const element = document.getElementById(viewConfig.divId);\r\n    const layerGroup = this.#stage.addLayerGroup(element);\r\n    // bind events\r\n    this.#bindLayerGroupToApp(layerGroup);\r\n  }\r\n\r\n  /**\r\n   * Set the layer groups binders.\r\n   *\r\n   * @param {Array} list The list of binder names.\r\n   */\r\n  setLayerGroupsBinders(list) {\r\n    // create instances\r\n    const instances = [];\r\n    for (let i = 0; i < list.length; ++i) {\r\n      if (typeof binderList[list[i]] !== 'undefined') {\r\n        instances.push(new binderList[list[i]]);\r\n      }\r\n    }\r\n    // pass to stage\r\n    this.#stage.setBinders(instances);\r\n  }\r\n\r\n  /**\r\n   * Render the current data.\r\n   *\r\n   * @param {string} dataId The data id to render.\r\n   * @param {ViewConfig[]} [viewConfigs] The list of configs to render.\r\n   */\r\n  render(dataId, viewConfigs) {\r\n    if (typeof dataId === 'undefined' || dataId === null) {\r\n      throw new Error('Cannot render without data id');\r\n    }\r\n\r\n    // create layer groups if not done yet\r\n    // (create all to allow for ratio sync)\r\n    if (this.#stage.getNumberOfLayerGroups() === 0) {\r\n      this.#createLayerGroups(this.#options.dataViewConfigs);\r\n    }\r\n\r\n    // use options list if non provided\r\n    if (typeof viewConfigs === 'undefined') {\r\n      viewConfigs = this.getViewConfigs(dataId);\r\n    }\r\n\r\n    // nothing to do if no view config\r\n    if (viewConfigs.length === 0) {\r\n      logger.info('Not rendering data: ' + dataId +\r\n        ' (no data view config)');\r\n      return;\r\n    }\r\n\r\n    // loop on configs\r\n    for (let i = 0; i < viewConfigs.length; ++i) {\r\n      const config = viewConfigs[i];\r\n      const layerGroup =\r\n        this.#stage.getLayerGroupByDivId(config.divId);\r\n      // layer group must exist\r\n      if (!layerGroup) {\r\n        throw new Error('No layer group for ' + config.divId);\r\n      }\r\n      // add view\r\n      // warn: needs a loaded DOM\r\n      if (typeof this.#dataController.get(dataId) !== 'undefined' &&\r\n        layerGroup.getViewLayersByDataId(dataId).length === 0) {\r\n        this.#addViewLayer(dataId, config);\r\n      }\r\n      // draw\r\n      layerGroup.draw();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Zoom to the layers.\r\n   *\r\n   * @param {number} step The step to add to the current zoom.\r\n   * @param {number} cx The zoom center X coordinate.\r\n   * @param {number} cy The zoom center Y coordinate.\r\n   */\r\n  zoom(step, cx, cy) {\r\n    const layerGroup = this.#stage.getActiveLayerGroup();\r\n    const viewController = layerGroup.getActiveViewLayer().getViewController();\r\n    const k = viewController.getCurrentScrollPosition();\r\n    const center = new Point3D(cx, cy, k);\r\n    layerGroup.addScale(step, center);\r\n    layerGroup.draw();\r\n  }\r\n\r\n  /**\r\n   * Apply a translation to the layers.\r\n   *\r\n   * @param {number} tx The translation along X.\r\n   * @param {number} ty The translation along Y.\r\n   */\r\n  translate(tx, ty) {\r\n    const layerGroup = this.#stage.getActiveLayerGroup();\r\n    layerGroup.addTranslation({x: tx, y: ty});\r\n    layerGroup.draw();\r\n  }\r\n\r\n  /**\r\n   * Set the image layer opacity.\r\n   *\r\n   * @param {number} alpha The opacity ([0:1] range).\r\n   */\r\n  setOpacity(alpha) {\r\n    const viewLayer = this.#stage.getActiveLayerGroup().getActiveViewLayer();\r\n    viewLayer.setOpacity(alpha);\r\n    viewLayer.draw();\r\n  }\r\n\r\n  /**\r\n   * Set the drawings on the current stage.\r\n   *\r\n   * @param {Array} drawings An array of drawings.\r\n   * @param {Array} drawingsDetails An array of drawings details.\r\n   */\r\n  setDrawings(drawings, drawingsDetails) {\r\n    const layerGroup = this.#stage.getActiveLayerGroup();\r\n    const viewController =\r\n      layerGroup.getActiveViewLayer().getViewController();\r\n    const drawController =\r\n      layerGroup.getActiveDrawLayer().getDrawController();\r\n\r\n    drawController.setDrawings(\r\n      drawings, drawingsDetails, this.#fireEvent, this.addToUndoStack);\r\n\r\n    drawController.activateDrawLayer(\r\n      viewController.getCurrentOrientedIndex(),\r\n      viewController.getScrollIndex());\r\n  }\r\n\r\n  /**\r\n   * Get the JSON state of the app.\r\n   *\r\n   * @returns {string} The state of the app as a JSON string.\r\n   */\r\n  getJsonState() {\r\n    const state = new State();\r\n    return state.toJSON(this);\r\n  }\r\n\r\n  /**\r\n   * Apply a JSON state to this app.\r\n   *\r\n   * @param {string} jsonState The state of the app as a JSON string.\r\n   */\r\n  applyJsonState(jsonState) {\r\n    const state = new State();\r\n    state.apply(this, state.fromJSON(jsonState));\r\n  }\r\n\r\n  // Handler Methods -----------------------------------------------------------\r\n\r\n  /**\r\n   * Handle resize: fit the display to the window.\r\n   * To be called once the image is loaded.\r\n   * Can be connected to a window 'resize' event.\r\n   *\r\n   * @function\r\n   */\r\n  onResize = () => {\r\n    this.fitToContainer();\r\n  };\r\n\r\n  /**\r\n   * Key down callback. Meant to be used in tools.\r\n   *\r\n   * @param {KeyboardEvent} event The key down event.\r\n   * @fires App#keydown\r\n   * @function\r\n   */\r\n  onKeydown = (event) => {\r\n    /**\r\n     * Key down event.\r\n     *\r\n     * @event App#keydown\r\n     * @type {KeyboardEvent}\r\n     * @property {string} type The event type: keydown.\r\n     * @property {string} context The tool where the event originated.\r\n     */\r\n    this.#fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Key down event handler example.\r\n   * - CRTL-Z: undo\r\n   * - CRTL-Y: redo\r\n   * - CRTL-ARROW_LEFT: next element on fourth dim\r\n   * - CRTL-ARROW_UP: next element on third dim\r\n   * - CRTL-ARROW_RIGHT: previous element on fourth dim\r\n   * - CRTL-ARROW_DOWN: previous element on third dim\r\n   *\r\n   * @param {KeyboardEvent} event The key down event.\r\n   * @fires UndoStack#undo\r\n   * @fires UndoStack#redo\r\n   * @function\r\n   */\r\n  defaultOnKeydown = (event) => {\r\n    if (event.ctrlKey) {\r\n      if (event.shiftKey) {\r\n        const viewController =\r\n          this.#stage.getActiveLayerGroup()\r\n            .getActiveViewLayer().getViewController();\r\n        const size = viewController.getImageSize();\r\n        if (event.key === 'ArrowLeft') { // crtl-shift-arrow-left\r\n          if (size.moreThanOne(3)) {\r\n            viewController.decrementIndex(3);\r\n          }\r\n        } else if (event.key === 'ArrowUp') { // crtl-shift-arrow-up\r\n          if (viewController.canScroll()) {\r\n            viewController.incrementScrollIndex();\r\n          }\r\n        } else if (event.key === 'ArrowRight') { // crtl-shift-arrow-right\r\n          if (size.moreThanOne(3)) {\r\n            viewController.incrementIndex(3);\r\n          }\r\n        } else if (event.key === 'ArrowDown') { // crtl-shift-arrow-down\r\n          if (viewController.canScroll()) {\r\n            viewController.decrementScrollIndex();\r\n          }\r\n        }\r\n      } else if (event.key === 'y') { // crtl-y\r\n        this.#undoStack.redo();\r\n      } else if (event.key === 'z') { // crtl-z\r\n        this.#undoStack.undo();\r\n      } else if (event.key === ' ') { // crtl-space\r\n        for (let i = 0; i < this.#stage.getNumberOfLayerGroups(); ++i) {\r\n          this.#stage.getLayerGroup(i).setShowCrosshair(\r\n            !this.#stage.getLayerGroup(i).getShowCrosshair()\r\n          );\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  // Internal members shortcuts-----------------------------------------------\r\n\r\n  /**\r\n   * Reset the display\r\n   */\r\n  resetDisplay() {\r\n    this.resetLayout();\r\n    this.initWLDisplay();\r\n  }\r\n\r\n  /**\r\n   * Reset the app zoom.s\r\n   */\r\n  resetZoom() {\r\n    this.resetLayout();\r\n  }\r\n\r\n  /**\r\n   * Set the colour map.\r\n   *\r\n   * @param {string} name The colour map name.\r\n   */\r\n  setColourMap(name) {\r\n    const viewController =\r\n      this.#stage.getActiveLayerGroup()\r\n        .getActiveViewLayer().getViewController();\r\n    viewController.setColourMap(name);\r\n  }\r\n\r\n  /**\r\n   * Set the window/level preset.\r\n   *\r\n   * @param {string} preset The window/level preset.\r\n   */\r\n  setWindowLevelPreset(preset) {\r\n    const viewController =\r\n      this.#stage.getActiveLayerGroup()\r\n        .getActiveViewLayer().getViewController();\r\n    viewController.setWindowLevelPreset(preset);\r\n  }\r\n\r\n  /**\r\n   * Set the tool\r\n   *\r\n   * @param {object} toolObject containing the name of the tool and the corresponding parent component update function.\r\n   */\r\n  setTool(toolObject) {\r\n    // bind tool to active layer\r\n    for (let i = 0; i < this.#stage.getNumberOfLayerGroups(); ++i) {\r\n      const layerGroup = this.#stage.getLayerGroup(i);\r\n      // draw or view layer\r\n      let layer = null;\r\n      let tool = toolObject.tool;\r\n      if (tool === 'Draw' ||\r\n        tool === 'Livewire' ||\r\n        tool === 'Floodfill') {\r\n        layer = layerGroup.getActiveDrawLayer();\r\n      } else {\r\n        layer = layerGroup.getActiveViewLayer();\r\n      }\r\n      if (layer) {\r\n        this.#toolboxController.bindLayerGroup(layerGroup, layer);\r\n      }\r\n    }\r\n\r\n    if(toolObject.hasOwnProperty(\"updateParent\") && toolObject.updateParent) {\r\n      this.setUpdateParent(toolObject.updateParent);\r\n    }\r\n\r\n    // set toolbox tool\r\n    this.#toolboxController.setSelectedTool(toolObject.tool);\r\n  }\r\n\r\n  /**\r\n   * Set the tool live features.\r\n   *\r\n   * @param {object} list The list of features.\r\n   */\r\n  setToolFeatures(list) {\r\n    this.#toolboxController.setToolFeatures(list);\r\n  }\r\n\r\n  /**\r\n   * Get the current parent component update function.\r\n   *\r\n   */\r\n  getUpdateParent() {\r\n    return this.#updateParent;\r\n  }\r\n\r\n  /**\r\n   * Set the parent component update function.\r\n   *\r\n   * @param {function} updateParent The list of features.\r\n   */\r\n  setUpdateParent(updateParent) {\r\n    this.#updateParent = updateParent;\r\n  }\r\n\r\n  getDatabaseObjects() {\r\n    return this.#databaseObjects;\r\n  }\r\n\r\n  setDatabaseObjects(databaseObjects) {\r\n    this.#databaseObjects = databaseObjects;\r\n  }\r\n\r\n  populateDatabaseObjects() {\r\n\r\n  }\r\n\r\n  /**\r\n   * Undo the last action\r\n   *\r\n   * @fires UndoStack#undo\r\n   */\r\n  undo() {\r\n    this.#undoStack.undo();\r\n  }\r\n\r\n  /**\r\n   * Redo the last action\r\n   *\r\n   * @fires UndoStack#redo\r\n   */\r\n  redo() {\r\n    this.#undoStack.redo();\r\n  }\r\n\r\n  /**\r\n   * Get the undo stack size.\r\n   *\r\n   * @returns {number} The size of the stack.\r\n   */\r\n  getStackSize() {\r\n    return this.#undoStack.getStackSize();\r\n  }\r\n\r\n  /**\r\n   * Get the current undo stack index.\r\n   *\r\n   * @returns {number} The stack index.\r\n   */\r\n  getCurrentStackIndex() {\r\n    return this.#undoStack.getCurrentStackIndex();\r\n  }\r\n\r\n  /**\r\n   * Get the overlay data for a data id.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @returns {OverlayData|undefined} The overlay data.\r\n   */\r\n  getOverlayData(dataId) {\r\n    let data;\r\n    if (typeof this.#overlayDatas !== 'undefined') {\r\n      data = this.#overlayDatas[dataId];\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Toggle overlay listeners.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   */\r\n  toggleOverlayListeners(dataId) {\r\n    const data = this.getOverlayData(dataId);\r\n    if (typeof data !== 'undefined') {\r\n      if (data.isListening()) {\r\n        data.removeAppListeners();\r\n      } else {\r\n        data.addAppListeners();\r\n      }\r\n    }\r\n  }\r\n\r\n  // Private Methods -----------------------------------------------------------\r\n\r\n  /**\r\n   * Fire an event: call all associated listeners with the input event object.\r\n   *\r\n   * @param {object} event The event to fire.\r\n   */\r\n  #fireEvent = (event) => {\r\n    this.#listenerHandler.fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Data load start callback.\r\n   *\r\n   * @param {object} event The load start event.\r\n   */\r\n  #onloadstart = (event) => {\r\n    // create overlay data\r\n    if (typeof this.#options.overlayConfig !== 'undefined') {\r\n      this.#overlayDatas[event.dataid] = new OverlayData(\r\n        this, event.dataid, this.#options.overlayConfig);\r\n    }\r\n    /**\r\n     * Load start event.\r\n     *\r\n     * @event App#loadstart\r\n     * @type {object}\r\n     * @property {string} type The event type: loadstart.\r\n     * @property {string} loadType The load type: image or state.\r\n     * @property {*} source The load source: string for an url,\r\n     *   File for a file.\r\n     */\r\n    event.type = 'loadstart';\r\n    this.#fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Data load progress callback.\r\n   *\r\n   * @param {object} event The progress event.\r\n   */\r\n  #onloadprogress = (event) => {\r\n    /**\r\n     * Load progress event.\r\n     *\r\n     * @event App#loadprogress\r\n     * @type {object}\r\n     * @property {string} type The event type: loadprogress.\r\n     * @property {string} loadType The load type: image or state.\r\n     * @property {*} source The load source: string for an url,\r\n     *   File for a file.\r\n     * @property {number} loaded The loaded percentage.\r\n     * @property {number} total The total percentage.\r\n     */\r\n    event.type = 'loadprogress';\r\n    this.#fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Data load callback.\r\n   *\r\n   * @param {object} event The load event.\r\n   */\r\n  #onloaditem = (event) => {\r\n    // check event\r\n    if (typeof event.data === 'undefined') {\r\n      logger.error('Missing loaditem event data.');\r\n    }\r\n    if (typeof event.loadtype === 'undefined') {\r\n      logger.error('Missing loaditem event load type.');\r\n    }\r\n\r\n    const isFirstLoadItem = event.isfirstitem;\r\n\r\n    let eventMetaData = null;\r\n    if (event.loadtype === 'image') {\r\n      if (isFirstLoadItem) {\r\n        this.#dataController.addNew(\r\n          event.dataid, event.data.image, event.data.info);\r\n      } else {\r\n        this.#dataController.update(\r\n          event.dataid, event.data.image, event.data.info);\r\n      }\r\n      eventMetaData = event.data.info;\r\n    } else if (event.loadtype === 'state') {\r\n      this.applyJsonState(event.data);\r\n      eventMetaData = 'state';\r\n    }\r\n\r\n    /**\r\n     * Load item event: fired when a load item is successfull.\r\n     *\r\n     * @event App#loaditem\r\n     * @type {object}\r\n     * @property {string} type The event type: loaditem.\r\n     * @property {string} loadType The load type: image or state.\r\n     * @property {*} source The load source: string for an url,\r\n     *   File for a file.\r\n     * @property {object} data The loaded meta data.\r\n     */\r\n    this.#fireEvent({\r\n      type: 'loaditem',\r\n      data: eventMetaData,\r\n      source: event.source,\r\n      loadtype: event.loadtype,\r\n      dataid: event.dataid,\r\n      isfirstitem: event.isfirstitem,\r\n      warn: event.warn\r\n    });\r\n\r\n    // update overlay data if present\r\n    if (typeof this.#overlayDatas !== 'undefined' &&\r\n      typeof this.#overlayDatas[event.dataid] !== 'undefined') {\r\n      this.#overlayDatas[event.dataid].addItemMeta(eventMetaData);\r\n    }\r\n\r\n    // render if first and flag allows\r\n    if (event.loadtype === 'image' &&\r\n      this.getViewConfigs(event.dataid).length !== 0 &&\r\n      isFirstLoadItem && this.#options.viewOnFirstLoadItem) {\r\n      this.render(event.dataid);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Data load callback.\r\n   *\r\n   * @param {object} event The load event.\r\n   */\r\n  #onload = (event) => {\r\n    /**\r\n     * Load event: fired when a load finishes successfully.\r\n     *\r\n     * @event App#load\r\n     * @type {object}\r\n     * @property {string} type The event type: load.\r\n     * @property {string} loadType The load type: image or state.\r\n     */\r\n    event.type = 'load';\r\n    this.#fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Data load end callback.\r\n   *\r\n   * @param {object} event The load end event.\r\n   */\r\n  #onloadend = (event) => {\r\n    /**\r\n     * Main load end event: fired when the load finishes,\r\n     *   successfully or not.\r\n     *\r\n     * @event App#loadend\r\n     * @type {object}\r\n     * @property {string} type The event type: loadend.\r\n     * @property {string} loadType The load type: image or state.\r\n     * @property {*} source The load source: string for an url,\r\n     *   File for a file.\r\n     */\r\n    event.type = 'loadend';\r\n    this.#fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Data load error callback.\r\n   *\r\n   * @param {object} event The error event.\r\n   */\r\n  #onloaderror = (event) => {\r\n    /**\r\n     * Load error event.\r\n     *\r\n     * @event App#error\r\n     * @type {object}\r\n     * @property {string} type The event type: error.\r\n     * @property {string} loadType The load type: image or state.\r\n     * @property {*} source The load source: string for an url,\r\n     *   File for a file.\r\n     * @property {object} error The error.\r\n     * @property {object} target The event target.\r\n     */\r\n    if (typeof event.type === 'undefined') {\r\n      event.type = 'error';\r\n    }\r\n    this.#fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Data load abort callback.\r\n   *\r\n   * @param {object} event The abort event.\r\n   */\r\n  #onloadabort = (event) => {\r\n    /**\r\n     * Load abort event.\r\n     *\r\n     * @event App#abort\r\n     * @type {object}\r\n     * @property {string} type The event type: abort.\r\n     * @property {string} loadType The load type: image or state.\r\n     * @property {*} source The load source: string for an url,\r\n     *   File for a file.\r\n     */\r\n    if (typeof event.type === 'undefined') {\r\n      event.type = 'abort';\r\n    }\r\n    this.#fireEvent(event);\r\n  };\r\n\r\n  /**\r\n   * Bind layer group events to app.\r\n   *\r\n   * @param {object} group The layer group.\r\n   */\r\n  #bindLayerGroupToApp(group) {\r\n    // propagate layer group events\r\n    group.addEventListener('zoomchange', this.#fireEvent);\r\n    group.addEventListener('offsetchange', this.#fireEvent);\r\n    // propagate viewLayer events\r\n    group.addEventListener('renderstart', this.#fireEvent);\r\n    group.addEventListener('renderend', this.#fireEvent);\r\n    // propagate view events\r\n    for (let j = 0; j < viewEventNames.length; ++j) {\r\n      group.addEventListener(viewEventNames[j], this.#fireEvent);\r\n    }\r\n    // propagate drawLayer events\r\n    if (this.#toolboxController && this.#toolboxController.hasTool('Draw')) {\r\n      group.addEventListener('drawcreate', this.#fireEvent);\r\n      group.addEventListener('drawdelete', this.#fireEvent);\r\n    }\r\n    // updata data view config\r\n    group.addEventListener('wlchange', (event) => {\r\n      const layerDetails = getLayerDetailsFromLayerDivId(event.srclayerid);\r\n      const groupId = layerDetails.groupDivId;\r\n      const config = this.getViewConfig(event.dataid, groupId, true);\r\n      if (typeof config !== 'undefined') {\r\n        config.windowCenter = event.value[0];\r\n        config.windowWidth = event.value[1];\r\n      }\r\n    });\r\n    group.addEventListener('opacitychange', (event) => {\r\n      const layerDetails = getLayerDetailsFromLayerDivId(event.srclayerid);\r\n      const groupId = layerDetails.groupDivId;\r\n      const config = this.getViewConfig(event.dataid, groupId, true);\r\n      if (typeof config !== 'undefined') {\r\n        config.opacity = event.value[0];\r\n      }\r\n    });\r\n    group.addEventListener('colourmapchange', (event) => {\r\n      const layerDetails = getLayerDetailsFromLayerDivId(event.srclayerid);\r\n      const groupId = layerDetails.groupDivId;\r\n      const config = this.getViewConfig(event.dataid, groupId, true);\r\n      if (typeof config !== 'undefined') {\r\n        config.colourMap = event.value[0];\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add a view layer.\r\n   *\r\n   * @param {string} dataId The data id.\r\n   * @param {ViewConfig} viewConfig The data view config.\r\n   */\r\n  #addViewLayer(dataId, viewConfig) {\r\n    const data = this.#dataController.get(dataId);\r\n    if (!data) {\r\n      throw new Error('Cannot initialise layer with missing data, id: ' +\r\n      dataId);\r\n    }\r\n    const layerGroup = this.#stage.getLayerGroupByDivId(viewConfig.divId);\r\n    if (!layerGroup) {\r\n      throw new Error('Cannot initialise layer with missing group, id: ' +\r\n        viewConfig.divId);\r\n    }\r\n    const imageGeometry = data.image.getGeometry();\r\n\r\n    // un-bind\r\n    this.#stage.unbindLayerGroups();\r\n\r\n    // create and setup view\r\n    const viewFactory = new ViewFactory();\r\n    const view = viewFactory.create(data.meta, data.image);\r\n    const viewOrientation = getViewOrientation(\r\n      imageGeometry.getOrientation(),\r\n      getMatrixFromName(viewConfig.orientation)\r\n    );\r\n    view.setOrientation(viewOrientation);\r\n\r\n    // make pixel of value 0 transparent for segmentation\r\n    // (assuming RGB data)\r\n    if (data.image.getMeta().Modality === 'SEG') {\r\n      view.setAlphaFunction(function (value /*, index*/) {\r\n        if (value[0] === 0 &&\r\n          value[1] === 0 &&\r\n          value[2] === 0) {\r\n          return 0;\r\n        } else {\r\n          return 0xff;\r\n        }\r\n      });\r\n    }\r\n\r\n    // do we have more than one layer\r\n    // (the layer has not been added to the layer group yet)\r\n    const isBaseLayer = layerGroup.getNumberOfLayers() === 0;\r\n\r\n    // opacity\r\n    let opacity = 1;\r\n    if (typeof viewConfig.opacity !== 'undefined') {\r\n      opacity = viewConfig.opacity;\r\n    } else {\r\n      if (!isBaseLayer) {\r\n        opacity = 0.5;\r\n      }\r\n    }\r\n\r\n    // view layer\r\n    const viewLayer = layerGroup.addViewLayer();\r\n    viewLayer.setView(view, dataId);\r\n    const size2D = imageGeometry.getSize(viewOrientation).get2D();\r\n    const spacing2D = imageGeometry.getSpacing(viewOrientation).get2D();\r\n    viewLayer.initialise(size2D, spacing2D, opacity);\r\n\r\n    // view controller\r\n    const viewController = viewLayer.getViewController();\r\n    // window/level\r\n    if (typeof viewConfig.windowCenter !== 'undefined' &&\r\n      typeof viewConfig.windowWidth !== 'undefined') {\r\n      const wl = new WindowLevel(\r\n        viewConfig.windowCenter, viewConfig.windowWidth);\r\n      viewController.setWindowLevel(wl);\r\n    }\r\n    // colour map\r\n    if (typeof viewConfig.colourMap !== 'undefined') {\r\n      viewController.setColourMap(viewConfig.colourMap);\r\n    } else {\r\n      if (!isBaseLayer) {\r\n        if (data.image.getMeta().Modality === 'PT') {\r\n          viewController.setColourMap('hot');\r\n        } else {\r\n          viewController.setColourMap('rainbow');\r\n        }\r\n      }\r\n    }\r\n\r\n    // listen to controller events\r\n    if (data.image.getMeta().Modality === 'SEG') {\r\n      viewController.addEventListener('masksegmentdelete', this.#fireEvent);\r\n      viewController.addEventListener('masksegmentredraw', this.#fireEvent);\r\n    }\r\n\r\n    // listen to image changes\r\n    this.#dataController.addEventListener('imageset', viewLayer.onimageset);\r\n    this.#dataController.addEventListener('imagechange', (event) => {\r\n      viewLayer.onimagechange(event);\r\n      this.render(event.dataid);\r\n    });\r\n\r\n    // optional draw layer\r\n    let drawLayer;\r\n    if (this.#toolboxController && this.#toolboxController.hasTool('Draw')) {\r\n      drawLayer = layerGroup.addDrawLayer();\r\n      drawLayer.initialise(size2D, spacing2D, dataId);\r\n      drawLayer.setPlaneHelper(viewLayer.getViewController().getPlaneHelper());\r\n    }\r\n\r\n    // sync layers position\r\n    const value = [\r\n      viewController.getCurrentIndex().getValues(),\r\n      viewController.getCurrentPosition().getValues()\r\n    ];\r\n    layerGroup.updateLayersToPositionChange({\r\n      value: value,\r\n      srclayerid: viewLayer.getId()\r\n    });\r\n\r\n    // sync layer groups\r\n    this.#stage.syncLayerGroupScale();\r\n\r\n    // view layer offset (done before scale)\r\n    viewLayer.setOffset(layerGroup.getOffset());\r\n\r\n    // get and apply flip flags\r\n    const flipFlags = this.#getViewFlipFlags(\r\n      imageGeometry.getOrientation(),\r\n      viewConfig.orientation);\r\n    if (flipFlags.offset.x) {\r\n      viewLayer.addFlipOffsetX();\r\n      if (typeof drawLayer !== 'undefined') {\r\n        drawLayer.addFlipOffsetX();\r\n      }\r\n    }\r\n    if (flipFlags.offset.y) {\r\n      viewLayer.addFlipOffsetY();\r\n      if (typeof drawLayer !== 'undefined') {\r\n        drawLayer.addFlipOffsetY();\r\n      }\r\n    }\r\n    if (flipFlags.scale.x) {\r\n      viewLayer.flipScaleX();\r\n      if (typeof drawLayer !== 'undefined') {\r\n        drawLayer.flipScaleX();\r\n      }\r\n    }\r\n    if (flipFlags.scale.y) {\r\n      viewLayer.flipScaleY();\r\n      if (typeof drawLayer !== 'undefined') {\r\n        drawLayer.flipScaleY();\r\n      }\r\n    }\r\n    if (flipFlags.scale.z) {\r\n      viewLayer.flipScaleZ();\r\n      if (typeof drawLayer !== 'undefined') {\r\n        drawLayer.flipScaleZ();\r\n      }\r\n    }\r\n\r\n    // layer scale (done after possible flip)\r\n    viewLayer.setScale(layerGroup.getScale());\r\n    if (typeof drawLayer !== 'undefined') {\r\n      drawLayer.setScale(layerGroup.getScale());\r\n    }\r\n\r\n    // bind\r\n    this.#stage.bindLayerGroups();\r\n    if (this.#toolboxController) {\r\n      this.#toolboxController.bindLayerGroup(layerGroup, viewLayer);\r\n    }\r\n\r\n    // initialise the toolbox for base\r\n    if (isBaseLayer) {\r\n      if (this.#toolboxController) {\r\n        this.#toolboxController.init();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the view flip flags: offset (x, y) and scale (x, y, z) flags.\r\n   *\r\n   * @param {Matrix33} imageOrientation The image orientation.\r\n   * @param {string} viewConfigOrientation The view config orientation.\r\n   * @returns {object} Offset and scale flip flags.\r\n   */\r\n  #getViewFlipFlags(imageOrientation, viewConfigOrientation) {\r\n    // 'simple' orientation code (does not take into account angles)\r\n    const orientationCode =\r\n      getOrientationStringLPS(imageOrientation.asOneAndZeros());\r\n    if (typeof orientationCode === 'undefined') {\r\n      throw new Error('Unsupported undefined orientation code');\r\n    }\r\n\r\n    // view orientation flags\r\n    const isViewUndefined = typeof viewConfigOrientation === 'undefined';\r\n    const isViewAxial = !isViewUndefined &&\r\n      viewConfigOrientation === 'axial';\r\n    const isViewCoronal = !isViewUndefined &&\r\n      viewConfigOrientation === 'coronal';\r\n    const isViewSagittal = !isViewUndefined &&\r\n      viewConfigOrientation === 'sagittal';\r\n\r\n    // default flags\r\n    const flipOffset = {\r\n      x: false,\r\n      y: false\r\n    };\r\n    const flipScale = {\r\n      x: false,\r\n      y: false,\r\n      z: false\r\n    };\r\n\r\n    if (orientationCode === 'LPS') {\r\n      // axial\r\n      if (isViewCoronal || isViewSagittal) {\r\n        flipScale.z = true;\r\n        flipOffset.y = true;\r\n      }\r\n    } else if (orientationCode === 'LAI') {\r\n      // axial\r\n      if (isViewUndefined || isViewAxial) {\r\n        flipOffset.y = true;\r\n      } else if (isViewCoronal) {\r\n        flipScale.z = true;\r\n      } else if (isViewSagittal) {\r\n        flipScale.z = true;\r\n        flipOffset.x = true;\r\n      }\r\n    } else if (orientationCode === 'RPI') {\r\n      // axial\r\n      if (isViewUndefined || isViewAxial) {\r\n        flipOffset.x = true;\r\n      } else if (isViewCoronal) {\r\n        flipScale.z = true;\r\n        flipOffset.x = true;\r\n      } else if (isViewSagittal) {\r\n        flipScale.z = true;\r\n      }\r\n    } else if (orientationCode === 'RAS') {\r\n      // axial\r\n      flipOffset.x = true;\r\n      flipOffset.y = true;\r\n      if (isViewCoronal || isViewSagittal) {\r\n        flipScale.z = true;\r\n      }\r\n    } else if (orientationCode === 'LSA') {\r\n      // coronal\r\n      flipOffset.y = true;\r\n      if (isViewUndefined || isViewCoronal) {\r\n        flipScale.z = true;\r\n      } else if (isViewAxial) {\r\n        flipScale.y = true;\r\n      } else if (isViewSagittal) {\r\n        flipOffset.x = true;\r\n        flipScale.y = true;\r\n        flipScale.z = true;\r\n      }\r\n    // } else if (orientationCode === 'LIP') { // nothing to do\r\n    } else if (orientationCode === 'RSP') {\r\n      // coronal\r\n      if (isViewUndefined || isViewCoronal) {\r\n        flipOffset.x = true;\r\n        flipOffset.y = true;\r\n        flipScale.x = true;\r\n        flipScale.z = true;\r\n      } else if (isViewAxial) {\r\n        flipOffset.x = true;\r\n        flipScale.x = true;\r\n      } else if (isViewSagittal) {\r\n        flipOffset.y = true;\r\n        flipScale.z = true;\r\n      }\r\n    } else if (orientationCode === 'RIA') {\r\n      // coronal\r\n      flipOffset.x = true;\r\n      if (isViewUndefined || isViewCoronal) {\r\n        flipScale.x = true;\r\n      } else if (isViewAxial) {\r\n        flipOffset.y = true;\r\n        flipScale.x = true;\r\n        flipScale.y = true;\r\n      } else if (isViewSagittal) {\r\n        flipScale.y = true;\r\n      }\r\n    } else if (orientationCode === 'PSL') {\r\n      // sagittal\r\n      flipScale.z = true;\r\n      if (isViewUndefined || isViewSagittal) {\r\n        flipOffset.y = true;\r\n      } else if (isViewCoronal) {\r\n        flipOffset.y = true;\r\n      }\r\n    } else if (orientationCode === 'PIR') {\r\n      // sagittal\r\n      flipScale.z = true;\r\n      if (isViewAxial || isViewCoronal) {\r\n        flipOffset.x = true;\r\n      }\r\n    } else if (orientationCode === 'ASR') {\r\n      // sagittal\r\n      flipOffset.x = true;\r\n      flipOffset.y = true;\r\n      if (isViewUndefined || isViewSagittal) {\r\n        flipScale.z = true;\r\n      } else if (isViewCoronal) {\r\n        flipScale.z = true;\r\n      }\r\n    } else if (orientationCode === 'AIL') {\r\n      // sagittal\r\n      if (isViewUndefined || isViewSagittal) {\r\n        flipOffset.x = true;\r\n        flipScale.z = true;\r\n      } else if (isViewAxial) {\r\n        flipOffset.y = true;\r\n      } else if (isViewCoronal) {\r\n        flipScale.z = true;\r\n      }\r\n    } else {\r\n      logger.warn('Unsupported orientation code: ' +\r\n        orientationCode + ', display could be incorrect');\r\n    }\r\n\r\n    return {\r\n      scale: flipScale,\r\n      offset: flipOffset\r\n    };\r\n  }\r\n\r\n} // class App\r\n","/**\r\n * Data writer.\r\n */\r\nexport class DataWriter {\r\n\r\n  /**\r\n   * Is the endianness Little Endian.\r\n   *\r\n   * @type {boolean}\r\n   */\r\n  #isLittleEndian = true;\r\n\r\n  /**\r\n   * The main data view.\r\n   *\r\n   * @type {DataView}\r\n   */\r\n  #view;\r\n\r\n  /**\r\n   * @param {ArrayBuffer} buffer The input array buffer.\r\n   * @param {boolean} [isLittleEndian] Flag to tell if the data is\r\n   *   little or big endian.\r\n   */\r\n  constructor(buffer, isLittleEndian) {\r\n    // Set endian flag if not defined.\r\n    if (typeof isLittleEndian !== 'undefined') {\r\n      this.#isLittleEndian = isLittleEndian;\r\n    }\r\n    this.#view = new DataView(buffer);\r\n  }\r\n\r\n  /**\r\n   * Write Uint8 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {number} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeUint8(byteOffset, value) {\r\n    this.#view.setUint8(byteOffset, value);\r\n    return byteOffset + Uint8Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write Int8 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {number} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeInt8(byteOffset, value) {\r\n    this.#view.setInt8(byteOffset, value);\r\n    return byteOffset + Int8Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write Uint16 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {number} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeUint16(byteOffset, value) {\r\n    this.#view.setUint16(byteOffset, value, this.#isLittleEndian);\r\n    return byteOffset + Uint16Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write Int16 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {number} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeInt16(byteOffset, value) {\r\n    this.#view.setInt16(byteOffset, value, this.#isLittleEndian);\r\n    return byteOffset + Int16Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write Uint32 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {number} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeUint32(byteOffset, value) {\r\n    this.#view.setUint32(byteOffset, value, this.#isLittleEndian);\r\n    return byteOffset + Uint32Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write Uint64 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {bigint} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeUint64(byteOffset, value) {\r\n    this.#view.setBigUint64(byteOffset, value, this.#isLittleEndian);\r\n    return byteOffset + BigUint64Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write Int32 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {number} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeInt32(byteOffset, value) {\r\n    this.#view.setInt32(byteOffset, value, this.#isLittleEndian);\r\n    return byteOffset + Int32Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write Int64 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {bigint} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeInt64(byteOffset, value) {\r\n    this.#view.setBigInt64(byteOffset, value, this.#isLittleEndian);\r\n    return byteOffset + BigInt64Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write Float32 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {number} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeFloat32(byteOffset, value) {\r\n    this.#view.setFloat32(byteOffset, value, this.#isLittleEndian);\r\n    return byteOffset + Float32Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write Float64 data.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {number} value The data to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeFloat64(byteOffset, value) {\r\n    this.#view.setFloat64(byteOffset, value, this.#isLittleEndian);\r\n    return byteOffset + Float64Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write string data of length 4 as hexadecimal (no '0x' prefix).\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {string} str The hexadecimal string to write ('####').\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeHex(byteOffset, str) {\r\n    // remove first two chars and parse\r\n    const value = parseInt(str, 16);\r\n    this.#view.setUint16(byteOffset, value, this.#isLittleEndian);\r\n    return byteOffset + Uint16Array.BYTES_PER_ELEMENT;\r\n  }\r\n\r\n  /**\r\n   * Write a boolean array as binary.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeBinaryArray(byteOffset, array) {\r\n    if (array.length % 8 !== 0) {\r\n      throw new Error('Cannot write boolean array as binary.');\r\n    }\r\n    let byte = null;\r\n    let val = null;\r\n    for (let i = 0, len = array.length; i < len; i += 8) {\r\n      byte = 0;\r\n      for (let j = 0; j < 8; ++j) {\r\n        val = array[i + j] === 0 ? 0 : 1;\r\n        byte += val << j;\r\n      }\r\n      byteOffset = this.writeUint8(byteOffset, byte);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Uint8 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array|Uint8Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeUint8Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeUint8(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Int8 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeInt8Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeInt8(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Uint16 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeUint16Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeUint16(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Int16 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeInt16Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeInt16(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Uint32 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeUint32Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeUint32(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Uint64 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeUint64Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeUint64(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Int32 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeInt32Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeInt32(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Int64 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeInt64Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeInt64(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Float32 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeFloat32Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeFloat32(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write Float64 array.\r\n   *\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} array The array to write.\r\n   * @returns {number} The new offset position.\r\n   */\r\n  writeFloat64Array(byteOffset, array) {\r\n    for (let i = 0, len = array.length; i < len; ++i) {\r\n      byteOffset = this.writeFloat64(byteOffset, array[i]);\r\n    }\r\n    return byteOffset;\r\n  }\r\n\r\n} // class DataWriter\r\n","import {\r\n  is32bitVLVR,\r\n  isCharSetStringVR,\r\n  vrTypes\r\n} from './dictionary';\r\nimport {\r\n  Tag,\r\n  getTagFromDictionary,\r\n  getTagFromKey,\r\n  getItemTag,\r\n  getItemDelimitationItemTag,\r\n  getSequenceDelimitationItemTag,\r\n  getFileMetaInformationGroupLengthTag,\r\n  isPixelDataTag,\r\n  isItemTag,\r\n  tagCompareFunction\r\n} from './dicomTag';\r\nimport {\r\n  getDwvVersion,\r\n  isImplicitTransferSyntax,\r\n  isBigEndianTransferSyntax,\r\n  getDataElementPrefixByteSize\r\n} from './dicomParser';\r\nimport {DataElement} from './dataElement';\r\nimport {DataWriter} from './dataWriter';\r\nimport {logger} from '../utils/logger';\r\n\r\n/**\r\n * Get the dwv UID prefix.\r\n * Issued by Medical Connections Ltd (www.medicalconnections.co.uk)\r\n *   on 25/10/2017.\r\n *\r\n * @returns {string} The dwv UID prefix.\r\n */\r\nfunction getDwvUIDPrefix() {\r\n  return '1.2.826.0.1.3680043.9.7278.1';\r\n}\r\n\r\n// local generated uid counter\r\nlet _uidCount = 0;\r\n\r\n/**\r\n * Writer rule.\r\n */\r\nexport class WriterRule {\r\n  /**\r\n   * Rule action: `copy`, `remove`, `clear` or `replace`.\r\n   *\r\n   * @type {string}\r\n   */\r\n  action;\r\n  /**\r\n   * Optional value to use for replace action.\r\n   *\r\n   * @type {any|undefined}\r\n   */\r\n  value;\r\n\r\n  /**\r\n   * @param {string} action The rule action.\r\n   */\r\n  constructor(action) {\r\n    this.action = action;\r\n  }\r\n}\r\n\r\n/**\r\n * Get a UID for a DICOM tag.\r\n * Note: Use https://github.com/uuidjs/uuid?\r\n *\r\n * @see http://dicom.nema.org/dicom/2013/output/chtml/part05/chapter_9.html\r\n * @see http://dicomiseasy.blogspot.com/2011/12/chapter-4-dicom-objects-in-chapter-3.html\r\n * @see https://stackoverflow.com/questions/46304306/how-to-generate-unique-dicom-uid\r\n * @param {string} tagName The input tag.\r\n * @returns {string} The corresponding UID.\r\n */\r\nexport function getUID(tagName) {\r\n  const prefix = getDwvUIDPrefix() + '.';\r\n  let uid = '';\r\n  if (tagName === 'ImplementationClassUID') {\r\n    uid = prefix + getDwvVersion();\r\n  } else {\r\n    // date (only numbers), do not keep milliseconds\r\n    const date = (new Date()).toISOString().replace(/\\D/g, '');\r\n    const datePart = '.' + date.substring(0, 14);\r\n    // count\r\n    _uidCount += 1;\r\n    const countPart = '.' + _uidCount;\r\n\r\n    // uid = prefix . tag . date . count\r\n    uid = prefix;\r\n\r\n    // limit tag part to not exceed 64 length\r\n    const nonTagLength = prefix.length + countPart.length + datePart.length;\r\n    const leni = Math.min(tagName.length, 64 - nonTagLength);\r\n    if (leni > 1) {\r\n      let tagNumber = '';\r\n      for (let i = 0; i < leni; ++i) {\r\n        tagNumber += tagName.charCodeAt(i);\r\n      }\r\n      uid += tagNumber.substring(0, leni);\r\n    }\r\n\r\n    // finish\r\n    uid += datePart + countPart;\r\n  }\r\n  return uid;\r\n}\r\n\r\n/**\r\n * Return true if the input number is even.\r\n *\r\n * @param {number} number The number to check.\r\n * @returns {boolean} True is the number is even.\r\n */\r\nfunction isEven(number) {\r\n  return number % 2 === 0;\r\n}\r\n\r\n/**\r\n * Is the input VR a VR that stores data in a typed array.\r\n * TODO: include ox and xs?\r\n *\r\n * @param {string} vr The element VR.\r\n * @returns {boolean} True if the VR is a typed array one.\r\n */\r\nfunction isTypedArrayVr(vr) {\r\n  const vrType = vrTypes[vr];\r\n  return typeof vrType !== 'undefined' &&\r\n    vrType !== 'string';\r\n}\r\n\r\n/**\r\n * Is the input VR a string VR.\r\n *\r\n * @param {string} vr The element VR.\r\n * @returns {boolean} True if the VR is a string one.\r\n */\r\nfunction isStringVr(vr) {\r\n  const vrType = vrTypes[vr];\r\n  return typeof vrType !== 'undefined' &&\r\n    vrType === 'string';\r\n}\r\n\r\n/**\r\n * Is the input VR a VR that could need padding.\r\n * see http://dicom.nema.org/dicom/2013/output/chtml/part05/sect_6.2.html\r\n *\r\n * @param {string} vr The element VR.\r\n * @returns {boolean} True if the VR needs padding.\r\n */\r\nfunction isVrToPad(vr) {\r\n  return isStringVr(vr) || vr === 'OB';\r\n}\r\n\r\n/**\r\n * Get the VR specific padding value.\r\n *\r\n * @param {string} vr The element VR.\r\n * @returns {string} The value used to pad.\r\n */\r\nfunction getVrPad(vr) {\r\n  let pad = '';\r\n  if (isStringVr(vr)) {\r\n    if (vr === 'UI') {\r\n      pad = '\\0';\r\n    } else {\r\n      pad = ' ';\r\n    }\r\n  }\r\n  return pad;\r\n}\r\n\r\n/**\r\n * Push a value at the end of an input Uint8Array.\r\n *\r\n * @param {Array|Uint8Array} arr The input array.\r\n * @param {Array|Uint8Array} value The value to push.\r\n * @returns {Uint8Array} The new array.\r\n */\r\nfunction uint8ArrayPush(arr, value) {\r\n  const newArr = new Uint8Array(arr.length + 1);\r\n  newArr.set(arr);\r\n  newArr.set(value, arr.length);\r\n  return newArr;\r\n}\r\n\r\n/**\r\n * Pad an input OB value.\r\n *\r\n * @param {Array|Uint8Array} value The input value.\r\n * @returns {Array|Uint8Array} The padded input.\r\n */\r\nfunction padOBValue(value) {\r\n  if (value !== null &&\r\n    typeof value !== 'undefined' &&\r\n    typeof value.length !== 'undefined') {\r\n    // calculate size and pad if needed\r\n    if (value.length !== 0 &&\r\n      typeof value[0].length !== 'undefined') {\r\n      // handle array of array\r\n      let size = 0;\r\n      for (let i = 0; i < value.length; ++i) {\r\n        size += value[i].length;\r\n      }\r\n      if (!isEven(size)) {\r\n        value[value.length - 1] = uint8ArrayPush(\r\n          value[value.length - 1], [0]);\r\n      }\r\n    } else {\r\n      if (!isEven(value.length)) {\r\n        value = uint8ArrayPush(value, [0]);\r\n      }\r\n    }\r\n  } else {\r\n    throw new Error('Cannot pad undefined or null OB value.');\r\n  }\r\n  // uint8ArrayPush may create a new array so we\r\n  // need to return it\r\n  return value;\r\n}\r\n\r\n/**\r\n * Helper method to flatten an array of typed arrays to 2D typed array\r\n *\r\n * @param {Array} initialArray array of typed arrays\r\n * @returns {object} a typed array containing all values\r\n */\r\nfunction flattenArrayOfTypedArrays(initialArray) {\r\n  const initialArrayLength = initialArray.length;\r\n  const arrayLength = initialArray[0].length;\r\n  // If this is not a array of arrays, just return the initial one:\r\n  if (typeof arrayLength === 'undefined') {\r\n    return initialArray;\r\n  }\r\n\r\n  const flattenendArrayLength = initialArrayLength * arrayLength;\r\n\r\n  const flattenedArray = new initialArray[0].constructor(flattenendArrayLength);\r\n\r\n  for (let i = 0; i < initialArrayLength; i++) {\r\n    const indexFlattenedArray = i * arrayLength;\r\n    flattenedArray.set(initialArray[i], indexFlattenedArray);\r\n  }\r\n  return flattenedArray;\r\n}\r\n\r\n/**\r\n * Default text encoder.\r\n */\r\nclass DefaultTextEncoder {\r\n  /**\r\n   * Encode an input string.\r\n   *\r\n   * @param {string} str The string to encode.\r\n   * @returns {Uint8Array} The encoded string.\r\n   */\r\n  encode(str) {\r\n    const result = new Uint8Array(str.length);\r\n    for (let i = 0, leni = str.length; i < leni; ++i) {\r\n      result[i] = str.charCodeAt(i);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * DICOM writer.\r\n *\r\n * @example\r\n * // add link to html\r\n * const link = document.createElement(\"a\");\r\n * link.appendChild(document.createTextNode(\"download\"));\r\n * const div = document.getElementById(\"dwv\");\r\n * div.appendChild(link);\r\n * // XMLHttpRequest onload callback\r\n * const onload = function (event) {\r\n *   const parser = new dwv.DicomParser();\r\n *   parser.parse(event.target.response);\r\n *   // create writer\r\n *   const writer = new dwv.DicomWriter();\r\n *   // get buffer using default rules\r\n *   const dicomBuffer = writer.getBuffer(parser.getDicomElements());\r\n *   // create blob\r\n *   const blob = new Blob([dicomBuffer], {type: 'application/dicom'});\r\n *   // add blob to download link\r\n *   link.href = URL.createObjectURL(blob);\r\n *   link.download = \"anonym.dcm\";\r\n * };\r\n * // DICOM file request\r\n * const request = new XMLHttpRequest();\r\n * const url = 'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm';\r\n * request.open('GET', url);\r\n * request.responseType = 'arraybuffer';\r\n * request.onload = onload;\r\n * request.send();\r\n */\r\nexport class DicomWriter {\r\n\r\n  // flag to use VR=UN for private sequences, default to false\r\n  // (mainly used in tests)\r\n  #useUnVrForPrivateSq = false;\r\n\r\n  /**\r\n   * Set the use UN VR for private sequence flag.\r\n   *\r\n   * @param {boolean} flag True to use UN VR.\r\n   */\r\n  setUseUnVrForPrivateSq(flag) {\r\n    this.#useUnVrForPrivateSq = flag;\r\n  }\r\n\r\n  /**\r\n   * Possible tag actions.\r\n   *\r\n   * @type {Object<string, Function>}\r\n   */\r\n  #actions = {\r\n    copy: function (item) {\r\n      return item;\r\n    },\r\n    remove: function () {\r\n      return null;\r\n    },\r\n    clear: function (item) {\r\n      item.value = [];\r\n      return item;\r\n    },\r\n    replace: function (item, value) {\r\n      item.value = [value];\r\n      return item;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Default rules: just copy\r\n   *\r\n   * @type {Object<string, WriterRule>}\r\n   */\r\n  #defaultRules = {\r\n    default: {action: 'copy', value: null}\r\n  };\r\n\r\n  /**\r\n   * Writing rules.\r\n   *\r\n   * @type {Object<string, WriterRule>}\r\n   */\r\n  #rules = this.#defaultRules;\r\n\r\n  /**\r\n   * Set the writing rules.\r\n   * List of writer rules indexed by either `default`, tagName or groupName.\r\n   * Each DICOM element will be checked to see if a rule is applicable.\r\n   * First checked by tagName and then by groupName,\r\n   * if nothing is found the default rule is applied.\r\n   *\r\n   * @param {Object<string, WriterRule>} rules The input rules.\r\n   */\r\n  setRules(rules) {\r\n    this.#rules = rules;\r\n  }\r\n\r\n  /**\r\n   * Default text encoder.\r\n   *\r\n   * @type {DefaultTextEncoder}\r\n   */\r\n  #defaultTextEncoder = new DefaultTextEncoder();\r\n\r\n  /**\r\n   * Special text encoder.\r\n   *\r\n   * @type {DefaultTextEncoder|TextEncoder}\r\n   */\r\n  #textEncoder = this.#defaultTextEncoder;\r\n\r\n  /**\r\n   * Encode string data.\r\n   *\r\n   * @param {string} str The string to encode.\r\n   * @returns {Uint8Array} The encoded string.\r\n   */\r\n  #encodeString(str) {\r\n    return this.#defaultTextEncoder.encode(str);\r\n  }\r\n\r\n  /**\r\n   * Encode data as a UTF-8.\r\n   *\r\n   * @param {string} str The string to write.\r\n   * @returns {Uint8Array} The encoded string.\r\n   */\r\n  #encodeSpecialString(str) {\r\n    return this.#textEncoder.encode(str);\r\n  }\r\n\r\n  /**\r\n   * Use a TextEncoder instead of the default text decoder.\r\n   */\r\n  useSpecialTextEncoder() {\r\n    /**\r\n     * The text encoder.\r\n     *\r\n     * @external TextEncoder\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder\r\n     */\r\n    this.#textEncoder = new TextEncoder();\r\n  }\r\n\r\n  /**\r\n   * Use default anonymisation rules.\r\n   */\r\n  useDefaultAnonymisationRules() {\r\n    this.setRules({\r\n      default: {action: 'remove', value: null},\r\n      PatientName: {action: 'replace', value: 'Anonymized'}, // tag\r\n      'Meta Element': {action: 'copy', value: null}, // group '0002'\r\n      Acquisition: {action: 'copy', value: null}, // group '0018'\r\n      'Image Presentation': {action: 'copy', value: null}, // group '0028'\r\n      Procedure: {action: 'copy', value: null}, // group '0040'\r\n      'Pixel Data': {action: 'copy', value: null} // group '7fe0'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the element to write according to the class rules.\r\n   * Priority order: tagName, groupName, default.\r\n   *\r\n   * @param {DataElement} element The element to check\r\n   * @returns {DataElement|null} The element to write, can be null.\r\n   */\r\n  getElementToWrite(element) {\r\n    // get group and tag string name\r\n    const groupName = element.tag.getGroupName();\r\n    const tagName = element.tag.getNameFromDictionary();\r\n\r\n    // apply rules:\r\n    let rule;\r\n    if (typeof this.#rules[element.tag.getKey()] !== 'undefined') {\r\n      // 1. tag itself\r\n      rule = this.#rules[element.tag.getKey()];\r\n    } else if (typeof tagName !== 'undefined' &&\r\n      typeof this.#rules[tagName] !== 'undefined') {\r\n      // 2. tag name\r\n      rule = this.#rules[tagName];\r\n    } else if (typeof this.#rules[groupName] !== 'undefined') {\r\n      // 3. group name\r\n      rule = this.#rules[groupName];\r\n    } else {\r\n      // 4. default\r\n      rule = this.#rules['default'];\r\n    }\r\n    // apply action on element and return\r\n    return this.#actions[rule.action](element, rule.value);\r\n  }\r\n\r\n  /**\r\n   * Write a list of items.\r\n   *\r\n   * @param {DataWriter} writer The raw data writer.\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} items The list of items to write.\r\n   * @param {boolean} isImplicit Is the DICOM VR implicit?\r\n   * @returns {number} The new offset position.\r\n   */\r\n  #writeDataElementItems(\r\n    writer, byteOffset, items, isImplicit) {\r\n    let item = null;\r\n    for (let i = 0; i < items.length; ++i) {\r\n      item = items[i];\r\n      const itemKeys = Object.keys(item);\r\n      if (itemKeys.length === 0) {\r\n        continue;\r\n      }\r\n      // item element (create new to not modify original)\r\n      let undefinedLength = false;\r\n      if (typeof item['FFFEE000'].undefinedLength !== 'undefined') {\r\n        undefinedLength = item['FFFEE000'].undefinedLength;\r\n      }\r\n      // const itemElement = {\r\n      //   tag: getItemTag(),\r\n      //   vr: 'NONE',\r\n      //   vl: undefinedLength ? 0xffffffff : item['FFFEE000'].vl,\r\n      //   value: []\r\n      // };\r\n      const itemElement = new DataElement('NONE');\r\n      itemElement.vl = undefinedLength ? 0xffffffff : item['FFFEE000'].vl,\r\n      itemElement.tag = getItemTag();\r\n      itemElement.value = [];\r\n      byteOffset = this.#writeDataElement(\r\n        writer, itemElement, byteOffset, isImplicit);\r\n      // write rest\r\n      for (let m = 0; m < itemKeys.length; ++m) {\r\n        if (itemKeys[m] !== 'FFFEE000' && itemKeys[m] !== 'FFFEE00D') {\r\n          byteOffset = this.#writeDataElement(\r\n            writer, item[itemKeys[m]], byteOffset, isImplicit);\r\n        }\r\n      }\r\n      // item delimitation\r\n      if (undefinedLength) {\r\n        // const itemDelimElement = {\r\n        //   tag: getItemDelimitationItemTag(),\r\n        //   vr: 'NONE',\r\n        //   vl: 0,\r\n        //   value: []\r\n        // };\r\n        const itemDelimElement = new DataElement('NONE');\r\n        itemDelimElement.vl = 0;\r\n        itemDelimElement.tag = getItemDelimitationItemTag();\r\n        itemDelimElement.value = [];\r\n        byteOffset = this.#writeDataElement(\r\n          writer, itemDelimElement, byteOffset, isImplicit);\r\n      }\r\n    }\r\n\r\n    // return new offset\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write data with a specific Value Representation (VR).\r\n   *\r\n   * @param {DataWriter} writer The raw data writer.\r\n   * @param {DataElement} element The element to write.\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} value The array to write.\r\n   * @param {boolean} isImplicit Is the DICOM VR implicit?\r\n   * @returns {number} The new offset position.\r\n   */\r\n  #writeDataElementValue(\r\n    writer, element, byteOffset, value, isImplicit) {\r\n\r\n    const startOffset = byteOffset;\r\n\r\n    if (element.vr === 'NONE') {\r\n      // nothing to do!\r\n    } else if (value instanceof Uint8Array) {\r\n      // binary data has been expanded 8 times at read\r\n      if (value.length === 8 * element.vl) {\r\n        byteOffset = writer.writeBinaryArray(byteOffset, value);\r\n      } else {\r\n        byteOffset = writer.writeUint8Array(byteOffset, value);\r\n      }\r\n    } else if (value instanceof Int8Array) {\r\n      byteOffset = writer.writeInt8Array(byteOffset, value);\r\n    } else if (value instanceof Uint16Array) {\r\n      byteOffset = writer.writeUint16Array(byteOffset, value);\r\n    } else if (value instanceof Int16Array) {\r\n      byteOffset = writer.writeInt16Array(byteOffset, value);\r\n    } else if (value instanceof Uint32Array) {\r\n      byteOffset = writer.writeUint32Array(byteOffset, value);\r\n    } else if (value instanceof Int32Array) {\r\n      byteOffset = writer.writeInt32Array(byteOffset, value);\r\n    } else if (value instanceof BigUint64Array) {\r\n      byteOffset = writer.writeUint64Array(byteOffset, value);\r\n    } else if (value instanceof BigInt64Array) {\r\n      byteOffset = writer.writeInt64Array(byteOffset, value);\r\n    } else {\r\n      // switch according to VR if input type is undefined\r\n      const vrType = vrTypes[element.vr];\r\n      if (typeof vrType !== 'undefined') {\r\n        if (vrType === 'Uint8') {\r\n          byteOffset = writer.writeUint8Array(byteOffset, value);\r\n        } else if (vrType === 'Uint16') {\r\n          byteOffset = writer.writeUint16Array(byteOffset, value);\r\n        } else if (vrType === 'Int16') {\r\n          byteOffset = writer.writeInt16Array(byteOffset, value);\r\n        } else if (vrType === 'Uint32') {\r\n          byteOffset = writer.writeUint32Array(byteOffset, value);\r\n        } else if (vrType === 'Int32') {\r\n          byteOffset = writer.writeInt32Array(byteOffset, value);\r\n        } else if (vrType === 'Uint64') {\r\n          byteOffset = writer.writeUint64Array(byteOffset, value);\r\n        } else if (vrType === 'Int64') {\r\n          byteOffset = writer.writeInt64Array(byteOffset, value);\r\n        } else if (vrType === 'Float32') {\r\n          byteOffset = writer.writeFloat32Array(byteOffset, value);\r\n        } else if (vrType === 'Float64') {\r\n          byteOffset = writer.writeFloat64Array(byteOffset, value);\r\n        } else if (vrType === 'string') {\r\n          byteOffset = writer.writeUint8Array(byteOffset, value);\r\n        } else {\r\n          throw Error('Unknown VR type: ' + vrType);\r\n        }\r\n      } else if (element.vr === 'SQ') {\r\n        byteOffset = this.#writeDataElementItems(\r\n          writer, byteOffset, value, isImplicit);\r\n      } else if (element.vr === 'AT') {\r\n        for (let i = 0; i < value.length; ++i) {\r\n          const hexString = value[i] + '';\r\n          const hexString1 = hexString.substring(1, 5);\r\n          const hexString2 = hexString.substring(6, 10);\r\n          const dec1 = parseInt(hexString1, 16);\r\n          const dec2 = parseInt(hexString2, 16);\r\n          const atValue = [dec1, dec2];\r\n          byteOffset = writer.writeUint16Array(byteOffset, atValue);\r\n        }\r\n      } else {\r\n        logger.warn('Unknown VR: ' + element.vr);\r\n      }\r\n    }\r\n\r\n    if (element.vr !== 'SQ' && element.vr !== 'NONE') {\r\n      const diff = byteOffset - startOffset;\r\n      if (diff !== element.vl) {\r\n        logger.warn('Offset difference and VL are not equal: ' +\r\n          diff + ' != ' + element.vl + ', vr:' + element.vr);\r\n      }\r\n    }\r\n\r\n    // return new offset\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write a pixel data element.\r\n   *\r\n   * @param {DataWriter} writer The raw data writer.\r\n   * @param {DataElement} element The element to write.\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {Array} value The array to write.\r\n   * @param {boolean} isImplicit Is the DICOM VR implicit?\r\n   * @returns {number} The new offset position.\r\n   */\r\n  #writePixelDataElementValue(\r\n    writer, element, byteOffset, value, isImplicit) {\r\n    // undefined length flag\r\n    let undefinedLength = false;\r\n    if (typeof element.undefinedLength !== 'undefined') {\r\n      undefinedLength = element.undefinedLength;\r\n    }\r\n    // explicit length\r\n    if (!undefinedLength) {\r\n      let finalValue = value[0];\r\n      // flatten multi frame\r\n      if (value.length > 1) {\r\n        finalValue = flattenArrayOfTypedArrays(value);\r\n      }\r\n      // write\r\n      byteOffset = this.#writeDataElementValue(\r\n        writer, element, byteOffset, finalValue, isImplicit);\r\n    } else {\r\n      // pixel data as sequence\r\n      const item = {};\r\n      // first item: basic offset table\r\n      item['FFFEE000'] = {\r\n        tag: getItemTag(),\r\n        vr: 'NONE',\r\n        vl: 0,\r\n        value: []\r\n      };\r\n      // data\r\n      for (let i = 0; i < value.length; ++i) {\r\n        item[i] = {\r\n          tag: getItemTag(),\r\n          vr: element.vr,\r\n          vl: value[i].length,\r\n          value: value[i]\r\n        };\r\n      }\r\n      // write\r\n      byteOffset = this.#writeDataElementItems(\r\n        writer, byteOffset, [item], isImplicit);\r\n    }\r\n\r\n    // return new offset\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Write a data element.\r\n   *\r\n   * @param {DataWriter} writer The raw data writer.\r\n   * @param {DataElement} element The DICOM data element to write.\r\n   * @param {number} byteOffset The offset to start writing from.\r\n   * @param {boolean} isImplicit Is the DICOM VR implicit?\r\n   * @returns {number} The new offset position.\r\n   */\r\n  #writeDataElement(\r\n    writer, element, byteOffset, isImplicit) {\r\n    const isTagWithVR = element.tag.isWithVR();\r\n    const is32bitVL = (isImplicit || !isTagWithVR)\r\n      ? true : is32bitVLVR(element.vr);\r\n    // group\r\n    byteOffset = writer.writeHex(byteOffset, element.tag.getGroup());\r\n    // element\r\n    byteOffset = writer.writeHex(byteOffset, element.tag.getElement());\r\n    // VR\r\n    let vr = element.vr;\r\n    // use VR=UN for private sequence\r\n    if (this.#useUnVrForPrivateSq &&\r\n      element.tag.isPrivate() &&\r\n      vr === 'SQ') {\r\n      logger.warn('Write element using VR=UN for private sequence.');\r\n      vr = 'UN';\r\n    }\r\n    if (isTagWithVR && !isImplicit) {\r\n      byteOffset = writer.writeUint8Array(byteOffset, this.#encodeString(vr));\r\n      // reserved 2 bytes for 32bit VL\r\n      if (is32bitVL) {\r\n        byteOffset += 2;\r\n      }\r\n    }\r\n\r\n    let undefinedLengthSequence = false;\r\n    if (element.vr === 'SQ' ||\r\n      isPixelDataTag(element.tag)) {\r\n      if (typeof element.undefinedLength !== 'undefined') {\r\n        undefinedLengthSequence = element.undefinedLength;\r\n      }\r\n    }\r\n    let undefinedLengthItem = false;\r\n    if (isItemTag(element.tag)) {\r\n      if (typeof element.undefinedLength !== 'undefined') {\r\n        undefinedLengthItem = element.undefinedLength;\r\n      }\r\n    }\r\n\r\n    // update vl for sequence or item with undefined length\r\n    let vl = element.vl;\r\n    if (undefinedLengthSequence || undefinedLengthItem) {\r\n      vl = 0xffffffff;\r\n    }\r\n    // VL\r\n    if (is32bitVL) {\r\n      byteOffset = writer.writeUint32(byteOffset, vl);\r\n    } else {\r\n      byteOffset = writer.writeUint16(byteOffset, vl);\r\n    }\r\n\r\n    // value\r\n    let value = element.value;\r\n    // check value\r\n    if (typeof value === 'undefined') {\r\n      value = [];\r\n    }\r\n    // write\r\n    if (isPixelDataTag(element.tag)) {\r\n      byteOffset = this.#writePixelDataElementValue(\r\n        writer, element, byteOffset, value, isImplicit);\r\n    } else {\r\n      byteOffset = this.#writeDataElementValue(\r\n        writer, element, byteOffset, value, isImplicit);\r\n    }\r\n\r\n    // sequence delimitation item for sequence with undefined length\r\n    if (undefinedLengthSequence) {\r\n      // const seqDelimElement = {\r\n      //   tag: getSequenceDelimitationItemTag(),\r\n      //   vr: 'NONE',\r\n      //   vl: 0,\r\n      //   value: []\r\n      // };\r\n      const seqDelimElement = new DataElement('NONE');\r\n      seqDelimElement.vl = 0;\r\n      seqDelimElement.tag = getSequenceDelimitationItemTag();\r\n      seqDelimElement.value = [];\r\n      byteOffset = this.#writeDataElement(\r\n        writer, seqDelimElement, byteOffset, isImplicit);\r\n    }\r\n\r\n    // return new offset\r\n    return byteOffset;\r\n  }\r\n\r\n  /**\r\n   * Get the ArrayBuffer corresponding to input DICOM elements.\r\n   *\r\n   * @param {Object<string, DataElement>} dataElements The elements to write.\r\n   * @returns {ArrayBuffer} The elements as a buffer.\r\n   */\r\n  getBuffer(dataElements) {\r\n    // Transfer Syntax\r\n    // const el = dataElements['00020010'];\r\n    // el.value = 1;\r\n    // el.vl = 'a';\r\n    const syntax = dataElements['00020010'].value[0];\r\n    const isImplicit = isImplicitTransferSyntax(syntax);\r\n    const isBigEndian = isBigEndianTransferSyntax(syntax);\r\n    // Specific CharacterSet\r\n    if (typeof dataElements['00080005'] !== 'undefined') {\r\n      const oldscs = dataElements['00080005'].value[0];\r\n      // force UTF-8 if not default character set\r\n      if (typeof oldscs !== 'undefined' && oldscs !== 'ISO-IR 6') {\r\n        logger.debug('Change charset to UTF, was: ' + oldscs);\r\n        this.useSpecialTextEncoder();\r\n        dataElements['00080005'].value = ['ISO_IR 192'];\r\n      }\r\n    }\r\n    // Bits Allocated (for image data)\r\n    let bitsAllocated;\r\n    if (typeof dataElements['00280100'] !== 'undefined') {\r\n      bitsAllocated = dataElements['00280100'].value[0];\r\n    }\r\n\r\n    // calculate buffer size and split elements (meta and non meta)\r\n    let totalSize = 128 + 4; // DICM\r\n    let localSize = 0;\r\n    const metaElements = [];\r\n    const rawElements = [];\r\n    let element;\r\n    let groupName;\r\n    let metaLength = 0;\r\n    // FileMetaInformationGroupLength\r\n    const fmiglTag = getFileMetaInformationGroupLengthTag();\r\n    // FileMetaInformationVersion\r\n    const fmivTag = new Tag('0002', '0001');\r\n    // ImplementationClassUID\r\n    const icUIDTag = new Tag('0002', '0012');\r\n    // ImplementationVersionName\r\n    const ivnTag = new Tag('0002', '0013');\r\n\r\n    // loop through elements to get the buffer size\r\n    const keys = Object.keys(dataElements);\r\n    for (let i = 0, leni = keys.length; i < leni; ++i) {\r\n      const originalElement = dataElements[keys[i]];\r\n      originalElement.tag = getTagFromKey(keys[i]);\r\n      element = this.getElementToWrite(originalElement);\r\n      if (element !== null &&\r\n        !fmiglTag.equals(element.tag) &&\r\n        !fmivTag.equals(element.tag) &&\r\n        !icUIDTag.equals(element.tag) &&\r\n        !ivnTag.equals(element.tag)) {\r\n        localSize = 0;\r\n\r\n        // XB7 2020-04-17\r\n        // Check if UN can be converted to correct VR.\r\n        // This check must be done BEFORE calculating totalSize,\r\n        // otherwise there may be extra null bytes at the end of the file\r\n        // (dcmdump may crash because of these bytes)\r\n        checkUnknownVR(element);\r\n\r\n        // update value and vl\r\n        this.#setElementValue(\r\n          element, element.value, isImplicit, bitsAllocated);\r\n\r\n        // tag group name\r\n        groupName = element.tag.getGroupName();\r\n\r\n        // prefix\r\n        if (groupName === 'Meta Element') {\r\n          localSize += getDataElementPrefixByteSize(element.vr, false);\r\n        } else {\r\n          localSize += getDataElementPrefixByteSize(\r\n            element.vr, isImplicit);\r\n        }\r\n\r\n        // value\r\n        localSize += element.vl;\r\n\r\n        // sort elements\r\n        if (groupName === 'Meta Element') {\r\n          metaElements.push(element);\r\n          metaLength += localSize;\r\n        } else {\r\n          rawElements.push(element);\r\n        }\r\n\r\n        // add to total size\r\n        totalSize += localSize;\r\n      }\r\n    }\r\n\r\n    // FileMetaInformationVersion\r\n    const fmiv = getDataElement('FileMetaInformationVersion');\r\n    let fmivSize = getDataElementPrefixByteSize(fmiv.vr, false);\r\n    fmivSize += this.#setElementValue(fmiv, [0, 1], false);\r\n    metaElements.push(fmiv);\r\n    metaLength += fmivSize;\r\n    totalSize += fmivSize;\r\n    // ImplementationClassUID\r\n    const icUID = getDataElement('ImplementationClassUID');\r\n    let icUIDSize = getDataElementPrefixByteSize(icUID.vr, false);\r\n    icUIDSize += this.#setElementValue(\r\n      icUID, [getUID('ImplementationClassUID')], false);\r\n    metaElements.push(icUID);\r\n    metaLength += icUIDSize;\r\n    totalSize += icUIDSize;\r\n    // ImplementationVersionName\r\n    const ivn = getDataElement('ImplementationVersionName');\r\n    let ivnSize = getDataElementPrefixByteSize(ivn.vr, false);\r\n    const ivnValue = 'DWV_' + getDwvVersion();\r\n    ivnSize += this.#setElementValue(ivn, [ivnValue], false);\r\n    metaElements.push(ivn);\r\n    metaLength += ivnSize;\r\n    totalSize += ivnSize;\r\n\r\n    // sort elements\r\n    const elemSortFunc = function (a, b) {\r\n      return tagCompareFunction(a.tag, b.tag);\r\n    };\r\n    metaElements.sort(elemSortFunc);\r\n    rawElements.sort(elemSortFunc);\r\n\r\n    // create the FileMetaInformationGroupLength element\r\n    const fmigl = getDataElement('FileMetaInformationGroupLength');\r\n    let fmiglSize = getDataElementPrefixByteSize(fmigl.vr, false);\r\n    fmiglSize += this.#setElementValue(\r\n      fmigl, new Uint32Array([metaLength]), false);\r\n    totalSize += fmiglSize;\r\n\r\n    // create buffer\r\n    const buffer = new ArrayBuffer(totalSize);\r\n    const metaWriter = new DataWriter(buffer);\r\n    const dataWriter = new DataWriter(buffer, !isBigEndian);\r\n\r\n    let offset = 128;\r\n    // DICM\r\n    offset = metaWriter.writeUint8Array(offset, this.#encodeString('DICM'));\r\n    // FileMetaInformationGroupLength\r\n    offset = this.#writeDataElement(metaWriter, fmigl, offset, false);\r\n    // write meta\r\n    for (let j = 0, lenj = metaElements.length; j < lenj; ++j) {\r\n      offset = this.#writeDataElement(\r\n        metaWriter, metaElements[j], offset, false);\r\n    }\r\n\r\n    // check meta position\r\n    const preambleSize = 128 + 4;\r\n    const metaOffset = preambleSize + fmiglSize + metaLength;\r\n    if (offset !== metaOffset) {\r\n      logger.warn('Bad size calculation... meta offset: ' + offset +\r\n        ', calculated size:' + metaOffset +\r\n        ' (diff:' + (offset - metaOffset) + ')');\r\n    }\r\n\r\n    // write non meta\r\n    for (let k = 0, lenk = rawElements.length; k < lenk; ++k) {\r\n      offset = this.#writeDataElement(\r\n        dataWriter, rawElements[k], offset, isImplicit);\r\n    }\r\n\r\n    // check final position\r\n    if (offset !== totalSize) {\r\n      logger.warn('Bad size calculation... final offset: ' + offset +\r\n        ', calculated size:' + totalSize +\r\n        ' (diff:' + (offset - totalSize) + ')');\r\n    }\r\n    // return\r\n    return buffer;\r\n  }\r\n\r\n  /**\r\n   * Set a DICOM element value according to its VR (Value Representation).\r\n   *\r\n   * @param {DataElement} element The DICOM element to set the value.\r\n   * @param {object} value The value to set.\r\n   * @param {boolean} isImplicit Does the data use implicit VR?\r\n   * @param {number} [bitsAllocated] Bits allocated used for pixel data.\r\n   * @returns {number} The total element size.\r\n   */\r\n  #setElementValue(\r\n    element, value, isImplicit, bitsAllocated) {\r\n    // byte size of the element\r\n    let size = 0;\r\n    // special sequence case\r\n    if (element.vr === 'SQ') {\r\n\r\n      if (value !== null && value !== 0) {\r\n        const newItems = [];\r\n        let name;\r\n\r\n        // explicit or undefined length sequence\r\n        let undefinedLength = false;\r\n        if (typeof element.undefinedLength !== 'undefined') {\r\n          undefinedLength = element.undefinedLength;\r\n          delete element.undefinedLength;\r\n        }\r\n\r\n        // items\r\n        for (let i = 0; i < value.length; ++i) {\r\n          const oldItemElements = value[i];\r\n          const newItemElements = {};\r\n          let subSize = 0;\r\n\r\n          // check data\r\n          if (oldItemElements === null || oldItemElements === 0) {\r\n            continue;\r\n          }\r\n\r\n          // elements\r\n          const itemKeys = Object.keys(oldItemElements);\r\n          for (let j = 0, lenj = itemKeys.length; j < lenj; ++j) {\r\n            const itemKey = itemKeys[j];\r\n            const subElement = oldItemElements[itemKey];\r\n            subElement.tag = getTagFromKey(itemKey);\r\n\r\n            if (isItemTag(subElement.tag)) {\r\n              continue;\r\n            }\r\n            // set item value\r\n            subSize += this.#setElementValue(\r\n              subElement, subElement.value, isImplicit, bitsAllocated);\r\n            newItemElements[itemKey] = subElement;\r\n            // add prefix size\r\n            subSize += getDataElementPrefixByteSize(\r\n              subElement.vr, isImplicit);\r\n          }\r\n\r\n          // add item element (used to store its size)\r\n          const itemElement = {\r\n            tag: getItemTag(),\r\n            vr: 'NONE',\r\n            vl: subSize,\r\n            value: []\r\n          };\r\n          if (undefinedLength) {\r\n            itemElement.undefinedLength = undefinedLength;\r\n          }\r\n          name = itemElement.tag.getKey();\r\n          newItemElements[name] = itemElement;\r\n          subSize += getDataElementPrefixByteSize(\r\n            itemElement.vr, isImplicit);\r\n\r\n          // add item delimitation size\r\n          if (undefinedLength) {\r\n            subSize += getDataElementPrefixByteSize(\r\n              'NONE', isImplicit);\r\n          }\r\n\r\n          size += subSize;\r\n          newItems.push(newItemElements);\r\n        }\r\n\r\n        // add sequence delimitation size\r\n        if (undefinedLength) {\r\n          size += getDataElementPrefixByteSize('NONE', isImplicit);\r\n        }\r\n\r\n        // update sequence element\r\n        element.value = newItems;\r\n        element.vl = size;\r\n        if (undefinedLength) {\r\n          element.undefinedLength = undefinedLength;\r\n        }\r\n      }\r\n    } else {\r\n      // pad if necessary\r\n      if (isVrToPad(element.vr)) {\r\n        const padStr = getVrPad(element.vr);\r\n        // encode string\r\n        // TODO: not sure for UN...\r\n        if (isStringVr(element.vr)) {\r\n          let pad;\r\n          if (isCharSetStringVR(element.vr)) {\r\n            value = this.#encodeSpecialString(value.join('\\\\'));\r\n            pad = this.#encodeSpecialString(padStr);\r\n          } else {\r\n            value = this.#encodeString(value.join('\\\\'));\r\n            pad = this.#encodeString(padStr);\r\n          }\r\n          if (!isEven(value.length)) {\r\n            value = uint8ArrayPush(value, pad);\r\n          }\r\n        } else if (element.vr === 'OB') {\r\n          value = padOBValue(value);\r\n        }\r\n      }\r\n\r\n      // calculate byte size\r\n      size = 0;\r\n      if (element.vr === 'AT') {\r\n        size = 4 * value.length;\r\n      } else if (element.vr === 'xs') {\r\n        size = value.length * Uint16Array.BYTES_PER_ELEMENT;\r\n      } else if (isTypedArrayVr(element.vr) || element.vr === 'ox') {\r\n        if (isPixelDataTag(element.tag) &&\r\n          Array.isArray(value)) {\r\n          size = 0;\r\n          for (let b = 0; b < value.length; ++b) {\r\n            size += value[b].length;\r\n          }\r\n        } else {\r\n          size = value.length;\r\n        }\r\n\r\n        // convert size to bytes\r\n        const vrType = vrTypes[element.vr];\r\n        if (isPixelDataTag(element.tag) || element.vr === 'ox') {\r\n          if (element.undefinedLength) {\r\n            const itemPrefixSize =\r\n              getDataElementPrefixByteSize('NONE', isImplicit);\r\n            // offset table\r\n            size += itemPrefixSize;\r\n            // pixel items\r\n            size += itemPrefixSize * value.length;\r\n            // add sequence delimitation size\r\n            size += itemPrefixSize;\r\n          } else {\r\n            // use bitsAllocated for pixel data\r\n            // no need to multiply for 8 bits\r\n            if (typeof bitsAllocated !== 'undefined') {\r\n              if (bitsAllocated === 1) {\r\n                // binary data\r\n                size /= 8;\r\n              } else if (bitsAllocated === 16) {\r\n                size *= Uint16Array.BYTES_PER_ELEMENT;\r\n              }\r\n            }\r\n          }\r\n        } else if (typeof vrType !== 'undefined') {\r\n          const bpe = getBpeForVrType(vrType);\r\n          if (typeof bpe !== 'undefined') {\r\n            size *= bpe;\r\n          } else {\r\n            throw Error('Unknown bytes per element for VR type: ' + vrType);\r\n          }\r\n        } else {\r\n          throw Error('Unsupported element: ' + element.vr);\r\n        }\r\n      } else {\r\n        size = value.length;\r\n      }\r\n\r\n      element.value = value;\r\n      element.vl = size;\r\n    }\r\n\r\n    // return the size of that data\r\n    return size;\r\n  }\r\n\r\n} // class DicomWriter\r\n\r\n/**\r\n * Fix for broken DICOM elements: Replace \"UN\" with correct VR if the\r\n * element exists in dictionary\r\n *\r\n * @param {DataElement} element The DICOM element.\r\n */\r\nfunction checkUnknownVR(element) {\r\n  if (element.vr === 'UN') {\r\n    const dictVr = element.tag.getVrFromDictionary();\r\n    if (typeof dictVr !== 'undefined' && element.vr !== dictVr) {\r\n      element.vr = dictVr;\r\n      logger.info('Element ' + element.tag.getGroup() +\r\n        ' ' + element.tag.getElement() +\r\n        ' VR changed from UN to ' + element.vr);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Get a DICOM element from its tag name (value set separatly).\r\n *\r\n * @param {string} tagName The string tag name.\r\n * @returns {DataElement} The DICOM element.\r\n */\r\nfunction getDataElement(tagName) {\r\n  const tag = getTagFromDictionary(tagName);\r\n  const element = new DataElement(tag.getVrFromDictionary());\r\n  element.tag = tag;\r\n  return element;\r\n}\r\n\r\n/**\r\n * Get the number of bytes per element for a given VR type.\r\n *\r\n * @param {string} vrType The VR type as defined in the dictionary.\r\n * @returns {number} The bytes per element.\r\n */\r\nfunction getBpeForVrType(vrType) {\r\n  let bpe;\r\n  if (vrType === 'Uint8') {\r\n    bpe = Uint8Array.BYTES_PER_ELEMENT;\r\n  } else if (vrType === 'Uint16') {\r\n    bpe = Uint16Array.BYTES_PER_ELEMENT;\r\n  } else if (vrType === 'Int16') {\r\n    bpe = Int16Array.BYTES_PER_ELEMENT;\r\n  } else if (vrType === 'Uint32') {\r\n    bpe = Uint32Array.BYTES_PER_ELEMENT;\r\n  } else if (vrType === 'Int32') {\r\n    bpe = Int32Array.BYTES_PER_ELEMENT;\r\n  } else if (vrType === 'Float32') {\r\n    bpe = Float32Array.BYTES_PER_ELEMENT;\r\n  } else if (vrType === 'Float64') {\r\n    bpe = Float64Array.BYTES_PER_ELEMENT;\r\n  } else if (vrType === 'Uint64') {\r\n    bpe = BigUint64Array.BYTES_PER_ELEMENT;\r\n  } else if (vrType === 'Int64') {\r\n    bpe = BigInt64Array.BYTES_PER_ELEMENT;\r\n  }\r\n  return bpe;\r\n}\r\n\r\n/**\r\n * Get the DICOM elements from a 'simple' DICOM json tags object.\r\n * The json is a simplified version of the oficial DICOM json with\r\n * tag names instead of keys and direct values (no value property) for\r\n * simple tags. See synthetic test data (in tests/dicom) for examples.\r\n *\r\n * @param {Object<string, any>} jsonTags The DICOM\r\n *   json tags object.\r\n * @returns {Object<string, DataElement>} The DICOM elements.\r\n */\r\nexport function getElementsFromJSONTags(jsonTags) {\r\n  const keys = Object.keys(jsonTags);\r\n  const dataElements = {};\r\n  for (let k = 0, len = keys.length; k < len; ++k) {\r\n    // get the DICOM element definition from its name\r\n    const tag = getTagFromDictionary(keys[k]);\r\n    if (typeof tag === 'undefined') {\r\n      continue;\r\n    }\r\n    const vr = tag.getVrFromDictionary();\r\n    // tag value\r\n    let value;\r\n    let undefinedLength = false;\r\n    const jsonTag = jsonTags[keys[k]];\r\n    if (vr === 'SQ') {\r\n      const items = [];\r\n      if (typeof jsonTag.undefinedLength !== 'undefined') {\r\n        undefinedLength = jsonTag.undefinedLength;\r\n      }\r\n      if (typeof jsonTag.value !== 'undefined' &&\r\n        jsonTag.value !== null) {\r\n        for (let i = 0; i < jsonTag.value.length; ++i) {\r\n          items.push(getElementsFromJSONTags(jsonTag.value[i]));\r\n        }\r\n      } else {\r\n        logger.trace('Undefined or null jsonTag SQ value.');\r\n      }\r\n      value = items;\r\n    } else {\r\n      if (Array.isArray(jsonTag)) {\r\n        value = jsonTag;\r\n      } else {\r\n        value = [jsonTag];\r\n      }\r\n    }\r\n    // create element\r\n    const dataElement = new DataElement(vr);\r\n    dataElement.tag = tag;\r\n    dataElement.value = value;\r\n    if (undefinedLength) {\r\n      dataElement.undefinedLength = undefinedLength;\r\n    }\r\n    // store\r\n    dataElements[tag.getKey()] = dataElement;\r\n  }\r\n  // return\r\n  // @ts-expect-error\r\n  return dataElements;\r\n}\r\n"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE__436__","__WEBPACK_EXTERNAL_MODULE__626__","__WEBPACK_EXTERNAL_MODULE__812__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","Index","constructor","values","Error","length","every","val","isNaN","i","toString","getValues","slice","canCompare","rhs","equals","leni","compare","diffDims","push","add","getWithNew2D","j","l","lenl","toStringId","dims","ii","res","getIndexFromStringId","inputStr","strIds","split","dim","pointLength","parseInt","substring","Array","fill","ModalityLut","rsi","bitsStored","isID","Math","pow","Float32Array","apply","getRSI","getLength","getValue","offset","logger","levels","TRACE","DEBUG","INFO","WARN","ERROR","level","trace","msg","console","debug","info","warn","error","WindowLevel","center","width","defaultPresets","CT","mediastinum","lung","bone","brain","head","VoiLut","wl","getWindowLevel","c","setSignedOffset","WindowLut","modalityLut","isSigned","isDiscrete","size","getVoiLut","getModalityLut","setVoiLut","lut","getSlope","Uint8ClampedArray","floor","lut_range_max","buildLut","func","id","invId","ColourMap","red","green","blue","luts","plain","invPlain","rainbow","hot","third","hot_iron","pet","hot_metal_blue","pet_20step","getShadowColour","hexColour","hexStr","rgbTriplet","g","b","isDarkColour","labToUintLab","triplet","d65","x","y","z","srgbToCielab","labFunc","illuminant","fy","ciexyzToCielab","invGammaFunc","rl","gl","bl","srgbToCiexyz","colourNameToHex","name","dict","Yellow","Red","White","Green","Blue","Lime","Fuchsia","Black","Vector3D","getX","getY","getZ","norm","sqrt","crossProduct","vector3D","dotProduct","BIG_EPSILON","Number","EPSILON","isSimilar","tol","abs","Matrix33","row","col","getInverse","m","m00","m01","m02","m10","m11","m12","m20","m21","m22","a1212","a2012","a0112","det","getMatrixInverse","p","str","multiply","tmp","k","getAbs","multiplyArray3D","array3D","multiplyVector3D","multiplyPoint3D","point3D","Point3D","multiplyIndex3D","index3D","getRowAbsMax","absMax","max","index","indexOf","getColAbsMax","asOneAndZeros","sign","getThirdColMajorDirection","getIdentityMat33","getCoronalMat33","getVectorStringLPS","vector","orientation","orientationX","orientationY","orientationZ","threshold","Point2D","getDistance","point2D","getRound","round","minus","Point","get3D","values0","values1","mergeWith3D","startsWith","search","rawPos","pos","endsWith","getFlags","flags","regex","match","exec","replaceFlags","keys","valueObj","valueStr","toPrecision","unit","flag","replace","getFileExtension","filePath","ext","pathSplit","toLowerCase","pop","test","includes","stringToUint8Array","arr","Uint8Array","charCodeAt","precisionRound","number","precision","factor","delta","arraySortEquals","arr0","arr1","arrayEquals","sort","element","uint8ArrayToString","String","fromCharCode","findInArraySubset","callbackFn","start","end","getFindArrayInArrayCallback","buildMultipart","parts","boundary","lineBreak","partsSize","headers","headerStr","partKeys","header","byteLength","data","trailer","buffer","set","dictionary","addTagsToDictionary","group","tags","tagGroups","vr32bitVL","OB","OD","OF","OL","OV","OW","SQ","SV","UC","UN","UR","UT","UV","ox","is32bitVLVR","vr","vrCharSetString","SH","LO","ST","LT","PN","isCharSetStringVR","vrTypes","AE","AS","AT","CS","DA","DS","DT","FL","FD","IS","SL","SS","TM","UI","UL","US","Tag","getGroup","getElement","getKey","getNameFromDictionary","getGroupName","isWithVR","isPrivate","getInfoFromDictionary","getVrFromDictionary","getTagFromKey","getItemTag","isItemTag","tag","isSequenceDelimitationItemTag","getPixelDataTag","isPixelDataTag","getTagFromDictionary","tagName","keys0","keys1","foundTag","k0","lenK0","k1","lenK1","flipArrayEndianness","array","blen","u8","byteOffset","bpe","BYTES_PER_ELEMENT","DataReader","Int8Array","Int16Array","isNativeLittleEndian","isLittleEndian","DataView","readUint16","getUint16","readInt16","getInt16","readUint32","getUint32","readBigUint64","getBigUint64","readInt32","getInt32","readBigInt64","getBigInt64","readFloat32","getFloat32","readFloat64","getFloat64","readBinaryArray","bitArray","byteArrayLength","bitNumber","bitIndex","readUint8Array","readInt8Array","readUint16Array","Uint16Array","arraySize","readInt16Array","readUint32Array","Uint32Array","readUint64Array","BigUint64Array","readInt32Array","Int32Array","readInt64Array","BigInt64Array","readFloat32Array","readFloat64Array","Float64Array","readHex","toUpperCase","DataElement","vl","undefinedLength","startOffset","endOffset","items","getDwvVersion","hasDicomPrefix","reduce","previous","current","ZWS","DefaultTextDecoder","decode","result","getReverseOrientation","ori","rlabels","L","R","A","P","H","F","rori","getOrientationName","isImplicitTransferSyntax","syntax","isBigEndianTransferSyntax","isJpegBaselineTransferSyntax","isJpegLosslessTransferSyntax","isJpeg2000TransferSyntax","isRleTransferSyntax","getTypedArray","bitsAllocated","pixelRepresentation","RangeError","powerOf2","log","getDataElementPrefixByteSize","isImplicit","DicomParser","getDefaultCharacterSet","setDefaultCharacterSet","characterSet","setDecoderCharacterSet","TextDecoder","getDicomElements","reader","implicit","itemData","item","isSeqDelim","isItemDelim","offsetTableVl","readTagRes","is32bitVL","concat","isKnownVR","pixItemData","sqEndOffset","vrType","from","stream","lastIndex","trim","cleanString","raw","stri","stri1","subElement","elements","parse","dataElement","metaReader","dataReader","magicword","metaEnd","tsElement","firstDataElement","oEightGroupLittleEndian","vr0","vr1","guessTransferSyntax","isReadSupportedTransferSyntax","isJpegRetiredTransferSyntax","isJpeglsTransferSyntax","getTransferSyntaxName","charSetTerm","label","getUtfLabel","numberOfFrames","pixItems","nItemPerFrame","newPixItems","f","newBuffer","fragOffset","ListenerHandler","type","callback","remove","splice","fireEvent","event","stack","range","dataAccessor","maxIter","increment","blockMaxIter","blockIncrement","reverse1","reverse2","nextIndex","finalBlockIncrement","mainCount","blockCount","next","done","getIteratorValues","iterator","ival","getSliceIterator","image","position","isRescaled","viewOrientation","getGeometry","getSize","dirMax2Index","posValues","posStart","map","indexToOffset","getRescaledValueAtOffset","getValueAtOffset","ncols","nrows","nslices","sliceSize","getDimSize","ncomp","getNumberOfComponents","isPlanar","getPlanarConfiguration","getRange","iters","r0","r1","r2","range3d","rangeObj","dirMax0","dirMax2","simpleRange","componentIncrement","nextIndex1","nextIndex2","simpleRange3d","colourRange","colours","nextColourIndex","colour","RescaleSlopeAndIntercept","slope","intercept","getIntercept","Size","moreThanOne","dimension","canScroll3D","canScroll","getTotalSize","isInBounds","dirs","offsetToIndex","off","dimSize","get2D","Spacing","Geometry","origin","spacing","time","getInitialTime","getCurrentTotalNumberOfSlices","count","hasSlicesAtTime","getCurrentNumberOfSlicesBeforeTime","getOrigin","getOrigins","includesOrigin","getOrientedArray3D","geoSliceSpacing","getSliceGeometrySpacing","getSpacing","orientedValues","getRealSpacing","getOrientation","getSliceIndex","point","localOrigins","closestSliceIndex","minDist","dist","closestOrigin","pointDir","appendOrigin","equalToOrigin","find","appendFrame","sizeValues","spacingValues","isIndexInBounds","worldToIndex","indexToWorld","orientedPoint3D","pointToWorld","worldToPoint","getDeOrientedArray3D","origins","withCheck","invOrientation","origin1","origin2","sliceSpacing","deltas","diff","sumReducer","sum","mean","toFixed","getImage2DSize","rows","columns","getDate","daValue","monthBeginIndex","dayBeginIndex","year","monthIndex","day","getTime","tmValue","tmHours","tmMinutes","tmSeconds","tmFracSecondsStr","hours","minutes","seconds","milliseconds","checkTag","warning","TagValueExtractor","_elements","ImageFactory","checkElements","dataElements","create","pixelBuffer","numberOfFiles","size2D","frames","rowSpacing","columnSpacing","parseFloat","getPixelSpacing","jpeg2000","jpegBase","jpegLoss","imagePositionPatient","slicePosition","imageOrientationPatient","orientationMatrix","rowCosines","colCosines","normal","geometry","sopInstanceUid","siu","samplesPerPixel","spp","bufferSize","Image","photometricInterpretation","photo","setPhotometricInterpretation","planarConfiguration","setPlanarConfiguration","rescaleSlope","rescaleIntercept","meta","modality","Modality","isPetWithSuv","radioInfoSq","totalDoseStr","halfLifeStr","acqDateEl","acqTimeEl","acqDateObj","acqTimeObj","acqDate","Date","seriesDateEl","seriesTimeEl","seriesDateObj","seriesTimeObj","canGetSuvFactor","intensityFactor","radioStartDateTimeEl","radioStartDateObj","radioStartTimeObj","radioStartDateTime","dtValue","date","getDateTime","radioStart","totalDoseEl","halfLifeEl","patWeightEl","decaySeconds","decay","decayedDose","getSuvFactor","setRescaleSlopeAndIntercept","sopClassUID","SOPClassUID","studyUID","StudyInstanceUID","seriesUID","SeriesInstanceUID","bits","BitsStored","pixelRep","PixelRepresentation","IsSigned","pixelUnit","getPixelUnit","frameOfReferenceUID","FrameOfReferenceUID","windowPresets","windowCenter","windowWidth","windowCWExplanation","getPhotometricInterpretation","redLutElement","greenLutElement","blueLutElement","redLut","greenLut","blueLut","descriptor","doScale","descSize","vlSize","scaleTo8","clone","recommendedDisplayFrameRate","RecommendedDisplayFrameRate","setMeta","equalPosPat","pos1","pos2","JSON","stringify","tagDefinition","tagValue","isArray","enum","RequiredDicomSegTags","getDefaultDicomSegJson","reqTag","DicomCode","meaning","longValue","urnValue","schemeDesignator","getCode","code","MaskSegment","algorithmType","algorithmName","displayValue","propertyTypeCode","propertyCategoryCode","trackingUid","trackingId","getSegment","segment","cielabElement","rgb","gammaFunc","min","ciexyzToSrgb","invLabFunc","l0","cielabToCiexyz","cielabToSrgb","getSpacingFromMeasure","pixelSpacing","getSegmentFrameInfo","derivationImages","derivationImageSq","sourceImages","sourceImageSq","sourceImage","referencedSOPClassUID","referencedSOPInstanceUID","dimIndex","refSegmentNumber","imagePosPat","frameInfo","framePlaneOrientationSeq","frameImageOrientation","framePixelMeasuresSeq","frameSpacing","MaskFactory","_dicomElements","framesElem","orgSq","orgUID","indices","indexSqElem","indexSq","indexPointer","indexOrg","DimensionOrganizationUID","DimensionIndexPointer","DimensionDescriptionLabel","organizations","getDimensionOrganization","segSequence","segments","storeAsRGB","sharedFunctionalGroupsSeq","funcGroup0","planeOrientationSeq","pixelMeasuresSeq","includesPosPat","some","arrVal","findIndexPosPat","findIndex","perFrameFuncGroupSequence","frameInfos","framePosPats","p1","p2","getComparePosPat","point3DFromArray","frameOrigins","newSpacing","tmpGeometry","isNotSmall","REAL_WORLD_EPSILON","posPats","sliceIndex","frameOrigin","distPrevious","numberOfSlices","uids","getFindSegmentFunc","mul","sliceOffset","frameOffset","pixelValue","safeGet","StudyDate","StudyTime","StudyID","SeriesNumber","ReferringPhysicianName","PatientName","PatientID","PatientBirthDate","PatientSex","Manufacturer","ManufacturerModelName","DeviceSerialNumber","SoftwareVersions","DimensionOrganizationSequence","DimensionIndexSequence","custom","SOPInstanceUID","lossyImageCompression","LossyImageCompression","createImage","createMaskImage","imageUids","getImageUid","uid","getSecondaryOffset","containsImageUids","itemArr1","arrayContains","getBuffer","canQuantify","canWindowLevel","nFiles","getRescaleSlopeAndIntercept","isConstantRSI","inRsi","isIdentityRSI","interp","config","getMeta","getOffsets","offsets","equal","hasValues","finalValues","v1","equalFunc","getEqualCallback","valuesToFind","indicesToRemove","v","clonedBuffer","copy","tmpBuffer","appendSlice","rhsSize","rhsRange","getDataRange","rhsResRange","getRescaledDataRange","resRange","timeId","isNewFrame","volumeGeometry","sliceGeometry","fullBufferSize","fullSliceIndex","indexOffset","maxOffset","subarray","numberOfImages","rhsPresets","pkey","rhsPreset","windowPreset","perslice","appendFrameBuffer","frameBuffer","frameIndex","frameSize","calculateDataRange","calculateRescaledDataRange","getHistogram","calculateHistogram","dataRange","rescaledDataRange","histogram","addEventListener","removeEventListener","setAtOffsets","setAtOffsetsAndGetOriginals","offsetsLists","originalColoursLists","previousColour","originalColours","currentColour","setAtOffsetsWithIterator","getValueAtIndex","getRescaledValue","getRescaledValueAtIndex","resmin","resmax","rmin","rmax","rvalue","histo","convolute2D","weights","newImage","imgSize","dimOffset","convoluteBuffer","componentOffset","wOff","wOff00","wOff0x","wOff0n","wOffx0","wOffxn","wOffn0","wOffnx","wOffnn","pixelOffset","newValue","wOffFinal","wi","transform","operator","compose","ViewFactory","view","View","setColourMap","minmax","preset","setWindowPresets","init","viewEventNames","createView","getCurrentIndex","setCurrentIndex","getImage","setImage","inImage","setOrientation","mat33","setInitialIndex","getPlaybackMilliseconds","_value","_index","getAlphaFunction","setAlphaFunction","currentIndex","setWindowLevelPresetById","voiLut","voiLutWl","wc","ww","skipGenerate","getWindowPresets","getWindowPresetsNames","presets","addWindowPresets","getCurrentWindowPresetName","getColourMap","getCurrentPosition","canSetPosition","getScrollIndex","originIndex","setCurrentPosition","silent","valid","minLen","maxLen","posEvent","imageUid","pixValue","setWindowLevel","isNewWidth","isNewCenter","manual","setWindowLevelPreset","getWindowLevelMinMax","setWindowLevelMinMax","generateImageData","photoInterpretation","alphaFunc","windowLut","colourMap","pxValue","generateImageDataMonochrome","is16BitsStored","to8","generateImageDataPaletteColor","generateImageDataRgb","cb","cr","generateImageDataYbrFull","incrementIndex","incr","newIndex","decrementIndex","decrementScrollIndex","incrementScrollIndex","PlaneHelper","imageOrientation","targetOrientation","getTargetOrientation","getOffset3DFromPlaneOffset","offset2D","planeOffset","getTargetDeOrientedVector3D","getPlaneOffsetFromOffset3D","offset3D","getTargetOrientedVector3D","planeVector","getTargetDeOrientedPoint3D","planePoint","getImageOrientedVector3D","getImageOrientedPoint3D","getImageDeOrientedVector3D","getImageDeOrientedPoint3D","getTargetOrientedPositiveXYZ","getNativeScrollIndex","MaskSegmentHelper","mask","hasSegment","segmentNumber","maskHasSegments","numbers","unknowns","getSegments","setSegments","list","setHiddenSegments","isHidden","addToHidden","removeFromHidden","getAlphaFunc","hiddenColours","deleteSegment","cmdCallback","exeCallback","delcmd","DeleteSegmentCommand","onExecute","onUndo","isValid","execute","getName","segmentnumber","undo","_event","ViewController","dataId","getPlaneHelper","isMask","getMaskSegmentHelper","applyHiddenSegments","setViewAlphaFunction","initialise","getPositionFromPlanePoint","getModality","getWindowLevelPresetsNames","addWindowLevelPresets","isPlaying","getCurrentOrientedIndex","getCurrentScrollIndexValue","getCurrentScrollPosition","scrollIndex","img","get2DSpacing","getRescaledImageValue","getImageRegionValues","rescaled","sliceValues","sliceOrigin","iter","rangeNumberOfColumns","regionSize","regionOffset","regionElementCount","rangeRegion","getRegionSliceIterator","getImageVariableRegionValues","regions","offsetRegions","region","regionIndex","regionCount","rangeRegions","getVariableRegionSliceIterator","canQuantifyImage","getImageSize","getImageWorldSize","getImageRescaledDataRange","equalImageMeta","imageMeta","metaKeys","metaKey","getPlanePositionFromPosition","getPlanePositionFromPlanePoint","play","window","setInterval","canDoMore","stop","clearInterval","dataid","InteractionEventNames","customUI","openRoiDialog","textExpr","prompt","getTouchesPositions","touches","offsetLeft","offsetTop","target","offsetParent","positions","pageX","pageY","getEventOffset","targetTouches","changedTouches","offsetX","offsetY","canCreateCanvas","height","testCvs","document","createElement","cropCvs","testCtx","getContext","cropCtx","fillRect","drawImage","getImageData","ViewLayer","containerDiv","className","getDataId","setImageSmoothing","setView","getViewController","onimageset","onimagechange","getId","getBaseSize","getOpacity","setOpacity","alpha","addFlipOffsetX","addFlipOffsetY","flipScaleX","flipScaleY","flipScaleZ","setScale","newScale","helper","orientedNewScale","finalNewScale","resetOffset","worldCenter","newOffset","getScaledOffset","newZoomOffset","setBaseOffset","scrollOffset","needsUpdate","setOffset","planeNewOffset","displayToPlaneIndex","planePos","displayToPlanePos","displayToPlaneScale","deScaled","planePosToDisplay","posX","posY","displayToMainPlanePos","display","style","isVisible","draw","layerid","globalAlpha","clear","setTransform","imageSmoothingEnabled","appendChild","alert","clearRect","createImageData","fitToContainer","fitScale1D","fitSize","fitOffset","needsDraw","newFitScale","newViewOffset","newFlipOffset","bindInteraction","pointerEvents","names","passive","unbindInteraction","srclayerid","putImageData","dims3D","indexScrollIndex","filter","save","restore","Style","getFontFamily","getFontSize","getStrokeWidth","getTextColour","getLineColour","setLineColour","setBaseScale","scale","setZoomScale","getBaseScale","getZoomScale","applyZoomScale","getShadowOffset","getTagOpacity","getTextPadding","getFontStr","getLineHeight","getScaledFontSize","getScaledStrokeWidth","getShadowLineColour","getShapeDisplayName","shape","displayName","Konva","points","DrawGroupCommand","layer","getParent","getKonvaLayer","MoveGroupCommand","translation","move","minusTrans","ChangeGroupCommand","startAnchor","endAnchor","viewController","update","DeleteGroupCommand","DrawMeta","quantification","DrawDetails","color","isNodeNameShape","node","isNodeNameShapeExtra","isNodeNameLabel","isPositionNode","isNodeWithId","canNodeChangeColour","DrawController","drawLayer","getCurrentPosGroup","posGroups","getChildren","posGroup","visible","reset","findOne","activateDrawLayer","getDrawDisplayDetails","groups","lenj","collec","text","shapeExtrakids","closed","extraName0","stroke","getDrawStoreDetails","drawingsDetails","posKids","anchors","texts","setDrawings","drawings","statePosGroups","statePosGroup","statePosKids","stateGroup","cmd","details","getText","setText","updateDraw","drawDetails","shapes","shapesExtra","shadowColor","kids","setVisible","deleteDrawGroup","shapeDisplayName","deleteDraw","deleteDraws","shapeGroups","getNumberOfDraws","DrawLayer","getKonvaStage","getLayers","getDrawController","setPlaneHelper","opacity","container","listening","getContent","setAttribute","konvaLayer","previousScale","previousFitScale","isGroupVisible","toggleGroupVisibility","ratioX","ratioY","labels","getLayerDetailsFromLayerDivId","idString","groupDivId","layerId","getLayerDetailsFromEvent","layerDiv","closest","indexCenter","LayerGroup","getShowCrosshair","setShowCrosshair","getDivId","getScale","getAddedScale","getOffset","getNumberOfLayers","forEach","getNumberOfViewLayers","getActiveViewLayer","tmpLayer","getViewLayersByDataId","searchViewLayers","getViewDataIndices","getActiveDrawLayer","getDrawLayersByDataId","setActiveViewLayer","setActiveViewLayerByDataId","setActiveDrawLayer","setActiveDrawLayerByDataId","addViewLayer","viewLayerIndex","div","append","addDrawLayer","viewLayer","updateLayersToPositionChange","eventName","empty","getElementsByClassName","removeLayer","numberOfDraws","getElementById","baseLayer","p2D","displayPos","lineH","offsetWidth","left","top","lineV","offsetHeight","baseViewLayerOrigin0","baseViewLayerOrigin","hasSetOffset","vc","origin0","zeroOffset","scrollDiff","planeDiff","hasSetPos","calculateFitScale","maxSize","getMaxSize","setFitScale","scaleIn","containerSize","addScale","scaleStep","addTranslation","binderList","WindowLevelBinder","getEventType","getCallback","layerGroup","viewLayers","PositionBinder","pointValues","currentPos","currentDims","inputDims","ZoomBinder","OffsetBinder","OpacityBinder","ColourMapBinder","Stage","getLayerGroup","getNumberOfLayerGroups","getActiveLayerGroup","setActiveLayerGroup","addLayerGroup","htmlElement","isBound","unbindLayerGroups","bindLayerGroups","getLayerGroupByDivId","setBinders","removeLayerGroup","syncLayerGroupScale","minScale","hasScale","binder","binderObj","elem","State","toJSON","app","drawController","version","toObject","fromJSON","json","baseScale","scaleCenter","originX","originY","oldTx","oldTy","render","getDataIds","v02DAndD","inputDrawings","newDrawings","drawGroups","drawGroup","lenk","lenf","newFrameDrawings","leng","kshape","ktick0","ktick1","karcs","ktexts","ktext","klabel","txtLen","quant","surface","angle","longText","v01Tov02DrawingsAndDetails","v02Tov03Drawings","v03Tov04DrawingsDetails","v04Tov05Data","v04Tov05Drawings","groupDetails","v02Tov03DrawingsDetails","groupShapes","parentGroup","groupDrawings","currentPosition","draggable","gnode","detail","children","ids","attrs","sliceNumber","frameNumber","newId","getUrlFromUri","uri","URL","location","splitUri","sepIndex","base","hashIndex","query","pairs","pair","splitKeyValueString","UndoStack","getStackSize","getCurrentStackIndex","command","redo","ToolboxController","toolList","getToolList","hasTool","getSelectedTool","getSelectedToolEventHandler","eventType","setSelectedTool","activate","setToolFeatures","setFeatures","bindLayerGroup","divId","layerGroupDivId","applySelectedTool","_x","_y","_x1","_y1","augmentEventOffsets","MultiProgressHandler","setNumberOfDimensions","num","setNToLoad","onprogress","lengthComputable","subindex","percent","loaded","total","source","lenprog","getMonoProgressHandler","getUndefinedMonoProgressHandler","UrlsLoader","request","loader","onload","onloadend","load","options","onloadstart","status","onerror","responseURL","statusText","response","mproghandler","loaders","loaderList","foundLoader","canLoadUrl","setOptions","defaultCharacterSet","onloaditem","onabort","lastRunRequestIndex","requestOnLoadEnd","send","XMLHttpRequest","open","requestHeaders","setRequestHeader","withCredentials","errorCallback","abortCallback","loadUrlAs","responseType","batchSize","dicomDirUrl","urls","parser","dirSeq","records","series","study","recType","refFileIds","join","getFileListFromDicomDir","rootUrl","fullUrls","abort","readyState","isLoading","ThreadPool","poolSize","taskQueue","freeThreads","WorkerThread","runningThreads","addWorkerTask","workerTask","onworkstart","workerThread","shift","run","onworkend","onTaskEnd","onwork","handleWorkerError","onworkitem","parentPool","random","runningTask","worker","Worker","script","onmessage","postMessage","startMessage","terminate","itemNumber","numberOfItems","WorkerTask","message","hasJpegBaselineDecoder","JpegImage","hasJpegLosslessDecoder","jpeg","lossless","hasJpeg2000Decoder","JpxImage","decoderScripts","rle","AsynchPixelBufferDecoder","_numberOfData","pixelMeta","ondecodestart","ondecodeditem","ondecoded","ondecodeend","SynchPixelBufferDecoder","algoName","numberOfData","decoder","decodedBuffer","buf","Decoder","decoded","getData","tiles","dwvdecoder","RleDecoder","PixelBufferDecoder","DicomBufferToView","opt","dataIndex","decodedData","fullSize","convert","dicomParser","algo","getSyntaxDecompressionName","needDecompression","columnsElement","rowsElement","samplesPerPixelElement","planarConfigurationElement","MemoryLoader","canLoadMemory","filename","imageDataToBuffer","imageData","dataLen","getDefaultImage","imageBuffer","imageSize","imageSpacing","canLoadFile","file","url","isDicom","urlObjext","pathname","hasNoExt","hasDcmExt","contentType","searchParams","mem","loadFileAs","fileContentTypes","ArrayBuffer","_opt","isJson","Text","memoryIO","progress","u8Array","partHeaderEndCb","partHeaderEndIndex","lines","boundaryStr","boundaryCb","boundaryLen","nextBoundaryIndex","part","partHeaderLines","line","semiColonIndex","dataBeginIndex","dataEndIndex","parseMultipart","_file","isMultipart","_mem","dataType","imageType","Blob","createObjectURL","domImage","canvas","ctx","lastModified","getViewFromDOMImage","src","isImage","hasImageExt","DataURL","bytes","videoDataStr","btoa","video","onloadedmetadata","videoWidth","videoHeight","ceil","duration","onseeked","imgBuffer","storeFrame","nextTime","currentTime","getViewFromDOMVideo","isVideo","content","unzipPercent","async","then","JSZip","zip","isZip","FilesLoader","FileReader","readAsText","readAsDataURL","readAsArrayBuffer","LoadController","loadFiles","files","loadURLs","loadImageObject","fileIO","urlIO","loadType","eventInfo","loadtype","isFirstItem","eventInfoItem","isfirstitem","ImageData","DataController","getNextDataId","getDataIdsFromSopUids","addNew","dataToUpdate","idKey","obj1","obj2","valueKey","mergedObj1","merged","id1","id2","keys2","value1","subValue1","value2","subValue2","mergeObjects","getNumberToPrecision","createDefaultReplaceFormat","OverlayData","configs","addAppListeners","addItemMeta","dataUid","dicomElements","overlays","modElement","overlay","format","poElement","po0","po1","createOverlayData","DOM","infoKeys","createOverlayDataForDom","sliceOverlayData","mapFunc","isListening","removeAppListeners","ScrollWheel","wheel","scrollMin","deltaMode","deltaY","up","layerDetails","i18n","t","props","mm","cm2","degree","Line","begin","getBegin","getEnd","getDeltaX","getDeltaY","getWorldLength","spacingX","spacingY","wlen","dxs","dys","getMidpoint","getInclination","atan2","PI","quantify","getAngle","line0","line1","dx0","dy0","dx1","dy1","dot","getPerpendicularLine","beginX","beginY","endX","endY","dx","Statistics","stdDev","median","p25","p75","getStats","includesFullStatsFlags","stats","getSimpleStats","getPercentile","getFullStats","sumSqr","variance","ratio","i0","v0","guid","getDefaultAnchor","radius","absRadius","strokeWidth","strokeScaleEnabled","radiusX","radiusY","dragOnTop","ShapeEditor","setFactoryList","setShape","inshape","isFactoryGroup","getShape","isActive","setDrawEventCallback","enable","getLayer","disable","resetAnchors","anchor","setAnchorsActive","getAnchors","getStyle","parent","on","cancelBubble","stageSize","boundNodePosition","validateAnchorPosition","chgcmd","addToUndoStack","moveToTop","changed","ROI","getPoint","addPoint","addPoints","defaults","labelText","arrow","circle","ellipse","freeHand","protractor","rectangle","roi","ruler","RoiFactory","getNPoints","getTimeout","fontSize","fontFamily","px","py","_viewController","kroi","textPos","Path","inputPointArray","inputControlPointIndexArray","pointArray","controlPointIndexArray","isControlPoint","addControlPoint","newPointArray","appenPath","other","oldSize","indexArray","BucketQueue","cost_functor","bucketCount","loc","cost","buckets","buildArray","bucket","getBucket","ret","isEmpty","newSize","__twothirdpi","gradUnitVector","gradX","gradY","out","oy","gvm","Scissors","curPoint","searchGranBits","searchGran","pointsPerPost","greyscale","laplace","gradient","parents","working","trained","trainingPoints","edgeWidth","trainingLength","edgeGran","edgeTraining","gradPointsNeeded","gradGran","gradTraining","insideGran","insideTraining","outsideGran","outsideTraining","getTrainingIdx","granularity","getTrainedEdge","edge","getTrainedGrad","grad","getTrainedInside","inside","getTrainedOutside","outside","setWorking","setDimensions","setData","dy","gradMagnitude","lap","computeGreyscale","computeLaplace","computeGradient","computeGradX","computeGradY","sides","guv","ix","iy","computeSides","findTrainingPoints","resetTraining","doTraining","calculateTraining","addInStaticGrad","input","output","maxVal","idx","len","gaussianBlur","have","need","gradDirection","qx","qy","__dgpuv","__gdquv","dp","dq","SQRT1_2","acos","dir","adj","sx","sy","ex","ey","setPoint","sp","visited","MAX_VALUE","pq","doWork","timeout","pointCount","newPoints","adjList","q","pqCost","Circle","centre","getCenter","getRadius","getSurface","getWorldSurface","mulABC","centerX","centerY","rSquare","maxY","transX","quantif","Ellipse","getA","getB","radiusRatio","rySquare","getEllipseIndices","centerValues","radiusI","radiusJ","radiusJ2","di","dj","jmax","jmin","imax","imin","Rectangle","getRealWidth","getRealHeight","getWidth","getHeight","Threshold","getMin","setMin","getMax","setMax","setOriginalImage","getOriginalImage","imageMin","Sharpen","Sobel","RunFilterCommand","setLastImage","defaultToolList","mousedown","x0","y0","mousemove","diffX","diffY","pixelToIntensity","WindowLevelValues","mouseup","mouseout","touchstart","touchmove","touchend","dblclick","keydown","context","onKeydown","_bool","Scroll","yMove","xMove","setTimeout","clearTimeout","span","parentElement","createTextNode","features","displayTooltip","ZoomAndPan","twotouchdown","point0","point1","midPoint","tx","ty","twotouchmove","lineRatio","zoom","step","Opacity","op","Draw","trashLine1","trashLine2","loadDrawing","dbObject","shapeName","x1","y1","x2","y2","stage","getIntersection","selectedShape","getUpdateParent","timer","shapeGroup","destroy","tmpPoints","viewLayerId","finalPoints","updateParent","finalShapeGroup","setShapeOn","body","cursor","mouseOnShape","dragStartPos","invscale","anchorMin","minX","minY","getAnchorMin","validateGroupPosition","updateQuantification","evt","eventPos","trashHalfWidth","scaleX","trashHalfHeight","scaleY","tshape","ashape","mvcmd","currentTarget","groupId","getOptionsType","autoShapeColour","shapeColour","hasShape","mouseOverCursor","withScroll","getEventNames","listener","Filter","bool","getSelectedFilter","filterName","hasFilter","args","runArgs","getFilterList","Floodfill","setExtend","getExtend","simple","MagicWand","cs","icsl","extend","ini","jl","modifyThreshold","setPoints","onThresholdChange","getAbsoluteScale","movedpoint","Livewire","pn","p0","results","_p","_q","toolOptions","ArrowFactory","linePerp0","linePerp1","hitFunc","beginPath","moveTo","lineTo","closePath","fillStrokeShape","beginTy","verticalLine","angleRad","kpoly","sin","cos","rotation","padding","shadowOffset","dX","dY","kline","ktriangle","bx","by","p2d0","p2d1","p2b","p2e","CircleFactory","_style","kcircle","right","bottom","centerPoint","kshadow","maxX","pixelLine","EllipseFactory","ellipseX","ellipseY","kellipse","radiusAbs","FreeHandFactory","tension","ProtractorFactory","pointsArray","inclination","midX","midY","karc","innerRadius","outerRadius","mid","mx","my","p2d2","arcPos","RectangleFactory","rectX","rectY","rectWidth","rectHeight","krect","topLeft","topRight","bottomRight","bottomLeft","rect","rWidth","rHeight","RulerFactory","tickLen","ThresholdFilter","getLastImage","_args","SobelFilter","SharpenFilter","ViewConfig","ToolConfig","AppOptions","dataViewConfigs","tools","binders","viewOnFirstLoadItem","overlayConfig","App","dataIds","lastId","addNewImage","getMetaData","getToolboxController","appToolList","toolName","toolConstructor","toolParams","appToolOptions","optionName","optionClassName","toolNamespace","charAt","resetLayout","loadFromUri","getUriQuery","onLoadEnd","state","protocol","host","decodeURIComponent","manifest","rootURL","getElementsByTagName","getAttribute","patientList","studyList","seriesList","instanceList","link","decodeManifest","responseXML","decodeManifestQuery","replaceMode","repeatKeyReplaceMode","queryUri","inputQueryPairs","repeatKey","repeatList","baseUrl","gotOneArg","decodeKeyValueUri","dwvReplaceMode","decodeQuery","abortLoad","initWLDisplay","getViewConfigs","excludeStarConfig","getViewConfig","getDataViewConfigs","setDataViewConfigs","addDataViewConfig","removeDataViewConfig","itemIndex","lg","vls","dls","updateDataViewConfig","configToUpdate","dataKeys","divIds","viewConfigs","viewConfig","setLayerGroupsBinders","instances","cx","cy","translate","getJsonState","applyJsonState","jsonState","onResize","defaultOnKeydown","ctrlKey","shiftKey","resetDisplay","resetZoom","setTool","toolObject","tool","setUpdateParent","getDatabaseObjects","setDatabaseObjects","databaseObjects","populateDatabaseObjects","getOverlayData","toggleOverlayListeners","isFirstLoadItem","eventMetaData","imageGeometry","getViewOrientation","matrix","getMatrixFromName","isBaseLayer","spacing2D","flipFlags","viewConfigOrientation","orientationCode","v2","getOrientationStringLPS","isViewUndefined","isViewAxial","isViewCoronal","isViewSagittal","flipOffset","flipScale","DataWriter","writeUint8","setUint8","writeInt8","setInt8","writeUint16","setUint16","writeInt16","setInt16","writeUint32","setUint32","writeUint64","setBigUint64","writeInt32","setInt32","writeInt64","setBigInt64","writeFloat32","setFloat32","writeFloat64","setFloat64","writeHex","writeBinaryArray","byte","writeUint8Array","writeInt8Array","writeUint16Array","writeInt16Array","writeUint32Array","writeUint64Array","writeInt32Array","writeInt64Array","writeFloat32Array","writeFloat64Array","_uidCount","WriterRule","action","getUID","prefix","getDwvUIDPrefix","datePart","toISOString","countPart","nonTagLength","tagNumber","isEven","isStringVr","uint8ArrayPush","newArr","DefaultTextEncoder","encode","DicomWriter","setUseUnVrForPrivateSq","default","setRules","rules","useSpecialTextEncoder","TextEncoder","useDefaultAnonymisationRules","Acquisition","Procedure","getElementToWrite","groupName","rule","writer","itemKeys","itemElement","itemDelimElement","hexString","hexString1","hexString2","atValue","finalValue","initialArray","initialArrayLength","arrayLength","flattenendArrayLength","flattenedArray","indexFlattenedArray","flattenArrayOfTypedArrays","isTagWithVR","undefinedLengthSequence","undefinedLengthItem","seqDelimElement","isBigEndian","oldscs","totalSize","localSize","metaElements","rawElements","metaLength","fmiglTag","fmivTag","icUIDTag","ivnTag","originalElement","checkUnknownVR","fmiv","getDataElement","fmivSize","icUID","icUIDSize","ivn","ivnSize","elemSortFunc","tagCompareFunction","fmigl","fmiglSize","metaWriter","dataWriter","metaOffset","newItems","oldItemElements","newItemElements","subSize","itemKey","padStr","pad","getVrPad","padOBValue","isTypedArrayVr","itemPrefixSize","getBpeForVrType","dictVr","getElementsFromJSONTags","jsonTags","jsonTag"],"sourceRoot":""}